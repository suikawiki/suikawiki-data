[1] 
[DFN[[RUBYB[[RUBY[表][ひょう][テーブル]]][table]]]]は、
[[TrueType]] / [[OpenType]]
[[フォント]]の[[データ構造]]の基本単位の1つです。

* 仕様書

[REFS[
- 
[2] 
[CITE@ja-jp[Advanced typographic tables - OpenType Layout (OpenType 1.9) - Typography | [[Microsoft]] Docs]], [[PeterCon]], [TIME[2022-08-28T02:24:32.000Z]] <https://docs.microsoft.com/ja-jp/typography/opentype/spec/ttochap1#opentype-layout-tables>
-
[5] 
[CITE@ja-jp[OpenType font file (OpenType 1.9) - Typography | [[Microsoft]] Docs]], [[PeterCon]], [TIME[2022-08-28T12:09:17.000Z]] <https://docs.microsoft.com/ja-jp/typography/opentype/spec/otff#data-types>
-
[18] 
[CITE@ja-jp[OpenType font file (OpenType 1.9) - Typography | [[Microsoft]] Docs]], [[PeterCon]], [TIME[2022-08-29T08:35:09.000Z]] <https://docs.microsoft.com/ja-jp/typography/opentype/spec/otff#font-tables>
-
[4] 
[CITE@ja-jp[TSI table specifications - Typography | [[Microsoft]] Docs]], [[robmck-ms]], [TIME[2022-08-28T02:26:40.000Z]] <https://docs.microsoft.com/ja-jp/typography/tools/vtt/tsi-tables>

]REFS]

* 意味

[6] 
[[OpenType]] では[RUBYB[[[欄]]][field]]を持った[[構造][データ構造]]に[[表]]と[[記録]]があり、
これらが [[OpenType]] [[ファイル]]の主要な構成要素になっています。

[7] 
[DFN[[RUBY[表][ひょう][table]]]]は一般に [[offset]] で参照されるものです。
[SRC[>>5]]

[8] 
[DFN[[RUBYB[[RUBY[記][き]][RUBY[録][ろく]]][record]]]]は親構造中に順序に従って出現するものです。
[SRC[>>5]]

[9] 
[[表][OpenType表]]から [[offset]] で参照される他の[[表][OpenType表]]は[DFN[[RUBYB[[RUBY[部][ぶ]][RUBY[分][ぶん]][RUBY[表][ひょう]]][subtable]]]]と呼ばれています。
曖昧でない時は[[部分表]]も[[表]]と呼ばれています。
文脈なく[[表]]というときはたいていは[[フォント]]の最上位の構造に相当する[[表]]のことを指しています。

* offset

[10] 
[[OpenType]]
における
[DFN[[CODE[Offset16]]]],
[DFN[[CODE[Offset24]]]],
[DFN[[CODE[Offset32]]]]
は、それぞれ
[CODE[uint16]],
[CODE[uint24]],
[CODE[uint32]]
で,
[[部分表]]への [[offset]] (位置の差分) を表しています。
[SRC[>>5]]

[11] 
[[offset]] の[[起算点]]は[[欄]]によって違い、
[[仕様書]]の関係するところで一々[[規定]]されています。
大抵はその [[offset]] が出現した[[部分表]]の先頭を [N[0]]
と数えています。

[12] 
[[offset]] 値は [N[0]] とすることができ、
[DFN[[CODE[NULL]]]]
値と呼ばれています。
[SRC[>>5]]

[13] 
[CODE[NULL]] 値を使えるかどうかは[[欄]]によって違い、
[[仕様書]]の関係するところで一々[[規定]]されています。
[SRC[>>5]]

[14] 
[[フォント]]が[[不適合]]な場合は使えないところでも [CODE[NULL]]
が使われる場合がありますから、
[[フォント]]を解釈する実装はそれを想定しておく[RUBYB[べき][should]]です。
[SRC[>>5]]
そうしなければ参照元の[[部分表]]自体が参照されていることになりますから、
処理がおかしくなってしまいます。

[15] 
[[フォント]]ファイル中の[[表]]の配置位置は決まっていません。
[[符号無し整数]]なので[[起算点]]より前には置けませんし、
[[offset]] 欄のビット数で表せる最大の位置よりも後には置けませんが、
その中間の好きな位置に置けます。
複数の [[offset]] 値が同じ位置を参照することもできます。

[EG[
[16] 
例えば複数の [[lookup]] が同等の [CODE[Coverage]] を使いたければ、
同じものを2つ配置する必要はなく、
それらより後に1つだけ配置して、どちらにもその先頭を指すような [[offset]]
を設定することができます。 [[offset]] の値は違うかもしれませんが、
参照元の[[起算点]] + [[offset]] が同じ値になります。

]EG]


[17] 
[[フォント]]ファイルを解釈する実装は、
[[バッファー溢れ]]等、
不正な[[メモリー操作]]が発生しないよう注意が必要です。
[[フォント]]ファイルは壊れているかもしれませんし、
不正なデータかもしれません。




* 表の一覧

[FIG(table)[ [3] [[OpenType]] [[表]]

:tag: [[タグ][OpenTypeタグ]]
:o:[[OpenType]] [SRC[>>19]]
:l:[[OpenType Layout]] [SRC[>>2]]
:v:[[Visual TrueType]] [SRC[>>4]]

:tag: [CODE[BASE]]
:l:○

:tag: [CODE[CBDT]]
:o: [[bitmap glyph]]

:tag: [CODE[CBLC]]
:o: [[bitmap glyph]]

:tag: [CODE[CFF ]]
:o: [[CFF outline]] (準必須)

:tag: [CODE[CFF2]]
:o: [[CFF outline]] (準必須)

:tag: [CODE[cmap]]
:o:必須

:tag: [CODE[cvt ]]
:o: [[TrueType outline]]

:tag: [CODE[EBDT]]
:o: [[bitmap glyph]]

:tag: [CODE[EBLC]]
:o: [[bitmap glyph]]

:tag: [CODE[EBSC]]
:o: [[bitmap glyph]]

:tag: [CODE[fpgm]]
:o: [[TrueType outline]]

:tag: [CODE[gasp]]
:o: [[TrueType outline]]


:tag: [CODE[GDEF]]
:l:○

:tag: [CODE[glyf]]
:o: [[TrueType outline]] (必須)

:tag: [CODE[GPOS]]
:l:○

:tag: [CODE[GSUB]]
:l:○

:tag: [CODE[head][head (OpenType)]]
:o:必須

:tag: [CODE[hhea]]
:o:必須

:tag: [CODE[hmtx]]
:o:必須

:tag: [CODE[JSTF]]
:l:○

:tag: [CODE[loca]]
:o: [[TrueType outline]] (必須)

:tag: [CODE[maxp]]
:o:必須

:tag: [CODE[name][name (OpenType)]]
:o:必須

:tag: [CODE[OS/2][OS/2 (OpenType)]]
:o:必須

:tag: [CODE[post][post (OpenType)]]
:o:必須

:tag: [CODE[prep]]
:o: [[TrueType outline]]

:tag: [CODE[sbix]]
:o: [[bitmap glyph]]

:tag: [CODE[SVG ]]
:o: [[SVG outline]]

:tag: [CODE[TSI0]]
:v:○

:tag: [CODE[TSI1]]
:v:○

:tag: [CODE[TSI2]]
:v:○

:tag: [CODE[TSI3]]
:v:○

:tag: [CODE[TSI4]]
:v:廃止

:tag: [CODE[TSI5]]
:v:○

:tag: [CODE[TSIB]]
:v:廃止

:tag: [CODE[TSIC]]
:v:○

:tag: [CODE[TSID]]
:v:廃止

:tag: [CODE[TSIJ]]
:v:廃止

:tag: [CODE[TSIP]]
:v:廃止

:tag: [CODE[TSIS]]
:v:廃止

:tag: [CODE[VORG]]
:o: [[CFF outline]]

]FIG]


* メモ