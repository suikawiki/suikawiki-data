* 仕様書

[REFS[
- [20] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-04-25 04:40:19 +09:00]] 版) <https://html.spec.whatwg.org/#read-html>
- [14] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2014-08-06 23:12:09 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#the-input-byte-stream>
]REFS]

* 概念

[FIG(short list)[
- [[入力バイトストリーム]]
- [[文字符号化]]
-- [[ASCII互換文字符号化]]
-- [[UTF-16符号化]]
- [[文字符号化宣言]]
- [[確信度]]
- [[文字コード指定メニュー]]
- [[encoding sniffing algorithm]]
- [[a known definite encoding]]

]FIG]


* [CODE(MIME)@en[charset]] 引数

[21] [CODE(MIME)@en[[[charset]]]] [[引数]]は、 [[sniffed MIME type]] ではなく、
元々の [[MIME型]]の指定から得ます [SRC[>>20]]。

* テストケース

[REFS[
- [15] [CITE[Index of /~wakaba/test/web/html/charset]] ([TIME[2014-08-09 02:05:02 +09:00]] 版) <http://suika.suikawiki.org/~wakaba/test/web/html/charset/>
]REFS]

[31] [[HTML documents misinterpreted by charset sniffer]]

* 歴史

[33] 
[CITE[Welcome to Netscape Navigator 3.0]], [TIME[2024-08-16T11:57:20.000Z]], [TIME[2002-06-30T20:20:49.244Z]] <https://web.archive.org/web/20020630200918/http://wp.netscape.com/eng/mozilla/3.0/relnotes/windows-3.0.html#International>


[1] [CITE@en[Web Applications 1.0 r7544     More detail on the inheritance of encodings from parent browsing contexts.]]
( ([TIME[2012-11-25 14:33:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7543&to=7544>

[2] [CITE@en[Web Applications 1.0 r7958     New encoding defaults based on more data.]]
( ([TIME[2013-06-12 13:49:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7957&to=7958>

[3] [CITE@en[Web Applications 1.0 r8073 Provide a hook for XHR and web components to incrementally decode with a known encoding]]
( ([TIME[2013-07-20 03:35:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8072&to=8073>

[4] [CITE@en[Web Applications 1.0 r8258     Add some more locales to the default encoding logic.]]
( ([TIME[2013-11-07 06:38:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8257&to=8258>

[5] [CITE@en[Web Applications 1.0 r8259     Add greek to the default encoding logic.]]
( ([TIME[2013-11-07 06:42:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8258&to=8259>

[6] [CITE@en[Attachment #8336745 for bug #910211]]
( ([TIME[2013-11-23 17:34:23 +09:00]] 版))
<https://bugzilla.mozilla.org/attachment.cgi?id=8336745&action=diff#a/dom/encoding/domainsfallbacks.properties_sec2>

[7] [CITE[IRC logs: freenode / #whatwg / 20131127]]
( ([TIME[2013-11-28 18:40:54 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20131127#l-273>

[8] [CITE[''''''[''''''whatwg'''''']'''''' Guessing the fallback encoding from the top-level domain name before trying to guess from the browser localization]]
( ([TIME[2013-12-19 14:28:30 +09:00]] 版))
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2013-December/041819.html>

[9] [CITE[Bug 126375 – Consider using top-level domain name for encoding sniffing]]
( ([TIME[2014-01-03 14:06:33 +09:00]] 版))
<https://bugs.webkit.org/show_bug.cgi?id=126375>

[10] [CITE@en[Web Applications 1.0 r8512 Adjust some internal comments regarding encodings]]
( ([TIME[2014-02-26 03:33:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8511&to=8512>



* 実装

[16] テストケース (>>15) によると ([TIME[2014-08-09T02:27:16.900Z]])、
- [17] [[Chrome]] は [[change the encoding]] で[[文字符号化]]を変更しても、
[[navigate]] を再実行しないようです。 ([[非ASCII文字]]が[[文字符号化宣言]]より前にあると、
[[文字化け]]したまま残ります。) [[Firefox]] は [[navigate]] を再実行します。
- [18] [[Chrome]] は prescan を実行しないようです。 [[Firefox]]
は実行するようです。
- [19] [[Chrome]] も [[Firefox]] も、[[文字符号化宣言]]が [CODE(JS)@en[[[document.write]]]]
由来の時、 [[change the encoding]] しないようです。ただし [[Chrome]] は[[タグ]]の先頭文字、
[[Firefox]] は末尾文字が [CODE(JS)@en[[[document.write]]]] 内かどうかで判断しているようです。

* 関連

[13] [[Encoding Standard]], [[参照処理モデル]], [[XMLにおける文字コード]],
[[MIME charset]] も参照してください。

* メモ


[25] [CITE@en[Update integration with Encoding Standard · whatwg/html@6a31c26]]
([TIME[2016-02-14 18:47:07 +09:00]] 版)
<https://github.com/whatwg/html/commit/6a31c26cf12e39dab1a488e75dd56c03d6786d39>

[26] [CITE@en[Regression: do not use "get an output encoding" for decoding · whatwg/html@c36f738]]
([TIME[2016-04-26 20:51:26 +09:00]] 版)
<https://github.com/whatwg/html/commit/c36f7384f1f617b13c68d28b89d850cb18ceadfb>


[30] [CITE@en[Require UTF-8]]
([[sideshowbarker]]著, [TIME[2017-10-06 19:09:17 +09:00]])
<https://github.com/whatwg/html/commit/fae77e3c558b9f083dfb9086752863a4789268f5>

[32] [CITE@en[Give browsing context an explicit container]]
([[annevk]], [TIME[2019-11-22 17:11:31 +09:00]], [TIME[2022-01-13T10:26:34.000Z]])
<https://github.com/whatwg/html/commit/7b4964ad0a953b05738afc66600fa47a4dc8045d>
