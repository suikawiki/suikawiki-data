[11] [DFN[[RUBYB[[[現職設定群オブジェクト]]]@en[incumbent settings object]]]]は、
[[起源]]のチェックなどに用いられる[[スクリプト設定群オブジェクト]]です。

* 仕様書

[REFS[
- [9] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-04-03 03:44:44 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#incumbent-settings-object>
]REFS]

* 定義

[19] [DFN[[RUBYB[[[現職設定群オブジェクト]]]@en[incumbent settings object]]]]は、
次のようにして得られるものです [SRC[>>9]]。

[FIG(steps)[
= [20] [VAR[結果]]を、 [CODE[[[GetActiveScriptOrModule]]()]]
[[抽象操作]]の結果に設定します。
= [21] [VAR[結果]]が null なら、
== [22] [[現職設定群オブジェクト]]はありません。
= [23] それ以外なら、
== [24] [VAR[結果]]の [CODE[[F(ss)[[[HostDefined]]]]]] 
の[[スクリプト]]の[F[[[設定群オブジェクト]]]]を返します。
]FIG]

[HISTORY[
[10] [DFN[[RUBYB[[[現職設定群オブジェクト]]]@en[incumbent settings object]]]]は、
[[スクリプト設定群オブジェクトのスタック]]に一番最近追加された[[スクリプト設定群オブジェクト]]です。
[[スクリプト設定群オブジェクト]]がなければ、[[現職設定群オブジェクト]]はありません。 [SRC[>>9]]
]HISTORY]

* 性質

[13] [[入口設定群オブジェクト]]は、[[スクリプト設定群オブジェクトのスタック]]のうち[[候補入口設定群オブジェクト]]とされているもののみから一番最近のものを選んでいますから、
[[現職設定群オブジェクト]]と同じになることもあれば、違うこともあります。

[14] [[スクリプト設定群オブジェクトのスタック]]は[[関連する類似起源閲覧文脈の単位]]ごとにありますから、
[[現職設定群オブジェクト]]も[[関連する類似起源閲覧文脈の単位]]ごとに存在します。

* 文脈

[16] [[現職設定群オブジェクト]]は、[[API]] の[[起源]]の検査などに使われます。

[17] 本来、[[同一起源ポリシー]]により、[[スクリプト]]が呼び出せるのは同じ[[起源]]の[[スクリプト]]だけのはずですから、どの[[環境設定群オブジェクト]]でも
([[大域オブジェクト]]の[[環境設定群オブジェクト]]や[[入口設定オブジェクト]]でも)
良さそうなものです。しかし [CODE(JS)@en[[[document.domain]]]] に値が設定されると[[実効スクリプト起源]]が変化しますから、
それ以前に異なる[[大域オブジェクト]]由来の[[関数]]への参照を取得していれば、
異なる[[実効スクリプト起源]]を持つ[[スクリプト]]を実行できることになります。
また [CODE(JS)@en[[[document.domain]]]] 設定以後は異なる[[起源]]で同じ[[実効スクリプト起源]]の[[スクリプト]]にアクセスできるようになります。
従って再帰的な[[関数]]呼び出しによって [[API]] の呼び出し元とみなすべき[[起源]]や[[実効スクリプト起源]]は変化することがあるのです。

* 歴史

[REFS[
- [1] [CITE@en[Web Applications 1.0 r7954 Try to clean up text where I referred to scripts that called a method, etc. Introduces the term 'incumbent script'.]]
( ([TIME[2013-06-12 06:45:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7953&to=7954>
- [2] [CITE@en[Web Applications 1.0 r8114     Try to clean up the incumbent script situation.]]
( ([TIME[2013-08-02 04:44:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8113&to=8114>
- [3] [CITE@en[Web Applications 1.0 r8129 Work in progress for integration with WebIDL (script execution stuff)]]
( ([TIME[2013-08-06 05:33:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8128&to=8129>
- [4] [CITE[IRC logs: freenode / #whatwg / 20130804]]
( ([TIME[2013-08-06 20:50:44 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20130804>
- [5] [CITE@en[Web Applications 1.0 r8169     Maintain the stack of incumbent scripts across calls to showModalDialog(), but empty it while that call is running, since showModalDialog() can resume out of order (you can call window.close() on a 'parent' modal window). (Untested.)]]
( ([TIME[2013-09-04 05:43:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8168&to=8169>
- [6] [CITE[IRC logs: freenode / #whatwg / 20131107]]
( ([TIME[2013-11-09 12:27:06 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20131107>
- [7] [CITE@en[Web Applications 1.0 r8247     The bulk of this is editorial: refactoring how scripts are defined so that all the common stuff is in a shared 'settings object' rather than being duplicated per script. But this also cleans up how postMessage() interacts with the event loop and a few other things I've since forgotten.]]
( ([TIME[2013-10-31 08:18:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8246&to=8247>
- [8] [CITE@en[Web Applications 1.0 r8262 Move the spec from a stack of incumbent scripts to a stack of script settings object. This should in theory have no concrete effects (though I may have changed some of the origin used for Web Workers started from document.domain-affected scripts that were called from other scripts with different original origins).]]
( ([TIME[2013-11-09 08:21:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8261&to=8262>
]REFS]

[12] 当初は[DFN[[RUBYB[[[現職スクリプト]]]@en[incumbent script]]]]が規定されていましたが、
[[スクリプト設定群オブジェクト]]が新設されて[[現職設定群オブジェクト]]へと置き換えられました。

[15] [CITE@en[Bug 18242 – Not clear what "script that invoked the method" means exactly in the case of e.g. a.setTimeout(b.postMessage, 0) // called from c]]
([TIME[2015-05-20 13:09:17 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=18242>

[18] [CITE@en[Rewrite script execution on top of ES · whatwg/html@4891d18]]
([TIME[2015-12-22 23:22:40 +09:00]] 版)
<https://github.com/whatwg/html/commit/4891d18aaf2df1d40aa61f467a5a10cfc19dd85d>

[25] [CITE@en[26603 – Consider merging the concept of incumbent global with the current realm]]
([TIME[2015-12-22 23:26:15 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=26603>

[26] [CITE@en[26603 – Consider merging the concept of incumbent global with the current realm]]
([TIME[2015-12-22 23:39:52 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=26603>

[27] [CITE@en[24403 – WebIDL callbacks should probably default to pushing a new entry settings object]]
( ([TIME[2016-06-03 17:57:35 +09:00]]))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=24403>