[2] [CODE(DOMi)@en[[[Document]]]] [[オブジェクト]]の [DFN[[CODE(DOMa)@en[[[hidden]]]]]] [[属性]]は、
[[文書]]が表示されているかを返します。

[16] [CODE(DOMi)@en[[[Document]]]] [[オブジェクト]]の [CODE(DOMa)@en[[[visibilityState]]]]
[[属性]]の値 [DFN[[CODE(DOM)@en[[[hidden]]]]]]、
[DFN[[CODE(DOM)@en[[[visible]]]]]] は[[文書]]が隠れていること、いないことをそれぞれ表します。

[17] これら2つの「hidden」の意味は若干異なっています。

* 仕様書

[REFS[
- [28] [CITE@en[Page Visibility (Second Edition)]] ([TIME[2015-11-13 18:23:52 +09:00]] 版) <https://w3c.github.io/page-visibility/#idl-def-.hidden>
- [31] [CITE@en[Page Visibility (Second Edition)]] ([TIME[2015-11-13 18:23:52 +09:00]] 版) <https://w3c.github.io/page-visibility/#h-hidden-attribute>
- [36] [CITE@en[Page Visibility (Second Edition)]] ([TIME[2015-11-13 18:23:52 +09:00]] 版) <https://w3c.github.io/page-visibility/#h-visibilitystate-attribute>
- [27] [CITE@en[Vibration API]] ([TIME[2014-11-20 01:59:39 +09:00]] 版) <http://dev.w3.org/2009/dap/vibration/#dfn-processing-vibration-patterns>
]REFS]

* [CODE(DOMa)@en[visibilityState]] 属性の値 [CODE(DOM)@en[hidden]]

[19] [[最上位閲覧文脈]]に含まれている [CODE(DOMi)@en[[[Document]]]] がまったく見えないなら
[CODE(DOMa)@en[[[visibilityState]]]] [[属性]]は [CODE(DOM)@en[[[hidden]]]]
を返さなければ[['''なりません''']]。ただし >>7 の場合は [CODE(DOM)@en[[[visible]]]]
を返して[['''構いません''']]。 [SRC[>>18]]

[HISTORY[
[20] >>19 の規定からすると [CODE(DOMa)@en[[[hidden]]]] [[属性]]が[[真]]なら [CODE(DOMa)@en[[[visibilityState]]]]
[[属性]]は必ず [CODE(DOM)@en[[[hidden]]]] になりそうなものですが、 >>11 の場合に [CODE(DOM)@en[[[unloaded]]]]
という別の値が用意されています。また [CODE(DOM)@en[[[prerender]]]] という値も用意されています。
更に [[vendor prefix]] のついた値も認められており、厳密に解釈すると >>19 の規定に反してしまう可能性があります。
仕様書の例示には >>9、>>10、>>13 のみ挙げられています。

;; [32] その後の改訂でこの辺の規定は整理されています。
]HISTORY]

[29] [[文書]]の[F[[[可視性状態]]]]の値[DFN[[RUBYB[隠れ]@en[hidden]]]]は、
[[文書]]がまったく[[画面]]内にないことを表します [SRC[>>28]]。

* [CODE(DOMa)@en[visibilityState]] 属性の値 [CODE(DOM)@en[visible]]

[23] [[最上位閲覧文脈]]に含まれている [CODE(DOMi)@en[[[Document]]]] 
がどこかの[[画面]]に一部分でも表示されているなら [CODE(DOMa)@en[[[visibilityState]]]]
[[属性]]は [CODE(DOM)@en[[[visible]]]] を返さなければ[['''なりません''']]。また >>7
の場合も [CODE(DOM)@en[[[visible]]]] で[['''構いません''']]。 [SRC[>>18]]

;; [24] これは [CODE(DOMa)@en[[[hidden]]]] が[[偽]]になる場合と同じである [SRC[>>18]] とわざわざ明記されています
(>>19 については言及なし)。

[30] [[文書]]の[F[[[可視性状態]]]]の値[DFN[[RUBYB[可視]@en[visible]]]]は、
[[文書]]の少なくても一部が可視状態であることを表します [SRC[>>28]]。

* 可視性の決定

[45] [[文書]]の[F[可視性状態]]は、[[文書]]が[[閲覧文脈]]中にあり、
それが[[最上位閲覧文脈]]である時のみ定義されているようです。

[35] [[文書]]の[F[[[可視性状態]]]]が[[可視]]であるか[[隠れ][document.hidden]]であるかは、
次のように判断されます [SRC[>>36]]。

[FIG(list)[
- [44] [[文書]]の[F[閲覧文脈]]の[F[窓][窓 (Web)]]の[F[画面]]の[F[[[ロック画面]]表示中]]が[[真]]なら、
-- [50] [[隠れ][document.hidden]]です。
- [43] [[利用者エージェント]]が[[文書]]を [[unload]] 中なら、[[隠れ]]です。
- [41] [[文書]]の[F[閲覧文脈]]の[F[窓][窓 (Web)]]の[F[最小化]]が[[真]]なら、
-- [46] [[隠れ][document.hidden]]です。
- [38] それ以外なら、
-- [42] [[利用者エージェント]]が完全に隠されていても、それが[[アクセシビリティーツール]]であり、[[文書]]の表示であるなら、[[可視]]です。
-- [39] [[文書]]の[F[閲覧文脈]]の[F[前景]]が[[真]]なら、
--- [47] [[可視]]です。
-- [40] それ以外 ([[背景]]) なら、
--- [48] [[隠れ][document.hidden]]です。
]FIG]

;; [49] つまり、最前面の[[タブ]]以外では、[[隠れ]]となります。

;; [37] [[事前レンダリング]]については、そちらの項を参照。

* [CODE(DOMi)@en[Document]] インターフェイス [CODE(DOMa)@en[hidden]] 属性 (DOM)

[4] [CODE(DOMi)@en[[[Document]]]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[[[hidden]]]]]] [[IDL属性]]は、
[[最上位閲覧文脈]]の[[文書]]が一部でも可視なら[[偽]]、
そうでないなら[[真]]を返します。

;; [6] 当該 [CODE(DOMi)@en[[[Document]]]] が直接含まれている[[閲覧文脈]]ではなく、[[最上位閲覧文脈]]によって決まります。

;; [5] [CODE(DOMi)@en[[[Document]]]] の [CODE(DOMa)@en[[[defaultView]]]] が [[null]] なら、[[真]]を返さなければ[['''なりません''']]
[SRC[>>1]]。

[FIG(important)[
[34] 本[[属性]]は歴史的なものであり、 [CODE[[[visibilityState]]]]
[[属性]]を使う[RUBYB[べき]@en[should]]です [SRC[>>31]]。
]FIG]

[3] [[取得時]]、[[文書が隠れているか決定する手順]]を実行しなければ[['''なりません''']] [SRC[>>31]]。
この[[属性]]は[[読み取り専用]]で、 [CODE(IDL)@en[[[boolean]]]] を返します [SRC[>>31]]。

[33] [DFN[[RUBYB[文書が隠れているか決定する手順]@en[steps to determine if the document is hidden]]]]は、
[[可視性状態を決定する手順]]が [CODE[[[visible]]]] を返すかどうかを返します [SRC[>>31]]。

[7] 通常[[全画面]]で表示するような[[アクセシビリティ・ツール]]もあったりしますから、
[[Webブラウザー]]が[[最小化]]されておらず他の[[アプリケーション]]に完全に隠れてしまっているような場合であれば[[偽]]を返しても[['''構いません''']]
[SRC[>>1]]。

[EG[
[8] 例えば次の場合に[[真]]を返します。

- [9] [[最小化]]されている場合 [SRC[>>1]]
- [10] 裏の[[タブ]]になっている場合 [SRC[>>1]]
- [11] [[unload]] しようとしている場合 [SRC[>>1]]
- [12] [[session history entry]] を探索しようとしている場合 [SRC[>>1]]
- [13] [[OS]] の[[ロック画面]]が表示されている場合 [SRC[>>1]]
- [21] [CODE(DOMa)@en[[[visibilityState]]]] が [CODE(DOM)@en[[[prerender]]]] の場合
]EG]

[25] 値の変化のタイミングについては [CODE(DOMe)@en[[[visibilitychange]]]] の項をご覧ください。

[26] [CODE(JS)@en[[[navigator.vibrate]]]] が無視されるかどうかは、
この[[属性]]の値に依存します [SRC[>>27]]。

* 歴史

[15] [[Page Visibility]] 仕様により追加されました。 [[WebKit]] では [DFN[[CODE(DOMa)@en[[[webkitHidden]]]]]]
として実装されています [TIME[2013-05-20T14:04:38.00Z]]。 [[WinIE]] では [DFN[[CODE(DOMa)@en[[[msHidden]]]]]]、
[[Firefox]] では [DFN[[CODE(DOMa)@en[[[mozHidden]]]]]] も実装されていました。

[REFS[
- [1] [CITE@en[Page Visibility]] ([TIME[2013-05-20 13:53:52 +09:00]] 版) <https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#dom-document-hidden>
- [18] [CITE@en[Page Visibility]] ([TIME[2013-05-20 14:16:53 +09:00]] 版) <https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#pv-page-hidden>
- [22] [CITE@en[Page Visibility]] ([TIME[2013-05-20 14:24:55 +09:00]] 版) <https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#pv-page-visible>
]REFS]

* 関連

[14] [[要素]]の [CODE(DOMa)@en[[[hidden]]]] [[属性]]とは関係ありません。