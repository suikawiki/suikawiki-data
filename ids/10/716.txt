#?SuikaWiki/0.9
- Subject: すごい遅くて嫌になっちゃう
- Priority: high
- Status: open
- Category: SuikaWiki
- Creation-Date: 2003-05-31T11:04:36+00:00

[1] この遅さは尋常じゃないですよ。最近特に酷くなってきたような。
- [2] >>1 変なプラグインが多いせいかなあ。そんなことはないはずなんだけどなあ
- [3] >>1 実際 SuikaWiki は遅いんだけど、それよりも Mozilla が馬鹿でかくなって遅いってこともあるみたいだよ。
- [4] [[gzip]] 圧縮出力できるようにしてみたけど大して変わらなかった。それ以前で遅すぎ。 [WEAK[([[conneg]] 未実装だから gzip も comment 化に戻しといたから、今はなってない。)]]
- [5] [[IMS]] が css mode でうまく機能していなかったのを修正。これであの異常な遅さは改善されたはず。 (スタイル・シート読み込み時に CGI を何度も起動するのが激烈な遅さの原因の1つ。)
- [6] それでも最初の1回 (と有効期限切れになったとき、すなわち2時間毎だったかな?) は遅いですけど。
- [7] >>5−6 でも一々[[代替スタイル・シート]]を全部一気に読む [[Mozilla]] も悪いのはいつも言っている通り。
- [8] [WEAK[2003-06-12 12:09:23 +00:00]] ''[[名無しさん]]'': でもスタイル・シートの IMS が効くようになったから随分速くなったや。 (というか前のに戻っただけだけど。なんで enbug してしまったんだろう?)
- [9] キャッシュを上手く機能させて体感上早くする方法が他にもないかと [[RFC2616]] を探してみたけどなさげ。 [CODE(HTTP)[[[Cache-Control:]]]] 欄の修飾子は色々あるけど、むやみにキャッシュされないようにするのが主にみえる。一部そうでないのもあるけど今回は使えなさげ。
- [10] それと、途中で [[HTTP/1.0]] cache を通ると [[303]] を使ってるところで downgrade してしまうから微妙に遅くなる。 (改善以前と同じ速さ。)
- [11] SuikaWiki の場合データの転送よりデータの内容を作るまでに時間がかかってるから、転送量を抑える対策はあんまり意味がない。これまでどおり裕福に行くのを原則としましょう。但し >>4 のような圧縮転送はそれなりに意味もあるだろうからそのうち ([[conneg]] 対応次第) 実装することにしましょう。
- [12] ネックとなっているのは、 perl の起動の overhead — 頑張ってモジュール化を推進して、いずれ mod_perl 化する; 検索 — もっと効率のいい検索方法を考える ([[Namazu]] とかを使う?) 辺りかな。
- [13] >>12 の2点以外は、色んなモジュールの読み込みのちょっとずつの遅さの累積だと思われ。これは少しずつ改善していくしか手はないだろう。
- [14] 高機能化・抽象化・部品化と高速化は[RUBY[相対] [あいたい]]するところがあるから難しい・・・。
- [15] [WEAK[2003-06-12 13:12:07 +00:00]] ''>>8'': やっぱり直ってない。っていうかこれは CGI 側じゃなくてブラウザのきまぐれなのかも。何も触ってないのにまた意味の無い IMS request を送るようになった。 (ブラウザを再起動したからか。)
- [16] >>15,>>5-7 でも一応代替スタイル・シートは最後に読むみたいだから、読み終わらなくても (読み込み中状態になってはいるが) レンダリングは完了している。気持ち悪いけど妥協点かなあ。
- [17] >>12 検索、 SuikaWiki 本家よりずっとデータ量の少ない local の wiki でも随分遅いんだよなあ。 (昔はもっと速かった気もするけど。 local wiki も大分増えたからかな。)
- [18] もっとも、本家 SuikaWiki は >>17 より更に遅いんだけど・・・。
- [19] [WEAK[2003-06-12 13:27:29 +00:00]] ''15'': 
- [20] [WEAK[2003-06-12 13:28:49 +00:00]] ''15'': 再起動したらまた >>8 の状態に戻ったよ。で、更に又再起動したけどまた早い >>8 の状態。どういう基準で速くなったり遅くなったりしてるのか (403 が自明な request を省略するかしないか判断してるのか) 不明。もしかして Moz の bug でキャッシュとの照合設定が上手く意図どおりになったりならなかったりするんだろうか? ようわからん・・・
- [21] わっからんなー
- [22] 今のところ一番問題なのは lock なんですが、これは SuikaWiki 3 で共有ロックを使うように、それも WikiDatabase を使う直前まで lock しないようにすることで今よりは改善できるはずです。 (SuikaWiki 3 が使えるようになるのがまだ先なのと、 lock 問題が解決しても十分重たいのがまだ問題ですが。。。)
