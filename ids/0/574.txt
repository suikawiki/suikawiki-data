[1] [DFN[[ABBR[XML] [Extensible Markup Language]] 1.1]] は、 [[XML 1.0]] の小改訂版です。
XML 1.0 と基本的には変わっていないのですが、
[[名前文字]]や[[空白]]の規定に多少の変更がありました。
そのため XML 1.0 と XML 1.1 で[[整形式]]の定義が変わってきます 
(ので新しい版とされました)。

[70] しかし [[XML 1.0 5e]] で[[整形式]]の定義が変更され、 [[XML 1.1]]
相当の変更の多くが取り込まれたことにより、事実上廃止されました。
形式的には依然として有効な [[W3C勧告]]ではあるものの、
当時も現在も、実際にはほとんど使われていません。

* 仕様書

[REFS[
- [2] <http://www.w3.org/TR/xml11>
]REFS]

* XML 1.0 との互換性

[5] 適合 [[XML 1.0]] [[文書]]を [[XML 1.1]] [[処理器]]に与えると、 [[XML 1.0]]
[[処理器]]と異なる出力が得られることがあります。この意味で [[XML 1.1]]
と [[XML 1.0]] に互換性はありません。

[6] 適合 [[XML 1.1]] [[文書]]を [[XML 1.0]] [[処理器]]に与えると、 [[XML 1.1]]
[[処理器]]と異なる出力が得られたり、[[致死的誤り]]となったりすることがあります。
この意味で [[XML 1.1]] と [[XML 1.0]] に互換性はありません。

[7] なお [[XML 1.1]] が派生した当時の [[XML 1.0 4e]] とは違いが色々ありましたが、
その多くは [[XML 1.0 5e]] に取り込まれていますから、 [[XML 1.1]] と
[[XML 1.0 5e]] では >>5 や >>6 のような結果になることは 4e よりは少なくなっています。
それでも >>5 や >>6 がまったく起こらなくなったわけではありません。

* XML 名前空間

[8] [[XML 1.1]] を使う場合は [[XML名前空間 1.1]] を使うことになっています。
[[XML名前空間 1.0]] を使うことはできません。

;; [9] また [[XML名前空間 1.1]] を [[XML 1.0]] で使うこともできません。

* 歴史

[REFS[
- [68] 第1版 勧告 <http://www.w3.org/TR/2004/REC-xml11-20040204/>
- [69] 第1版 正誤表 <http://www.w3.org/XML/xml-V11-1e-errata>
]REFS]

** XML 1.0 からの変更点

[17] XML 1.0 [ABBR[TE] [第3版]] から XML 1.1 の変更点を、
仕様書の差分を取って調べてみました。 

(変更点を示した版も用意されていますが、
すべての変更点が明記されているわけではありません。
その差分版で明記されていない変更点は
[Q[(マークされていない)]] と注記しています。)

- [Q[1.0]] が [Q[1.1]] に置き換えられた。 
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-origin-goals>
(マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-prolog-dtd>
(マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-rmd>
(マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-prolog-dtd>
(マークされていない)
- [Q[[[ISO/IEC 10646]]]] が [Q[[[Unicode]]]] に変更された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#dt-match>
(マークされていない)
- 変更点解説の節が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-xml11>
概要:
-- XML 1.0 は 1998 年の最初の勧告以来、何が[[整形式]]でなにがそうでないかは変えずに来た。これは[[相互運用性]]的には極めて有用だ。
-- しかしその間に XML の参照する [[Unicode]] はどんどん変わっていって、
[[名前]]に使えるべき文字が使えなかったり、そもそも本来使えるべきでない文字が名前文字になっていた。
-- 名前文字の定義の仕方をまったく変えて、がちっと決めてしまうのではなく、
禁止文字以外なんでもありにした。
-- [[メインフレーム]]の[[改行]]文字が[[空白]]じゃなくて不便だったので、
追加した。完全性のために [CODE(char)[U+2028]] も追加した。
-- [CODE(char)[[[C0]]]] を使いたいという要求が多かったので、
[CODE(char)[[[NULL]]]] 以外は[[文字参照]]でなら使えるようにした。
[[頑強性]]のため、 [CODE(char)[[[DEL]]]] と [CODE(char)[[[C1]]]]
は文字参照でないと使えないようにした。
-- [DFN[[[完全正規化]]]]制約集合を追加した。
著者は従う'''べき'''だし、処理器は検証する'''べき'''だ。
完全正規化されていれば[[バイナリ比較]]できる。
-- 整形式の定義に関わるので新しい版とした。
版は [[XML宣言]]の版宣言で区別する。
- [CODE(ABNF)[[[document]]]] の定義で、[[制限文字]]の除外が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-document>
(マークされていない)
- ISO/IEC 10646 の版・章節参照が削除された。
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#dt-character> (マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#charencoding>
(マークされていない)
- [CODE(ABNF)[[[Char]]]] の定義が拡大され、 [CODE(char)[C0]]
([CODE(char)[NULL]] を除く。) が追加された
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-Char>
- 新しい生成規則 [CODE(ABNF)[[[RestrictedChar]]]]
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-RestrictedChar>
- Unicode の版・章節参照が削除された。
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#charsets>
(マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-external-ent>
(マークされていない)
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#charencoding>
(マークされていない)
- [[互換文字]]についての [[UnicodeStandard]] 参照から章番号が削除された
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#charsets>
(マークされていない)
- 文字の分類 (附属書 B) についての言及が削除された
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-common-syn>
- 名前の文字について追記された
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-common-syn>
概要:
-- 名前は [CODE(ABNF)[NameStartChar *NameChar]] でなければ'''ならない'''。
つまり[[欧州数字]]と[[基本結合文字]]は最初に来れない。
-- [[区切子]]以外のほとんどの文字が名前に使える。
定義は排他的ではなく包含的なので、まだ Unicode にない[[書字系]]も使える。
-- 名前についての提案 (附属書 I) を参照されたし。
-- [[文書著者]]は、自然言語的に意味のある名前を使い、
記号的な名前や空白を避けるように推奨する (encouraged)。
-- [CODE(char)[[[COLON]]]], [CODE(char)[[[FULL STOP]],  [CODE(char)[[[HYPHEN-MINUS]]]], [CODE(char)[[[LOW LINE]]]],]]
[CODE(char)[[[MIDDLE DOT]]]] は陽に認める。
-- 記号・句読点の多くは、 XML 文書以外で名前を使う場合も想定し、
除外している。
-- [CODE(char)[[[GREEK QUESTION MARK]]]] は正規化すると
[CODE(charname)@en[SEMICOLON]] になってしまうので除外している。
- [CODE(ABNF)[NameStartChar]] が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-NameStartChar>
- [CODE(ABNF)[NameChar]] の定義が大きく変更された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-NameChar>
- [CODE(ABNF)[Name]] の定義が [CODE(ABNF)[NameStartChar]]
を使うように変更された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-Name>
- (要素の内容の文字は) [Q[どのマークの開始区切子も含まないし、 CDATA 区間閉じ区切子も含まない]]が[Q[どのマークの開始区切子も CDATA 区間閉じ区切子も含まない]]に改められた。また、二つ目の [Q[CDATA 区間閉じ区切子, [CODE(XML)[''']'''''']'''>]]]] が単に [Q[CDATA 区間閉じ区切子]]に改められた。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#syntax>
(マークされていない)
- [Q[XML 文書]]が [Q[XML 1.1 文書]]に変更された。
-- <http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-prolog-dtd>
(マークされていない)
- 文書は [Q[XML 宣言で始める'''べきである''']]から[Q[始めなければ'''ならない''']]に変更された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#dt-xmldecl>
(マークされていない)
- XML 宣言のない例の説明が、 XML 1.0 とみなされる旨に変更された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-prolog-dtd>
(マークされていない)
- [CODE(ABNF)[[[prolog]]]] で [CODE(ABNF)[[[XMLDecl]]]]
が必須となった。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-prolog>
(マークされていない)
- [CODE(ABNF)[VersionNum]] が [Q[[CODE(ABNF)['1.0']]]] から [Q[[CODE(ABNF)['1.1']]]] に変更された。
- XML 1.0 との関係についての記述が追加された
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-prolog-dtd>
概要:
-- [DEL[XML 1.1 処理器は XML 1.0 文書も受け入れる'''べきである'''。]]
--- [39] 正誤表 E15 で削除されました。
XML 1.1 処理器は XML 1.0 文書を受け入れなければ'''なりません'''
(>>40)。
-- XML 1.0 整形式/妥当で、 [CODE(char)[U+007F]] や [CODE(char)[[[C1]]]]
を生で含まなければ、版番号を直すだけで 1.1 整形式/妥当である。
- [DEL[[CODE(ABNF)[SDDecl]] の [CODE(ABNF)[[[S]]]] が [CODE(ABNF)[1*[CODE(char)[U+0020]]]] に変更された。]]
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-SDDecl>
(マークなし)
-- [28] 正誤表で元に戻されました。
<http://www.w3.org/XML/xml-V11-1e-errata#E10>
- [19] 改行の処理についての変更。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-line-ends>
概要:
-- 次は、 [CODE(char)[[[U+000A]]]] に変換する。
--- [CODE(char)[[[U+000D]]]] [CODE(char)[U+000A]] (従来通り)
--- [CODE(char)[U+000D]] [CODE(char)[[[U+0085]]]]
--- [CODE(char)[U+0085]]
--- [CODE(char)[[[U+2028]]]]
--- [CODE(char)[U+000D]] (従来通り)
-- [[符号化宣言]]を読むまで表現が不定であるから、
[CODE(char)[U+0085]] や [CODE(char)[U+2028]]
を XML 宣言や[[文宣言]]で使うことはできず、[[致命的誤り]]とする。
- 正規化検査の章が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-normalization-checking>
概要:
-- すべての[[解析対象実体]]は、附属書 B とこの章の
[DFN[XML の[[関連構造]]]]の定義にしたがって完全正規化されている'''べきである'''。
XML の関連構造 (relavant constructs) とは、
--- 解析実体の[[置換文]]
--- [CODE(ABNF)[Cdata]]
--- [CODE(ABNF)[CharData]]
--- [CODE(ABNF)[content]]
--- [CODE(ABNF)[[[Name]]]]
--- [CODE(ABNF)[Nmtoken]]
-- 文書は完全正規化されていなくても整形式である。
-- XML 処理器は[[利用者の任意選択]]で完全正規化形かどうかを検証 (verify) することができる'''べきである'''。
検証しない選択肢は完全正規化形であることが[[保証]] ([[certify]]) されているときのみ選ぶ'''べきである'''。
-- 完全正規化形検証は、次の手順であるかのように行わなければ'''ならない''':
=== まず[[取込み正規化形]]であるかを検証
=== 関連構造 (参照展開済み) の中に[[合成文字]] ([[composing character]]) で始まるものがないか検証
--- メモ: 合成文字とは、すべての [[Unicode]] の非零[[結合級]]
(cmbining class) の文字と、零級であるにもかかわらずある Unicode
[[正準分解]] (cannonical decomposition) の最初以外になる文字。
これらの文字は[[基底文字]]の後に続くことを想定したものだから、
関連構造の先頭から排除しても実質表現力低下には至らない。
-- 非検証 (validating) 処理器は、読んでいない[[外部実体]]の取込みにより起こり得る非正規化 (denormalization) を無視しなければ'''ならない'''。
-- 完全正規化形検証において正規化特性を得られない文字
(処理器が対応している Unicode の版より後で追加された文字)
に遭遇したら、利用者の任意選択により、その文字により起こり得る非正規化を無視しても'''よい'''。
信頼性や安全性が重要である応用はこれを既定では選択する'''べきではない'''。
-- XML 処理器は入力を完全正規化形にかえては'''ならない'''。
-- XML 1.0/1.1 を出力する応用は、それが完全正規化されているようにする'''べきである'''。
-- 内部処理形が完全正規化されている必要はない。
-- この章の目的は、 XML文書の作者が適切に文書を正規化するように
XML 処理器を推奨 (encourage) することで、 XML 応用が複数の「綴り」
をいちいち検査しなくても文字列一致ができるようにというところにある。
-- 実体が非 Unicode 符号化であって、処理器がこれを Unicode
に変換するときは、[[正規化転符号器]]を使う'''べきである'''。
- [Q[4.5 内部実体置換文の構築]]が [Q[4.5 実体置換文の構築]]に修正された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-internal-ent>
(マークされていない。本来 XML 1.0 [ABBR[SE]] Errata での節題修正に合わせて修正されるべきで、 XML 1.0 [ABBR[TE]] の修正漏れ)
- [CODE(ABNF)[extParsedEnt]] で制限文字の除外が書き加えられた。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-extParsedEnt>
- [CODE(ABNF)[extParsedEnt]] で [CODE(ABNF)[restrictedChar]]
を除外するように修正された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#NT-extParsedEnt>
- 実体と XML 版情報についての節が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-version-info>
概要:
-- [[文書実体]]の版が文書全体の版となる。
-- XML 1.1 文書は XML 1.0 外部実体を呼び出しても良い。
そのような場合でも文書全体に XML 1.1 の規則が適用される。
- [Q[whitespace]] が [Q[white space]] に修正された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#dt-extrepltext>
(マークされていない)
- 適合性について追記された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#proc-types> (マークなし)
概要:
-- [40] XML 1.1 処理器は XML 1.0 も処理できないと'''いけない'''。
-- XML 生成プログラムは XML 1.1 の機能を使う場合以外 1.0
文書を生成する'''べきである'''。 
- [DEL[<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#safe-behavior>  の最後の段落の文中の閉じ括弧が削除された。]]
(マークされていない。 XML 1.1 の編集ミス。
開き括弧も削るか、閉じ括弧を復活させないといけない。)
-- XML 1.1 初版正誤表 E09 で修正。
<http://www.w3.org/XML/xml-V11-1e-errata#E09>
- [ISO/IEC 10646:2000] が削除された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-existing-stds>
(マークされていない。 [ISO/IEC 10646] はそのまま。)
- [Unicode] が最新版参照に改められた (もとは Unicode 2.0 参照)。
[Unicode3] は削除された、
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#Unicode>
(マークされていない)
- [XML-1.0] が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#XML1.0>
- [Charmod] が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#Charmod>
- [Q[附属書 B 文字級]]が削除され、新しい[Q[附属書 B 文字正規化]]が追加されました。<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-CharNorm> (マークされていない (XMLspec 注釈にはある)。)
概要:
-- 文字正規化に関する定義をする。背景情報と例示は [Charmod]
を参照。[WEAK[(Draft では完全に Charmod 参照だったけど、 Charmod はまだ WD だから定義をコピペしたらしい。)]]
-- 文が [[UTF-8]], [[UTF-16]] または [[UTF-32]] で符号化されているとき、
[DFN[[[Unicode符号化形]]]]であるという。
-- [DFN[[[遺産符号化]]]]とは、 Unicode に基づかない任意の文字符号化を意味する。
-- [DFN[[[正規化転符号器]]]]とは、遺産符号化から Unicode 符号化形に変換し、結果が確実に [[Unicode正規化形C]] になる転符号器である。
-- [DFN[[[文字逃避]]]]とは、マーク付け言語またはプログラム言語で、
次の一つ以上を実現する構文装置である。
--- 構文で意味を持つ文字を、その意味を持たさずに表現する
--- 選択した文字符号化で表現できない文字を表現する
--- 一般に文字を対応する[[文字符号]]を使わずに表現する
-- [DFN[[[保証]]]]文は、次の最低一つを満足する。
--- 文が検査により正規化形されていることが確認されている
--- 原始文処理部品がわかっていて、正規化文だけを出力することを知っている
-- 文は、次の条件を満たすとき、この仕様書の目的においては
[DFN[[[Unicode正規化]]]]されている。
--- Unicode 符号化形である
--- 次のうちの新しい方の版の Unicode 規格において [[NFC]] である。
---- [[Unicode3.2]]
---- 実際に文に含まれている全ての文字を含む最古の版
-- 文は、次のいずれかを満たすとき、[DFN[[[取込み正規化]]済み]]である。
--- Unicode 正規化されており、それを取込むことによって正規化形でなくなる文字参照や取込みを含まない。
--- 遺産符号化されており、正規化転符号器を使ったとしたら前項を満たす。
-- [DFN[[[合成文字]]]]は、次の一方又は両方を満たす。
--- なんらかの[[一次分解]]の[[正準分解写像]]の第2文字である。
--- 非零[[結合級]]である。
-- 次のいずれかの時、文は[DFN[[[完全正規化]]]]されている。
--- 文は Unicode 符号化形であり、取込み正規化されており、
関連構造で合成文字や合成文字を表す文字逃避で始まるものがない。
--- 文は遺産符号化であり、正規化転符号器で Unicode 符号化形に変換したとすると前項を満たす。
- 附属書 C XML と SGML が削除された。 (マークされていない。 XMLspec 注釈にはある。)
- 附属書 D〜I が附属書 C〜H に繰り上げられた。
(マークされていない。)
-- [DEL[附属書 C (XML 1.1) に [CODE(XML)[version="1.0"]] の例がある!]]
--- XML 1.1 初版正誤表 E06 で修正。 <http://www.w3.org/XML/xml-V11-1e-errata#E06>
- 附属書 F (旧附属書 G) の記述がやや改められた。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-xml-wg>
(マークされていない)
-- XML 1.0 [ABBR[SE]]: [Q[この仕様書を WG が承認したことは、必ずしもすべての WG 構成員が承認票を投じたことを暗示しない。現在および以前の XML WG 構成員は:]]
-- XML 1.0 [ABBR[TE]]: [Q[この仕様書を WG が承認したことは、必ずしもすべての WG 構成員が承認票を投じたことを暗示しない。現在および以前の XML WG 関係者は:]]
-- XML 1.1: [Q[この仕様書を WG が承認したことは、必ずしもすべての WG 関係者が承認票を投じたことを暗示しない。現在および以前の XML WG 構成員は:]]
- 1.0 [ABBR[TE]] では Fran&#231;ois Yergeau の後に [Q[(第3版編集者)]] と書かれているが 1.1 にはなく、 1.1 には John Cowan の後ろに [Q[(XML 1.1 初版編集者)]] と書かれているが 1.0 [ABBR[TE]] にはない。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-core-wg>
(マークされていない)
- 附属書 H (旧附属書 I) で[Q[第3版]]が[Q[この版]]に置き換えられた。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#prod-notes>
(マークされていない)
- [Q[附属書 I XML 名前についての提案]]が追加された。
<http://www.w3.org/TR/2004/REC-xml11-20040204/REC-xml11-20040204-review.html#sec-suggested-names>
概要:
-- XML 名前の構築についての最前の慣習と信ずるところの提案である。
-- Unicode 3.0 以上の特定の版だが、どれを採用するかは著者や
schema 設計者の裁量である。
-- Unicode 3.0 の識別子についての規則から、
制御文字、囲み[[現在位置の前進動作を伴わない]]記号、
非十進数字、私用文字、句読点 (例外あり)、記号、未割当て符号位置、
空白を除外した。すなわち:
--- 名前開始文字は [CODE[[[Ll]]]], [CODE[[[Lu]]]], [CODE[[[Lo]]]], [CODE[[[Lm]]]], [CODE[[[Lt]]]], [CODE[[[Nl]]]] または
[CODE(char)[[[_]]]] ([CODE(char)[U+005F]]) であるべきだ。
--- 名前文字は [CODE[[[Ll]]]], [CODE[[[Lu]]]], [CODE[[[Lo]]]], [CODE[[[Lm]]]], [CODE[[[Lt]]]],
[CODE[[[Mc]]]], [CODE[[[Mn]]]], [CODE[[[Nl]]]], [CODE[[[Nd]]]], [CODE[[[Pc]]]], [CODE[[[Cf]]]],
[CODE(char)[[[-]]]] ([CODE(char)[U+002D]]), [CODE(char)[.]] ([CODE(char)[U+002E]]), [CODE(char)[[[:]]]] ([CODE(char)[U+003A]]) または
[CODE(char)[&#183;]] ([CODE(char)[U+00B7]] = [CODE(char)[MIDDLE DOT]])
であるべきだ。
--- [CODE[Cf]] は直接的には不可視なので、注意して、必要なときにかぎって使用するべきだ。 (XML 処理器的には異なるけど人間が見たら同じ名前は避けたほうがいい。)
-- XML 1.0 附属書 B から。
--- [[正準分解]]を持つ[[表意文字]] ([[CJK互換漢字]]を含む。)
は使用するべきではない。
--- [[互換分解]]を持つ文字は使用するべきではない。ただし、
[CODE(char)[U+0E33]] = [CODE(char)[THAI CHARACTER SARA AM]], [CODE(char)[U+0EB3]] = [CODE(char)[LAO CHARACTER AM]]
は普通に使われているから除く。
--- 記号と共にのみ使われることを想定した結合文字は使用するべきではない。
--- [[行内注釈文字]]は使用するべきではない。
--- [[異体字選択子文字]]は使用するべきではない。
--- 意味のない名前、発音できない名前、読みにくい名前、
他の名前と混同しやすい名前は使用するべきではない。

[22]  差分明示版、 1.0 TE との差分でも 1.1 PR との差分でもない。
いったいなにとの差分なのでしょうねぇ。

前掲の修正点一覧は w3m で 1.0 TE と 1.1 FE のレンダリング結果を保存したものを [KBD[[[diff]]]] 取ったものと差分版と見比べながら作りました。
ちなみに、 XMLspec 版の両仕様書の差分は、字下げ修正のせいで
([KBD[diff -b]] したって) なんとも面倒くさい状態です。
(1.0 から 1.1 が fork した後で更に両仕様書に修正が入っているみたい。
面倒なことしやがって。)
[WEAK[行指向ではなく木としての差分を取ればまともな結果が得られるかもしれないけど。)]]

リストにはありませんが、 (XMLspec 版の字下げ修正なんて阿呆なことをしたせいで)
例示中の空白がずれてるところが大量にあります。
([[混合内容]]のときに空白整形をいじったりしたら困ることくらいわかりそうなものだが!)

[18] [CODE(char)[U+0085]] や [CODE(char)[U+2028]] が XML 宣言/文宣言で使えない件、
本当は他の文字だって符号化方式が確定しないと分からないのだけどね。
(非 ASCII 文字が混じると推定が難しくなるのは確かだから、適当な線引きだとは思うけど。。。)

使えない (使うべきではない) 本当の理由は、
XML 1.0 との互換性ではないのでしょうか。
2.11 <http://www.w3.org/TR/xml11/#sec-line-ends> の規定により、
解析器は構文解析の前に改行の正規化をしないといけませんが、
正規化の仕様は XML 1.1 で改められました (>>19)。
ですから正規化の前に XML の版が判らないと正しい処理ができません。
しかし XML の版を得るためには少なくても XML 
宣言を構文解析しなければならないのでして・・・。

[19] 
[CODE(ABNF)[CData]], [CODE(ABNF)[PI]], [CODE(ABNF)[Comment]],
[CODE(ABNF)[CharData]], [CODE(ABNF)[EntityValue]],
[CODE(ABNF)[AttValue]], [CODE(ABNF)[SystemLiteral]],
[CODE(ABNF)[Ignore]]
の定義は改められていない。

[CODE(ABNF)[Document]] や [CODE(ABNF)[extParsedEnt]]
から [CODE(ABNF)[restritedChar]] が除外されているのだから、
[PRE[
<?xml version="1.1"?>
<![CODE[]]
[CODE(char)[U+0001]]
]]>
]PRE]

は不可だけど、
[PRE[
<?xml version="1.1"?>
<!ENTITY % foo "<![CODE[&#x0001;]]>">
%foo;
]PRE]

ならいいのだろう。

実体参照を置換した結果が [CODE(char)[C0]] や
[CODE(char)[C1]] を含んだ[[注釈]]や[[処理指令]]を持っていたら、
(実体参照が存在したという情報を除去して、完全に置換してしまっていたら)
再度 serialize することが (適当な実体でもでっち上げない限り) 
できなくなってしまう。 [[DOM]] のようにプログラム等から実体を作ろうとする場合も同様。
(従来このような問題は、 [CODE[--]] のような分離子を含めようとしたときか、
非 ISO/IEC 10646 符号化方式で保存しようとしたときにしか生じなかった。)

[20] [CODE(XML)[[[standalone]]]] 疑似属性の前の
[CODE(ABNF)[S]] は [CODE(ABNF)[#x20+]] にしたのに、
XML 宣言/文宣言の他の [CODE(ABNF)[S]] はそのままのはなぜ?

[21] XML 1.1 文書から参照されている XML 1.0 外部解析実体は XML 1.1
の規則が適用される。ということは、 [CODE(char)[C1]]
が含まれた外部解析実体は整形式でなくなる。

また、 [CODE(XML)[version="1.0"]] または版情報なしの外部実体を
XML 1.1 文書から参照していると、その実体の整形式性・妥当性は正しく検証されるとは限らないわけだ。
(だから XML 1.0 外部実体が正しいか検証するのに、 XML 1.1 文書実体を使ってはいけない。当たり前と言えば当たり前だが。 XML 1.1 外部解析実体のつもりで文宣言を忘れるというのはありうるミスだから、検証器は警告してくれるといいかもしれない。)

** 2004年4月15日の修正

[23] 2004年4月15日に仕様書の HTML
版が差し替えられています。

修正されているのは、生成規則 [1]
の [CODE(ABNF)[Document]] で、
記号の周りに挿入されるべき[[空白]]が欠けていました。

<http://www.w3.org/TR/2004/REC-xml11-20040204/#status>

[24] この種の見ればわかる程度の間違いは訂正票だけで十分ではないでしょうか?
[Q[Edited in place]] ってのはマークの誤りのようなもっと重大な間違いのための制度では。

[25]
なお、修正は HTML 版だけで、
XML 版や差分版はそのままのようです。
([[名無しさん]] [WEAK[2004-06-04 06:56:04 +00:00]])

[26]
>>25 差分版も間違っているのにね。

[27]
>>23 は >>3 と同じ。

** 訂正票による仕様書の修正

[3] 第1版 Errata による修正点:

- E01 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E01>
-- [[EBNF]] [[生成規則]]中で[[間隔]]が欠落している箇所があったので挿入。
-- 該当するのは XML 1.1 初版で変更された部分。
- E02 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E02>
-- EBNF 生成規則中で曖昧な箇所があったので括弧を挿入。
-- 該当2箇所共 XML 1.1 初版で変更された部分。
- E03 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E03>
-- [CODE(XMLa)[[[xml]]:[[lang]]]] の実際の適用は応用依存であることを追記。
-- XML 1.0 第3版の訂正 E1 と同じ内容。
- E04 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E04>
-- 文字の欠落を修正。
-- XML 1.0 第2版の訂正 E46 で追加された部分。
<http://www.w3.org/XML/xml-V10-2e-errata#E46>
-- XML 1.0 第3版の訂正 E02 と同じ内容。
- E05 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E05>
-- 用語のリンク先を修正。
-- XML 1.0 第3版の訂正 E03 と同じ内容。
- E06 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E06>
-- [CODE(XMLa)[[[version]]]] 擬似属性の値を [CODE(XML)[1.0]] から
[CODE(XML)[1.1]] に変更。
-- XML 1.1 初版の修正漏れ。
- E07 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E07>
-- 括弧が欠落しているのを修正。
-- XML 1.1 初版で追加された部分。
- E08 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E08>
-- EBNF 生成規則にリンクを追加。
-- XML 1.0 第3版の修正 E04 と同じ内容。
- E09 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E09>
-- 括弧が欠落しているのを修正。
-- XML 1.1 初版で誤って変更された部分。
- E10 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E10>
-- [CODE(XMLa)[[[standalone]]]] 擬似属性の直前に[[間隔]]以外の[[空白]]文字を認める。
-- XML 1.1 初版で誤って変更された部分。
- E11 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E11>
-- [CODE(XML)[[[ANY]]]] [[要素内容]]で[[注釈宣言]], [[処理指令]], 
[[[CODE(XML)[CDATA]]区間]]が使えることを明確化。
-- XML 1.0 第3版の訂正 E05 と同じ内容。
- E12 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E12>
(2004年11月20日)
-- [[妥当性制約]][Q[属性既定値が構文的に正しいこと]]
の[Q[正しい]]条件が明確化されました。
-- XML 1.0 第3版の訂正 E06 と同じ内容です。
- E13 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E13>
(2004年12月15日)
-- リンクの説明の書き間違いが修正されました。
-- XML 1.0 第3版の訂正 E07 と同じ内容です。
- E14 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E14>
(2005年1月9日)
-- [[外部解析対象実体]]が[[整形式]]であることは、
その実体が[[文書]]から直接又は間接に参照されている場合のみ要求されることが注記として加えられました。
-- この規定自体は以前から仕様書の別の場所に書かれていました。
-- XML 1.0 第3版の訂正 E08 と同じ内容です。
-- 正誤表への追加日が2004年になっています。
(そのうち修正されるでしょう。)
- E15 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E15>
(2005年1月9日)
-- [Q[XML 1.1 処理器は XML 1.0 に対応する'''べきです'''。]]
という規定が削除されました。
-- 以前から他の部分で[Q[対応しなければ'''なりません'''。]]
と規定されていました。
-- 正誤表への追加日が2004年になっています。
(そのうち修正されるでしょう。)
- E16 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E16>
(2005年1月9日)
-- XML 文書が[[妥当]]たりうることの言い回しが改められました。
-- XML 1.0 第3版の訂正 E09 と同じ内容です。
-- 正誤表への追加日が2004年になっています。
(そのうち修正されるでしょう。)
--- いつの間にか修正されています @ 2005年11月
- E17 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E17>
(2005年11月2日)
-- [[妥当性制約]][Q[実体が宣言されていること]]における条件の中で、
[Q[[[外部引数実体]]]]が[Q[[[外部引数実体''参照'']]]]に改められました。
-- XML 1.0 第3版の訂正 E10 と同じ内容です。
- E18 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E18>
(2005年11月2日)
-- [[タブ]]と[[改行]]を''除く'' [[C0]] 
[[制御文字]]が''非推奨''な[[符号位置]]の一覧に付け加えられました。
-- [[XML 1.0]] では使えず、 [[XML 1.1]] 
で新たに[[文字参照]]としてに限って使えるようになった[[文字]]ですが、
使えるようにしたと言っても推奨できるものではないからだそうです。
-- [Q[本質的]]とは言えないまでも[Q[編集上]]の変更じゃないと思うがどうよ。
- E19 [編集上] <http://www.w3.org/XML/xml-V11-1e-errata#E19>
(2005年12月7日)
-- [Q[意味]]が[Q[応用での意味]]に修正されました。
[Q[字句化型はそれぞれ字句的・意味的に制約されます]]が[Q[字句化型は更に制約されます]]に修正されました。
-- 2つの[Q[意味]]の意味の違いを明確にするための訂正だそうです。
-- XML 1.0 第3版の訂正 E11 と同じ内容です。
- E20 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E20>
(2006年4月25日)
-- [CODE@en[[[DefaultDecl]]]] に[[整形式制約]][[外部実体参照なし]]が追加されました。
-- [[属性指定]]ではこの[[整形式制約]]が参照されているのに、
こちらの[[属性定義]]の方では参照されていませんでした。
-- [[XML 1.0]] 第3版の訂正 E12 と同じ内容です。
- E21 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E21>
(2006年4月25日)
-- [[妥当性制約]][[実体が宣言されていること]]の条件で[Q[[[外部引数実体]]]]とあったところが、[Q[[[引数実体]]]]と修正されました。
-- [[妥当性]]を[[検証]]しない[[処理器]]は[[内部引数実体]]も[[処理]]しないので、
こう規定しておくべきでした。
-- [[XML 1.0]] 第3版の訂正 E13 と同じ内容です。
- E22 [本質的] <http://www.w3.org/XML/xml-V11-1e-errata#E22>
(2006年8月9日)
-- [[RFC 2396]] と [[RFC 2732]] への参照が削除され、
代わりに [[RFC 2732]] への参照になりました。
-- [[XML 1.0]] 第3版の訂正 E14 と同じ内容です。

* 各仕様の XML 1.1 対応状況

[41]
,仕様	,構文	,意味	,仕様書	,その他
,[CODE(XML)[[[xml-stylesheet]]]]	,[[XML 1.0]] を'''陽に参照'''	,仕様書本文で [[XML 1.0]] を'''陽に参照'''	,[[XML 1.0]] [[FE]] を参照


[43]
[CITE[Pronunciation Lexicon Specification (PLS) Version 1.0]] ([TIME[2008-10-13 23:03:02 +09:00]] 版) <http://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/#S3>

[[XML 1.0 4e]] と [[XML 1.1 2e]] を参照しています。

[45] [CITE[Introduction – SVG Tiny 1.2]] ([TIME[2008-12-20 02:31:29 +09:00]] 版) <http://www.w3.org/TR/2008/REC-SVGTiny12-20081222/intro.html#compatibility>

[67] [[EmotionML]] は [[XML 1.1]] を参照しておらず、適合 [[EmotionML]] [[文書]]には [[XML 1.0]]
と [[XML名前空間1.0]]への適合を求めていますが、 [[EmotionML]] [[名前空間]]は [[XML名前空間1.0]]と[[XML名前空間1.1]]
で利用できるとしています [SRC[>>66]]。

[REFS[
- [66] [CITE@en[Emotion Markup Language (EmotionML) 1.0]] ([TIME[2014-05-20 20:02:30 +09:00]] 版) <http://www.w3.org/TR/emotionml/#s4>
]REFS]

* XML 1.1 は使われるのか

[20] XML 1.1 で嬉しい人は余りいないので XML 1.1
は使われないという意見があります。

特に、文字の正規化は面倒なだけなので誰も実装しないという意見があります。
実際、現在 W3C の XML 1.1 実装報告の頁に載っている実装は、
Duerest の charlint を呼び出すことができるものが1種類あるだけで、
他は正規化は実装していない模様です。

[21] 文字正規化以外の XML 1.1 の機能は XML 1.0
と然程違いがないので、実装は徐々に 1.1 に対応していくでしょうが、
文書の方はどうでしょう。 XML 1.1 仕様書も、
必要がない限り XML 1.0 を使えと言っていますしねぇ。

なんだかんだいっても少しずつ使われるようになっていくような気もしますけど、
普及して来た頃に今度は XML 1.2 が出たりして:)

[42]
[CITE@ja[「忘れられた XML1.1」@水無月ばけらのえび日記]] ([CODE[2007-06-29 15:36:42 +09:00]] 版) <http://bakera.jp/ebi/topic/2929>
([[名無しさん]] [WEAK[2007-06-29 12:58:23 +00:00]])

[[#comment]]


* メモ

[44] [CITE[OEBPS Container Format 1.0]] ([TIME[2008-01-16 00:44:29 +09:00]] 版) <http://www.idpf.org/ocf/ocf1.0/download/ocf10-20060911.htm#_Toc130009832>

>
-All XML files MUST be well-formed (as defined in XML 1.1) and thus include a correct XML declaration (e.g. <?xml version=’1.0’?>)
-All XML files MUST be compatible with the XML 1.1 specification (http://www.w3.org/TR/2004/REC-xml11-20040204) and the Namespaces in XML specification (http://www.w3.org/TR/REC-xml-names)

そんな無茶苦茶なwww

[46] [CITE[EMMA: Extensible MultiModal Annotation markup language]] ([TIME[2009-02-03 15:38:28 +09:00]] 版) <http://www.w3.org/TR/2009/REC-emma-20090210/#s5>

[[文書]]も[[処理器]]も [[XML 1.1]]、[[XML名前空間 1.1]] に適合しなければならないことになっています。
でも仕様書中の例示のどれにも [[XML宣言]]が含まれていませんが・・・。

[47] [[XML 1.1]] の規定により、[[XML 1.1]] に適合する[[処理器]]は [[XML 1.0]]
[[文書]]をも処理できなければなりません。一方、 [[XML 1.0]] に適合する[[文書]]が
[[XML 1.1]] にも適合するという規定は特にありません。なので [[XML宣言]]がないものは
[[XML 1.1]] には適合しません。

[48] [CITE@en-US[Basic XML Schema Patterns for Databinding Version 1.0]] ([TIME[2009-05-05 01:07:15 +09:00]] 版) <http://www.w3.org/TR/2009/NOTE-xmlschema-patterns-20090505/#assert-XML10>、
[CITE@en-US[Advanced XML Schema Patterns for Databinding Version 1.0]] ([TIME[2009-05-05 01:07:15 +09:00]] 版) <http://www.w3.org/TR/2009/NOTE-xmlschema-patterns-advanced-20090505/#document-conformance>

[[XML 1.0]] [[整形式]]で[['''なければなりません''']]とあり、 [[XML 1.1]] には言及されていません。

[49] [CITE@en-US[Service Modeling Language, Version 1.1]] ([TIME[2009-05-12 17:50:10 +09:00]] 版) <http://www.w3.org/TR/2009/REC-sml-20090512/#document>,
<http://www.w3.org/TR/2009/REC-sml-20090512/#Conformance>

[[XML 1.0]] [[整形式]]で[['''なければなりません''']]とあり、 [[XML 1.1]] には言及されていません。

[CITE@en-US[Service Modeling Language Interchange Format Version 1.1]] ([TIME[2009-05-12 17:50:21 +09:00]] 版) <http://www.w3.org/TR/2009/REC-sml-if-20090512/#Dependencies>

こちらでは [[XML 1.0]] を実装し[['''なければなりません''']]とあり、注記として新しい版にも対応してもよいが、
版間の差異による問題があるかも、とのみ言及があります。

[50] [CITE[XProc: An XML Pipeline Language]]
([TIME[2010-05-11 22:38:07 +09:00]] 版)
<http://www.w3.org/TR/2010/REC-xproc-20100511/#syntax>

[51] [CITE@EN[XQuery 1.0 and XPath 2.0 Functions and Operators (Second Edition)]]
( ([TIME[2010-12-17 00:06:54 +09:00]] 版))
<http://www.w3.org/TR/2010/REC-xpath-functions-20101214/#conformance>

[52] [CITE@en[RFC 6120 - Extensible Messaging and Presence Protocol (XMPP): Core]]
( ([TIME[2011-03-31 08:23:45 +09:00]] 版))
<http://tools.ietf.org/html/rfc6120#section-11.8>

[53] [CITE@en[Voice Browser Call Control: CCXML Version 1.0]]
( ([TIME[2011-06-28 19:48:47 +09:00]] 版))
<http://www.w3.org/TR/2011/REC-ccxml-20110705/#J1>

[54] [[InkML]] は [[XML 1.1]] だけを参照し、 [[XML 1.0]] を参照していません。

[REFS[
- [55] [CITE[Ink Markup Language (InkML)]] ([TIME[2011-09-20 17:16:49 +09:00]] 版) <http://www.w3.org/TR/2011/REC-InkML-20110920/#s8.1>
]REFS]

[56] [CITE@EN[W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes]]
( ([TIME[2012-04-05 06:34:51 +09:00]] 版))
<http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#intro-relatedWork>

[57] [CITE@EN[W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes]]
( ([TIME[2012-04-05 06:34:51 +09:00]] 版))
<http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#sec-ast-lex>

[58] [CITE@EN[W3C XML Schema Definition Language (XSD) 1.1 Part 1: Structures]]
( ([TIME[2012-04-05 06:34:07 +09:00]] 版))
<http://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/#intro-relatedWork>

[59] [CITE@en[233154 – Add support for XML 1.1]]
( ([TIME[2013-11-10 02:02:59 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=233154>

[60] [[Firefox]] も [[Chrome]] も [[XML 1.1]] を実装していません。 [TIME[2013-11-10T02:36:58.100Z]]

[61] [CITE@EN[XQuery 3.0: An XML Query Language]]
( ([TIME[2014-04-08 08:26:21 +09:00]] 版))
<http://www.w3.org/TR/xquery-30/#parse-note-xml-version>

[62] [CITE@EN[XML Path Language (XPath) 3.0]]
( ([TIME[2014-04-08 07:58:50 +09:00]] 版))
<http://www.w3.org/TR/xpath-30/#parse-note-xml-version>

[63] [CITE@en[XQuery and XPath Data Model 3.0]]
( ([TIME[2014-04-08 07:00:06 +09:00]] 版))
<http://www.w3.org/TR/xpath-datamodel-3/#xml-and-xsd-versions>

[64] [CITE@EN[XPath and XQuery Functions and Operators 3.0]]
( ([TIME[2014-04-08 07:02:07 +09:00]] 版))
<http://www.w3.org/TR/xpath-functions-3/#conformance>

[65] [CITE@en[XSLT and XQuery Serialization 3.0]]
( ([TIME[2014-04-07 23:19:15 +09:00]] 版))
<http://www.w3.org/TR/xslt-xquery-serialization-3/#reconstructed-tree>

[71] [CITE@en[RFC 7303 - XML Media Types]]
( ([TIME[2014-07-07 20:56:43 +09:00]] 版))
<http://tools.ietf.org/html/rfc7303#section-7>

[4] [CITE@EN[XQuery 3.1: An XML Query Language]]
([TIME[2017-03-20 09:23:33 +09:00]])
<https://www.w3.org/TR/2017/REC-xquery-31-20170321/#parse-note-xml-version>