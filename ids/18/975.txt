* 仕様書

[REFS[
- [4] '''[CITE@en-US[DOM Standard]] ([TIME[2013-04-26 20:00:45 +09:00]] 版) <http://dom.spec.whatwg.org/#dom-event-istrusted>'''
- [3] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2013-04-30 04:07:36 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#concept-events-trusted>
- [65] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#location>
- [68] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#allowed-to-show-a-popup>
]REFS]

* 信用済みイベント

[5] [CODE(DOMa)@en[[[isTrusted]]]] が[[真]]の[[イベント]]を[DFN[[RUBYB[[[信用済みイベント]]]@en[trusted event]]]]といいます [SRC[>>3]]。

[69] [DFN[[[allowed to show a popup]]]] とは、次のいずれかの条件を満たすことをいいます
[SRC[>>68]]。

[FIG(list)[
- [14] [[タスク]]が[[信頼済み]] [CODE(DOMe)@en[[[click]]]] [[イベント]]の[[活性化動作]]の処理中である
- [15] [[タスク]]が[[信頼済み]] [CODE(DOMe)@en[[[click]]]], [CODE(DOMe)@en[[[change]]]],
[CODE(DOMe)@en[[[dblclick]]]], [CODE(DOMe)@en[[[mouseup]]]], [CODE(DOMe)@en[[[reset]]]],
[CODE(DOMe)@en[[[submit]]]] [[イベント]]の[[イベントリスナー]]の処理中である
- [16] [[タスク]]が [[allowed to show a popup]] な[[タスク]]から[[タスクキューに追加]]されたものである、
ただし最初の[[タスク]]から[[利用者エージェント]]定義の[[時間]]が経過していない
]FIG]

;; [17] 時間制限は、例えば[[クリック]]から数秒後ならともかく、数時間後は相応しくない
[SRC[>>68]] ことによります。

[64] [CODE(DOMi)@en[[[Location]]]] では、次のいずれかの条件を満たすと分岐します [SRC[>>65]]。 ([[タスク]]以外の判定条件もあります。 [CODE(DOMi)@en[[[Location]]]] 参照。)
[FIG(list)[
- [66] [[タスク]]が[[信頼済み]] [CODE(DOMe)@en[[[click]]]] [[イベント]]の[[活性化動作]]の処理中である
- [67] [[タスク]]が[[信頼済み]] [CODE(DOMe)@en[[[click]]]] [[イベント]]の[[イベントリスナー]]の処理中である
]FIG]

[18] [[タスク]]は、自身がこの条件を満たしているかどうかの情報を保持しておく必要があります。
また[[イベントオブジェクト]] (の持つ情報の一部または全部) も必要かもしれません。
例えば [CODE(JS)@en[[[window.open]]]] は、[[プラットフォームの慣習]]により、 [KBD[[[Ctrl]]]] 
押下時に新しい[[閲覧文脈]]を常に開く、といったような動作にできます。

[25] 実際には [[allowed to show a popup]] の実装 (またはその呼び出し元の実装)
は更に厳しく制限しているかもしれません。

[EG[
[27] 例えば同じ[[タスク]]内で多数の新しい[[最上位閲覧文脈]]を作成するのは[[ブラクラ]]であり、
拒否するべきと考えられます。
]EG]

[26] 更に、[[タスク]]を超えた制約もあるかもしれません。

[EG[
[28] 例えば [CODE(JS)@en[[[setTimeout]]]] を使って短時間に別の[[タスク]]で多くの新しい[[最上位閲覧文脈]]を作成するのは[[ブラクラ]]であり、
拒否するべきと考えられます。
]EG]

[19] [[allowed to show a popup]] は、次の場面で使われます。
[FIG(list)[
- [20] 新しい[[最上位閲覧文脈]]を開くかどうかの判断 ([[閲覧文脈名から閲覧文脈を選ぶ規則]]など)
- [21] [CODE(HTMLa)@en[[[download]]]] や [[navigate]] で[[ダウンロード]]するべきかの判断
- [24] [[navigate]] で[[ヘルパーアプリケーション]]を起動するべきかの判断
- [22] [CODE(DOMm)@en[[[requestAutocomplete]]]] 時
- [23] [CODE(HTML)@en[[[<input type=file>]]]] [[ダイアログ]]を開くかどうかの判断
]FIG]

* 歴史

** [CODE(DOMa)@en[trusted]]

[8] 最初 [[XBL2]] で [CODE(DOMi)@en[[[Event]]]] [[オブジェクト]]が[[実装]]するべき[[インターフェイス]]
[DFN[[CODE(DOMi)@en[[[EventXBL]]]]]] の[[IDL属性]] [DFN[[CODE(DOMa)@en[[[trusted]]]]]]
として規定されました。

[REFS[
-[7] [CITE@en-US-x-Hixie[XML Binding Language 2.0]]
( ([TIME[2012-06-07 23:10:04 +09:00]] 版))
<http://www-archive.mozilla.org/projects/xbl/xbl2.html#the-eventxbl>
-[6] [CITE@en-US[XBL 2.0]]
( ([TIME[2012-05-03 02:23:03 +09:00]] 版))
<http://dev.w3.org/2006/xbl2/Overview.html#the-eventxbl-interface>
]REFS]

** [CODE(DOMa)@en[isTrusted]]

[REFS[
-[1] [CITE@en[Web Applications 1.0 r7437     Define when events are trusted and when they're not. Hopefully I got all the places that create and dispatch events...]]
( ([TIME[2012-10-07 03:04:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7436&to=7437>
-[2] [CITE[Add ''''''[''''''Unforgeable'''''']'''''' to isTrusted. · 559d925 · whatwg/dom]]
( ([TIME[2013-04-04 09:12:21 +09:00]] 版))
<https://github.com/whatwg/dom/commit/559d92560a94b5bebc3fdc9f037f971af7e9beb5>
]REFS]

[9] [CITE@en-US[Document Object Model (DOM) Level 3 Events Specification]]
( ([TIME[2012-10-25 23:58:38 +09:00]] 版))
<http://dev.w3.org/2006/webapi/DOM-Level-3-Events/html/DOM3-Events.html#events-event-type-isTrusted>

[10] [CITE@en-US[XML Binding Language (XBL) 2.0]]
( ([TIME[2007-03-16 22:20:16 +09:00]] 版))
<http://www.w3.org/TR/2007/CR-xbl-20070316/#trusted>

[11] [CITE@en-US[XML Binding Language (XBL) 2.0]]
( ([TIME[2007-03-16 22:20:16 +09:00]] 版))
<http://www.w3.org/TR/2007/CR-xbl-20070316/#the-eventxbl>

[12] [CITE@en-US[XML Binding Language (XBL) 2.0]]
( ([TIME[2007-03-16 22:20:16 +09:00]] 版))
<http://www.w3.org/TR/2007/CR-xbl-20070316/#trusted0>

[13] [CITE@en[Bug 25504 – isTrusted in the events generated by the methods]]
( ([TIME[2014-08-27 03:05:13 +09:00]] 版))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=25504>