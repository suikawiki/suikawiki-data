* 仕様書

[REFS[
- [3] [CITE@en[RFC 7616 - HTTP Digest Access Authentication]] ([TIME[2015-11-10 07:05:08 +09:00]] 版) <https://tools.ietf.org/html/rfc7616#section-3.4>
]REFS]

* 意味

[5] [[利用者]]が[[合言葉]]を知っていることを示すものです [SRC[>>3]]。

* 構文

[4] [[十六進数字]]列です [SRC[>>3]]。

[7] [[字句]]ではなく[[引用文字列]]を[[生成]]しなければ[['''なりません''']] [SRC[>>3]]。

* 値の算出

[8] [CODE(HTTP)@en[[[response]]]] [[引数]]の値は、
[CODE(HTTP)@en[[[qop]]]] [[引数]]の値が [CODE[[[auth]]]] や
[CODE[[[auth-int]]]] の時、次の通り定義されています [SRC[>>3]]。

[FIG(steps)[
= [11] [VAR[[[nonce]]]]、[VAR[[[nc]]]]、[VAR[[[cnonce]]]]、[VAR[[[qop]]]]
を、それぞれ同名の[[引数]]の値 ([[引用文字列]]は、その表す値) に設定します。
= [10] [VAR[値]]を、 [VAR[[[nonce]]]]、[CODE[[[:]]]]、[VAR[[[nc]]]]、
[CODE[[[:]]]]、[VAR[[[cnonce]]]]、[CODE[[[:]]]]、[VAR[[[qop]]]]、
[CODE[[[:]]]]、[VAR[[[H]]]] ([VAR[[[A2]]]]) を連結した値に設定します。
= [9] [VAR[[[KD]]]] ( [VAR[[[H]]]] ([VAR[[[A1]]]]), [VAR[値]] ) の結果を返します。
]FIG]

[13] [DFN[[VAR[[[A1]]]]]] は、次のように定義されています [SRC[>>3]]。

[FIG(steps)[
= [14] [VAR[アルゴリズム]]を、 [CODE(HTTP)@en[[[algorithm]]]]
[[引数]]の値に設定します。
= [16] [VAR[利用者名]]を、 [CODE(HTTP)@en[[[username]]]] [[引数]]の値
([[引用文字列]]の表す値) に設定します。
ただし、 [CODE[[[userhash]]]] [[引数]]の指定に従い[[ハッシュ化]]する場合でも、
[[ハッシュ化]]前の値を用います。
= [19] [VAR[realm]] を、 [CODE(HTTP)@en[[[realm]]]] [[引数]]の値
([[引用文字列]]の表す値) に設定します。
= [17] [VAR[合言葉]]を、適切な[[合言葉]]に設定します。
= [15] [VAR[アルゴリズム]]が [CODE[[[-sess]]]] で終わらないものなら、
== [18] [VAR[利用者名]]、[CODE[[[:]]]]、[VAR[realm]]、[CODE[[[:]]]]、[VAR[合言葉]]
を連結した値を返します。
= [20] それ以外なら、
== [21] [VAR[値]]を、 [VAR[利用者名]]、[CODE[[[:]]]]、[VAR[realm]]、
[CODE[[[:]]]]、[VAR[合言葉]]を連結したものに設定します。
== [23] [VAR[nonce-prime]] を、 [[challenge]] の [CODE(HTTP)@en[[[nonce]]]]
[[引数]]の値 ([[引用文字列]]の表す値) に設定します。
== [24] [VAR[cnonce-prime]] を、 [[credentials]] の [CODE(HTTP)@en[[[cnonce]]]]
[[引数]]の値 ([[引用文字列]]の表す値) に設定します。
== [22] [CODE[[VAR[[[H]]]] ([VAR[値]])]]、[CODE[[[:]]]]、
[VAR[nonce-prime]]、[CODE[[[:]]]]、[VAR[cnonce-prime]] を連結したものを返します。
]FIG]

[25] [DFN[[VAR[A2]]]] は、次のように定義されています [SRC[>>3]]。

[FIG(steps)[
= [31] [VAR[メソッド]]を、[[要求]]の[F[[[メソッド]]]]に設定します。
= [32] [VAR[要求URL]]を、
@@ ???
= [33] [VAR[実体本体]]を、[[要求]]の [F[[[payload body]]]] に設定します。
= [26] [VAR[[[qop]]]] を、 [CODE(HTTP)@en[[[qop]]]] [[引数]]の値に設定します。
= [27] [VAR[qop]] が [CODE[[[auth]]]] か未指定なら、
== [28] [VAR[メソッド]]、[CODE[[[:]]]]、[VAR[要求URL]]を連結したものを返します。
= [29] [VAR[qop]] が [CODE[[[auth-int]]]] なら、
== [30] [VAR[メソッド]]、[CODE[[[:]]]]、[VAR[要求URL]]、
[CODE[[[:]]]]、[CODE[[VAR[[[H]]]] ([VAR[実体本体]])]] を連結したものを返します。
]FIG]

;; [12] [CODE[[VAR[[[H]]]] ()]] と [CODE[[VAR[[[KD]]]] ()]] は、
[[ハッシュアルゴリズム]]に依存して決まる[[関数]]です。

* 文脈

[6] [[ダイジェスト認証]]の [[credentials]] の [CODE(ABNF)@en[[[auth-param]]]] として使うことができます [SRC[>>3]]。

* 歴史

[REFS[
- [2] [CITE@en[RFC 2069 - An Extension to HTTP : Digest Access Authentication]] ([TIME[2012-02-26 10:05:21 +09:00]] 版) <http://tools.ietf.org/html/rfc2069#section-2.1.2>
- [1] [CITE@en[RFC 2617 - HTTP Authentication: Basic and Digest Access Authentication]] ([TIME[2012-01-09 21:04:30 +09:00]] 版) <http://tools.ietf.org/html/rfc2617#section-3.2.2>
]REFS]