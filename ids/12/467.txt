[36] [DFN[ZIP]] は、広く用いられている[[書庫形式]]の一種です。

[37] 
[[Windows]]、[[Java]] などで採用され、[[書庫形式]]の[[事実上の標準]]となっています。


* 仕様書

[REFS[

- [66] 
[TIME[2022-11-01T17:34:41.000Z]], [TIME[2025-05-11T13:11:44.590Z]] <https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT>
- [15] [CITE[MIME Sniffing Standard]] ([TIME[2016-03-05 01:29:10 +09:00]] 版) <https://mimesniff.spec.whatwg.org/#zip-based-type>
]REFS]

* ファイル形式

[FIG(short list)[ [45] [[ZIPファイル]]

- [[ZIPファイルの署名]]
- [CODE[META-INF/]]
- [CODE[__MACOSX/]]

]FIG]


[50] [[Open Packaging]] ([[OOXML]]) は [[ZIP]] 仕様で曖昧な部分を [[Open Packaging]]
における規定として明確化しています。 [SRC[>>49]]

[49] [CITE@ja[ECMA-376-new-merged.pdf]], [TIME[2007-02-09T03:33:59.000Z]], [TIME[2024-06-04T14:04:20.573Z]] <http://web.mit.edu/~stevenj/www/ECMA-376-new-merged.pdf#page=255>

** ファイル名

[53] 
元々の仕様では[[ファイル名]]の[[文字コード]]は
[[CP437]]
とされますが、実際には各[[プラットフォーム]]の各言語環境の[[文字コード]]として扱われていました。

[54] 
例えば[[日本]]の [[DOS]] 系[[プラットフォーム]]では [[CP932]] が使われてきました。

[55] 
比較的新しく [[UTF-8]]
であることを[[中央ディレクトリー]]の
[[general purpose bit flag]] 第11ビット ([N[0x0800]])
で明示できるようになりました。

[58] 
現在では [[UTF-8]] フラグを利用して出力する実装が多くなってきており、
[[ZIP]] を使う[[ファイル形式]]等でこれの利用を要求する技術仕様もあります。

[59] 
しかし既に作成され蓄積されている膨大なデータとの[[後方互換性]]のため、実装は、

- [60] フラグなし、各種文字コード
- [61] フラグなし、 [[UTF-8]]
- [62] フラグあり、 [[UTF-8]]

に対応する必要があります。

[FIG(middle list)[ [67] [[ファイル名]]で使われることがあるとされる[[文字コード]] [要出典]

- [[CP437]]
- [[CP850]]
- [[CP857]]
- [[CP866]] ([CODE[ibm866]])
- [[CP932]] ([CODE[shift_jis]])
- [[CP936]] ([CODE[gb18030]])
- [[CP950]] ([CODE[big5]])
- [[CP949]] ([CODE[euc-kr]])
- [[CP874]] ([CODE[windows-874]])
- [[CP1250]] ([CODE[windows-1250]])
- [[CP1251]] ([CODE[windows-1251]])
- [[CP1252]] ([CODE[windows-1252]])
- [[CP1253]] ([CODE[windows-1253]])
- [[CP1254]] ([CODE[windows-1254]])
- [[CP1255]] ([CODE[windows-1255]])
- [[CP1256]] ([CODE[windows-1256]])
- [[UTF-8]] ([CODE[utf-8]])

]FIG]

[68] 
同じ [[UTF-8]] でも [[Windows]] などでは [[NFC]] 系の[[正規化]]に近い状態が一般的で
(ただし必ずしも[[正規化]]されるわけではない)、
[[Mac]] では [[NFD]] 系の[[正規化]]が適用されている状態
([SEE[ [[HFS+のNFD]] ]])
が標準的です。

-*-*-

[56] 
この他に
[[Extra Field]]
に 
[N[0x7075]] (Info-ZIP Unicode Path Extra Field)
として [[UTF-8]] [[ファイル名]]を通常の[[ファイル名]]と別に格納することができます。

[57] 
現在ではこの方法は一部の実装が読み取りに対応しているものの、書き込みには対応していないか、
特別に指定しないと出力しないようです。

-*-*-

[63] 
[[ファイル名]]の[[文字コード]]は[[ファイル]] ([[ディレクトリー]]を含みます。) 
ごとに違うものとできます。

[64] 
異なる[[文字コード]]の[[ファイル名]]の混在に対応している実装もありますが、
対応していない実装もあります。

[EG[
[65]
例えば[[文字コード]]の扱いが異なる[[アプリケーション]]によって[[ファイル]]を追加することで、
そのような[[ZIP]]ファイルが生成される可能性があります。
]EG]

-*-*-

[69] 
実世界の事例:

[REFS[

- [72] [[CP932]] 
-- [74] 
[TIME[2025-05-12T12:47:57.00Z]]
<https://www.city.yokohama.lg.jp/tsuzuki/kusei/koho/koho_tsuzuki/kohoback/R2tzkoho.files/2004tsuzuki-text.zip>
-- [75] 
[TIME[2025-05-12T12:53:38.00Z]]
<https://www.city.yokohama.lg.jp/totsuka/shokai/gaiyo/totsukafuoto/kategori_sagasu/sonota/c04-01-mt_fuji01.files/c04-01-0006.zip>
-- [73] 
[TIME[2025-05-12T11:46:36.00Z]]
<https://www2s.biglobe.ne.jp/~ant/gaiji.zip>
--- ([[半角カタカナ]])
-- >>78
- [79] [[EUC-JP]]
-- >>78
--- [80] 
<https://wiki.ubuntulinux.jp/Develop/UnzipTestcase?action=AttachFile&do=get&target=unzip_EUC-JP_testfile.zip>
- [71] [[CP950]]
-- [70] 
[TIME[2025-05-12T11:45:46.700Z]]
<https://www.cns11643.gov.tw/opendata/MapingTables.zip>


]REFS]

[76] 
実装関連:

[REFS[

- [77] 
[CITE@en[Bug #177929 “Should autodetect filename character encoding in zi...” : Bugs : file-roller package : Ubuntu]], [TIME[2025-05-16T09:43:23.000Z]] <https://bugs.launchpad.net/ubuntu/+source/file-roller/+bug/177929>
- [78] 
[CITE@ja[Develop/UnzipTestcase - Ubuntu Japanese Wiki]], [TIME[2025-05-16T09:43:54.000Z]] <https://wiki.ubuntulinux.jp/Develop/UnzipTestcase>


]REFS]

[81] 
[CITE@en[GitHub - vlm/zip-fix-filename-encoding: Fix cyrillic character encoding of filenames inside zip archives]], [TIME[2025-05-16T10:03:38.000Z]] <https://github.com/vlm/zip-fix-filename-encoding>

>Convert filenames inside ZIP archives from autodetected older Russian encodings (koi8-r, koi8-u, cp866, windows-1251) to UTF-8.


* MIME 型

[33] [DFN[[RUBYB[ZIPを基にした型]@en[ZIP-based type]]]]は、
次のいずれかを満たすものです [SRC[>>15]]。
[FIG(list)[
- [34] [[構文解析可能MIME型]]であって、[F[部分型]]が [CODE[+zip]] で終わるもの
- [35] [[構文解析可能MIME型]]であって、[F[MIME型部分]]が 
[CODE(MIME)@en[application/zip]] であるもの
]FIG]

;; [46] [[JSON]] 形式の一覧データファイルがあります。
[REFS[
- [47] [CITE@en[data-web-defs/mime-types.txt at master · manakai/data-web-defs]] ([TIME[2016-04-06 21:39:51 +09:00]] 版) <https://github.com/manakai/data-web-defs/blob/master/doc/mime-types.txt>
-- [48] ドキュメント: [CITE@en[data-web-defs/mime-types.json at master · manakai/data-web-defs]] ([TIME[2016-04-06 21:39:29 +09:00]] 版) <https://github.com/manakai/data-web-defs/blob/master/data/mime-types.json>
]REFS]

* [CODE(URI)@en[zip:]] URL scheme

[16] 構文: [CODE[zip:// zip-file-uri[! absolute-path] ]]

[17] 例:
-[SAMP(URI)[zip:http://somehost/downloads/somefile.zip]]
-[SAMP(URI)[jar:zip:outer.zip!/nested.jar!/somedir]]
-[SAMP(URI)[jar:zip:outer.zip!/nested.jar!/some%21dir]] 

[18] [CITE[Commons VFS - Supported File Systems]] <http://jakarta.apache.org/commons/sandbox/vfs/filesystems.html#Zip%20and%20Jar>

* 応用

[14] 
[FIG(list short)[
- [[JAR]]
- [[XPI]]
- [CODE[.crx]]
- [[Widgets]]
- [[OCF]]
- [[Open Document Format]]
- [[Open Packaging Conventions]]
- [[APK]]
- [[ASiC]]

]FIG]

* zipでくれ

[44] [CITE[俺の彼女と幼なじみが修羅場すぎる 全13話一挙放送 - 2023/6/14(水) 19:00開始 - ニコニコ生放送]]
([TIME[2023-06-19 11:06:22 +09:00]])
<https://live.nicovideo.jp/watch/lv341136348>


* 歴史

[1] [CITE@en-gb[Application Note Archives - PKWARE, Inc.]] ([[Justin Nichols]] 著, [TIME[2008-11-30 18:37:52 +09:00]] 版) <http://www.pkware.com/support/application-note-archives>

[51] 
[CITE@ja[Microsoft Word - A-100-5.doc - a_100_5.pdf]], [TIME[2024-08-30T08:17:33.000Z]] <https://web.archive.org/web/20060927005504/http://www.atsc.org/standards/a_100_5.pdf>

[2] [CITE@en-US[Data.driven() » Widgets 1.0]] ([TIME[2008-11-30 18:37:15 +09:00]] 版) <http://datadriven.com.au/tag/widgets-10/>

[3] [CITE@en-US[Zip files and Encoding - I hate you. | Data.driven()]] ([TIME[2009-07-05 11:55:12 +09:00]] 版) <http://datadriven.com.au/2008/12/08/zip-files-and-encoding-i-hate-you/>

[4] [CITE@en['''['''dsdl-discuss''']''' Basic ZIP format is "public domain" from rjelliffe_at_allette.com.au on 2010-03-26 (dsdl-discuss.2010-03)]]
([[rjelliffe_at_allette.com.au (rjelliffe_at_allette.com.au)]] 著, [TIME[2010-03-27 00:03:02 +09:00]] 版)
<http://lists.dsdl.org/dsdl-discuss/2010-03/0024.html>

[5] [CITE@ja[ZIP (ファイルフォーマット) - Wikipedia]]
( ([TIME[2012-11-16 23:51:31 +09:00]] 版))
<http://ja.wikipedia.org/wiki/ZIP_(%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88)>

[6] [CITE@en[Zip - WHATWG Wiki]]
( ([TIME[2013-08-31 03:47:21 +09:00]] 版))
<http://wiki.whatwg.org/wiki/Zip>

[7] ( ([TIME[2012-11-08 06:46:45 +09:00]] 版))
<http://www.itscj.ipsj.or.jp/sc34/open/1855.pdf>

[8] [CITE@en[RFC 6839 - Additional Media Type Structured Syntax Suffixes]]
( ([TIME[2013-06-28 00:23:48 +09:00]] 版))
<http://tools.ietf.org/html/rfc6839#section-3.6>

[9] [CITE[OASIS Open Document Format for Office Applications (OpenDocument) Version 1.2 - Part 3: Packages]]
([TIME[2011-09-29 13:00:00 +09:00]] 版)
<http://docs.oasis-open.org/office/v1.2/os/OpenDocument-v1.2-os-part3.html#a2_2_1OpenDocument_Package>

[10] ([TIME[2014-04-08 22:35:48 +09:00]] 版)
<https://www.khronos.org/files/collada_spec_1_5.pdf>

[FIG(quote)[
[FIGCAPTION[
[11] ([TIME[2011-07-16 05:29:35 +09:00]] 版)
<https://www.iana.org/assignments/media-types/application/zip>
]FIGCAPTION]

> This filetype is not recommended for normal use, since Content-Type
> information for the files contained within the archive are not known.
> Instead multipart/mixed should be used and each file should have it's
> own Content-Type.

]FIG]


[12] [CITE[Packaged Web Apps (Widgets) - Packaging and XML Configuration (Second Edition)]]
([TIME[2015-01-27 11:24:04 +09:00]] 版)
<http://w3c.github.io/packaged-webapps/packaging/>

[13] [CITE@en[RFC 6839 - Additional Media Type Structured Syntax Suffixes]] ([TIME[2013-06-28 00:23:48 +09:00]] 版) <http://tools.ietf.org/html/rfc6839#section-3.6>

[19] [CITE[IRC logs: freenode / #whatwg / 20131006]]
( ([TIME[2013-10-11 20:32:09 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20131006#l-537>

[20] [CITE[Remove zip archives (for now). · e5c1f60 · whatwg/fetch]]
( ([TIME[2013-10-30 06:19:44 +09:00]] 版))
<https://github.com/whatwg/fetch/commit/e5c1f60bce08f571b3da946560eeb3012776ab87>

[21] [CITE[packages.md]]
( ([TIME[2014-01-08 11:35:46 +09:00]] 版))
<https://gist.github.com/wycats/220039304b053b3eedd0>

[22] [CITE[IRC logs: freenode / #whatwg / 20140106]]
( ([TIME[2014-01-07 23:19:33 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20140106#l-347>

[23] [CITE@en[''''''[''''''dsdl-discuss'''''']'''''' Re: ISO/IEC 21320-1 - CD ballot from Jirka Kosek on 2013-09-13 (dsdl-discuss.2013-09)]]
( ([[Jirka Kosek (jirka_at_kosek.cz)]] 著, [TIME[2013-09-15 08:33:01 +09:00]] 版))
<http://lists.dsdl.org/dsdl-discuss/2013-09/0000.html>

[24] [CITE@en[Generic syntax]]
( ([[Anne van Kesteren]] 著, [TIME[2013-08-27 23:15:22 +09:00]] 版))
<http://lists.w3.org/Archives/Public/public-media-fragment/2013Aug/0001.html>

[25] [CITE@en[64286 – web archive save/view support (KDE/Konqueror-like .war, .zip, .tgz, .tar.gz, .tar.bz2, tb2, .tbz2, .jar)]]
([TIME[2015-05-07 23:03:12 +09:00]] 版)
<https://bugzilla.mozilla.org/show_bug.cgi?id=64286>

[26] [CITE[zip URLs]]
( ([TIME[2013-08-26 12:08:58 +09:00]] 版))
<https://gist.github.com/annevk/6174119>

[27] [CITE[''''''[''''''whatwg'''''']'''''' Zip archives as first-class citizens]]
( ([TIME[2013-08-28 13:32:53 +09:00]] 版))
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2013-August/040599.html>

[28] [CITE@en[MoPad: zipurls]]
( ([TIME[2013-08-29 14:06:47 +09:00]] 版))
<https://etherpad.mozilla.org/zipurls>

[29] [CITE[IRC logs: freenode / #whatwg / 20130823]]
( ([TIME[2013-08-26 12:15:51 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20130823#l-719>

[30] [CITE[IRC logs: freenode / #whatwg / 20130829]]
( ([TIME[2013-09-05 09:02:52 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20130829>

[31] [CITE@en[URL format for linking to resources inside ZIP files · Issue #137 · dataprotocols/dataprotocols]]
([TIME[2015-06-25 15:43:43 +09:00]] 版)
<https://github.com/dataprotocols/dataprotocols/issues/137>

[32] [CITE[技術/歴史/zip,gzip,zlib,bzip2 - Glamenv-Septzen.net]]
([TIME[2016-02-04 22:31:03 +09:00]] 版)
<http://www.glamenv-septzen.net/view/495>

[38] [CITE@en[Define a new MIME type model, parser, and serializer]]
([[annevk]]著, [TIME[2017-12-07 22:11:12 +09:00]])
<https://github.com/whatwg/mimesniff/commit/cc81ec48288944562c4554069da1d74a71e199fb>

[39] [CITE@en[Editorial: tweak MIME type group definitions]]
([[domenic]]著, [TIME[2018-02-06 06:35:09 +09:00]])
<https://github.com/whatwg/mimesniff/commit/452938939d1d88e3c74f59f41f14579249130437>

[40] [CITE@en[Editorial: tweak MIME type group definitions by domenic · Pull Request #59 · whatwg/mimesniff]]
([TIME[2018-02-17 18:28:01 +09:00]])
<https://github.com/whatwg/mimesniff/pull/59>

[41] [CITE@en[IETF HTML5 Meeting March 2009 - W3C Wiki]]
([TIME[2018-04-21 13:28:11 +09:00]])
<https://www.w3.org/wiki/IETF_HTML5_Meeting_March_2009>

[42] [CITE@ja[zipファイルをお送り頂いた場合の手数料について | 株式会社サムライズム]]
(2020年4月1日 に yusuke が投稿 [TIME[2020-04-03 13:08:22 +09:00]])
<https://samuraism.com/2020/04/01/11319>

[43] [CITE@ja[霞が関でパスワード付きzipファイルを廃止へ 平井デジタル相 - ITmedia NEWS]]
([TIME[2020-11-19T02:05:06.000Z]])
<https://www.itmedia.co.jp/news/articles/2011/17/news150.html>


[52] 
[CITE@ja[XユーザーのBinary numberさん: 「えー zip圧縮についてなんですがぁ... 調査の結果 Macが圧縮時にエンコードをUTF-8にしてるにもかかわらず、General purpose bit 11にフラグを立てずに圧縮するのが悪いってことがわかりました()」 / X]], [TIME[午前11:28 · 2024年12月12日][2024-12-12T02:28:26.000Z]], [TIME[2024-12-14T11:15:09.000Z]] <https://x.com/_actbit/status/1867033742738591908>
