[4] [[インターフェイス]]や[[例外]]が [RUBYB[[[JavaScript]] に晒されている]@en[exposed to JavaScript]]とは、
[[WebIDL]] の規定するところにより[[インターフェイス]]や[[例外]]が [[JavaScript]] の[[大域オブジェクト]]に晒されることをいいます
[SRC[>>1]]。

* 仕様書

[REFS[
- [24] '''[CITE[Web IDL (Second Edition)]] ([TIME[2014-02-10 21:45:38 +09:00]] 版) <http://heycam.github.io/webidl/#Exposed>'''
- [9] [CITE[Web IDL (Second Edition)]] ([TIME[2013-08-25 07:30:46 +09:00]] 版) <http://dev.w3.org/2006/webapi/WebIDL/#dfn-expose>
- [2] [CITE[Web IDL (Second Edition)]] ([TIME[2013-09-27 04:34:45 +09:00]] 版) <http://dev.w3.org/2006/webapi/WebIDL/#es-interfaces>
- [3] [CITE[Web IDL (Second Edition)]] ([TIME[2013-09-27 04:34:45 +09:00]] 版) <http://dev.w3.org/2006/webapi/WebIDL/#es-exceptions>
]REFS]

* 説明

[5] [[WebIDL]] により記述された[[インターフェイス]]や[[例外]]は、
[[コールバックインターフェイス]]や [CODE@en[[['''['''NoInterfaceObject''']''']]]] [[拡張属性]]がついたものを除き、
対応する[[インターフェイスオブジェクト]]や[[例外インターフェイスオブジェクト]]が[[大域オブジェクト]]の[[特性]]として存在することになります。
これを [[JavaScriptに晒されている]]といいます。

[EG[
[6] 例えば [CODE(DOMi)@en[[[Node]]]] [[インターフェイス]]は、その[[インターフェイスオブジェクト]]に
[CODE(JS)@en[[[window]].[[Node]]]] のようにしてアクセスできます。 (ここで [CODE(JS)@en[[[window]]]]
は[[大域オブジェクト]]を返すものとします。)
]EG]

[7] しかしすべての[[大域オブジェクト]]にすべての[[インターフェイス]]や[[例外]]が晒されるわけではありません。
ある[[インターフェイス]]や[[例外]]が[[大域オブジェクト]]に晒されるかどうかは、
それらの存在する[[JavaScript大域環境]]により異なります。

[EG[
[8] 例えば [CODE(DOMi)@en[[[Node]]]] [[インターフェイス]]は[[文書環境]]では[[JavaScriptに晒され]]ていますが、
[[ワーカー環境]]ではそうではありません。従って、 [CODE(JS)@en[[[self]]]] が[[大域オブジェクト]]を返すとして、
[CODE(JS)@en[[[self]].[[Node]]]] は[[文書環境]]では[[インターフェイスオブジェクト]]を返しますが、
[[ワーカー環境]]では [CODE(JS)@en[[[undefined]]]] を返します。
]EG]

* [CODE(IDL)@en[Exposed]] 拡張属性 (Web IDL)

[26] [DFN[[CODE(IDL)@en[[[Exposed]]]]]] [[拡張属性]]は、
指定された対象が[[晒される]]ことになる[[ECMAScript大域環境]]を表します。

** 文脈

[25] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]は、[[インターフェイス]]、
[[部分インターフェイス定義]]、[[インターフェイスメンバー]]、
[[コンストラクター]]付きの[[辞書]]に指定できます [SRC[>>24]]。

;; [42] [[例外]]には指定できません。

[32] [CODE(IDL)@en[[[Constructor]]]] [[拡張属性]]を持たない
[CODE(IDL)@en[[[dictionary]]]] に指定しては[['''なりません''']] [SRC[>>24]]。

[39] [[部分インターフェイス定義]]に指定すると、その[[インターフェイスメンバー]]すべてに指定したのと同義となります。
([[インターフェイス]]本体に指定した時と意味が異なります。)

[31] [[部分インターフェイス定義]]とその中の[[インターフェイスメンバー]]の両方に指定しては[['''なりません''']]
[SRC[>>24]]。

;; [40] [[インターフェイス]]本体に対する指定は[[部分インターフェイス定義]]の中の[[インターフェイスメンバー]]には適用されないようです。
[[部分インターフェイス定義]]には個別に指定が必要です。

;; [46] [[部分インターフェイス定義]]に何も指定しなければ[[インターフェイス]]本体と同じと解釈するのが自然な感じがしますが...

[30] [[overload]] された[[演算]]に現れる場合は、すべての [[overload]]
において同じ[[識別子リスト]]で現れなければ[['''なりません''']] [SRC[>>24]]。

** 構文

[28] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]には[[識別子]]1つか[[識別子リスト]]を指定しなければなりません。
[[識別子]]は[[大域名]]でなければなりません。 [SRC[>>24]]

** 効果

[27] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]が指定されない場合、
[[一次大域インターフェイス]]にのみ[[晒される]]ことになります [SRC[>>24]]。

[29] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]が指定された場合、
指定された[[大域名]]で表される[[インターフェイス]]を[[実装]]する[[大域オブジェクト]]の
[[ECMAScript大域環境]]にのみ[[晒される]]ことになります [SRC[>>24]]。

* 大域オブジェクトに晒されるもの

[33] [[辞書]]の[[コンストラクター]]や[[インターフェイス]]が[[ECMAScript大域環境]]に[[晒される]]のは、次の場合です
[SRC[>>24]]。

- [34] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]があって、
そこに指定された[[大域名]]を持つ[[インターフェイス]]を[[大域オブジェクト]]が[[実装]]している場合
- [35] [CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]がなくて、
[[大域オブジェクト]]が[[一次大域インターフェイス]]を[[実装]]している場合

;; [41] [[インターフェイスオブジェクト]]が[[大域オブジェクト]]に現れるのは、
これら[[晒される]]もののうちの一部です。

[43] [[例外]]はすべての[[ECMAScript大域環境]]に[[晒される]]ようです。

* インターフェイスメンバーとして晒されるもの

[36] [[インターフェイスメンバー]]が[[ECMAScript大域環境]]に[[晒される]]のは、
次の場合です [SRC[>>24]]。

- [37] [[インターフェイスメンバー]]かその属する[[部分インターフェイス定義]]に
[CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]があって、
そこに指定された[[大域名]]を持つ[[インターフェイス]]を[[大域オブジェクト]]が[[実装]]している場合
- [38] [[インターフェイスメンバー]]かその属する[[部分インターフェイス定義]]に
[CODE(IDL)@en[[[Exposed]]]] [[拡張属性]]がなくて、
[[大域オブジェクト]]が[[一次大域インターフェイス]]を[[実装]]している場合

;; [44] 主たる[[インターフェイス]]の定義に属する[[インターフェイスメンバー]]は、
明記されていない時所属する[[インターフェイス]]が[[晒される]]かに従うものと思われます。

;; [45] [[インターフェイス]]が[[晒される]][[大域環境]]以外に[[晒される]]ような[[インターフェイスメンバー]]を指定することも禁止はされていないようですが、
意味がありません。

* 歴史

[REFS[
- [1] '''[CITE@en-US-x-hixie[HTML Standard]] ([TIME[2013-10-18 20:52:42 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#exposed-to-javascript>'''
- [10] [CITE@en[Web Applications 1.0 r8425     Update the spec to say what's exposed to workers: take 1]]
( ([TIME[2014-01-28 08:08:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8424&to=8425>
- [11] [CITE[IRC logs: freenode / #whatwg / 20140127]]
( ([TIME[2014-01-28 20:45:52 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20140127>
- [12] [CITE@en[Web Applications 1.0 r8430 Try doing this a different way (MessageEvent.source exposure)]]
( ([TIME[2014-01-29 05:34:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8429&to=8430>
- [13] [CITE@en[Web Applications 1.0 r8444 Ok, go back to exposing MessageEvent.source in one form everywhere, relying on WebIDL for the rest of the logic here]]
( ([TIME[2014-01-30 11:41:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8443&to=8444>
- [14] [CITE@en[Web Applications 1.0 r8449     Forgot to expose some canvas interfaces to workers.]]
( ([TIME[2014-02-01 03:24:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8448&to=8449>
- [15] [CITE[Expose events in workers · 0f69e71 · whatwg/dom]]
( ([TIME[2014-02-01 02:21:53 +09:00]] 版))
<https://github.com/whatwg/dom/commit/0f69e7175dcae9edffa636bb213991330d225bf3>
- [16] [CITE[Expose TextDecoder and TextEncoder in workers · 6ac6218 · whatwg/encoding]]
( ([TIME[2014-02-01 23:37:48 +09:00]] 版))
<https://github.com/whatwg/encoding/commit/6ac62184e7902a2b28b8c1b85a996ab3f04da133>
- [17] [CITE@en[Web Applications 1.0 r8467 Remove the text made redundant by '''''''''['''''''''Exposed''''''''']''''''''']]
( ([TIME[2014-02-06 04:34:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8466&to=8467>
- [18] [CITE[Align with IDL changes to make the worker story better · 4d307f0 · whatwg/xhr]]
( ([TIME[2014-02-13 06:42:52 +09:00]] 版))
<https://github.com/whatwg/xhr/commit/4d307f0a00301fbd147ed78f37428694b14cde08>
- [19] [CITE@en[Web Applications 1.0 r7851 Try to clarify use of the term 'expose' in the WebIDL sense.]]
( ([TIME[2013-04-24 07:51:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7850&to=7851>
- [20] [CITE@en[Web Applications 1.0 r8467 Remove the text made redundant by ''''''[''''''Exposed'''''']'''''']] ([TIME[2014-02-06 04:34:00 +09:00]] 版) <http://html5.org/tools/web-apps-tracker?from=8466&to=8467>
]REFS]

[21] 当初は [[HTML Standard]] の本文によりどの[[インターフェイス]]が晒されるか定義されていましたが、
[[WebIDL]] の[[拡張属性]] [CODE[[[Exposed]]]] に置き換えられました。

[22] [CITE[Expose events in workers · 0f69e71 · whatwg/dom]]
( ([TIME[2014-04-11 22:50:24 +09:00]] 版))
<https://github.com/whatwg/dom/commit/0f69e7175dcae9edffa636bb213991330d225bf3>

[23] [CITE@en[Bug 25495 – Behavior of no '''['''Exposed''']''' on interface members is weird]] ([TIME[2014-06-25 08:13:30 +09:00]] 版) <https://www.w3.org/Bugs/Public/show_bug.cgi?id=25495>

[47] [CITE@en[Bug 25495 – Behavior of no ''''''[''''''Exposed'''''']'''''' on interface members is weird]]
( ([TIME[2014-07-29 23:37:02 +09:00]] 版))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=25495>

[57] [CODE(IDL)@en[[[Exposed]]]] (と [CODE(IDL)@en[[[Global]]]]
の値は [CODE[[[,]]]] 区切りで複数指定できることになっていましたが、
[[拡張属性]]同士の区切りも [CODE[[[,]]]] で構文上曖昧だったので、
複数値があるときは [CODE[[[(]]]]...[CODE[[[)]]]] で括るように2014年7月に変更されました。

[REFS[
- [48] [CITE@en[Bug 24959 – "Exposed=Window,Worker" will be parsed to 2 extended attributes]] ([TIME[2014-08-03 06:21:28 +09:00]] 版) <https://www.w3.org/Bugs/Public/show_bug.cgi?id=24959>
- [49] [CITE[Fix extended attribute identifier list argument grammar. · 0527ec4 · heycam/webidl]] ([TIME[2014-08-03 06:22:37 +09:00]] 版) <https://github.com/heycam/webidl/commit/0527ec461492849d310257c50a7d2c54b4632b91>
- [55] [CITE[Remove duplicate production. · 4e2c9d9 · heycam/webidl]] ([TIME[2014-08-03 06:30:17 +09:00]] 版) <https://github.com/heycam/webidl/commit/4e2c9d9bd8e9050051d4a23bcdef036ff1559da3>
- [56] [CITE[Tweak '''['''Exposed''']''' argument grammar. · 68ebd77 · heycam/webidl]] ([TIME[2014-08-03 06:30:38 +09:00]] 版) <https://github.com/heycam/webidl/commit/68ebd7772eb5b4b2e10bd8bdee56145c77e318cf>
- [50] [CITE[Fix '''['''Exposed''']''' for URLSearchParams · 067a2cd · whatwg/url]] ([TIME[2014-08-03 06:26:20 +09:00]] 版) <https://github.com/whatwg/url/commit/067a2cd418b8655dd9cac16ae12d58590dd2a41c>
- [51] [CITE[Use the new '''['''Exposed''']''' syntax · d59c1ad · whatwg/url]] ([TIME[2014-08-03 06:26:51 +09:00]] 版) <https://github.com/whatwg/url/commit/d59c1ade1684a68b64f868de819b22459467ef96>
- [52] [CITE[Update '''['''Exposed''']''' syntax · 4863bf9 · whatwg/fetch]] ([TIME[2014-08-03 06:27:19 +09:00]] 版) <https://github.com/whatwg/fetch/commit/4863bf91ed65e42fc8b2af8c287a4774be2640a1>
- [54] [CITE[Update '''['''Exposed''']''' syntax · ccc7660 · whatwg/xhr]] ([TIME[2014-08-03 06:29:24 +09:00]] 版) <https://github.com/whatwg/xhr/commit/ccc7660a02b168d949e43c518370044c14a0ce3f>
- [53] [CITE[Nothing shall escape '''['''Exposed''']''' https://www.w3.org/Bugs/Public/show_bug.c... · 59512a7 · whatwg/xhr]] ([TIME[2014-08-03 06:28:54 +09:00]] 版) <https://github.com/whatwg/xhr/commit/59512a70107244a3810662a8d8feb1f9fa2d9042>
]REFS]