[20] [DFN[[RUBY[Markdown][マークダウン]]]] は、[[テキスト]]系[[マーク付け言語]]の一種です。

[21] [[GitHub]] など[[エンジニア]]向け製品が採用したことで普及し、
世界的に使われるようになりました。しかし製品ごとに大きく異なる[[方言]]のため[[相互運用性]]は絶望的に低い状態にあります。

* 仕様書

[17] [[Markdown]] には様々な[[方言]]があり、[[標準]]が存在しません。
[[標準化]]の試みが複数ありましたが、相互に矛盾しており、
[[相互運用性]]は存在しないと言わざるを得ません。

[53] 近年 [[GitHub Flavored Markdown]] が人気を博しており、
これが[[事実上の標準]]と言われることもあります。しかし[[仕様書]]は存在せず、
[[GitHub Flavored Markdown]] 対応を謳う実装もそれぞれ異なる拡張を施しているなど、
「有力な[[方言]]」以上のものと位置づけるのは難しそうです。

* 方言

[18] [[Markdown]] には色々な方言があります。

[FIG(short list)[
- [[Markdown Extra]]
- [[GitHub Flavored Markdown]]
- [[CommonMark]]
- [[vfmd]]
- [[Markdown Extended]]
- [[でんでんマークダウンの記法]]
- [[Bikeshed]]
- [[Ecmarkdown]]
- [[Qiita::Markdown]]
- [[Markdown for Apple News Format]]
- [[kramdown Syntax]]
- [[grammarkdown]]
- [[MSON]]
- [[sgmljs.net Markdown]]
- [[R Markdown]]
- [[MultiMarkdown]]
- [[Jatdown]]
- [[Pandoc Markdown]]
- [[Softcover-flavored Markdown]]
- [[Spec Markdown]]
- [[ScholarlyMarkdown]]
- [[CTAN Mark­down]]
- [[Markdown Survey Format]]
- [[Stobo Flavored Markdown]]
- [[はてなブログのMarkdown]]
- [[MackerelのMarkdown]]
]FIG]

[44] 同じ方言に対応していると主張する実装であっても、更に細かい方言である場合があります。
(各項を参照。)

[19] 同じものを実装すると主張するソフトウェア同士でも解釈が一定しないことは普通です。
同じ会社の別の製品や、場合によっては同じ製品の異なる版同士で、
異なって解釈されることもよくあります。

[EG[
[45] 例えば[[ネイティブアプリケーション]]版で[[プレビュー]]を見ながら
[[Webサイト]]に投稿したら、 [[Webページ]]では違って見えることがあります。
]EG]

[38] ある製品向けに記述した [[Markdown]] の文書を、無変換でそのまま他の製品に完全に移植できることは期待しない方が安全です。

[39] 最悪[[プレインテキスト]]としてほぼ解釈できるとはいえ、重要な文書は [[Markdown]]
で記述しない方が安全です。

* 構文

[40] 
[FIG(short list)[
- [[HTMLタグ]]
- [[絵文字]]
]FIG]

* MIME型

[22] [[IETF]] は [DFN[[[RFC 7763]]]] で[[MIME型]]
[DFN[[CODE(MIME)@en[text/markdown]]]] を規定しています [SRC[>>15]]。

[23] 方言問題のため [CODE[variant]] [[引数]]を定義していますが、
これは[[ヒント]]とされており [SRC[>>15]]、
一応は[[IANA登録簿]] [SRC[>>24]] も用意されているものの、
その値を用いる義務もありません。

[50] つまり一応[[方言]]問題の対策は用意したというポーズだけで、
実際何の役にも立ちません。どのような値が与えられた時受信者がどう解釈するべきかも規定されていません。
例えば未知の値を指定された時や、指定された値と実際の内容に齟齬がある時、
指定された[[方言]]に対応していない時などに、
どのように動作するべきかはまったく不明です。

[51] [CODE[variant]] が指定されない時に内容をどう解釈するべきなのかも不明です。

-*-*-

[26] [CODE(MIME)@en[charset]] [[引数]]があり、[[必須]]とされています [SRC[>>15]]。

[27] [[RFC 6838]] に従ったものだ [SRC[>>15]] と言っていますが、
[CODE(MIME)@en[text/plain]] や [CODE(MIME)@en[text/html]] で
[CODE(MIME)@en[charset]] [[引数]]が正しく運用されてこなかった歴史と >>25
を踏まえると、[[政治的に正しい]]のかもしれませんが、この規定に意味があるのかは謎です。

[28] [[RFC]] は [[Markdown]] の仕様書で[[文字コード]]が規定されていないといっていますが、
そもそも、今の時代、 [[UTF-8]] 固定の実装が多いのではないかという気もします。
[CODE(MIME)@en[charset]] 引数が指定されない場合にどう扱うべきなのかは不明です。

-*-*-

[29] 更に他の任意の[[引数]]も使える [SRC[>>15]] とされています。
方言ごとに[[引数]]の意味を定めるべきだと言っていますが、
[CODE[variant]] 省略時に使用してはならないとの規定もありません。
[CODE[variant]] [[引数]]の制約もあってないようなものですから (>>23)、
実質的に標準化を放棄しているだけです。

[25] そもそも [[MIME型]]の[[引数]]というもの自体の[[相互運用性]]と[[可搬性]]がほとんどない現状で、
これらの定義すら曖昧な[[引数]]もほとんど役に立ちそうにありません。
[[実装]]は[[引数]]をすべて無視するべきですし、[[著者]]は[[引数]]を使うべきではありません。

* 素片識別子

[30] [[RFC]] は、[[素片識別子]]は方言次第としつつ、独自の構文も定めています
[SRC[>>15]]。

[31] 独自の構文は、 [CODE(MIME)@en[application/x-www-form-urlencoded]]
風ではありますが、曖昧な説明があるだけです。

[32] [CODE[line=123]] のようにして、[[行]]を指定できます [SRC[>>15]]。

[33] 他の[[引数]]とは [CODE[&]] で区切れます。方言は追加の引数を規定できます。 [SRC[>>15]]

[52] [[素片識別子]]に対応している実装があるのかは不明です。

* API

[14] [[Markdown API]]。

* 互換性と相互運用性

[46] [[Markdown]] の実装は色々あってそれぞれに異なる解釈があり、
同じ実装の異なる版で動作が異なることもよくあります。

[47] [[アプリケーション]]の開発者は、独自の方言を新たに作るべきではありません。
既存の[[ライブラリー]]があれば、それを利用するべきです。

[49] ただし、一度 [[HTML]] などに変換したら終わりの場合はともかく、
長期的に保存されるデータの場合は、利用する[[ライブラリー]]が継続的に適切にメンテナンスされる見込みがあるか、
慎重に判断する必要があります。バージョンアップしたら古いデータの解釈が変わってしまうというリスクがあります。

[37] 実装によっては、色々な[[方言]]の仕様を取り込んだ結果機能として破綻しているものもあります。

[EG[
[36] [[はてなブログのMarkdown]]は出自の異なる2種類の[[脚注]]構文を含んでおり、
それぞれ違った形で [[HTML]] として出力されるようです。
]EG]

* 関連

[34] [[RFC 7763]] は、 [[Markdown]] の[[プレビュー]]に使う [[MIME型]]を指定するための
[CODE(MIME)@en[Content-Disposition:]] [[ヘッダー]]の
[CODE(MIME)@en[preview-type]] [[引数]]を定義しています。

;; [35] 誰が使うんでしょうかね、これ...

* 歴史

- [1] [CITE@en[Daring Fireball: Markdown Syntax Documentation]]
( ([TIME[2014-02-05 08:00:15 +09:00]] 版))
<http://daringfireball.net/projects/markdown/syntax>

[2] [CITE[tantek / Markdown]]
( ([TIME[2014-08-30 03:15:04 +09:00]] 版))
<http://tantek.pbworks.com/w/page/59905776/Markdown>

[3] ( ([TIME[2014-11-12 08:09:48 +09:00]] 版))
<http://www.iana.org/assignments/media-types/text/markdown>

[4] [CITE@en[draft-ietf-appsawg-text-markdown-04 - The text/markdown Media Type]]
( ([TIME[2014-12-18 15:13:44 +09:00]] 版))
<http://tools.ietf.org/html/draft-ietf-appsawg-text-markdown-04>

[5] [CITE@en[the MDE manifest]]
( ([TIME[2014-11-19 18:20:41 +09:00]] 版))
<http://markdown-extended.github.io/manifest/>

[6] [CITE@en-US[Markdown Community Group]]
( ([TIME[2015-01-02 20:42:23 +09:00]] 版))
<http://www.w3.org/community/markdown/>

[7] [CITE@en[karlcow/markdown-testsuite]]
( ([TIME[2015-01-02 20:43:17 +09:00]] 版))
<https://github.com/karlcow/markdown-testsuite>

[8] [CITE[Markdown Syntax Specification]]
( ([TIME[2015-01-02 20:44:54 +09:00]] 版))
<http://rawgit.com/karlcow/markdown-testsuite/master/markdown-spec.html>

[9] [CITE[The Markdown-Discuss Archives]]
( ([TIME[2014-12-16 13:12:35 +09:00]] 版))
<https://pairlist6.pair.net/pipermail/markdown-discuss/>

[10] [[Pandoc]]

[11] [CITE@en[Comments]]
( ([TIME[2015-02-04 19:42:09 +09:00]] 版))
<http://doc.rust-lang.org/nightly/book/comments.html>


[FIG(quote)[
[FIGCAPTION[
[12] [CITE[Text::Markdown - search.cpan.org]]
([TIME[2015-10-07 17:44:59 +09:00]] 版)
<http://search.cpan.org/~bobtfish/Text-Markdown-1.000031/lib/Text/Markdown.pm>
]FIGCAPTION]

> Markdown is not interpreted in HTML block-level elements, in order for chunks of pasted HTML (e.g. JavaScript widgets, web counters) to not be magically (mis)interpreted. For selective processing of Markdown in some, but not other, HTML block elements, add a markdown attribute to the block element and set its value to 1, on or yes:
>     <div markdown="1" class="navbar">
>     * Home
>     * About
>     * Contact
>     <div>
> The extra markdown attribute will be stripped when generating the output.

]FIG]


[13] [CITE[Markdown - Qiitaマークダウンの癖 - Qiita]]
([TIME[2015-11-13 13:47:15 +09:00]] 版)
<http://qiita.com/Takeru/items/0c5e3f7910498b846bc1>

[15] [CITE@en[RFC 7763 - The text/markdown Media Type]]
([TIME[2016-03-28 02:57:21 +09:00]] 版)
<https://tools.ietf.org/html/rfc7763>

[16] [CITE@en[RFC 7764 - Guidance on Markdown: Design Philosophies, Stability Strategies, and Select Registrations]]
([TIME[2016-03-28 03:11:32 +09:00]] 版)
<https://tools.ietf.org/html/rfc7764>

[24] [CITE[Markdown Variants]] ([TIME[2016-03-29 02:50:58 +09:00]] 版) <https://www.iana.org/assignments/markdown-variants/markdown-variants.xml>

[FIG(quote)[
[FIGCAPTION[
[41] [CITE[Telegram Bot API]]
([TIME[2016-10-03 19:16:17 +09:00]])
<https://core.telegram.org/bots/api#formatting-options>
]FIGCAPTION]

> Use the following syntax in your message:
> *bold text*
> _italic text_
> '''['''text''']'''(http://www.example.com/)
> `inline fixed-width code`
> ```text
> pre-formatted fixed-width code block
> ```

]FIG]


[FIG(quote)[
[FIGCAPTION[
[42] [CITE@en[scholmd/scholmd: Learn how to use scholarly markdown]]
([TIME[2016-11-21 20:13:16 +09:00]])
<https://github.com/scholmd/scholmd>
]FIGCAPTION]

> Markdown is a fantastic and minimalist tool for authoring scientific documents. This repository is a collection of tools, resources, and tutorials to simplfy your workflow. If you spend a little time going through the tutorials you'll be able to stop using Microsoft Word entirely and write clean, lightweight markdown files that can easily be version controlled by git. Collaboration with your coauthors would also become way more powerful and simpler.

]FIG]


[43] [CITE@en[Extending Markdown · scholmd/scholmd Wiki]]
([TIME[2016-11-21 20:14:47 +09:00]])
<https://github.com/scholmd/scholmd/wiki/Extending-Markdown>

[FIG(quote)[
[FIGCAPTION[
[48] [CITE@en[Markdown | GitHub Developer Guide]]
( ([TIME[2016-12-21 11:10:42 +09:00]]))
<https://developer.github.com/v3/markdown/>
]FIGCAPTION]

> The raw API is not JSON-based. It takes a Markdown document as plaintext (text/plain or text/x-markdown) and renders it as plain Markdown without a repository context (just like a README.md file is rendered -- this is the simplest way to preview a readme online).

]FIG]


