[5] [DFN[[RUBYB[モジュール写像][module map]]]]は、
[[モジュールスクリプト]]の読み込みを管理するための[[仕様書]]上の[[データ構造]]です。
[[文書]]や[[ワーカー]]ごとに読み込み中や読み込み済みの[[モジュールスクリプト]]の [[URL]]
が保存されており、二重に [[fetch]] されるのを防ぐ働きをしています。

* 仕様書

[REFS[
- [10] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-03-27 03:13:07 +09:00]] 版) <https://html.spec.whatwg.org/#concept-document-module-map>
- [13] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-03-27 03:13:07 +09:00]] 版) <https://html.spec.whatwg.org/#environment-settings-object>
- [2] '''[CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-01-21 11:56:00 +09:00]] 版) <https://html.spec.whatwg.org/#module-map>'''
- [14] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-03-27 03:13:07 +09:00]] 版) <https://html.spec.whatwg.org/#concept-workerglobalscope-module-map>
]REFS]

* 意味

[3] [DFN[[F[[RUBYB[モジュール写像]@en[module map]]]]]]は、
[[絶対URL]]から値への[[写像]]です [SRC[>>2]]。

[4] 値は、[[モジュールスクリプト]]、 [[null]]、「[RUBYB[fetch中]@en[fetching]]」
のいずれかです [SRC[>>2]]。

[6] この[[写像]]は、[[輸入]]された [[JavaScript]] [[モジュール]]が、
一度だけ [[fetch]]、[[構文解析]]、[[評価]]されるようにするためのものです [SRC[>>2]]。

* 文脈

[11] [[文書]]は、[DFN[[F[[RUBYB[[[モジュール写像]]]@en[module map]]]]]]を持ちます。
初期状態では、空の[[モジュール写像]]です。 [SRC[>>10]]

[15] [CODE(DOMi)@en[WorkerGlobalScope]] は、
[DFN[[F[[RUBYB[[[モジュール写像]]]@en[module map]]]]]]を持ちます。
初期状態では、空の[[モジュール写像]]です。 [SRC[>>14]]

[12] [[環境設定群オブジェクト]]は、
[DFN[[F[[RUBYB[[[モジュール写像]]]@en[module map]]]]]]を持ちます [SRC[>>13]]。
これは[[文書]]や[[ワーカー大域オブジェクト]]の[F[モジュール写像]]を返すものです。

;; [[環境設定群オブジェクト]]参照。

[7] この[[写像]]は、[[単一モジュールスクリプトのfetch]]で参照・変更されます。

[8] この[[写像]]は、 [CODE[[[HostResolveImportedModule]]]] で参照されます。

[16] この[[写像]]は、[[未実現値化包括的子孫モジュールスクリプト群]]で参照されます。

* 歴史

[REFS[
- [1] [CITE@en[Add <script type="module"> and module resolution/fetching/evaluation · whatwg/html@cd1a9fb]] ([TIME[2016-01-21 23:18:53 +09:00]] 版) <https://github.com/whatwg/html/commit/cd1a9fb1e83f7d0bc30be8b34ecdaf444a0b19a4>
]REFS]

[9] [CITE@en[Move module map to Document/WorkerGlobalScope · whatwg/html@9a889fe]]
([TIME[2016-03-28 21:48:49 +09:00]] 版)
<https://github.com/whatwg/html/commit/9a889fee2ecb106974fb48fa50491edd77047954>