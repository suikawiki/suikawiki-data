[6] [DFN[[RUBYB[ハイパーリンクをたどる]@en[follow a hyperlink]]]]と、
[[リンク先]]への [[navigate]] が発生し、必要に応じて[[閲覧文脈]]が更新されます。

* 仕様書

[REFS[
- [5] '''[CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-03-24 02:22:02 +09:00]] 版) <https://html.spec.whatwg.org/#following-hyperlinks-2>'''
- [34] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-03-24 02:22:02 +09:00]] 版) <https://html.spec.whatwg.org/#hyperlink-auditing>
]REFS]

* 処理

[7] [[要素]][VAR[要素]]の[DFN[[RUBYB[[[ハイパーリンクをたどる]]]@en[follow a hyperlink]]]]ことを求められたら、
次のようにしなければ[MUST[なりません]] [SRC[>>5]]。

この操作は[[引数]]として次のものを受け取ります。
[FIG(list members)[
:[VAR[ハイパーリンク接尾辞]]:
[[画像写像]]の[[リンク]]では、[[座標]]から決まった値が指定されます。
通常の[[リンク]]では指定されません。
:[VAR[利用者指示]]:
「新しい[[閲覧文脈]]を開く」などの [[UI]] を通じた ([[利用者エージェント]]依存の) 
[[利用者]]からの指定です。
]FIG]

[FIG(steps)[
= [9] [VAR[始点]]を、[VAR[要素]]の[F[節点文書]]の[F[閲覧文脈]]に設定します。
= [10] [VAR[対象]]を、[[閲覧文脈の選択]]の結果に設定します。
この選択[[手続き]]には[VAR[要素]]と[VAR[利用者指示]]を引き渡します。
= [11] [VAR[要素]]の[F[リンク型群][リンク型]]に 
[CODE(HTML)@en[noreferrer]] または [CODE(HTML)@en[noopener]] が含まれていれば、
== [12] [VAR[置換]]を、[[真]]に設定します。
== [13] [VAR[対象]]の[F[opener閲覧文脈]]を [[disown][disown its owner]] します。
= [14] それ以外なら、
== [8] [VAR[置換]]を、[[偽]]に設定します。
= [15] [VAR[URL]] を、[VAR[要素]]の[F[節点文書]]について[VAR[要素]]の 
[CODE(HTMLa)@en[href]] [[属性値]]に [[URLの構文解析]]を適用した結果に設定します。
= [16] [VAR[URL]] が[[失敗]]なら、
== [18] 次のようにすることができます。
[FIG(list)[
- [19] [[利用者エージェント]]依存の方法で[[利用者]]に[[誤り]]を報告します。
- [22] [[タスク]]を[[タスクキューに追加]]します。
[FIG(list members)[
[FIGCAPTION[
[[タスク]]
]FIGCAPTION]
: [VAR[処理]] :
[FIG(steps)[
= [20] [[navigate]] します。
[FIG(list members)[
: [VAR[新しい[[資源]]]] : エラーを説明したページ
: [VAR[[[navigate]] する[[閲覧文脈]]]] : [VAR[対象]]
]FIG]
]FIG]
: [VAR[タスク源]] : [[DOM操作タスク源]]
]FIG]
- [21] 何もしません。
]FIG]
= [17] それ以外なら、
== [23] [VAR[URL]] の末尾に[VAR[ハイパーリンク接尾辞]]を追加します。
== [25] [[タスク]]を[[タスクキューに追加]]します。
[FIG(list members)[
[FIGCAPTION[
[[タスク]]
]FIGCAPTION]
: [VAR[処理]] :
[FIG(steps)[
= [26] [[navigate]] します。
[FIG(list members)[
: [VAR[新しい[[資源]]]] : 
[FIG(list members)[
: [VAR[URL]] : [VAR[URL]]
]FIG]
: [VAR[[[navigate]] する[[閲覧文脈]]]] : [VAR[対象]]
: [VAR[[[始点閲覧文脈]]]] : [VAR[始点]]
: [VAR[[[置換有効]]]] : [VAR[置換]]
]FIG]
]FIG]
: [VAR[タスク源]] : [[DOM操作タスク源]]
]FIG]
== [35] [VAR[要素]]が [CODE(HTMLe)@en[a]] [[要素]]または [CODE(HTMLe)@en[area]]
[[要素]]で、 [CODE(HTMLa)@en[ping]] [[属性]]を持つなら、
=== [36] [CODE(HTMLa)@en[ping]] [[属性]]の処理を実行します。 [SRC[>>34]]
]FIG]

[24] [VAR[URL]] に[[素片識別子]]が含まれる場合、[VAR[ハイパーリンク接尾辞]]はその後に追加されるので、
[[サーバー]]には送信されないことになります。おかしな動作ですが、
[[HTML Standard]]、[[Chrome]]、[[Firefox]] とも共通しています。

* 文脈

[32] 次の場面で用いられます。
[FIG(list)[
- [CODE(HTMLe)@en[a]] [[要素]]の[[活性化動作]]
- [CODE(HTMLe)@en[area]] [[要素]]の[[活性化動作]]
- [CODE(HTMLe)@en[link]] [[要素]]の[[活性化動作]]
- [CODE(HTMLe)@en[link]] [[要素]]から生成された [[UI]] 要素が選択された時
]FIG]

[33] [[SVG]] の [CODE(XMLe)@en[a]] [[要素]]や、かつて実装されていた頃の [[XLink]]
[[単純リンク]]もほぼ同様に処理されるべきものと思われますが、明文規定はありません。

* 利用者インターフェイス

[27] 普通、[[Webブラウザー]]は、実際に[[利用者]]が[[ハイパーリンクをたどる]]前に、
[[リンク先]]の [[URL]] ([VAR[URL]]) を[[利用者]]へのヒントとして提示します。

[28] かつては[[ステータスバー]]に示すのが一般的でしたが、
[[ステータスバー]]が使われなくなってからは、
一時的に[[ステータスバー]]の位置に表示する形態が普通となりました。

[31] [[tooltip]] として表示する実装もありました。

[29] [[利用者エージェント]]によっては、 [[URL]] 全体ではなく、
一部を省略して表示することがあります。

[30] [[Firefox]] は[VAR[ハイパーリンク接尾辞]]も含めて表示しますが、
[[Chrome]] は含めずに表示します。 [TIME[2016-03-26T04:18:24.300Z]]

[37] [CODE(HTMLa)@en[ping]] [[属性]]がある場合はその旨も併記する[SHOULD[べき]]
[SRC[>>34]] とされていますが、現行の[[利用者エージェント]]でそのように実装しているものはなさそうです。

;; [CODE(HTMLa)@en[ping]] も参照。

* ダウンロード

[38] 多くの[[利用者エージェント]]では、
[[利用者]]が[[ハイパーリンク]]をたどるか[[ダウンロード]]するか選択できます。
[[ダウンロード]]を選択した場合はそちらの処理が実行され、
本処理は実行されません。

;; [39] しかし、[[利用者]]が選択せずとも本処理から呼び出した [[navigate]]
が最終的に[[ダウンロード]]となることはあります。

* 歴史

[1] [CITE@en[Integrate Fetch into HTML · whatwg/html@7c5555a]]
([TIME[2015-09-18 18:47:59 +09:00]] 版)
<https://github.com/whatwg/html/commit/7c5555a16f2920c02244c10756bb2f1a11e87a22>

[2] [CITE@en[Clarify the following/downloading hyperlink algorithms · whatwg/html@47e4aa0]]
([TIME[2015-11-05 17:14:33 +09:00]] 版)
<https://github.com/whatwg/html/commit/47e4aa05825df966848ca2c7773794576a130b88>

[3] [CITE@en[Add a 'noopener' <link rel> keyword and window feature · whatwg/html@2992ea9]] ([TIME[2015-11-12 22:04:20 +09:00]] 版) <https://github.com/whatwg/html/commit/2992ea921bc75e44157451a37a807a8ce0b9a884>

[4] [CITE@en[Editorial: clarify follow a hyperlink algorithm · whatwg/html@d22a9f1]]
([TIME[2016-03-26 12:44:39 +09:00]] 版)
<https://github.com/whatwg/html/commit/d22a9f12e1cc13a77504fa6482b7ded6ba790b54>