[1] 多くの[[ファイル]]を扱うシステムに[DFN[ファイルの時刻]]の[[属性]]がいくつかあります。


* 種別

[2] ほとんどが

- [3] [[birthtime]] : 作成日時
- [4] [[mtime]] : 変更日時
- [5] [[ctime]] : 属性を含む変更日時
- [6] [[atime]] : 最終読取日時

... のいずれかに分類できます。

[7] 
ただし各[[日時]]の厳密な意味は[[プラットフォーム]]と[[ファイルシステム]]/[[データ形式]]/[[プロトコル]]によって異なります。

[9] 
[[NTFS]] では [CODE[$STANDARD_INFORMATION]] (ファイルの内容のデータ側)
と 
[CODE[$FILE_NAME]] ([[ファイル名]]側)
にそれぞれ4種類あります。
大まかに言って、内容が変更されれば両者が変更され、
ファイル操作が行われると後者が変更されます。
ファイル1個の情報の読み書きでは基本的に前者が使われ、
ファイル一覧の表示では後者が使われます。
[[ハードリンク]]が作られると、後者が複数個になります。

* 時間帯

[10] 
[[FATの日時形式]]は[[地方時]]を保存します。[[時差]]の情報が含まれず、
どこの[[時刻]]かわかりませんし、[[標準時]]か[[夏時刻]]かもわかりません。

[11] 
それより新しいほとんどのシステムは[[時差]]の概念のない絶対的な時刻の値を保存します。
[[利用者]]に表示するときは[[システムの時間帯]]に合わせて表示されます。

[12] 
[[ZIP]] のように、古くからある標準の[[ファイルの時刻]]は >>10
で、後から拡張として追加された (つまりすべての [[ZIPファイル]]に含まれるわけではない)
[[ファイルの時刻]]は >>11 で両方が共存しているという[[書庫形式]]もあります。


* プロトコル

[FIG(short list)[ [8] [[ファイルの時刻]]に関係する[[プロトコル要素]]と機能

- [[FATの日時形式]]
- [[NTFSの日時形式]]
- [[i-node]]
- [CODE[Content-Disposition]]
- [[ZIP]]
- [CODE[stat]]
- [CODE[touch]]

]FIG]

** ZIP

[15] 
[[ZIP]] は[[ファイル]]に対して[[日時]]を表す

- [16] last mod file date / last mod file time (date and time fields)
-- [61] [[FATの日時形式]]
-- [68] 各2バイト
-- [23] [[central directory]] が暗号化され [[general purpose bit flag 13]]
が masking を表すとき、 [[local header]] の値は 0 となる
- [17] 拡張 [N[0x000D]] : [[UNIX]] 用
-- [63] Atime (File last access time), Mtime (File last modification time)
-- [62] 各[[32ビット符号無し整数]] [[小エンディアン]]
--- [67] [[Unix time]]
-- [18] ほとんど使われていないという。
-- [96] 実装はあるにはあるらしい [SRC[>>95]]。 
- [19] 拡張 [N[0x000A]] : [[NTFS]] 用
-- [64] Mtime (File last modification time), Atime (File last access time), 
Ctime (File creation time)
-- [65] 各[[64ビット符号無し整数]] [[小エンディアン]]
--- [66] [[NTFSの日時形式]]
-- [22] 主に [[Windows]] で使われる
- [20] 拡張 [N[0x5455]] : [[Extended Timestamp Extra Field]] ([[Info-ZIP]])
-- [75] [[central directory header]] / [[local header]] : 
ModTime (time of last modification)
-- [76] [[central directory header]] :
ModTime (time of last modification),
AcTime (time of last access),
CrTime (time of original creation)
-- [74] 各[[32ビット符号無し整数]] [[小エンディアン]]
--- [73] [[Unix time]]
--- [94] 
[[符号付き整数]]とする実装がある [SRC[>>93]]
-- [21] 主に [[Unix]] で使われる
-- [77] flags でどの時刻が含まれるかを指定できる。5個分、
将来の拡張で時刻の追加ができるとされている。
-- [80] flags は [[local header]] に含まれる時刻を表すとされ、
[[central directory header]] は ModTime のみ含められ、
flags は [[local header]] と同じものを記述するとされる。
--- [81] 実際には [[local header]] と [[central directory header]]
で flags が異なる[[ZIPファイル]]が流通している。
- [37] 拡張 [N[0x5855]] : [[Info-ZIP Unix Extra Field]]
-- [83] [[central directory header]] と [[local header]]
にそれぞれ、 AcTime (time of last access), ModTime (time of last modification)
-- [82] 各[[32ビット符号無し整数]] [[小エンディアン]]
--- [85] [[Unix time]]
- [69] 拡張 [N[0x07C8]] : [[Info-ZIP Macintosh Extra Field]]
-- [71] [[central directory header]] と [[local header]]
にそれぞれ、 各[[32ビット整数]] [[大エンディアン]]
--- [84] おそらく[[符号無し整数]]
--- [70] [[HFSの日時形式]]
-- [72] [CODE[CrDat]] ([CODE[ioFlCrDat]]),
[CODE[MdDat]] ([CODE[ioFlMdDat]])
- [38] 拡張 [N[0x334D]] : [[Info-ZIP Macintosh Extra Field (new)]]
-- [86] [[local header]] の Attribs に
FlCrDat (date and time of creation),
FlMdDat (date and time of last modification),
FlBkDat (date and time of last backup)
--- [87] [[Mac]] [[FileTime]] 値
--- [88] [[地方時]]
--- [89] [[32ビット符号無し整数]] [[小エンディアン]]
Flags により64ビットに切り替えることができるとされる。
ただし Currently は32ビットで future version may 64ビットに対応するとある。
-- [90]  [[local header]] の Attribs に
CrGMTOffs, MdGMTOffs, BkGMTOffs
(difference "local [VAR[...]] time - UTC")
--- [91] [[32ビット符号付き整数]] [[小エンディアン]]
--- [92] Flags により含めるかどうかを指定できる。

... を持っています。

[60] [[ZIP]] は[[ファイル]]ごとに [[central directory header]] と [[local header]]
があります。前者は [[ZIP]] 全体の[[索引]]として一括されたものであり、
後者は個別の[[ファイル]]のデータに付与されたメタデータです。
どちらにも書き込まれる情報、一方にのみ書き込まれる情報、
両方に別の値で書き込まれる情報があります。
どう書き込むか仕様上で定まっている場合もあれば曖昧な場合もあり、
実データが仕様と一致していないこともよくあります。
こうした性格は[[日時]]情報各種にも当てはまります。


[REFS[

- [36] 
[CITE[null]], [TIME[2022-11-01T17:34:41.000Z]], [TIME[2025-12-30T15:47:51.658Z]] <https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT>
- [35] 
[CITE[null]], [TIME[2020-06-30T08:46:01.000Z]], [TIME[2025-12-30T15:47:33.052Z]] <https://libzip.org/specifications/extrafld.txt>
- [13] [CITE@en[zip展開後のタイムスタンプがおかしい · Issue #31 · koron/netupvim]], [TIME[2025-12-30T14:50:21.000Z]] <https://github.com/koron/netupvim/issues/31>
- [14] [CITE@en[archive/zip: handle mtime in NTFS/UNIX/ExtendedTS extra fields (18274) · Gerrit Code Review]], [TIME[2025-12-30T14:50:33.000Z]] <https://go-review.googlesource.com/c/go/+/18274>
- [79] 
[CITE@en[A non-scientific survey of ZIP Metadata]], [TIME[2025-12-31T09:27:51.000Z]] <https://publicobject.com/2024/02/26/zip-metadata/>
- [93] 
[CITE@en[X5455_ExtendedTimestamp (The Adobe Experience Manager SDK 2022.11.9850.20221116T162329Z-220900)]], [TIME[2025-11-06T10:59:11.000Z]], [TIME[2025-12-31T09:56:30.240Z]] <https://developer.adobe.com/experience-manager/reference-materials/cloud-service/javadoc/org/apache/commons/compress/archivers/zip/X5455_ExtendedTimestamp.html>
- [95] 
[CITE@en[7-Zip / Bugs / #1432 7ZFM can't recognize UNIX timestamps in .ZIP archive]], [TIME[2025-12-31T10:01:42.000Z]] <https://sourceforge.net/p/sevenzip/bugs/1432/>


]REFS]


[78] 
[CITE@en[GitHub - thejoshwolfe/yazl: yet another zip library for node]], [TIME[2025-12-31T09:25:14.000Z]] <https://github.com/thejoshwolfe/yazl>

>When attempting to encode an [CODE[mtime]] outside the supported range for either format, such as the year 1970 in the DOS format or the year 2039 for the modern format, the time will clamped to the closest supported time.



*** 利用例

[46] 実利用例:

[REFS[

- [47] [TIME[2025-12-30T16:09:29.800Z]]
<https://opendata.attica.gov.gr/content/genikh-dieythynsh-eswterikhs-leitoyrgias/d-nsh-dioikhtikwn-yphresiwn/155-diakhrykseis?fdl=WGNVMDZpUXBkL0VvczA4L0RHM1NMVWxCMkRQSUdMdWlDbjNFY1VGZTZSQXk2aEJoWGhoSkRGZWtSa0diR2c0MVltZ3ZNa3R1VTA1MlZUWnNSM0p6V21wWk5ERk5VVDA5>
-- [48] [[ディレクトリー]], 一般[[ファイル]]とも [[central directory]] に [[NTFS]] 時刻
- [49] 
[TIME[2025-12-31T02:15:50.500Z]]
<https://statistique.quebec.ca/en/fichier/rda-startup-kit.zip>
-- [52] [TIME[2025-12-31T02:20:17.100Z]]
<https://web.archive.org/web/20251231021855/https://statistique.quebec.ca/en/fichier/rda-startup-kit.zip>
--- [53] 古いものは同じ [[URL]] でも別ファイル (日付構造も違う) なので注意。
-- [50] [[ディレクトリー]]は 
[[local header]]
の
[N[0x5455]]
に mtime, atime, ctime (flag もこれに一致)
[[central directory]]
に mtime (flag もこれに一致)
-- [51] 一般[[ファイル]]は
[[central directory]]
に mtime (flag もこれに一致)
- [54] 
[TIME[2025-12-31T03:01:46.400Z]]
<https://www.sio.gov.sa/assets/files/guide_files/Arabic.zip>
-- [55] [[ディレクトリー]]は [N[0x5855]] に
[[central directory]], [[local header]] の modtime, actime の計4つ同じ値。
--- [56] おそらく[[時差]]を除いて last mod file date / time とも同じ値。
-- [57] [[ファイル]]は [N[0x5855]] に
[[central directory]] のみ modtime, actime の2つが別の値。
--- [58] last mod file date / time と modtime が同じ値。
- [97] 
[TIME[2025-12-31T10:05:01.00Z]]
<https://web.archive.org/web/20110706022639/http://www.youngcreativechevrolet.eu/app/webroot/uploads/fonts_ycc.zip>
-- [98] [[ディレクトリー]]は [N[0x5855]] に
[[central directory]], [[local header]] の modtime, actime の計4つの値。
-- [99] [[ファイル]]は [N[0x5855]] に
[[central directory]] のみ modtime, actime の2つの値。


]REFS]


[25] 人工的な利用例:

[REFS[

- [24] [TIME[2025-12-30T15:12:40.200Z]]<https://bugs.python.org/file48724/t.zip>
-- [26] [[ディレクトリー]]は [N[0x5455]] に
--- [27] [[central directory]] では
flag では mtime と atime が入っていることになっているが値は mtime だけ
(仕様通り)
--- [28] [[local header]] では
mtime と atime の両方が値もある
-- [29] 一般[[ファイル]]は [N[0x5455]] に
--- [30] [[central directory]] では
flag では mtime と atime が入っていることになっているが値は mtime だけ
--- [31] [[local header]] には [N[0x5455]] が無し
- [32] [TIME[2025-12-30T15:26:42.000Z]]<https://github.com/icsharpcode/SharpZipLib/files/2522058/UTF8_Filenames.zip>
-- [33] >>24 と同じ構造
- [39] [TIME[2025-12-30T15:51:44.800Z]]
<https://github.com/user-attachments/files/16069900/default.zip>
-- [40] [[central directory]] に NTFS タイムスタンプがあります。
3つの時刻のどれも last mod file date / time と微妙にずれています。
- [41] [TIME[2025-12-30T16:02:49.400Z]]
<https://github.com/thejoshwolfe/yauzl/files/1973376/default.zip>
-- [42] [[ディレクトリー]]は [N[0x5855]] に
[[central directory]], [[local header]] の modtime, actime の計4つ同じ値。
--- [43] おそらく[[時差]]を除いて last mod file date / time とも同じ値。
-- [44] [[ファイル]]は [N[0x5855]] に
[[central directory]] のみ modtime, actime の2つが別の値。
--- [45] last mod file date / time とは一致しないが、おそらく modtime
と少し前後した時刻。

]REFS]

** メモ

[34] 
[CITE@ja[アーカイブファイルフォーマットのタイムスタンプまとめ]], [TIME[2025-12-30T15:42:11.000Z]] <https://zenn.dev/sorairolake/articles/timestamp-of-archive-formats>



[59] 
[[Git]] は [[commit]] に日付があり、[[ファイル]]には[[日付]]がありません。
他の多くの[[版管理システム]]でも同様です。




* メモ