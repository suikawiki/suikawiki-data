[1] 多くの[[ファイル]]を扱うシステムに[DFN[ファイルの時刻]]の[[属性]]がいくつかあります。


* 種別

[2] ほとんどが

- [3] [[birthtime]] : 作成日時
- [4] [[mtime]] : 変更日時
- [5] [[ctime]] : 属性を含む変更日時
- [6] [[atime]] : 最終読取日時

... のいずれかに分類できます。

[7] 
ただし各[[日時]]の厳密な意味は[[プラットフォーム]]と[[ファイルシステム]]/[[データ形式]]/[[プロトコル]]によって異なります。

[9] 
[[NTFS]] では [CODE[$STANDARD_INFORMATION]] (ファイルの内容のデータ側)
と 
[CODE[$FILE_NAME]] ([[ファイル名]]側)
にそれぞれ4種類あります。
大まかに言って、内容が変更されれば両者が変更され、
ファイル操作が行われると後者が変更されます。
ファイル1個の情報の読み書きでは基本的に前者が使われ、
ファイル一覧の表示では後者が使われます。
[[ハードリンク]]が作られると、後者が複数個になります。

* 時間帯

[10] 
[[FATの日時形式]]は[[地方時]]を保存します。[[時差]]の情報が含まれず、
どこの[[時刻]]かわかりませんし、[[標準時]]か[[夏時刻]]かもわかりません。

[11] 
それより新しいほとんどのシステムは[[時差]]の概念のない絶対的な時刻の値を保存します。
[[利用者]]に表示するときは[[システムの時間帯]]に合わせて表示されます。

[12] 
[[ZIP]] のように、古くからある標準の[[ファイルの時刻]]は >>10
で、後から拡張として追加された (つまりすべての [[ZIPファイル]]に含まれるわけではない)
[[ファイルの時刻]]は >>11 で両方が共存しているという[[書庫形式]]もあります。


* プロトコル

[FIG(short list)[ [8] [[ファイルの時刻]]に関係する[[プロトコル要素]]と機能

- [[FATの日時形式]]
- [[NTFSの日時形式]]
- [[i-node]]
- [CODE[Content-Disposition]]
- [[ZIP]]
- [CODE[stat]]
- [CODE[touch]]

]FIG]

** ZIP

[15] 
[[ZIP]] は

- [16] last mod file date / last mod file time
-- [23] 元々ある [[FATの日時形式]]そのままのもの
- [17] 拡張 [N[0x000D]] : [[UNIX]] 用 Atime, Mtime
-- [18] ほとんど使われていない
- [19] 拡張 [N[0x000A]] : [[NTFS]] 用 Mtime, Atime, Ctime
-- [22] 主に [[Windows]] で使われる
- [20] 拡張 [N[0x5455]] : [[Extended Timestamp Extra Field]] ([[Info-ZIP]])
-- [21] 主に [[Unix]] で使われる
- [37] 拡張 [N[0x5855]] : [[Info-ZIP Unix Extra Field]]
- [38] 拡張 [N[0x334D]] : [[Info-ZIP Macintosh Extra Field]]

... を持っています。

[REFS[

- [36] 
[CITE[null]], [TIME[2022-11-01T17:34:41.000Z]], [TIME[2025-12-30T15:47:51.658Z]] <https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT>
- [35] 
[CITE[null]], [TIME[2020-06-30T08:46:01.000Z]], [TIME[2025-12-30T15:47:33.052Z]] <https://libzip.org/specifications/extrafld.txt>
- [13] [CITE@en[zip展開後のタイムスタンプがおかしい · Issue #31 · koron/netupvim]], [TIME[2025-12-30T14:50:21.000Z]] <https://github.com/koron/netupvim/issues/31>
- [14] [CITE@en[archive/zip: handle mtime in NTFS/UNIX/ExtendedTS extra fields (18274) · Gerrit Code Review]], [TIME[2025-12-30T14:50:33.000Z]] <https://go-review.googlesource.com/c/go/+/18274>

]REFS]

*** 利用例

[46] 実利用例:

[REFS[

- [47] [TIME[2025-12-30T16:09:29.800Z]]
<https://opendata.attica.gov.gr/content/genikh-dieythynsh-eswterikhs-leitoyrgias/d-nsh-dioikhtikwn-yphresiwn/155-diakhrykseis?fdl=WGNVMDZpUXBkL0VvczA4L0RHM1NMVWxCMkRQSUdMdWlDbjNFY1VGZTZSQXk2aEJoWGhoSkRGZWtSa0diR2c0MVltZ3ZNa3R1VTA1MlZUWnNSM0p6V21wWk5ERk5VVDA5>
-- [48] [[ディレクトリー]], 一般[[ファイル]]とも [[central directory]] に [[NTFS]] 時刻
- [49] 
[TIME[2025-12-31T02:15:50.500Z]]
<https://statistique.quebec.ca/en/fichier/rda-startup-kit.zip>
-- [52] [TIME[2025-12-31T02:20:17.100Z]]
<https://web.archive.org/web/20251231021855/https://statistique.quebec.ca/en/fichier/rda-startup-kit.zip>
--- [53] 古いものは同じ [[URL]] でも別ファイル (日付構造も違う) なので注意。
-- [50] [[ディレクトリー]]は 
[[local header]]
の
[N[0x5455]]
に mtime, atime, ctime (flag もこれに一致)
[[central directory]]
に mtime (flag もこれに一致)
-- [51] 一般[[ファイル]]は
[[central directory]]
に mtime (flag もこれに一致)
- [54] 
[TIME[2025-12-31T03:01:46.400Z]]
<https://www.sio.gov.sa/assets/files/guide_files/Arabic.zip>
-- [55] [[ディレクトリー]]は [N[0x5855]] に
[[central directory]], [[local header]] の modtime, actime の計4つ同じ値。
--- [56] おそらく[[時差]]を除いて last mod file date / time とも同じ値。
-- [57] [[ファイル]]は [N[0x5855]] に
[[central directory]] のみ modtime, actime の2つが別の値。
--- [58] last mod file date / time と modtime が同じ値。


]REFS]


[25] 人工的な利用例:

[REFS[

- [24] [TIME[2025-12-30T15:12:40.200Z]]<https://bugs.python.org/file48724/t.zip>
-- [26] [[ディレクトリー]]は [N[0x5455]] に
--- [27] [[central directory]] では
flag では mtime と atime が入っていることになっているが値は mtime だけ
(仕様通り)
--- [28] [[local header]] では
mtime と atime の両方が値もある
-- [29] 一般[[ファイル]]は [N[0x5455]] に
--- [30] [[central directory]] では
flag では mtime と atime が入っていることになっているが値は mtime だけ
--- [31] [[local header]] には [N[0x5455]] が無し
- [32] [TIME[2025-12-30T15:26:42.000Z]]<https://github.com/icsharpcode/SharpZipLib/files/2522058/UTF8_Filenames.zip>
-- [33] >>24 と同じ構造
- [39] [TIME[2025-12-30T15:51:44.800Z]]
<https://github.com/user-attachments/files/16069900/default.zip>
-- [40] [[central directory]] に NTFS タイムスタンプがあります。
3つの時刻のどれも last mod file date / time と微妙にずれています。
- [41] [TIME[2025-12-30T16:02:49.400Z]]
<https://github.com/thejoshwolfe/yauzl/files/1973376/default.zip>
-- [42] [[ディレクトリー]]は [N[0x5855]] に
[[central directory]], [[local header]] の modtime, actime の計4つ同じ値。
--- [43] おそらく[[時差]]を除いて last mod file date / time とも同じ値。
-- [44] [[ファイル]]は [N[0x5855]] に
[[central directory]] のみ modtime, actime の2つが別の値。
--- [45] last mod file date / time とは一致しないが、おそらく modtime
と少し前後した時刻。

]REFS]

** メモ

[34] 
[CITE@ja[アーカイブファイルフォーマットのタイムスタンプまとめ]], [TIME[2025-12-30T15:42:11.000Z]] <https://zenn.dev/sorairolake/articles/timestamp-of-archive-formats>



[59] 
[[Git]] は [[commit]] に日付があり、[[ファイル]]には[[日付]]がありません。
他の多くの[[版管理システム]]でも同様です。




* メモ