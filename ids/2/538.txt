[1] [[URL]] は同じものを表すにも関わらず複数の表現方法がある場合が数多く存在します。
その一方で、 [[URL]] [WEAK[(によって表されるもの)]] が同一かどうか判定したいこともあります。
それ故、2つの [[URL]] が同一かどうかを判定する'''[[比較演算]]'''を定義する必要が生じます。
比較演算の定義に当たっては'''[[正規化]]'''の方法を規定し、それによる[[正規形]]の比較を用いることもあります
[WEAK[(もちろん[[正規化]]なしで[[比較]]を定義することもあります)]]。
なお、[[正規化]]は純粋な[[比較]]のため以外にも[[部品]]の取り出しや[[パターン一致]]のために使われることがありますし、
[[人間]]が読むためにも便利です。

[22] [[URL]] は表現の自由度が極めて高く、しかも様々な場面で使われているため、
[[比較]]と[[正規化]]の方法は色々定義されています。
[[比較]]や[[正規化]]の[[コスト]]を無視できないというのも様々なバリエーションが生まれる要因となっています。

* 単純文字列比較

''[[URLの単純文字列比較]]''

[23] 最も単純なのが、 [[URL]] を単純に[[文字列]]として比較する、というものです。

[24] ほとんど自明な比較方法に思えますが、単純比較すら、いくつかバリエーションが考えられます。
- [25] 与えられた [[URL]] を本当に純粋に[[文字列]]として[[比較]]する
- [26] 与えられた [[URL]] が[[相対URL]] なら[[絶対URL]] に[[解決]]した上で、[[文字列]]として[[比較]]する
- [27] 与えられた [[IRI]] を [[URI]] にした上で、[[文字列]]として[[比較]]する
- [28] 与えられた [[URL]] を[[バイト列]]として比較する

[29] 普通は >>25 だろう、と思えるかもしれませんが、規定をよく読むと比較演算への入力が元々の入力そのものではなく[[解決]]後の
[[URL]] だったり、[[RFC 3986]] [[URI]] 上の演算として定義されていたりするので注意が必要です。

[30] 普通は仕様上は[[文字列]]に対して比較が定義されていますが、現実の実装はしばしば[[バイト列]]に対して比較が実装されていたりして、
[[非ASCII文字]]が含まれる時に結果が変わってしまうことがあるので、やはり注意が必要です。

* URL scheme にあまり依存しない比較・正規化

[FIG(list)[
- [32] [[AtomにおけるURLの正規形]]
- [16] [[OAuthにおけるURLの正規化]]
]FIG]

* URL scheme に依存した比較・正規化

[FIG(list)[
- [31] [[HTTPにおけるURLの比較]]
- [33] [[SIPにおけるURLの比較]]
- [36] [CODE(URI)@en[[[msrp:]]]] / [CODE(URI)@en[[[msrps:]]]]
- [40] [[ハッシュ値URLの比較]]
]FIG]

[REFS[
- [35] [CITE[Widget Access Request Policy]] ([TIME[2012-02-04 04:00:27 +09:00]] 版) <http://dev.w3.org/2006/waf/widgets-access/#ta-case-insensitive-compare>
]REFS]

* 歴史

[FIG(quote)[
[FIGCAPTION[
[41] RFC 2396 (URI) 6. URI Normalization and Equivalence
]FIGCAPTION]

> In many cases, different URI strings may actually identify the
identical resource. For example, the host names used in URL are
actually case insensitive, and the URL <http://www.XEROX.com> is
equivalent to <http://www.xerox.com>. In general, the rules for
equivalence and definition of a normal form, if any, are scheme
dependent. When a scheme uses elements of the common syntax, it will
also use the common syntax equivalence rules, namely that the scheme
and hostname are case insensitive and a URL with an explicit ":port",
where the port is the default for the scheme, is equivalent to one
where the port is elided.
]FIG]

* メモ

- [3] [[XML]] と関連仕様における URI の扱いについては [[XML//URI]] も参照して下さい。

[10]
[[RFC 4452]]: [CODE(URI)@en[[[info]]:]] [[URI]] の比較法

[12]

@@ [[SOAP]]: 応用依存


[20] [CITE[Wondering around: Java's URL little secret]]
([TIME[2009-08-29 10:34:46 +09:00]] 版)
<http://www.eishay.com/2008/04/javas-url-little-secret.html>

[21] [CITE[OWL 2 Web Ontology Language Structural Specification and Functional-Style Syntax]]
([TIME[2009-10-27 23:15:00 +09:00]] 版)
<http://www.w3.org/TR/2009/REC-owl2-syntax-20091027/#IRIs>

[34] [CITE@en[RFC 6021 - Common YANG Data Types]]
([TIME[2010-10-07 04:53:03 +09:00]] 版)
<http://tools.ietf.org/html/rfc6021>

[37] [CITE@en[RFC 6943 - Issues in Identifier Comparison for Security Purposes]]
( ([TIME[2013-11-19 01:20:54 +09:00]] 版))
<http://tools.ietf.org/html/rfc6943#section-3.3>

[38] [CITE@en[RDF 1.1 Concepts and Abstract Syntax]]
( ([TIME[2014-04-26 05:40:02 +09:00]] 版))
<https://dvcs.w3.org/hg/rdf/raw-file/default/rdf-concepts/index.html#dfn-iri-equality>

[39] [CITE@en[RFC 7252 - The Constrained Application Protocol (CoAP)]]
( ([TIME[2014-06-27 00:59:37 +09:00]] 版))
<http://tools.ietf.org/html/rfc7252#section-6.3>

[42] [CITE[IRC logs: freenode / #whatwg / 20140903]]
( ([TIME[2014-09-04 12:38:30 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20140903#l-914>