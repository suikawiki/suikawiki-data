* 仕様書

[REFS[
- [1] '''[CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-02-04 17:09:00 +09:00]] 版) <https://html.spec.whatwg.org/#allowed-to-navigate>'''
- [18] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2017-02-25 17:12:45 +09:00]]) <https://html.spec.whatwg.org/#one-permitted-sandboxed-navigator>
]REFS]

* 意味

[7] [[閲覧文脈]] [VAR[A]] が[[閲覧文脈]] [VAR[B]] を[DFN[[RUBYB[navigateすることを認められる]@en[allowed to navigate]]]]とは、
[VAR[[[triggered by user activation]]]] について次の手順が[[真]]を返すことをいいます [SRC[>>1]]。

[FIG(steps)[
= [8] 
[FIG(list)[
- [VAR[A]] と [VAR[B]] が異なる
- [VAR[A]] が [VAR[B]] の[[祖先閲覧文脈]]では''ない''
- [VAR[B]] は[F[最上位閲覧文脈]]では''ない''
- [VAR[A]] の[F[活性文書]]の[F[活性砂箱化フラグ集合]]の[F[sandboxed navigation browsing context flag]]が設定されている
]FIG]
... の''すべて''を満たすなら、
== [9] [[偽]]を返し、ここで停止します。
= [15] 
[FIG(list)[
- [VAR[A]] と [VAR[B]] が異なる
- [VAR[B]] が [VAR[A]] の[[祖先閲覧文脈]]では''ない''
- [VAR[B]] は[F[最上位閲覧文脈]]である
- [VAR[A]] の[F[活性文書]]の[F[活性砂箱化フラグ集合]]の[F[sandboxed navigation browsing context flag]]が設定されている
- [VAR[B]] の [F[one permitted sandboxed navigator]] が [VAR[A]] では''ない''
]FIG]
... の''すべて''を満たすなら、
== [16] [[偽]]を返し、ここで停止します。
= [10] 
[FIG(list)[
- [VAR[B]] が[F[最上位閲覧文脈]]である
- [VAR[B]] が [VAR[A]] の[[祖先閲覧文脈]]である
]FIG]
... の''すべて''を満たすなら、
== [11] 
[FIG(list)[
- [VAR[[[triggered by user activation]]]] が[[真]]
- [VAR[A]] の[F[活性文書]]の[F[活性砂箱化フラグ集合]]の[F@en[top-level navigation ''with'' user activation browsing context flag]]が設定されている
]FIG]
... の''すべて''を満たすなら、
=== [12] [[偽]]を返し、ここで停止します。
== [13] 
[FIG(list)[
- [VAR[[[triggered by user activation]]]] が[[偽]]
- [VAR[A]] の[F[活性文書]]の[F[活性砂箱化フラグ集合]]の[F@en[sandboxed top-level navigation ''without'' user activation browsing context flag]]が設定されている
]FIG]
... の''すべて''を満たすなら、
=== [14] [[偽]]を返し、ここで停止します。
= [17] [[真]]を返します。
]FIG]

[20] [[閲覧文脈]]は、 [DFN[[F[one permitted sandboxed navigator]]]]
[SRC[>>18]] を持ちます。 [CODE(HTML)@en[sandbox]] で [[navigate]]
が制限されている時、特定の[[閲覧文脈]]からのみ [[navigate]]
を認める検査のために使われます。[[閲覧文脈の選択]]により設定されます。

;; [[仕様書]]上は、他に[[ハイパーリンクをたどる]]や [CODE(JS)@en[document.open]]
から参照されていますが、新しい[[閲覧文脈]]を開いた直後の [[navigate]]
に関する[[仕様書]]の構成上必要になる処理です。それ以外の実質的な参照は、
[[allowed to navigate]] の検査のみです。

* 文脈

[3] [[navigate]] から参照されます。

[5] [CODE(JS)@en[window.close]] から参照されます。

* 関連

[6] [[精通]]とは似て非なるものです。

* 歴史

[2] [CITE@en[Use browsing contexts's active document, it has no node document · whatwg/html@f7e01c0]]
([TIME[2016-02-10 22:51:45 +09:00]] 版)
<https://github.com/whatwg/html/commit/f7e01c01e99eb82491f4a05e6ee8ca5dcb60bf40>

[4] [CITE@en[Add allow-top-navigation-by-user-activation sandbox token]]
([[domenic]]著, [TIME[2017-02-24 04:51:48 +09:00]])
<https://github.com/whatwg/html/commit/8abd73ec3a56541e3f6486d3a593a8bcfd67295d>