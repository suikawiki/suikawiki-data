* Data model

[9] An [DFN[object]] has 
[DFN[[F[name]]]], and
[DFN[[F[description]]]],
which are initially [[null]].

[23] A [DFN[data set]] is an [[object]].

[24] A [[data set]] has
[DFN[[F[generator]]]],
which is initially [[null]].

[19] A [DFN[data set]] has
[DFN[[F[waypoints]]]],
[DFN[[F[routes]]]], and
[DFN[[F[tracks]]]], which are initially empty lists.

[25] A [DFN[point]] is an [[object]].

[26] A [[point]] has
[DFN[[F[latitude]]]], and
[DFN[[F[longitude]]]],
which are initially [[null]].

* Parsing

[1] To [DFN[parse a GPX document]] [VAR[doc]], run these steps:
[FIG(steps)[
= [2] Let [VAR[element]] be [VAR[doc]]'s [F[document element]].
= [4] If [VAR[element]] is an [[element]] whose [F[local name]] is [CODE[gpx]]:
== [8] Let [VAR[object]] be a [[data set]].
== [6] [[Parse a [CODE[gpx]] element][parse a [CODE[gpx]] element]] [VAR[element]]
into [VAR[object]].
== [7] Return [VAR[object]].
= [11] Otherwise:
== [12] Return [[null]].
]FIG]

[28] To [DFN[process property elements]] of [[element]] [VAR[element]], run these steps:
[FIG(steps)[
= [29] For each [[element]] [VAR[child]] in [VAR[element]]'s [F[children]], in order:
== [30] Switch by [VAR[child]]'s [F[local name]]:
[FIG(switch)[
: [CODE[name][name (GPX)]] :
[FIG(steps)[
= [35] If [VAR[object]]'s [F[name]] is [[null]]:
== [31] Let [VAR[text]] be [VAR[child]]'s [F[child text content]].
== [32] If [VAR[text]] is not the [[empty string]]:
=== [33] Set [VAR[object]]'s [F[name]] to [VAR[text]].
]FIG]
: [CODE[desc][desc (GPX)]] :
[FIG(steps)[
= [36] If [VAR[object]]'s [F[description]] is [[null]]:
== [37] Let [VAR[text]] be [VAR[child]]'s [F[child text content]].
== [38] If [VAR[text]] is not the [[empty string]]:
=== [39] Set [VAR[object]]'s [F[description]] to [VAR[text]].
]FIG]

]FIG]
]FIG]

[10] To [DFN[parse a [CODE[gpx]] element]] [VAR[element]]
into [VAR[object]], run these steps:
[FIG(steps)[
= [14] For each [[element]] [VAR[child]] in [VAR[element]]'s [F[children]], in order:
== [16] If [VAR[child]] has a [CODE(XMLa)@en[creator]] [[attribute]]:
=== [17] If [VAR[object]]'s [F[generator]] is [[null]]:
==== [18] Set [VAR[object]]'s [F[generator]] to 
[VAR[child]]'s [CODE(XMLa)@en[creator]] [[attribute value]].
== [15] Switch by [VAR[child]]'s [F[local name]]:
[FIG(switch)[
: [CODE(XMLe)@en[metadata][metadata (GPX)]] or [CODE(XMLe)@en[extensions][extensions (GPX)]] :
[[Process property elements][process property elements]] of [VAR[child]] into [VAR[object]].
: [CODE(XMLe)@en[wpt]] :
[FIG(steps)[
= [20] Let [VAR[point]] be a [[point]].
= [21] [[Parse a point element][parse a point element]] [VAR[child]] into [VAR[point]].
= [22] Append [VAR[point]] to [VAR[object]]'s [F[waypoints]].
]FIG]
: [CODE(XMLe)@en[rte]] :
@@
: [CODE(XMLe)@en[trk]] :
@@
]FIG]
]FIG]

[27] To [DFN[parse a point element]] [VAR[element]] into [VAR[object]],
run these steps:

@@

;; [13] These steps intentionally ignore [[namespaces][namespace]].

* References

[5] The terms [DFN[[[element]]]], [DFN[[[attribute]]]],
[DFN[[F[children]]]], [DFN[[F[local name]]]],
and [DFN[[F[namespace]]]] are defined by the [[DOM Standard]].

[34] The term [DFN[[F[child text content]]]]
is defined by the [[HTML Standard]].

[3] The term [DFN[[F[document element]]]] is defined by
@@ XXX
