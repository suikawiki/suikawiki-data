* 仕様書

[REFS[
- [1] [CITE@en[Service Workers Nightly]] ([TIME[2017-03-02 15:00:14 +09:00]]) <https://w3c.github.io/ServiceWorker/#algorithms>
]REFS]

* ジョブ

[2] [DFN[[RUBYB[ジョブ]@en[job]]]]は、
[[サービスワーカー登録]]への要求を表します [SRC[>>1]]。

** 状態

[3] [[ジョブ][サービスワーカージョブ]]は、次の状態を持ちます。

[FIG(list members)[
: [DFN[[F[[RUBYB[[[ジョブ型]]]@en[job type]]]]]] :
[[登録][登録ジョブ]], [[更新][更新ジョブ]], [[登録解除][登録解除ジョブ]]のいずれか [SRC[>>1]]。
: [F[スクリプトURL][サービスワーカー]] :
: [F[ワーカー型]] :
: [F[キャッシュ利用]] :
: [F[クライアント][サービスワーカークライアント]] :
: [F[参照元]] :
: [DFN[[F[[RUBYB[[[ジョブ約束]]]@en[job promise]]]]]] :
[[約束]]または [CODE[null]]。初期値は [CODE[null]]。 [SRC[>>1]]
: [DFN[[F[[RUBYB[[[等価ジョブ群のリスト]]]@en[list of equivalent jobs]]]]]] :
[[ジョブ][サービスワーカージョブ]]の[[リスト]]。初期値は[[空リスト]]。 [SRC[>>1]]
: [F[force bypass cache flag]] : 
]FIG]

** 等価性

[4] [[ジョブ][サービスワーカージョブ]]が[DFN[[RUBYB[等価]@en[equivalent]]]]であるとは、
次の条件を''すべて''満たすことをいいます [SRC[>>1]]。

[FIG(list)[
- [5] [F[ジョブ型]]が等しい
- [8] [F[適用範囲URL]]が等しい
- [6] [F[ジョブ型]]が[[登録][登録ジョブ]]または[[更新][更新ジョブ]]の場合、
-- [7] [F[スクリプトURL][サービスワーカー]]が等しい
]FIG]

** 作成

[12] [DFN[[RUBYB[ジョブ作成]@en[Create Job]]]]は、
[VAR[ジョブ型]]、
[VAR[適用範囲URL]]、
[VAR[スクリプトURL]]、
[VAR[約束]]、
[VAR[クライアント]]を次のようにします [SRC[>>1]]。

[FIG(steps)[
= [13] [VAR[ジョブ]]を、新しい[[ジョブ][サービスワーカージョブ]]に設定します。
[FIG(list members)[
: [F[ジョブ型]] : [VAR[ジョブ型]]
: [F[適用範囲URL]] : [VAR[適用範囲URL]]
: [F[スクリプトURL][サービスワーカー]] : [VAR[スクリプトURL]]
: [F[ジョブ約束]] : [VAR[約束]]
: [F[クライアント][サービスワーカークライアント]] : [VAR[クライアント]]
]FIG]
= [15] [VAR[クライアント]]が [CODE[null]] でない場合、
== [16] [VAR[ジョブ]]の[F[参照元]]を、[VAR[クライアント]]の[F[作成URL]]に設定します。
= [14] [VAR[ジョブ]]を返します。
]FIG]

* ジョブキュー

[9] [DFN[[RUBYB[ジョブキュー][job queue]]]]は、
[[ジョブ]]を順に実行するための[[スレッド安全]]な[[キュー]]です。 [SRC[>>1]]

[10] [[FIFO]] [[キュー]]の一般的な特性を満たす[SHOULD[べきです]]。 [SRC[>>1]]

[11] [[利用者エージェント]]は、 ([F[適用範囲URL]]の異なる) [[サービスワーカー登録]]ごとにそれぞれ個別の[[ジョブキュー][サービスワーカージョブキュー]]を設けなければ[MUST[なりません]]。
[SRC[>>1]]
