[18] 
[DFN[資源ヘッダー]]は、[[ファイル]]の
[[sniffing]]
に使われる部分です。


* Web における資源ヘッダー

[2] 
[CITE[MIME Snffing]]
では、
[[sniffing]] に使われる[[ファイル]]の先頭部分を[DFN[[RUBYB[資源ヘッダー]@en[resource header]]]]といいます [SRC[>>1]]。

** 仕様書

[REFS[
- [1] [CITE@en[MIME Sniffing Standard]] ([TIME[2017-03-09 23:51:04 +09:00]]) <https://mimesniff.spec.whatwg.org/#reading-the-resource-header>
- [5] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2017-05-05 18:17:33 +09:00]]) <https://html.spec.whatwg.org/#character-encoding-declaration>
- [7] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2017-05-05 18:17:33 +09:00]]) <https://html.spec.whatwg.org/#encoding-sniffing-algorithm>
- [11] [CITE@en[XMLHttpRequest Standard]] ([TIME[2017-04-20 18:49:47 +09:00]]) <https://xhr.spec.whatwg.org/#document-response>
- [13] [CITE@en[CSS Syntax Module Level 3]] ([TIME[2017-05-07 16:12:44 +09:00]]) <https://drafts.csswg.org/css-syntax/#input-byte-stream>
]REFS]


** MIME 型の sniffing における資源ヘッダー

[4] [CITE[MIME Sniffing Standard]] は、
先頭 [N[1445]] [[バイト]][[以上]]が読み込まれるか、
末尾に到達するか、
[[利用者エージェント]]定義の十分な時間が経過するかのいずれか最初の時点での利用可能なデータ''全体''としています
[SRC[>>1]]。

[HISTORY[
[15] 当初は [N[512]] [[バイト]]でしたが、 [[MP3]] に対応するため拡大されました [SRC[>>3]]。
]HISTORY]

** 符号化 sniffing における資源ヘッダー

[19] [[encoding sniffing]] には、[[資源ヘッダー]]という用語はありませんが、
類似の規定が各仕様にあります。

[8] [[HTML]] の [[encoding sniffing algorithm]] では、
[[利用者エージェント]]依存としつつも、
先頭 [N[1024]] [[バイト]]または [N[500]] [[ms]] 経過までのデータを使うことを勧めています
[SRC[>>7]]。

[HISTORY[
[9] 当初は [N[512]] [[バイト]]とされていましたが、[[Web互換性]]のため拡大されました [SRC[>>16]]。
]HISTORY]

;; [20] 処理速度を条件にいれることで、[[ネットワーク]]の偶然の転送の具合に依存してしまうことになりますが、
読み込みの速度が遅くていつまでも [[charset sniffing]] の結果を得られないことを防げます。
[[navigate]]
に限ってこのような規定があるのは、
[[incremental rendering]] が必要であること、
最初の[[レンダリング]]までの処理速度が[[利用者体験]]上特に重要であることと、
[[符号化の変更]]による修復が可能だからでしょう。

[12] [[XHR]] の[[文書応答]]における [[HTML]] の処理では、
先頭 [N[1024]] [[バイト]]を使うと規定されています [SRC[>>11]]。

[6] [[HTML]] の[[文字符号化宣言]]は、最初の [N[1024]] [[バイト]]以内に含めなければ[MUST[ならない]]と規定されています
[SRC[>>5]]。

;; [21] これは[[著者]]に対する要件です。

[14] [[CSS]] では、先頭 [N[1024]] [[バイト]]を使うと規定されています [SRC[>>13]]。

** 歴史

[10] [[MIME sniffing]]、[[HTML charset sniffing]] も参照。

[16] [CITE@en['''['''c''']''' (0) Change the limit for where charsets should be given to the fi…]] ([[Hixie]]著, [TIME[2011-02-09 09:02:05 +09:00]]) <https://github.com/whatwg/html/commit/51babfe760a1dbe28c4521b2070e692ac872550a>

[3] [CITE@en[Add an algorithm to sniff MP3 without ID3]] ([[padenot]]著, [TIME[2016-03-03 01:32:46 +09:00]]) <https://github.com/whatwg/mimesniff/commit/998b959332e8dd372f06cfde23f48b4ed5e3567c>

* その他の資源ヘッダー


[33] 
[CN[BOM]] は先頭に置けます。

[30] 
[[shebang]] はファイルの先頭に書けます。
ただし [[Ruby]] ではもっと後に来ることもあります。
[SEE[ [[shebang]] ]]

[32] 
[[XML宣言]]と[[テキスト宣言]]はファイルの先頭に書けます。
[CN[BOM]] より後になります。

[36] 
[CODE[#ABNF]] はファイルの先頭に書けます。
[CN[BOM]] より後になります。

[37] 
[CODE[#VRML]], [CODE[#X3D]] はファイルの先頭に書けます。

[29] 
[CODE[-*-]] は最初の[[行]]に書けます。ただしその前に [[shebang]] を置けます。
[CITE[Emacs]] や [[Python]] では第2行までですが、
[[Ruby]] ではもっと後に来ることもあります。
[SEE[ [[-*-]], [[ファイル局所変数]] ]]

[34] 
[[Python]] の[[符号化]]の[[魔法注釈]]は、
第1行か第2行に置けます。

[17] 
[CITE[Vim]] の[[モード行]]は先頭と末尾の5行に書けるとするのが既定値ですが、
変更も可能です。 [SEE[ [[vim:]] ]]

[28] 
[[Kate Modelines]] は先頭と末尾の10行に書けます。
[SEE[ [[kate:]] ]]

[31] 
[[局所変数群並び]]はファイルの末尾の3000文字より後、
最後の [CN[FORM FEED]] より後に書けます。



* 関連

[SEE[ [[sniffing]], [[テキストファイルの先頭]] ]]


* メモ