[8] [DFN[CircleCI]] は、 [[CI]] サービス ([[Webアプリケーション]]) です。

* Heroku deploy 設定

[9] 1. リポジトリーを追加する

[10] 2. 設定 → 「Heroku Deployment」 → 「Step 2: Associate a Heroku SSH key with your account」

[11] 3. [CODE[Makefile]] に [[Heroku]] 用の書き換えを追加 (一例):

[FIG[
[PRE(code)[
create-commit-for-heroku:
	git config --global user.email "dummy@test"
	git config --global user.name "dummy"
	git remote rm origin
	rm -fr deps/pmtar/.git deps/pmpp/.git modules/*/.git
	git add -f deps/pmtar/* #deps/pmpp/*
	#rm -fr ./t_deps/modules
	#git rm -r t_deps/modules
	git rm .gitmodules
	git rm modules/* --cached
	git add -f modules/*/*
	git commit -m "for heroku"
]PRE]
]FIG]

;; [12] [[submodule]] やビルド結果など、 [[CircleCI]] 側で用意して [[Heroku]]
側では [[pull]] するだけで良い状態にするための変更を加える。

[13] 4. [CODE[circle.yml]] (一例):

[FIG[
[PRE(code)[
dependencies:
  override:
    - make deps
test:
  override:
    - make test
deployment:
  heroku:
    branch: master
    commands:
      - "'''['''[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]''']''' || git fetch --unshallow"
      - make create-commit-for-heroku
      - git push git@heroku.com:[VAR[HEROKUAPPNAME]].git +`git rev-parse HEAD`:refs/heads/master
]PRE]
]FIG]

;; [14] [CODE[deployment:]] の部分がポイント。他は何でも良い。

* Web API から build を指示

[16] 
[CITE[CircleCI API v1.1 Reference - CircleCI]] ([TIME[2017-06-10 05:03:08 +09:00]]) <https://circleci.com/docs/api/v1-reference/#new-build>

* メモ

[1] [CITE@en-US[Continuous Integration and Deployment on CircleCI just got better: now it’s free. | The Circle Blog]]
( ([TIME[2014-11-20 05:45:53 +09:00]] 版))
<http://blog.circleci.com/continuous-integration-and-deployment-on-circleci-just-got-better-now-its-free/>

[5] 基本機能は無料化されました。

[2] [[GitHub]] に対応している。
[[BitBucket]] には[DEL[対応していない。]] その後対応しました。

[3] 公開リポジトリーの実行結果は公開される。

[4] 好きな [[Docker]] コマンドを使える。

[FIG(amazon)[
[[Circle CI]]
]FIG]

[6] 昔から [[UI]] は微妙ですが、同種サービス内ではましな方です。
昔より少しは改善されています。使っていれば慣れるというのもあります。

[7] 同種他サービスとは違って、やりたい操作がどこにあるのか想像付かないということはない。

[15] [CITE[CircleCI API Documentation - CircleCI]]
([TIME[2017-06-10 05:03:08 +09:00]])
<https://circleci.com/docs/api/>