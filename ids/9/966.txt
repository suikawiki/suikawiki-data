[3] [[URL]] を生成する元となる構文を一般に[DFN[URL[RUBYB[雛形]@en[template]]]]といいます。
文脈などによっていくつかの構文が存在します。一応の標準規格はいくつかありますが、プロトコルやサービスによってそれぞれ少しずつ異なる構文を採用していて、
互換性はそれほど高くないようです。

* [CODE(URI)[%s]]

[26] [CODE(DOMm)@en[[[registerProtocolHandler]]]] や [CODE(DOMm)@en[[[registerContentHandler]]]]
では、 [[URL]] を生成する際に [CODE(URI)[[[%s]]]] の置換が行われます [SRC[>>5]]。

[28] この [CODE(URI)[%s]] が含まれ得る[[絶対URL]]のことを[DFN[[[proto-URL]]]]といいます
[SRC[>>27]]。

[30] なおこの形式の値は通常の [[URL]] と同じように [[URLの解決]]が適用されます。

[REFS[
- [5]
[CITE[Web Applications 1.0]] <http://www.whatwg.org/specs/web-apps/current-work/#custom-handlers>
-- [27] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-01-16 08:47:54 +09:00]] 版) <https://html.spec.whatwg.org/#proto-url>
]REFS]

* OpenSearch URL template 

[23] [[OpenSearch]] は、[DFN[OpenSearch URL template]] を規定しています。

[1]
[CITE[Specifications/OpenSearch/1.1/Draft 3 - OpenSearch]] <http://www.opensearch.org/Specifications/OpenSearch/1.1#OpenSearch_URL_template_syntax>
([[名無しさん]])

[2]
[CITE[A9.com > OpenSearch > OpenSearch Query Syntax 1.0]] <http://opensearch.a9.com/spec/opensearchquerysyntax/1.0/>

* URI Template

[3] [DFN[[[RFC 6570]]]] は、 [DFN[[[URI Template]]]] を規定しています。

** 仕様書

[REFS[
- [34] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570>
-- [17] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570#section-1.1>
-- [40] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570#section-1.6>
-- [45] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570#section-2>
-- [47] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570#section-3>
-- [68] [CITE@en[RFC 6570 - URI Template]] ([TIME[2014-10-27 23:08:55 +09:00]] 版) <http://tools.ietf.org/html/rfc6570#appendix-A>
- [35] [CITE[RFC Errata Report]] ([TIME[2015-01-17 15:19:44 +09:00]] 版) <http://www.rfc-editor.org/errata_search.php?rfc=6570>
]REFS]

** 言語

[36] 次の概念が存在します。
[FIG(short list)[
- [[URI雛形]]
- [[雛形リテラル]]
- [[雛形式]]
- [[式型]]
- [[演算子]]
- [[変数]]
- [[値修飾子]]
- [[展開]]
- [[雛形処理器]]
- [[水準 (URI雛形)]]
]FIG]

[38] 入力となる[[雛形]]は、 [[絶対URL]]相当のものであることもあれば、
[[相対URL]]相当のものであることもあります。[[解決]]は、
[[展開]]より後に行います [SRC[>>17]]。

;; [[展開]]の前に[[解決]]を適用してしまうと、結果が変わってしまうことがあります。

[44] [[URI Template]] は、0個以上の[[リテラル]]や[[式]]の列です [SRC[>>45]]。
[FIG(railroad)[
= *
== |
=== [[雛形リテラル]]
=== [[雛形式]]
]FIG]

[41] [[URI Template]] は、 [[Unicode符号位置]]の列です [SRC[>>40]]。

;; [42] [[RFC 3986]] [[URI]] とは違って、 [[ASCII文字]]に限定はされていません。

** 展開

[48] [[URI雛形]]から [[RFC 3986]] [[URI参照]]を得る[[演算]]を[DFN[[RUBYB[[[展開]]]@en[expansion]]]]といいます。
また[[演算式]]を処理して得られる[[文字列]]のことも[DFN[[RUBYB[[[展開]]]@en[expansion]]]]
[SRC[>>17]] と呼ばれています。

[49] [[URI雛形]]の[[展開]]は、次のように行います。
[FIG(steps)[
= [50] 入力として[[雛形]]と、[[変数]]の値を用意します [SRC[>>47]]。
= [51] 出力として結果を空文字列、誤りを null とします。
= [52] [[雛形]]を最初から順に[[走査]]してゆきます [SRC[>>47]]。
== [53] [[雛形リテラル]]なら、[[展開]]し、結果の末尾に連結します [SRC[>>47]]。
== [54] [CODE[[[{]]]] ... [CODE[[[}]]]] [SRC[>>68]] なら、
=== [55] [[雛形式]]として[[展開]]を試みます [SRC[>>47]]。
=== [56] 成功したら、結果の末尾に[[展開]]結果を連結します [SRC[>>47]]。
=== [57] 失敗したら、
==== [58] 誤りの位置と種類を設定する[['''べきです''']] [SRC[>>47]]。
==== [59] [[展開]]しないまま結果の末尾に連結する[['''べきです''']] [SRC[>>47]]。
== [60] [[文法]]に一致しない文字列 (対応する [CODE[[[}]]]] のない [CODE[[[{]]]] や、
[[雛形リテラル]]以外の[[文字]] [SRC[>>68]]) なら、
=== [61] 誤りの位置と種別を設定する[['''べきです''']]。 [SRC[>>47]]
=== [62] この部分以降の[[雛形]]残りすべてをそのまま結果の末尾に連結し、
>>64 に進む[['''べきです''']] [SRC[>>47]]。
== [63] [[雛形]]の最後に到達したら、 >>64 に進みます。そうでなければ、 >>52 に戻ります。
= [64] 出力として結果と誤りを返します。
]FIG]

;; [65] [[雛形リテラル]]、[[雛形式]]の展開の項も参照。

[43] [[利用者]]によって与えられた値は、 [[NFC]] に[[正規化]]する[['''べきです''']]
[SRC[>>40]]。

;; [46] それ以外の場合について特に制約はありません。従って出力が [[NFC]]
である保証もありません。

[37] 出力は、 [[RFC 3986]] [[URI参照]]です [SRC[>>34]]。

[66] [[誤り]]がある場合、得られた文字列は妥当な [[URI参照]]ではないかもしれません。
これは診断用のものです。 [SRC[>>47]]

[67] [[誤り]]が無い場合、[[RFC 3986]] [[URI参照]]で使うことができない[[文字]]が含まれないことは保証されます。
構文的・意味的に正しいことは保証されません。

** 応用

[6]
[[WADL]] [CODE(XMLa)@en[[[pattern]]]] [[属性]]: >>3 系の構文

[8]
[[AtomPP]] は以前 >>3 系の構文で [[URI雛形]] (or [[IRI雛形]]) を使っていましたが、既に削除されています。

;; [CITE[ietf-atompub-protocol]] <http://ietfreport.isoc.org/idref/draft-ietf-atompub-protocol/>

[REFS[
- [32] [CITE[Restlet | Technical Resources | Framework]] ([TIME[2015-01-17 15:14:29 +09:00]] 版) <http://restlet.com/technical-resources/restlet-framework/tutorials#part11>
-- [11]
[CITE[Restlet - Tutorial]] ([TIME[2007-01-09 21:53:39 +09:00]] 版) <http://www.restlet.org/tutorial#part11>
-- [33] >>11 は [CODE(HTTP)[[[404]]]] [TIME[2015-01-17T06:15:08.00Z]]
]REFS]

[21] [CITE@en[draft-hammer-hostmeta-13 - Web Host Metadata]]
( ([TIME[2010-09-16 05:16:02 +09:00]] 版))
<http://tools.ietf.org/html/draft-hammer-hostmeta>

** 歴史

[39] [[URI Template]] は [[WSDL]]、[[WADL]]、[[OpenSearch]] などの既存の雛形構文を統合し拡張して[[インターネット]][[応用]]での共通の構文とする [SRC[>>34]] ことを謳っています。
しかし実際には [[OpenSearch]] の構文と互換性があるのは[[水準1]]だけで、
[[OpenSearch]] の省略可能構文に [[URI Template]] は対応していません。

[7]
[CITE[gregorio-uritemplate]] <http://ietfreport.isoc.org/idref/draft-gregorio-uritemplate/>

[16]
[CITE[mnot’s Web log: URI Templates Redux]] ([TIME[2007-07-28 13:11:02 +09:00]] 版) <http://www.mnot.net/blog/2007/07/28/more_uri_templates>
([[名無しさん]] [WEAK[2007-07-28 13:19:06 +00:00]])

[18]
[CITE@en-US[snellspace.com &#187; Blog Archive &#187; URI Template Update]] ([TIME[2007-08-15 13:20:27 +09:00]] 版) <http://www.snellspace.com/wp/?p=717>

** 実装

[9]
[CITE[Joe Gregorio | BitWorking | Projects | URI-Templates]] <http://bitworking.org/projects/URI-Templates/>

[14]
[CITE[Brian Cassidy / URI-Template - search.cpan.org]] ([CODE[2007-02-18 15:08:51 +09:00]] 版) <http://search.cpan.org/dist/URI-Template/>
([[名無しさん]] [WEAK[2007-02-18 06:10:45 +00:00]])

[19] [CITE[URI::Template 0.14_01 は draft-03 相当 - Yet Another Hackadelic]] ([TIME[2009-02-01 19:35:28 +09:00]] 版) <http://d.hatena.ne.jp/ZIGOROu/20081211/1229008879>

[20] [CITE[URI Templates の各言語実装 - Mi manca qualche giovedi`?]] ([TIME[2009-02-01 19:35:13 +09:00]] 版) <http://d.hatena.ne.jp/n_shuyo/20080614/uritemplates>

[22] [CITE[uri-templates - URI Template Library - Google Project Hosting]]
( ([TIME[2011-06-11 15:17:56 +09:00]] 版))
<http://code.google.com/p/uri-templates/>

** メモ

[69] [[水準1]]だけにとどめておけばよかったものを、欲を出して拡張したせいで必要以上に複雑なものになってしまった印象があります。

* 歴史

** [CODE(URI)[%%]]

[25] [[HTML]] の[[フォームの提出]]では、 [CODE(URI)@en[[[data:]]]]
[[URL]] を生成する際に [CODE(URI)[[[%%]]]] の置換が行われます [SRC[>>24]]。

[29] なおこの形式の値は通常の [[URL]] と同じように [[URLの解決]]が適用されます。

[77] [[Web Forms 2.0]] で導入され、 [[HTML5]] にも引き継がれましたが、
実装されず用途も乏しいとして2016年5月に削除されました。

[REFS[
- [24] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-01-16 08:47:54 +09:00]] 版) <https://html.spec.whatwg.org/#submit-data-post>
-- [4] 旧版:
[CITE[Web Forms 2.0]] <http://www.whatwg.org/specs/web-forms/current-work/#for-data>
- [76] [CITE@en[Fix form submission for the data URL scheme]]
( ([[annevk]]著, [TIME[2016-05-27 17:47:54 +09:00]]))
<https://github.com/whatwg/html/commit/e2d80d9285976c6c38bda188c59e97456006d0a3>
]REFS]

* その他

[REFS[
- [10]
[CITE[Scholarly Link Specification Framework (S-Link-S)]] <http://www.openly.com/SLinkS/SLinkS-20060711.html>
]REFS]

[31] >>10 は [[XML]] によって[[雛形]]を記述する言語です。

[12]
[CITE@en[Web Service Definition Language (WSDL)]] ([CODE[2001-03-15 07:14:12 +09:00]] 版) <http://www.w3.org/TR/2001/NOTE-wsdl-20010315#_http:urlReplacement>

[15]
[CITE@en[Web Services Description Language (WSDL) Version 2.0 Part 2: Adjuncts]] ([CODE[2007-06-23 05:33:39 +09:00]] 版) <http://www.w3.org/TR/2007/REC-wsdl20-adjuncts-20070626/#_http_operation_location_cited_ser>

[13]
[CITE@ja[InterWikiテクニカル - InterWikiNameの記述方法など]] ([CODE[2007-02-04 18:22:17 +09:00]] 版) <http://www.hyuki.com/yukiwiki/wiki.cgi?InterWiki%a5%c6%a5%af%a5%cb%a5%ab%a5%eb>

[70] [[wlwmanifest]] も水準1のようなものを使っているようです。

[71] [CITE@en[Schema.org Actions - schema.org]]
( ([TIME[2015-02-12 17:09:35 +09:00]] 版))
<http://schema.org/docs/actions.html>

[FIG(quote)[
[FIGCAPTION[
[72] [CITE@en[Opera: Opera Link API Beta]]
([[Frank M. Palinkas, Technical Writer]] 著, [TIME[2015-03-14 20:57:45 +09:00]] 版)
<http://www.opera.com/docs/apis/linkrest/>
]FIGCAPTION]

> 
> uri: Search result URI; the formatting operator %s will be replaced by the search terms '''['''Required''']'''

]FIG]


[73] [CITE@en[draft-wilde-template-desc-00 - URI Template Descriptions]]
([TIME[2015-01-25 14:15:21 +09:00]] 版)
<https://tools.ietf.org/html/draft-wilde-template-desc-00>

[FIG(quote)[
[FIGCAPTION[
[74] [CITE@en[OpenService Format Specification for Accelerators - Version 0.8]]
([TIME[2015-04-19 15:03:40 +09:00]] 版)
<https://msdn.microsoft.com/en-us/library/cc304163(v=vs.85).aspx>
]FIGCAPTION]

> All variables are treated as required unless it the modifier "?". An optional variable that cannot be resolved is treated as an empty string for an inline parameterized URL. In a form-based parameterized URL the entire parameter element is ignored.
> Example of an optional variable in an inline parameterized URL:
> <execute action="http://encarta.msn.com/encnet/refpages/search.aspx?q={selection?}" />

]FIG]


[FIG(quote)[
[FIGCAPTION[
[75] [CITE@en[OpenService Format Specification for Accelerators - Version 0.8]]
([TIME[2015-04-19 15:03:56 +09:00]] 版)
<https://msdn.microsoft.com/en-us/library/cc304163(v=vs.85).aspx>
]FIGCAPTION]

> Escape Character
> To specify { and } literally, escape them with a backslash \. Backslash can be used to escape any character.
> \{{selection}\}

]FIG]
