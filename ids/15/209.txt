[FIG(table)[

:1: [[元日]]
:t: 初[[木曜日]]
:f: [[ISO週暦]][[年始]]
:f-: [[ISO週暦]][[年始]] - 1
:w: 初[[水曜日]]
:wf: 日曜週暦年始
:m: 初[[月曜日]]

:1: [TIME[2010-01-01]]
:t: [TIME[2010-01-07]]
:f: [TIME[2010-01-04]]
:f-: [TIME[2010-01-03]]
:w: [TIME[2010-01-06]]
:wf: [TIME[2010-01-03]]
:m: [TIME[2010-01-04]]

:1: [TIME[2011-01-01]]
:t: [TIME[2011-01-06]]
:f: [TIME[2011-01-03]]
:f-: [TIME[2011-01-02]]
:w: [TIME[2011-01-05]]
:wf: [TIME[2011-01-02]]
:m: [TIME[2011-01-03]]

:1: [TIME[2012-01-01]]
:t: [TIME[2012-01-05]]
:f: [TIME[2012-01-02]]
:f-: [TIME[2012-01-01]]
:w: [TIME[2012-01-04]]
:wf: [TIME[2012-01-01]]
:m: [TIME[2012-01-02]]

:1: [TIME[2013-01-01]]
:t: [TIME[2013-01-03]]
:f: [TIME[2012-12-31]]
:f-: [TIME[2012-12-30]]
:w: [TIME[2013-01-02]]
:wf: [TIME[2012-12-30]]
:m: [TIME[2013-01-07]]

:1: [TIME[2014-01-01]]
:t: [TIME[2014-01-02]]
:f: [TIME[2013-12-30]]
:f-: [TIME[2013-12-29]]
:w: [TIME[2014-01-01]]
:wf: [TIME[2013-12-29]]
:m: [TIME[2014-01-06]]

:1: [TIME[2015-01-01]]
:t: [TIME[2015-01-01]]
:f: [TIME[2014-12-29]]
:f-: [TIME[2014-12-28]]
:w: [TIME[2015-01-07]]
:wf: [TIME[2015-01-04]]
:m: [TIME[2015-01-05]]

:1: [TIME[2016-01-01]]
:t: [TIME[2016-01-07]]
:f: [TIME[2016-01-04]]
:f-: [TIME[2016-01-03]]
:w: [TIME[2016-01-06]]
:wf: [TIME[2016-01-03]]
:m: [TIME[2016-01-04]]

:1: [TIME[2017-01-01]]
:t: [TIME[2017-01-05]]
:f: [TIME[2017-01-02]]
:f-: [TIME[2017-01-01]]
:w: [TIME[2017-01-04]]
:wf: [TIME[2017-01-01]]
:m: [TIME[2017-01-02]]

:1: [TIME[2018-01-01]]
:t: [TIME[2018-01-04]]
:f: [TIME[2018-01-01]]
:f-: [TIME[2017-12-31]]
:w: [TIME[2018-01-03]]
:wf: [TIME[2017-12-31]]
:m: [TIME[2018-01-01]]

:1: [TIME[2019-01-01]]
:t: [TIME[2019-01-03]]
:f: [TIME[2018-12-31]]
:f-: [TIME[2018-12-30]]
:w: [TIME[2019-01-02]]
:wf: [TIME[2018-12-30]]
:m: [TIME[2019-01-07]]


]FIG]


* [CODE[YYYY]] と [CODE[yyyy]]

[317] 
[[Objective-C]] や [[Swift]] の
[CODE[NSDateFormatter]]
([[Mac OS X]] や [[iOS]])
の 
[CODE[YYYY]]
を誤用したことによる大小の不具合は、
少なくても[TIME[西暦2014年][2014]]末
[SRC[>>227, >>330]],
[TIME[西暦2015年][2015]]末 [SRC[>>331, >>332]] / [TIME[西暦2016年][2016]]初 [SRC[>>327]],
[TIME[西暦2016年][2016]]末 [SRC[>>333]],
[TIME[西暦2017年][2017]]末 [SRC[>>342]],
[TIME[西暦2019年][2019]]末
[SRC[>>318]],
[TIME[西暦2020年][2020]]末
[SRC[>>318]]
など
[SRC[>>326, >>328, >>329, >>334]]
に繰り返し報告されています。
[TIME[西暦2014年][2014]]末の >>108、
[TIME[西暦2017年][2017]]末の >>282
も参照。

;; [335] [[年末年始]]に発覚するケースが多いですが、
[[年末年始]]の[[日付]]を年中に処理するケースもあり、
1年を通して相談があります。
なお、ほとんどの報告においては当該[[不具合]]が製品で発生したのか、
開発過程で発覚し実害がなかったのか不明です。


[REFS[
-
[326] 
[CITE@en[ios - String formatted date picker date is off - [[Stack Overflow]]]], [TIME[2022-07-10T06:18:28.000Z]] <https://stackoverflow.com/questions/6388370/string-formatted-date-picker-date-is-off/6388430>
-
[330] 
[CITE@en[ios - NSDateFormatter - Adding a Year? - [[Stack Overflow]]]], [TIME[2022-07-10T06:25:00.000Z]] <https://stackoverflow.com/questions/27700622/nsdateformatter-adding-a-year?noredirect=1&lq=1>
-
[328] 
[CITE@en[objective c - [[NSDateFormatter]] returning wrong year - Stack Overflow]], [TIME[2022-07-10T06:22:40.000Z]] <https://stackoverflow.com/questions/23847361/nsdateformatter-returning-wrong-year?noredirect=1&lq=1>
-
[329] 
[CITE@en[ios - NSDateFormatter returns wrong year - [[Stack Overflow]]]], [TIME[2022-07-10T06:23:59.000Z]] <https://stackoverflow.com/questions/32140615/nsdateformatter-returns-wrong-year?noredirect=1&lq=1>
-
[331] 
[CITE@en[ios - NSDateFormatter transition to NSString error - [[Stack Overflow]]]], [TIME[2022-07-10T06:25:38.000Z]] <https://stackoverflow.com/questions/34491928/nsdateformatter-transition-to-nsstring-error?noredirect=1&lq=1>
-
[332] 
[CITE@en[ios - NSDateFormatter outputting incorrect year - [[Stack Overflow]]]], [TIME[2022-07-10T06:27:59.000Z]] <https://stackoverflow.com/questions/34744345/nsdateformatter-outputting-incorrect-year?noredirect=1&lq=1>
-
[327] 
[CITE@en[ios - NSDateFormater - returns same year for 2015 and 2016 date - [[Stack Overflow]]]], [TIME[2022-07-10T06:20:04.000Z]] <https://stackoverflow.com/questions/34578692/nsdateformater-returns-same-year-for-2015-and-2016-date?noredirect=1&lq=1>
-
[333] 
[CITE@en[ios - DateFormatter producing unexpected result on device - [[Stack Overflow]]]], [TIME[2022-07-10T06:28:54.000Z]] <https://stackoverflow.com/questions/40660319/dateformatter-producing-unexpected-result-on-device?noredirect=1&lq=1>
-
[342] 
[CITE@en[ios - Dateformatter returns wrong year for 2017-12-31 - [[Stack Overflow]]]], [TIME[2022-07-10T07:23:20.000Z]] <https://stackoverflow.com/questions/48041969/dateformatter-returns-wrong-year-for-2017-12-31?noredirect=1&lq=1>
-
[334] 
[CITE@en[ios - Convert date format in returns wrong date xcode - [[Stack Overflow]]]], [TIME[2022-07-10T06:36:21.000Z]] <https://stackoverflow.com/questions/45347575/convert-date-format-in-returns-wrong-date-xcode?noredirect=1&lq=1>



]REFS]

-*-*-

[319] 
[CODE[NSDateFormatter]]
は[[日時]]を整形して[[文字列]]を得るだけでなく、
[[文字列]]を解釈して[[日時]]を得る操作もできます。
その解釈にもやはり同じ書式の指定を用いるため、
[CODE[yyyy]]
でなく
[CODE[YYYY]] 
と指定すると[[暦年]]でなく[[週年]]と解釈されることになります。
これによる[[不具合]]も何度か報告されています
[SRC[>>318]]。

[336] 
この場合は対象となる[[日付]]は[[年末年始]]に限りません。

- [337] 
[TIME[2012-09-14T11:00:30Z]]の質問サイトへの投稿によると、
[CODE[2012-09-14]]
[WEAK[([TIME[2012-09-14]])]]
を
[CODE[YYYY-MM-dd]]
として解釈した結果、
「2011-09-13 16:00:00 +0000」
が得られました。
[SRC[>>318]]
-
[341] 
[CODE[Feb 28, 2013 05:30pm]]
[WEAK[([TIME[2013-02-28]])]]
を
[CODE[MMM dd, YYYY hh:mma]]
として解釈した結果、
「2013-01-05 12:00:00 +0000」
が得られました。
[SRC[>>340]]
-
[321] 
[CODE[03-02-2017]]
[WEAK[([TIME[2017-02-03]])]]
を
[CODE[dd-MM-YYYY]]
として解釈した結果、
「2016-12-24 16:00:00 +0000」
が得られました。
[SRC[>>320]]
-
[339] 
[CODE[01/24/2018]]
[WEAK[([TIME[2018-01-24]])]]
を
[CODE[MM/dd/YYYY]]
として解釈した結果、
「2017-12-24」
が得られました。
[SRC[>>338]]


[343] 
書式を用いた日時文字列の[[構文解析]]の挙動の詳細は、
[[Apple]] のドキュメントにも、
そこから参照される [[LDML]] [SRC[>>269]]
にも定められていません。
報告されている
[CODE[NSDateFormatter]]
の挙動は[[プログラマー]]にとって意図しないものですが、
[[Apple]]
にとって意図したものなのかどうかはよくわかりません。

[344] 
[CODE[YYYY-MM-dd]] のような指定があると、
([[週年]], [[暦月]], [[暦日]])
という3つの値の[[組]]から[[日付]]を決定することになります。
[[年末年始]]の[[日付]]で曖昧性が生じるかもしれませんが、
それ以外の大部分の[[日付]]は実は曖昧なく特定できます。

[345] 
そうなっていないのは、おそらく[[週年]]の[[年始]]の[[日付]]を基準に、
[[月]]と[[日]]の値を調整するような形の実装になっているのでしょう。

[346] 
きっと [[Apple]] は[[週年]]が[[暦月]]や[[暦日]]と組み合わせるようなケースは想定していなかったのでしょう。
想定していない入力に対して壊れた (しかしそのことがわかりにくい) 出力をするくらいなら、
エラーにしてしまうべきだと思うのですが、
十年以上もこの仕様にしてしまっている以上、
[[後方互換性]]のため今更仕様変更というわけにもいかないのでしょう。


[NOTE[

[322] 
本題から外れますが、
その質問サイトは投稿日時を


[PRE(code HTML)[
                    <div class="flex--item ws-nowrap mr16 mb8" title="2012-09-14 11:00:30Z">
                        <span class="fc-light mr2">Asked</span>
                        <time itemprop="dateCreated" datetime="2012-09-14T11:00:30">9 years, 10 months ago</time>
                    </div>
                    <div class="flex--item ws-nowrap mr16 mb8">
                        <span class="fc-light mr2">Modified</span>
                        <a href="?lastactivity" class="s-link s-link__inherit" title="2019-05-19 03:43:59Z">3 years, 1 month ago</a>
                    </div>
]PRE]

のように記述しています。 [SRC[>>318]]

[323] 
作成日時は [[Microdata]] の特性として [CODE[time]] [[要素]]で記述されていますが、
更新日時が [CODE[time]] [[要素]]でも [[Microdata]] 特性でもないただのテキストだけなのは謎です。

[324] 
両者ともただの [CODE[div]] [[要素]]や [CODE[a]] [[要素]]の [CODE[title][title=""]]
属性にそれと等しい[[日時]]らしきものを記述しています。
[[日時]]を記述する意思はあるのに、なぜ [CODE[time]] [[要素]]にしないのか不思議です。

[325] 
作成日の場合 [CODE[title][title=""]] 属性値は[[時間帯]]の [CODE[Z]] が明記されているのに、
[CODE[time]] [[要素]]の [CODE[datetime][datetime=""]] 属性値には付いていません。
これは [[HTML]] の [CODE[time]] [[要素]]の構文として誤りではないのですが、
[[時間帯が不明の地方時][浮動時刻]]の扱いになってしまいます。
[[時間帯]]を明示する意思はあるのに、なぜ [CODE[time]] [[要素]]でだけ明示しないのか謎です。

]NOTE]

[REFS[

- [318] [CITE@en[ios6 - NSDateFormatter show wrong year - [[Stack Overflow]]]], [TIME[2022-07-10T05:53:30.000Z]] <https://stackoverflow.com/questions/12423179/nsdateformatter-show-wrong-year>
-
[340] 
[CITE@en[ios - Difference between 'YYYY' and 'yyyy' in NSDateFormatter - [[Stack Overflow]]]], [TIME[2022-07-10T07:20:58.000Z]] <https://stackoverflow.com/questions/15133549/difference-between-yyyy-and-yyyy-in-nsdateformatter>
-
[320] 
[CITE@en[objective c - NSDateFormater stringFromDate to dateFromString return wrong date - [[Stack Overflow]]]], [TIME[2022-07-10T06:58:13.000Z]] <https://stackoverflow.com/questions/42289063/nsdateformater-stringfromdate-to-datefromstring-return-wrong-date?noredirect=1&lq=1>
-
[338] 
[CITE@en[swift - Unexpected result after formating string to date - [[Stack Overflow]]]], [TIME[2022-07-10T07:06:54.000Z]] <https://stackoverflow.com/questions/48421542/unexpected-result-after-formating-string-to-date?noredirect=1&lq=1>



]REFS]

* 西暦2013年初の Apple バグ


[348] 
[TIME[2013-01-01]]、
[[Apple]]
社の
[[iOS]]
に新規実装されていた
[[Do Not Disturb]] ([[DND]])
機能が誤動作する[[不具合]]が発生しました。
これは予め指定していた[[時刻]]に切り替わるはずでしたが、
それが機能しなくなっていました。
[SRC[>>357, >>349, >>347, >>365]]

[351] 
[TIME[2013-01-02]]、
[[Apple]]
は、
[TIME[2013-01-01]]以来機能しなくなっており、
[TIME[2013-01-07]]に復旧すると発表しました。
[SRC[>>350, >>361]]

[353] 
[TIME[2013-01-28]]付の
[[Apple]]
文書には [[iOS]] を更新すると解消すると書かれており
[SRC[>>352]]、
その日までには修正版が公開されたようです。

[355] 
[[Apple]] は[[不具合]]の原因は発表せず、
ニュースサイト記者の照会にも回答しませんでした [SRC[>>349, >>347]]。

[356] 
[[週]]が関係している [SRC[>>354]],
[[ISO週日付]]が関係している [SRC[>>347, >>362]]
といった推測がなされています。
もっと踏み込んで 
[CODE[yyyy]] とするべきところを [CODE[YYYY]]
と誤ったとの推測もあります [SRC[>>347]]。

[363] 
ただし[TIME[西暦2013年][2013]]の[[年始]]数日がISO週暦[TIME[西暦2012年][2012]]に属する
[SRC[>>347, >>362]]
とするのは誤りで [SRC[>>362]]、
逆に[TIME[2012-12-31]]がISO週暦[TIME[西暦2013年][2013]]に属します。
従ってそのような単純な誤りではこの不具合は説明できません。
また[[週年]]と[[暦年]]の違いを
「ISO versus Gregorian」
と表現する [SRC[>>347]] のも誤りです。


;; [364] >>362 は誤りを指摘されて修正しているのに対し、
>>347 はコメント欄で誤りを指摘されているのに元の記事のまま放置しています。
コメント欄は別ページになっていて数十コメント付いているので、
本文しか読まない人も多いでしょう。
明らかに誤っている記事を放置する[[媒体]]は困りますね。


[360] 
発症直後の[TIME[2013-01-01]]のうちに[[日付]]を変えて各年の挙動を確かめた人がいました。
[SRC[>>359]]
この結果は原因の推測に大変参考になります。

>Let's check the next few years, this is the pattern :
>
[PRE[
2013 : Issue fixed on Sunday Jan 6
2014 : Issue fixed on Sunday Jan 5
2015 : Issue fixed on Sunday Jan 4
2016 : Issue not happening even though first day is a Friday
2017 : Issue fixed on Sunday Jan 8 (Jan 1st is also a Sunday)
2018 : Issue fixed on Sunday Jan 7
2019 : Issue fixed on Sunday Jan 6
2020 : Issue fixed on Sunday Jan 5
2021 : Issue fixed on Sunday Jan 3
2022 : Issue not happening even though first day is a Saturday
2023 : Issue fixed on Sunday Jan 8 (Jan 1st is also a Sunday)
2024 : Issue fixed on Sunday Jan 7
Etc...
]PRE]
>
The same pattern happens if you go back in time as well.


[REFS[

-
[357] 
[CITE@en[iOS 6's 'Do Not Disturb' Not Shutting Off Automatically on New Year's Day - [[MacRumors]]]], 
[[Arnold Kim]],
Monday December 31, 2012 9:03 pm PST,
[TIME[2022-07-10T08:56:08.000Z]] <https://www.macrumors.com/2013/01/01/ios-6s-do-not-disturb-not-shutting-off-automatically-on-new-years-day/>
--
[358] 
[CITE@en-US[iOS 6's 'Do Not Disturb' Not Shutting Off Automatically on New Year's Day | Page 8 | [[MacRumors]] Forums]], [TIME[2022-07-10T09:03:10.000Z]], [TIME[2022-07-10T09:03:14.832Z]] <https://forums.macrumors.com/threads/ios-6s-do-not-disturb-not-shutting-off-automatically-on-new-years-day.1517623/page-8?post=16586672#post-16586672>
---
[359] 
[[stevem1981]],
[TIME[Jan 1, 2013 at 1:40 PM][2013-01-01T13:40:51-0800]]
-
[350] 
[CITE@en[iOS 6: [[Do Not Disturb]] mode stays on after scheduled time]], 
Last Modified: Jan 2, 2013,
[TIME[2022-07-10T08:25:26.000Z]], [TIME[2013-01-04T19:11:17.675Z]] <https://web.archive.org/web/20130104190941/http://support.apple.com/kb/TS4510?viewlocale=en_US&locale=en_US>
--
[352] 
[CITE@en[iOS 6: [[Do Not Disturb]] mode stays on after scheduled time]], 
Last Modified: Jan 28, 2013,
[TIME[2022-07-10T08:27:15.000Z]], [TIME[2013-03-08T23:25:48.014Z]] <https://web.archive.org/web/20130308232448/http://support.apple.com/kb/TS4510?viewlocale=en_US&locale=en_US>
-
[361] 
[CITE@en[Apple says New Year's 'Do Not Disturb' bug will fix itself Jan. 7 | [[AppleInsider]]]], 
Jan 02, 2013,
[TIME[2022-07-10T09:09:10.000Z]] <https://appleinsider.com/articles/13/01/02/apple-says-new-years-do-not-disturb-bug-will-fix-itself-jan-7>
-
[365] 
[CITE@en[Do Not Disturb bug makes iPhone users even harder to rouse in new year | iPhone | [[The Guardian]]]], 
[[Charles Arthur]],
Wed 2 Jan 2013 12.18 GMT,
[TIME[2022-07-10T10:08:33.000Z]] <https://www.theguardian.com/technology/2013/jan/02/apple-do-not-disturb-bug>
-
[362] 
[CITE@en[A possible explanation for the iOS New Year's Do Not Disturb bug | TUAW - The Unofficial [[Apple]] Weblog]], 
[[Richard Gaywood]],
Jan 3rd 2013 at 9:00AM,
[TIME[2022-07-10T09:12:09.000Z]], [TIME[2013-01-15T16:24:45.172Z]] <https://web.archive.org/web/20130105191804/http://www.tuaw.com/2013/01/03/a-possible-explanation-for-the-ios-new-years-do-not-disturb-bug/>
-
[349] 
[CITE@en-us[Apple says [[Do Not Disturb]] scheduling is broken until January 8 | Ars Technica]], 
[[Chris Foresman]],
[TIME[1/3/2013, 4:26 AM][2013-01-02T19:26:46+00:00]],
[TIME[2022-07-10T08:15:53.000Z]] <https://arstechnica.com/gadgets/2013/01/apple-says-do-not-disturb-scheduling-is-broken-until-january-7/>
--
[354] 
[[Chuckstar]],
Jan 3, 2013 12:07 PM,
[TIME[2022-07-10T08:43:50.300Z]]
<https://arstechnica.com/gadgets/2013/01/apple-says-do-not-disturb-scheduling-is-broken-until-january-7/?comments=1&start=40#comment-23649844>
(コメント欄2ページ目)
-
[366] 
[CITE@en[Do Not Disturb bug will fix itself, says Apple, as developers figure its cause | Apple | [[The Guardian]]]], 
[[Charles Arthur]],
Thu 3 Jan 2013 09.15 GMT,
[TIME[2022-07-10T10:10:10.000Z]] <https://www.theguardian.com/technology/2013/jan/03/apple-do-not-disturb-bug-explained>
- [347] 
[CITE@en-us[Ask Ars: Why will [[Apple]]’s Do Not Disturb bug fix itself next week? | Ars Technica]], 
[[Jacqui Cheng]],
[TIME[1/4/2013, 2:35 AM][2013-01-03T17:35:01+00:00]],
[TIME[2022-07-10T08:10:37.000Z]] <https://arstechnica.com/gadgets/2013/01/ask-ars-why-will-apples-do-not-disturb-bug-fix-itself-next-week/>
]REFS]


* 西暦2014年末の Twitter 障害

[2] 
[[米国時間]]の[TIME[2014-12-28]]、
[[Android]]
版
[[Twitter]]
公式[[アプリ]]等一部のクライアント
[WEAK[(すべてではありません。)]]
から
[[Twitter]]
にログインできなくなる[[障害]]がありました。
[SRC[>>11, >>12, >>16, >>17, >>18]]

[19] 
[[Android]] 版 [[Twitter]] 公式アプリ等では、
一部の[[利用者]]が[[ログアウト]]状態になり、
再ログインできない症状が発生していました。
[SRC[>>17, >>18, >>30, >>263, >>250]]

[20] 
[[Twitter API]] を利用した外部製アプリでは、
新着[[ツイート]]の日付が
“365日前”
となる現象が発生していました。
[SRC[>>17, >>18, >>30]]

** Twitter 社からの公式発表

[13] 
[TIME[北米太平洋標準時28日21時28分 [WEAK[(UTC 29日5時28分、日本中央標準時29日14時28分)]]][2014-12-29T05:28Z]]
付けの公式発表によれば、
[TIME[北米太平洋標準時28日16時0分 [WEAK[(UTC 29日0時0分、日本中央標準時29日9時0分)]]][2014-12-29T00:00Z]]
から[TIME[北米太平洋標準時28日21時25分 [WEAK[(UTC 29日5時25分、日本中央標準時29日14時25分)]]][2014-12-29T05:25Z]]
まで発生していました。
[SRC[>>12]]

[14] 
原因は
「front end code」
の[[不具合]]とだけ発表されました。
[SRC[>>12]]。
ここでいう[[フロントエンド]]が何を指すか明らかではありませんが、
[[Android]]
版アプリや [[Twitter API]] 利用クライアント等での障害報告があること
[SRC[>>1, >>16]]
や、
この時間で対処可能であったことを鑑みれば、
[[Twitter]]
サービスを提供する[[アプリケーションサーバー]]のうち、
アクセスを受け付ける外部側に近しい部分を担当するシステムでしょうか。





[REFS[

-
[74] 
[CITE@ja[Twitter SupportさんはTwitterを使っています: 「We're working on resolving issues some users are having signing in on some platforms. Watch this handle & http://t.co/7BlGvFMC3e for updates」 / [[Twitter]]]], 午前11:11 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-05T06:58:16.000Z]] <https://twitter.com/twittersupport/status/549387313474596864>
-
[FIG(quote)[
[FIGCAPTION[
[11] 
[CITE@en[[[Twitter Status]] - sign in issue]], [TIME[2022-06-30T09:34:00.000Z]], [TIME[2014-12-29T04:07:53.078Z]] <https://web.archive.org/web/20141229040541/http://status.twitter.com/post/106461837558/sign-in-issue>
]FIGCAPTION]

>
[BOX(set)[
[BOX[
SUN[LINES(quarter)[DEC][28TH]]
]BOX]

[BOX[

sign in issue [WEAK[2 hours ago]]

Some users are currently having trouble signing in to twitter.

Our engineers are currently working to resolve this.

]BOX]

]FIG]
-
[FIG(quote)[
[FIGCAPTION[
[12] 
[CITE@en[[[Twitter]] Status]], [TIME[2022-06-30T09:39:38.000Z]], [TIME[2014-12-30T02:23:36.245Z]] <https://web.archive.org/web/20141230021659/http://status.twitter.com/>
]FIGCAPTION]

>
[BOX(set)[
[BOX[
SUN[LINES(quarter)[DEC][28TH]]
]BOX]

[BOX[

sign in issue [WEAK[1 day ago]]

[ Update 9:28 PST ]

Between 4:00pm and 9:25pm PST today some users were unable to sign in to twitter.[BR[]]
This issue was due to a bug in our front end code, which has been patched.
We apologize for any inconvenience caused by this.

]BOX]

]FIG]
-
[75] 
[CITE@ja[Twitter SupportさんはTwitterを使っています: 「The issue that prevented some users from signing in to Twitter has been resolved. We apologize for the inconvenience: http://t.co/7BlGvFMC3e」 / [[Twitter]]]], 午後2:29 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-05T06:58:16.000Z]] <https://twitter.com/TwitterSupport/status/549437034746478592>


]REFS]

** 発生当時の HTTP 応答

[3] 
[[障害]]発生直後の[TIME[北米太平洋標準時28日16時41分 [WEAK[(UTC 29日0時41分、日本中央標準時29日9時41分)]]][2014-12-30T00:41Z]]
頃、
[[Twitter]]
の[[HTTPサーバー]]が西暦2015年12月29日と書いた
[[HTTPヘッダー]]を
[[HTTP応答]]に含めて送ってきていると一般の [[Twitter]] 
利用者と思われるアカウントが発見し、
数分後に報告しました。
[SRC[>>1]]

[4] 
発見報告ツイートへの返信で指摘されていますが、
本来の[TIME[2015-12-29]]と[[曜日]]が合いません。
[SRC[>>1]]
[TIME[2014-12-29]]の[[曜日]]のまま、[[年]]が誤っているのです。

[5] 
指摘はされていませんが、発見報告ツイートの画像 [SRC[>>1]]
をよく見ると、

- [6] 
誤っているのは 
[CODE[Date:]]
[[ヘッダー]]だけで、
[CODE[Last-Modified:]]
[[ヘッダー]]は[TIME[2014-12-29]]です。
[[年]]以外は[[秒]]まで一致しているにも関わらずです。
- [7] 
[CODE[Set-Cookie:]]
[[ヘッダー]]の
[CODE[Expires]] 
属性は[TIME[2016-12-29]]になっていますが、
[[年]]と[[曜日]]を除けば[[月]]から[[秒]]まで一致しています。
(構文が他と少し違いますが、それは仕様通りです。
[SEE[ [[HTTPの日時形式]], [[Cookieの日時形式]] ]])
- [8] 
[CODE[Date:]]
と
[CODE[Expires]]
の[[時間帯]]は [CODE[UTC]]
になっています。
[CODE[Last-Modified:]]
の[[時間帯]]は
[CODE[GMT]]
です。
正しいのは 
[CODE[GMT]]
です。
(ちょっと複雑な事情: [SEE[ [[HTTPの日時形式]] ]])

[9] 
この状況から、この3つの[[日付]]はすべて別の方法で出力されたことがわかります。
当時と現在では [[Twitter]] のサーバーの仕様も違っているでしょうからもはや検証不能ですが、
おそらく [CODE[Expires]] は現在日時の1年後を示していたものでしょう。
[CODE[UTC]] と誤記していたのは、この障害とは関係なく元々そうだったのでしょう。
[CODE[Last-Modified:]]
はわかりませんが、
[CODE[Date:]]
と
[CODE[Expires]]
は
[[HTTP]]
専用の[[日時形式]]生成ライブラリーではなく独自のアドホックな方法で生成していたのか、
専用ライブラリーだとしても製作者は [[HTTP]]
の知識に乏しかったのでしょう。

;; [10] 
今次の障害がなかったとしても、世界最高峰の[[Web企業]]の製品とは思えない低品質ですね。

[25] 
この発見報告が最速かどうかはわかりませんが、
この報告には多くの[[返信]]が付いており、
外部の[[ブログ]]等からも引用されました。

[REFS[
-
[1] 
[CITE@ja[Ninjiさんは[[Twitter]]を使っています: 「I MITMed Twitter for Android's login to see why it was failing. The Twitter servers think it's 2015. Amazing. http://t.co/iEu4rEUub9」 / Twitter]], 午前9:45 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-06-30T07:34:48.000Z]] <https://twitter.com/_Ninji/status/549365454322802688>
]REFS]


** Twitter 関係者の反応

[152] 
[[Berk D. Demir]]
(@bd)
は本段落執筆 
[WEAK[([TIME[令和4(2022)年7月][2022-07]])]]
時点で [[Twitter]] のプロフィールに元 [[Twitter]] 社員と書いています [SRC[>>149]]。
当時は [[Twitter]] 社員の技術者であることをほのめかす記述がありました [SRC[>>150]]。
[TIME[2016-08-02]]が最終出社日で [SRC[>>151]]、
障害当時もまだ社員だったことは確実と思われます。

[153] 
[[Berk D. Demir]]
は、
[TIME[北米太平洋標準時28日18時10分 [WEAK[(UTC 29日2時20分、日本中央標準時29日11時20分)]]][2014-12-29T11:20+09:00]]
に、
何かに驚いたような、しかし含みを残したような、
[[意味深]]な[[ツイート]]を投稿しました。
[SRC[>>144]]

[154] 
[[Berk D. Demir]]
は、
[TIME[北米太平洋標準時28日18時19分 [WEAK[(UTC 29日2時29分、日本中央標準時29日11時29分)]]][2014-12-29T11:29+09:00]]
に、
現状を的確に説明したイラストとして、
[[POSIX]]
に銃口を向けた絵を[[ツイート]]しました。
[SRC[>>145]]

[155] 
[[Berk D. Demir]] 
は、
[TIME[北米太平洋標準時28日18時40分 [WEAK[(UTC 29日2時40分、日本中央標準時29日11時40分)]]][2014-12-29T11:40+09:00]]
に、

> my dinner is corn chips and soda. THANK YOU POSIX!

> 夕食はコーンチップとソーダでした。 ** POSIX さんありがと! **

と皮肉めいて[[ツイート]]しました。
[SRC[>>134]]
それに対する返信に対して
[[Berk D. Demir]]
は、
[TIME[北米太平洋標準時28日18時54分 [WEAK[(UTC 29日2時54分、日本中央標準時29日11時54分)]]][2014-12-29T11:54+09:00]]
に、

> %Good on you lad.

と[[意味深]]に「%G」と書いて返しました。
[SRC[>>136]]
また、元の投稿に対して [[Rich Unger]] (>>141)
は、
[TIME[北米太平洋標準時28日19時15分 [WEAK[(UTC 29日3時15分、日本中央標準時29日12時15分)]]][2014-12-29T12:15+09:00]]
に、
料理中に呼び出されたので云々と返信しました。
[SRC[>>133]]

[REFS[
- [149] [CITE@ja[berk d. demir(@bd)さん / [[Twitter]]]], [TIME[2022-07-07T12:35:22.000Z]], [TIME[2022-07-07T12:37:25.295Z]] <https://twitter.com/bd>
-- [150] [CITE@ko[트위터의 [[Berk D. Demir]] (bd) 님]], [TIME[2022-07-07T12:48:00.000Z]], [TIME[2014-07-30T04:50:00.186Z]] <https://web.archive.org/web/20140730044721/https://twitter.com/bd>
-- [148] [CITE@ja[from:bd until:2014-12-31 - Twitter検索 / [[Twitter]]]], [TIME[2022-07-07T12:35:22.000Z]], [TIME[2022-07-07T12:36:52.304Z]] <https://twitter.com/search?q=from%3Abd%20until%3A2014-12-31&src=typed_query&f=live>
--- [144] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「wow...」 / Twitter]], 午前11:20 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T12:27:53.000Z]] <https://twitter.com/bd/status/549389363444842496>
--- [145] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「current status eloquently described by @marius. http://t.co/Yg8Ff1iynu」 / Twitter]], 
午前11:29 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T12:26:36.000Z]] <https://twitter.com/bd/status/549391832962981888>
---- [146] 「[L[POSIX]]」に銃口が向けられている[[拳銃]]のイラスト。
--- [134] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「my dinner is corn chips and soda. THANK YOU POSIX!」 / Twitter]], 午前11:40 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T11:58:36.000Z]] <https://twitter.com/bd/status/549394536925913089>
---- [133] [CITE@ja[[[Rich Unger]]さんはTwitterを使っています: 「@bd My dinner was just cooking when I got called in. Brought my fish and soup out to the shed with me.」 / Twitter]], 
午後0:15 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T11:58:36.000Z]] <https://twitter.com/rich_unger/status/549403180035891200>
---- [135] 返信 (非公開 [TIME[2022-07-07T12:02:10.900Z]])
----- [136] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「@sayrer %Good on you lad.」 / Twitter]], 
午前11:54 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T11:58:36.000Z]] <https://twitter.com/bd/status/549398033905876992>
--- [147] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「startup idea: uber for incident time ex-employee sideshows of wisdom distribution.」 / Twitter]], 午後2:23 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T12:33:59.000Z]] <https://twitter.com/bd/status/549435628920643584>
-- [151] [CITE@ja[[[berk d. demir]]さんはTwitterを使っています: 「today is my last day at twitter. i worked on exciting things with kind and brilliant folks; learned a ton and made some lifelong friends.」 / Twitter]], 午前1:00 · 2016年8月3日 [TZ[+09:00]], [TIME[2022-07-07T12:36:50.000Z]] <https://twitter.com/bd/status/760505491411705857>
]REFS]


[141] 
[[Rich Unger]] (@rich_unger) は本段落執筆
[WEAK[([TIME[令和4(2022)年7月][2022-07]])]]
時点で [[Twitter]] のプロフィールに元 [[Twitter]] 社員と書いています [SRC[>>140]]。
[TIME[2013-12-18]]時点で入社1年と書いていました [SRC[>>139]]。
障害から数日経った[TIME[2015-01-09]]には、
自分は [[Twitter]] でずっと[[技術的負債]]の相手をしていると[[ツイート]]していました
[SRC[>>137]]。
特に何を指しているとは言っていませんが、次に示すツイートを鑑みれば、
今回の障害をも含めていると解するのが自然でしょう。


[142] 
[[Rich Unger]]
は、
[TIME[北米太平洋標準時28日19時13分 [WEAK[(UTC 29日3時13分、日本中央標準時29日12時13分)]]][2014-12-29T12:13+09:00]]
に、

>Hey, anyone know what week it is?

>ねえ、いま何週か誰か知ってます?

と[[意味深]]な[[ツイート]]を投稿しました。
[SRC[>>112]]


[REFS[
- [140] [CITE@ja[[[Rich Unger]](@rich_unger)さん / Twitter]], [TIME[2022-07-07T11:55:02.000Z]], [TIME[2022-07-07T12:09:11.741Z]] <https://twitter.com/rich_unger>
-- [139] [CITE@ja[[[Rich Unger]]さんはTwitterを使っています: 「Been at @twitter 1 year today, and just having a great time.」 / Twitter]], 午前9:01 · 2013年12月18日 [TZ[+09:00]], [TIME[2022-07-07T11:55:10.000Z]] <https://twitter.com/rich_unger/status/413096637393666048>
-- [138] [CITE@ja[from:rich_unger until:2014-12-31 - Twitter検索 / [[Twitter]]]], 2014年12月30日 [TZ[+09:00]], [TIME[2022-07-07T12:02:45.000Z]] <https://twitter.com/search?q=from%3Arich_unger%20until%3A2014-12-31&src=typed_query&f=live>
--- [112] [CITE@ja[[[Rich Unger]]さんはTwitterを使っています: 「Hey, anyone know what week it is?」 / Twitter]], 
午後0:13 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T11:55:09.000Z]] <https://twitter.com/rich_unger/status/549402879547551744>
--- >>132
--- >>133
-- [137] [CITE@ja[[[Rich Unger]]さんはTwitterを使っています: 「Been on 4 teams at twitter. In all cases, my job has been addressing technical debt. I'm getting pretty darned good at it.」 / Twitter]], 午前7:55 · 2015年1月9日 [TZ[+09:00]], [TIME[2022-07-07T12:02:45.000Z]] <https://twitter.com/rich_unger/status/553324207439101952>
]REFS]


[157] 
[[mark mcbride]]
(@mccv)
は [[Twitter]] の [[Java]] 技術者でしたが、
[TIME[2012-10-05]]に3年にして退職したことを公表していました。 [SRC[>>158]]
従って障害当時は社員ではありませんでした。
[[mark mcbride]]
は障害当時、 [[Twitter]] の新旧社員らと障害原因について[[ツイート]]していました。
[SRC[>>156]]

[REFS[
- [158] [CITE@ja[[[mark mcbride]]さんはTwitterを使っています: 「3 years ago @twitter took a chance on an enterprise Java dev with an MBA. It's been a fantastic ride, but I'm off to @nest. Thank you all.」 / Twitter]], 午前2:08 · 2012年10月6日 [TZ[+09:00]], [TIME[2022-07-09T00:16:35.000Z]] <https://twitter.com/mccv/status/254266801792352256>
- [156] 
[CITE@ja[from:mccv until:2014-12-30 - Twitter検索 / [[Twitter]]]], 2014年12月28日 [TZ[+09:00]], [TIME[2022-07-09T00:02:15.000Z]] <https://twitter.com/search?q=from%3Amccv%20until%3A2014-12-30&src=typed_query&f=live>
-- [159] [CITE@ja[[[mark mcbride]]さんはTwitterを使っています: 「Pour one out for the oncall」 / Twitter]], 午後0:34 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/mccv/status/549408199871193088>
--- [160] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「@mccv have you been coming up with hypotheses, too?」 / Twitter]], 午後0:40 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/jmhodges/status/549409490383020033>
---- [161] [CITE@ja[[[mark mcbride]]さんはTwitterを使っています: 「@jmhodges I wouldn't dare」 / Twitter]], 午後0:40 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/mccv/status/549409566123765760>
----- [162] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「@mccv i got some good ones just saying」 / Twitter]], 午後0:41 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/jmhodges/status/549409848920506368>
------ [132] [CITE@ja[[[Rich Unger]]さんはTwitterを使っています: 「@jmhodges @mccv I'd tell you the root cause, Jeff, but you'd be too sad to have missed this.」 / Twitter]], 
午後1:09 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-07T11:56:44.000Z]] <https://twitter.com/rich_unger/status/549416998711468032>
------- [163] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「@rich_unger @mccv https://t.co/0pCelYftNc」 / Twitter]], 午後1:10 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/jmhodges/status/549417144450949120>
-------- [166] 引用: >>165
-------- [164] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「@rich_unger @mccv I got lots of hints」 / Twitter]], 午後1:10 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/jmhodges/status/549417180731682817>
-- [189] [CITE@ja[[[mark mcbride]]さんはTwitterを使っています: 「If this is indeed a %G bug can we either name it "warren" or "g thang" also I have more ideas hit me up」 / Twitter]], 午後1:35 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T04:46:03.000Z]] <https://twitter.com/mccv/status/549423411290570752>
--- [190] 
[CITE@ja[[[mark mcbride]]さんはTwitterを使っています: 「No wait. Err on the G string」 / Twitter]], 午前2:30 · 2014年12月30日 [TZ[+09:00]], [TIME[2022-07-09T05:09:53.000Z]] <https://twitter.com/mccv/status/549618468140879873>
---- [191] [CITE@ja[[[Tatsuhiko Miyagawa]]さんはTwitterを使っています: 「@mccv https://t.co/HpzmDd42EY :/」 / Twitter]], 午前2:31 · 2014年12月30日 [TZ[+09:00]], [TIME[2022-07-09T00:09:47.000Z]] <https://twitter.com/miyagawa/status/549618728996843520>




]REFS]


[176] 
[[Jeff Hodges]]
(@jmhodges)
は [[Twitter]] の技術者でしたが、
[TIME[2014-10-22]]に退職しました。 [SRC[>>170]]
従って障害当時は社員ではありませんでした。
[[Jeff Hodges]]
は障害当時、 [[Twitter]] の新旧社員らと障害原因について[[ツイート]]していました。
[SRC[>>175]]

[180] 
[[Jeff Hodges]]
は、
[TIME[北米太平洋標準時28日20時9分 [WEAK[(UTC 29日4時9分、日本中央標準時29日13時9分)]]][2014-12-29T13:09+09:00]]
に、
特に何とは明言せず、
YYYY と %G 
に言及しました。 [SRC[>>165]]
続いて
[TIME[北米太平洋標準時28日21時1分 [WEAK[(UTC 29日5時1分、日本中央標準時29日14時1分)]]][2014-12-29T14:01+09:00]]、

>If you're using YYYY in your JVM service or %G in anything, fix it now. You're using the wrong year format. Reproduction: `date -u "+%G"`

>JVM サービスで YYYY を使っている人、何かで %G を使っている人は、今すぐ修正されたし。年の書式を間違って使っています。再現: [CODE[[[date]] -u "+%G"]]

と[[ツイート]]しました。 [SRC[>>169]]
この[[ツイート]]はよく拡散されました [SRC[>>171]]。


[REFS[
- [170] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「Hey, today's my last day at Twitter, Inc. We're gonna be okay.」 / Twitter]], 午前3:37 · 2014年10月23日 [TZ[+09:00]], [TIME[2022-07-09T00:15:07.000Z]] <https://twitter.com/jmhodges/status/524993060602511361>
- [175] [CITE@ja[from:jmhodges until:2014-12-31 - Twitter検索 / [[Twitter]]]], [TIME[2022-07-09T00:15:07.000Z]], [TIME[2022-07-09T01:11:30.667Z]] <https://twitter.com/search?q=from%3Ajmhodges%20until%3A2014-12-31&src=typed_query&f=live>
-- [173] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「No Twitter joke like a Twitter employee Twitter joke」 / Twitter]], 午前10:34 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T01:09:13.000Z]] <https://twitter.com/jmhodges/status/549377970297511938>
-- [174] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「One of the weird parts of Twitter is that the folks who make and run it are very visible on it.」 / Twitter]], 午前10:35 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T01:09:13.000Z]] <https://twitter.com/jmhodges/status/549378261638074368>
-- [165] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「lol YYYY lol %G」 / Twitter]], 午後1:09 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:09:57.000Z]] <https://twitter.com/jmhodges/status/549416970282487809>
-- >>160
-- [169] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「If you're using YYYY in your JVM service or %G in anything, fix it now. You're using the wrong year format. Reproduction: `date -u "+%G"`」 / Twitter]], 午後2:01 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:10:01.000Z]] <https://twitter.com/jmhodges/status/549430032616017921>
---
[188] 
[CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「(The correct formats are "yyyy" and "%Y". Yes, this matters and is happening right now. "Week-based years" are a thing.)」 / Twitter]], 午後2:07 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T02:23:34.000Z]] <https://twitter.com/jmhodges/status/549431554879938560>
-- [167] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「Shoutout to the I'm-going-leave-them-nameless engineers that showed me the week year problem. Y'all are the real MVPs」 / Twitter]], 午後2:24 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:22:06.000Z]] <https://twitter.com/jmhodges/status/549435704959197184>
-- [168] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「I'm not working at any company right now and if someone is telling you different, they don't know me very well. This is a weird tweet.」 / Twitter]], 午後4:25 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T00:15:17.000Z]] <https://twitter.com/jmhodges/status/549466122102132736>
-- [171] [CITE@ja[[[Jeff Hodges]]さんはTwitterを使っています: 「Anyway, now my most retweeted and faved tweet is about a datetime bug and isn't even my bug welp https://t.co/Mk1Jks1kki」 / Twitter]], 午前5:14 · 2014年12月30日 [TZ[+09:00]], [TIME[2022-07-09T00:57:49.000Z]] <https://twitter.com/jmhodges/status/549659800275939331>
--- [172] 引用: >>169
]REFS]


[143] 
元社員の
[[mark mcbride]] (>>157)
と
[[Jeff Hodges]] (>>176)
は、
障害の原因は何だろうねと[[ツイート]]し合っていました。
[SRC[>>159]]

[178] 
[[Twitter]] 社員の
[[Rich Unger]] (>>142)
は、
[TIME[北米太平洋標準時28日20時9分 [WEAK[(UTC 29日4時9分、日本中央標準時29日13時9分)]]][2014-12-29T13:09+09:00]]
に、

>I'd tell you the root cause, Jeff, but you'd be too sad to have missed this.

>Jeff に根本の原因を教えてあげたいわ、でもこれ逃してたなんて悲しみそうよね。

と返信しました。
[SRC[>>132]]

[179] 
その返信に対して
[[Jeff Hodges]] 
は、
[CODE[%G]]
ではないかという推測 [SRC[>>165]]
を示しました [SRC[>>163]]。
[[Rich Unger]] 
はそれに対して特に何も明言しませんでした。



[177] 
[[Twitter]] 社員の
[[Berk D. Demir]] (>>152)
は、
[TIME[北米太平洋標準時28日21時23分 [WEAK[(UTC 29日5時23分、日本中央標準時29日14時23分)]]][2014-12-29T14:23+09:00]]
に、

>startup idea: uber for incident time ex-employee sideshows of wisdom distribution.

>起業案: 事案の時に元従業員が余興で知識を広める [[Uber]]。

と冗談めいた[[ツイート]]を投稿しました。
[SRC[>>147]]

[181] 
以上、
[[Twitter]]
社員は障害原因と明言はしないものの、
[[週年]]との関係性をほのめかす[[ツイート]]をしていました。
そして親交が続いていたらしい
[[Twitter]]
元社員が、
やはり障害原因とは明言しないものの、
より具体化した[[ツイート]]で[[週年]]との関係性を説明していました。
そして
[[Twitter]]
社員はその事故原因共有プロセスを好意的に評価していました。

[182] 
[[Twitter]] 社員が明言しなかったのは、
おそらく [[Twitter]] 社でも社内のプログラムコードの情報や障害原因は社外秘であって、
一従業員の立場で勝手にそれを開示するわけにはいかなかったからでしょう。
しかし技術者としての落胆や知的興奮の発露や情報共有の欲求は抑えきれなかったのですね。

[183] 
元社員が非公開の場でそうした情報を密かに知った可能性は否定できませんが、
いずれの[[ツイート]]も公開情報から推測し得る範囲に留まっていますから、
あくまで独自の推測で発言したものと思われます。
[WEAK[(同内容の推測は元社員以外も早い段階で行われています: 例えば >>1 への返信。)]]
社員時代に障害発生部分にどの程度関与していたかは不明ですが、
ある程度のシステム構成のイメージは把握していたでしょうから、
まったくの外部の人よりは確度が高く予測できそうです。
そして社員がその予測に明確な否定はせず、
歓迎するかのような反応をしているのをみれば、
概ね妥当な線といえるのではないでしょうか。




** 発生当時の反応



[108] 
[[Twitter]] のすべてのアクセスが遮断されたわけではありませんでしたから、
[[Twitter]] では[[利用者]]による関係する投稿が相次ぎました。
その中には
[[Twitter]] の
[[HTTP応答]]に注目したもの (>>3)
や、それを受けて[[週年]]との関係を指摘したものもありました。

[109] 
年末の[[月曜日]]というタイミングで[[年]]が切り替わるという現象に心当たりある技術者は珍しくないようです。
そしてその具体的な原因として、
[[日時形式パターン]]の [CODE[G]] と [CODE[Y]] の取り違いや、
[CODE[yyyy]] と [CODE[YYYY]] の取り違いではないかと推測されていました。
(例えば >>1 の[[返信]]欄を参照。)

[111] 
一方で情報技術者ながらもその挙動に驚きを隠せないコメントを残す人が少なくありませんでした。
見る人が見れば一瞬でわかる反面、
まったく想像だにしなかった人も多いということなのでしょう。



[15] 
[[IT]]ベンチャー系[[Web媒体]]として有名な
[CITE[TechCrunch]]
[WEAK[(本家英語版)]]
は、
[TIME[北米太平洋標準時28日18時21分 [WEAK[(UTC 29日2時21分、日本中央標準時29日11時21分)]]][2014-12-29T02:21Z]]
に障害を報じました。
実際には復旧後に追記されています。
しかしこの記事は障害の発生原因には踏み込んでいませんでした。
[SRC[>>16]]

[NOTE[

[53] 
本段落を執筆した[TIME[令和4(2022)年6月][2022-06]]時点で、
この[[Webページ]]には次のようにあります。
[SRC[>>16]]

-
[55] 
[[URL path]] 
に [CODE[2014/12/28]]
とあります。
-- [61] [[米国時間]]の[[日付]]と推測されます。
-
[22] 
[CODE[<meta name=sailthru.date>]] には
"2014-12-28 18:21:52"
とあります。
[[Sailthruの日時形式]]で、[[時間帯]]は明記されません。
-- [62] [[PST]] と推測されます。
-
[54] 
[[JSON-LD]]
形式の 
[[Schema.org]] メタデータには、
[CODE[dateCreated]] が "2014-12-29T02:21:52Z"、
[CODE[datePublished]] が "2014-12-29T02:21:52Z"、
[CODE[dateModified]] が "2015-01-13T06:55:41Z"
とあります。
-
[60] 
[[JSON-LD]]
形式の 
[[Schema.org]] メタデータがもう1組あって、
[CODE[datePublished]] が "2014-12-29T02:21:52+00:00"、
[CODE[dateModified]] が "2015-01-13T06:55:41+00:00" 
とあります。
-- [63] なぜ2組あるのか不明ですが、内容が微妙に違っています。
-- [64] [[時間帯]]の表記もなぜか違っています。
-
[56] 
[CODE[<meta name>]] 
[CODE[cXenseParse:recs:publishtime]] に
"2014-12-29T02:21:52Z"、
[CODE[cXenseParse:modified_time]] に
"2015-01-13T06:55:41Z"
とあります。
-
[57] 
サーバーから送信された [[HTML]] ソースコード中の大見出し下日付表示部分に、
「8 years」
とあります。
(いわゆる [[ambtime]] です。)
--
[66] 
どうせここには後から [CODE[time]] [[要素]]が挿入されるのに、
なぜサーバーでは生成されないのでしょうかね。
---
[67] 
そのせいで [[JavaScript]] を実行せずベンダー独自のメタデータを理解しない[[クライアント]]は[[日付]]を知り得ません。
-
[58] 
その日付は表示時に [[JavaScript]] によって次のように書き換えられます。
[PRE[
<time class="full-date-time" datetime="2014-12-29T02:21:52">11:21 AM GMT+9<span class="full-date-time__separator">•</span>December 29, 2014</time>
]PRE]
-- [59] 
この GMT+9 は表示側の[[時間帯]]設定によって決められたものと思われます。
-- [65] 
[CODE[datetime][<time datetime>]]
になぜか[[時間帯]]が明示されていませんが、 [[UTC]] と推測されます。



]NOTE]

[21] 
有名[[Web媒体]]の
[CITE[ZDNet]]
[WEAK[(本家英語版)]]
は、
[TIME[北米太平洋標準時28日18時29分 [WEAK[(UTC 29日2時29分、日本中央標準時29日11時29分)]]][2014-12-29T02:29Z]]
に障害を報じました。
[SRC[>>18]]


[24] 
この記事は、障害の症状を紹介したものでしたが、
「Twitter は2015年をほぼぶっ飛ばして2016年に近づいている」
と皮肉って、キャッチーな[[見出し]]を付けていました。
[[Twitter]]
社の告知文
[WEAK[(出典は明記されていませんが、 >>74 と推測されます。)]]
を引用していました。
初公開以後も更新されているようですが (>>23)、
復旧は報じていませんし、
原因にも言及していません。
[SRC[>>17, >>18]]


[NOTE[

[68] 
本段落を執筆した[TIME[令和4(2022)年6月][2022-06]]時点で、
この[[Webページ]]には次のようにあります。
[SRC[>>17]]

-
[69] 
[[JavaScript]]
コード中に
[CODE["articlePubDate":"2014-12-29 02:29:00+0000"]]
とあります。
--
[70] 公開日時と推測されます。
-
[23] 
[[JSON-LD]]
形式の
[[Schema.org]]
メタデータには、
[CODE[dateModified]]
が
"2015-01-05T22:29:00.000Z"、
[CODE[datePublished]]
が
"2014-12-29T02:29:00.000Z"
とあります。
-
[71] 
大見出し下日付表示部分に、
[PRE(HTML code)[
<time class="c-globalAuthor_time">Dec. 28, 2014</time>
]PRE]
とあります。
--
[72] 
[CITE[HTML Standard]]
の定める構文に違反しています。
[WEAK[(他にも [[HTML]] として不適切な記述が多く、この[[Webサイト]]の技術スタッフの技能水準に不安を感じさせます。)]]
-- [73] [[米国時間]]の[[日付]]と推測されます。


]NOTE]


[28] 
[[IT技術者]]向けニュース[[掲示板]]コミュニティーの
[CITE[Slashdot]]
[WEAK[(本家英語版)]]
は、
29日13時 ([[時間帯]]不明)
に記事を公開しました。
[CITE[TechCrunch]] の記事 (>>15)
と
[CITE[ZDNet]] の記事 (>>21)
を参照し、特に後者から[[日時]]が1年ずれた症状の説明を[[引用]]していました。
[SRC[>>27]]


[NOTE[

[76] 
本段落を執筆した[TIME[令和4(2022)年6月][2022-06]]時点で、
この[[Webページ]]には次のようにあります。
[SRC[>>27]]

-
[77] 
[[URL path]]
に
[CODE[14/12/29]] 
とあります。
--
[78] 
公開日[TIME[2014-12-29]]を表すと推測されます。
-
[79] 
大見出し下日付表示部分に、
[PRE(HTML code)[
<time id="fhtime-68598101" datetime="on Monday December 29, 2014 @01:01AM">on Monday December 29, 2014 @01:01AM</time>
]PRE]
とあります。
--
[80] 
[CITE[HTML Standard]]
の定める構文に違反しています。

[29] 
1つ前の記事は [[URL path]] に「29」とあって表示されている日付に「28」とあります。
両者は別の瞬間または別の[[時間帯]]の日付であるようです。

[81] [[Internet Archive]] では[TIME[2014-12-31]]時点の版が最古です。
]NOTE]



[44] 
この事件の原因に言及した[[ツイート]]があったとされます [SRC[>>51, >>52]]。
残念ながらこのアカウントは現在非公開になっており [SRC[>>49]]、
[[Twitter]]
サイト上の原文を確認できません。

[88] 
[[Twitter]] の当該ページで[[返信]]関係の[[子孫]]に当たる[[ツイート]]として表示されるもののうち、
最古のものの[[日時]]は
[CODE[2014-12-29T05:39:58.000Z]]
となっています
[SRC[>>49, >>45]]。
従って大元の[[ツイート]]はこれを下らないことになります。
[WEAK[(引用の >>51, >>52 とも引用元の[[日付]]だけで[[時刻]]は不明です。どちらの記事もこの返信ツイートより後に公開されたものです。)]]

[89] 
この[[ツイート]]は、

>
a single character G instead of Y took down twitter’s api because the ISO year starts today

>
たった1文字 Y でなく G のせいで Twitter の API が落ちた、
今日から ISO 年が始まったので

と書いていました。
[SRC[>>51, >>52]]

[90] 
すなわち、
「ISO year」  (>>185)
を表す
[CODE[G]]
を[[暦年]]を表す
[CODE[Y]]
のかわりに使ってしまったので障害が発生したと断定していました。

[91] 
しかしこの[[ツイート]]はその根拠を一切示していませんでした。
同じアカウントの他の[[ツイート]]がそれを書いていた可能性も否定はできませんが、
[[ツイート]]が非公開で他のサイトにも引用されていないため、
何とも言えません。

[92] 
このアカウントの所有者の素性も[[ツイート]]が非公開のため確認し難いです。
しかし
[[Internet Archive]]
で確認できるごく一部の[[ツイート]]や、
[[返信]]している他の人からの[[ツイート]]、
当時及び現在の[[アカウント]]のプロフィール ([[bio]]) 欄とその[[リンク先]]の
[[Webページ]]の記述内容において、
この人物が
[[Twitter]]
の社員等、本件の原因を知り得る立場にあったと推測し得る徴証は見つけられません。

[26] 
時間的には
[[Twitter]] 関係者の[[ツイート]]
(例えば >>155, >>180)
を見て書いたのかもしれませんし、
まったく根拠なく当てずっぽうで書いているのかもしれませんが、
今となっては確かめる術がありません。

[185] 
この[[ツイート]]は、
「ISO year」
が始まったの原因だと言っています。
この[[ツイート]]だけ読んでも
「ISO year」
とは何か明らかにし得ませんが、
[[ISO 8601]] の定める[[週年]]の意味でしょうか。
[[返信]]にも[[週年]]の誤りではないかとの指摘がありますが、
元の[[ツイート]]主はそれに反応していません。
(現在では非公開なので、その後訂正したのかどうかわかりません。)
[[暦年]]と[[週年]]の取り違えが原因ではないかという文脈で、
[[暦年]]も[[週年]]もどちらも
[[ISO 8601]] の定めるところであるにも関わらず、
[[週年]]を
「ISO year」
と表記するのは極めて不適切と言わざるを得ません。
誤りといってもいいでしょう。

[186] 
そしてそのような技術的誤りを含む[[ツイート]]を事実確認もせずに[[引用]]する[[媒体]]
(>>47 >>102)
もまた、信頼に値しないと言わざるを得ません。
障害の原因 (とされるもの) を理解していたなら、
それと同じ過ちを犯した[[ツイート]]を根拠に記事が書けるはずがありません。


[31] 
[[英国]]の[[ニュースサイト]]
[CITE[The Guardian]]
は、
[TIME[北米太平洋標準時29日11時14分 [WEAK[(UTC 29日16時14分、日本中央標準時30日1時14分)]]][2014-12-29T16:14Z]]
に障害を報じました。
[SRC[>>30, >>32]]


[46] 
この記事はサーバーの返す時刻の間違いの発見ツイート
(>>3)
を引いて症状を紹介しました。
[SRC[>>30]]

[47] 
更に、
1文字間違いのツイート (>>44) を引いて、
[[Mac]]
で
[CODE[date]]
コマンドを使って日時書式付けを1文字変えて実行した画面を示しつつ、

>Assuming that this is the error that brought Twitter down overnight, it’s easy to see how it happened.

>これが Twitter を一晩落とした誤りだったとすると、
如何にして起こったのかよくわかります。

と書いていました。
これを踏まえてでしょう、
この記事は障害を

>a bug in a line of code caused the service to think that it was 29 December, 2015

>1行のコードのバグによって Twitter は2015年12月29日だと思ってしまった

と説明していました。
「Assuming」と一歩引いた表現を織り交ぜながらも、
原因が[[週年]]を表す「1行」だと完全に断定しています。
[SRC[>>30]]


[110]
この [CODE[date]] コマンドは元 [[Twitter]] 関係者が[[ツイート]]したもの
(>>180) とほぼ同じですが、その[[ツイート]]は[[引用]]していません。
この分野の知識のある技術者なら難しいものではなく、
単純で誰が書いても同じになるものですから、
まったく独立に考案していたとしてもおかしくありません。
当該[[ツイート]]を見ていなかったのでしょう。
素性の分からない者の[[ツイート]]を引用してソースにするくらいですから、
情報源を隠す理由はないはずです。




[NOTE[

[82] 
本段落を執筆した[TIME[令和4(2022)年6月][2022-06]]時点で、
この[[Webページ]]には次のようにあります。
[SRC[>>30]]

- [83] 
[[URL path]]
に
[CODE[2014/dec/29]]
とあります。
--
[84] 
公開日[TIME[2014-12-29]]を表すと推測されます。
-
[34] 
[[JSON-LD]]
形式の 
[[Schema.org]] メタデータに、
[CODE[datePublished]] が
"2014-12-29T16:14:50.000Z"、
[CODE[dateModified]] が
"2017-02-21T18:17:06.000Z"
とあります。
-
[36] 
[[OGP]]
メタデータに、
[CODE[article:published_time]] 
が 
"2014-12-29T16:14:50.000Z"、
[CODE[article:modified_time]]
が
"2017-02-21T18:17:06.000Z"
とあります。
-
[38] 
著者名下日付欄に
[PRE(HTML code)[
<details class="dcr-km9fgb"><summary class="dcr-h56grb">Mon 29 Dec 2014 16.14 GMT</summary>First published on Mon 29 Dec 2014 16.12 GMT</details>
]PRE]
とあります。
--
[85] 
最終更新日時と初公開日時を表すと推測されますが、
[[Schema.org]] や [[OGP]] のものと基準が違うようです。


[39] 
[[Internet Archive]]
で保存されている最古は
[TIME[UTC 30日2時6分56秒][2014-12-30T02:06:56Z]]
時点とされるものです。
次のようにあります。
[SRC[>>32]]

-
[33] 
Monday 29 December 2014 11.14 EST
付と書かれていました。
[SRC[>>32]]
-
[40] 
[[Microdata]]
の
[[Schema.org]] メタデータで
[CODE[datePublished]] は
"2014-12-29T11:14:50-0500"
と書かれていました。
--
[37] 
その
[CODE[time]]
要素には独自の
[CODE[[[data-]]timestamp="1419869690000"]]
属性がありました。
--
[86] 
いかにも[[ミリ秒単位のUnix time]]のように見えます。
そう解釈すると両者は同じ[[日時]]を表しています。
-
[41] 
[[OGP]] メタデータで
[CODE[article:published_time]]
は
"2014-12-29T16:14:50.000Z"、
[CODE[article:modified_time]]
は
"2014-12-29T17:30:27.963Z"
と書かれていました。
-
[42] 
[[JavaScript]]
中の独自のデータで
[CODE["renderTime":"2014-12-30T02:06:30Z"]]、
[CODE["webPublicationDate":1419869690000]]
と書かれていました。
[SRC[>>32]]
--
[87] 
前者は >>39 とほぼ同じ、
後者は >>40 と完全に一致します。
前者はアクセス日時、
後者は公開日時と推測されます。

[35] 
当時は [CODE[time]] 要素で日時が [[HTML]] レベルで[[機械可読]]な形で明示されていたのに、
現在はそうではありません。 [[Webページ]]の技術担当者 (社?) が変わったのでしょうか。
技術的には退化していると言わざるを得ません。

]NOTE]


[93] 
[[仏国]]のある[[ブログ]]は、
[TIME[2014-12-30]]に本件に言及しました。
[SRC[>>48]]

[101] 
この記事は障害の期間を
「this Monday, between midnight and 5 AM, CET」
としました。
出典はなく根拠は不明です。
[SRC[>>48]]
公式発表によれば [[UTC]] の0時から5時半前で (>>99)、
[[CET]] (>>13) [TZ[+01:00]] では1時から6時半前に当たるものです。
[[分]]を丸めた大雑把な表現とも捉えられますが、
[[換算][時差換算]]を1時間誤ったと解する方が素直でしょうか。

[102] 
この記事は1文字間違いのツイート (>>44) を引いて、

> A bug in a line of code caused the service to think that it was 29 December, 2015.

> 1行のコード中のバグによって Twitter は2015年12月29日だと思ってしまった。

と断言しました。
[SRC[>>48]]

[103] そして、

> ISO week numbering system uses the [CODE[YYYY]] format for the year instead of the Gregorian calendar’s [CODE[yyyy]]. 

> ISO 紀週法は年に [CODE[YYYY]] 形式を使っていてグレゴリオ暦の [CODE[yyyy]] 形式ではないのです。

と説明していました。
[SRC[>>48]]

[187] 
この記事は
「ISO year」
という誤った記述 (>>185)
を含んだ[[ツイート]]を引用しながら、何の断りもなくそれを
「ISO week numbering system」
の[[年]]の話にすり替えています。
文意を汲んだものだとしても、
話の根幹に関わる部分でこれは不誠実ではないでしょうか。



[104] 
しかもこの記事は、
[[ISO週]]の[[週年]]が障害の原因だとする解釈は受け入れながら、
なぜか引用元ツイートの1文字間違い説ではなく大文字と小文字の違いで説明しています。
ただしこの記事の説明は [[ISO週]]がそうだと言っているだけで、
[[Twitter]] のシステムがそうしているとは断言していません
[WEAK[(著者はそう思っていたのかもしれませんが、この記事だけではどちらとも言えません)]]。
また、 [CODE[YYYY]] / [CODE[yyyy]] の書式がどの[[プラットフォーム]]のどの構文に基づいているのか、
一言も説明がありません。 [[ISO]] が決めているという認識かもしれませんね。

[106] 
この記事の[[著者]]が [[Twitter]] 
の社員等、本件の原因を知り得る立場にあったと推測し得る徴証は見つけられません。


[105] 
更に [[Apple]]
の
[[Do Not Disturb]]
の不具合を先行事例 [SRC[>>347]] として引いて、
[[日時処理]]は難しいと結んでいました。
[SRC[>>48]]


[NOTE[

[107] 
本段落を執筆した[TIME[令和4(2022)年6月][2022-06]]時点で、
この[[Webページ]]には次のようにあります。
[SRC[>>48]]

-
[94] 
[[URL path]]
に
[CODE[2014/12]]
とあります。
--
[95] 公開日を表すと推測されます。
-
[96] 
本文下の日付表示部分に
[PRE(HTML code)[
<li class="date-meta">
<div class="genericon genericon-month"></div>
<span class="screen-reader-text">Date</span>
<a href="https://blog.antoine-augusti.fr/2014/12/twitter-api-app-down-5-hours-calendars/" rel="bookmark" title="9 h 29 min">30 December 2014</a>
</li>
]PRE]
とあります。
--
[97] 
公開日を表すと推測されます。
--
[98] 
[CODE[title][title=""]] [[属性]]は公開の時刻が9時20分であると解していいものでしょうか。
-
[99] 
本文中に障害発生時刻が 「CET」 で書かれています。
[[CET]] は[[中央欧州時刻]]を意味すると思われます。
[[仏国の標準時]] [TZ[+01:00]] です。
--
[100] [[著者]]の常用の[[時間帯]]と推測されます。


]NOTE]


[223] 
[[英語]]の
[[IT]]技術者向け[[掲示板]]コミュニティーとして有名な
[[Hacker News]]
には、
[TIME[2014-12-29]] ([[時間帯]]不明)
に親記事が投稿され、
多くのコメントが集まりました。
[SRC[>>220]]

[224] 
[[pinaceae]]
による親記事は、投稿日時が

>
[PRE(HTML code)[
<span class="age" title="2014-12-29T15:35:12"><a href="item?id=8810157">on Dec 29, 2014</a></span>
]PRE]

と書かれていましたが、

> The single character G instead of Y took down Twitter's API today.

> たった1文字 Y でなく G のせいで Twitter の API が落ちた

と題し、本文で

>
If you're using YYYY in your JVM service or %G in anything, fix it now. You're very likely using the wrong year format.
>
date Mon Dec 29 00:44:45 EST 2014 date -u "+%G" 2015
>
ISO 8601 week numbering has 2015 start this week.

>JVM サービスで YYYY を使っている人、何かで %G を使っている人は、今すぐ修正されたし。年の書式を間違って使っています。
>
date Mon Dec 29 00:44:45 EST 2014 date -u "+%G" 2015
> ISO 8601 紀週法では今週、2015年が始まります。

と書きました。
[SRC[>>220]]

[225] 
題名は >>89,
本文の先頭2段落は >>169
のツイートとほぼ一致するものです。
差はほんのわずかで、明らかにどちらかがどちらかの複製です。
当サイトの[[日時]]が[[北米太平洋標準時]]だとすれば、
本文は >>169 がオリジナルということになります。
題名は >>89 の[[日時]]が確定できないので判断できません。

;; [226] 出典を明記しないで[[コピペ]]する文化は困ったものです。

[228] 
この
[[Hacker News]] 
の記事に対し、その出典は何なのかと問うコメントがありました
[SRC[>>220]]。
(当然の疑問ですね。)
それに対して
[[spatulon]]
は、
[CODE[2014-12-29T16:26:48]] ([[時間帯]]不明)
に、
[[Jeff Hodges]] (>>176)
の2つの[[ツイート]]
>>169, >>188
を示しました
[SRC[>>220]]。
それに対してどこかの誰かが[[ツイート]]しただけでは出典にはならないとする指摘
(「Not much of a source really, it's just some random dudes tweet, with no real explanation.」)
がありましたが、
[[dmourati]] ([[時間帯]]不明)
は
[CODE[2014-12-29T19:40:34]]
に、

>※ [[Twitter]] で働いていた人で、その人が[[ツイート]]している時間に問題を見つけて直した現在 [[Twitter]] で働いてる人々を引用したどこかの誰か

>* Random dude who worked at twitter and cited the people currently working at twitter who found and fixed the problem during the time he tweeted it.

と嫌味ったらしく補足しました
[SRC[>>220]]。

[229] 
つまり
[[Jeff Hodges]] は
[[Twitter]] の元社員で、
障害対応中の現役 [[Twitter]] 社員の[[ツイート]]も[[引用]]しているから、
信頼できる情報だといいたいようです。
(それならその[[ツイート]]も提示するべきですよね。
[[URL]] が貼られた >>169 >>188 とその返信だけを見ても、
その情報にはたどり着けません。)

[230] 
現役 [[Twitter]] 写真と親しい [[Twitter]] 元社員だからといって、
その[[ツイート]]が信用できるという主張には難があります。
該当すると思しき [[Twitter]] 社員は結局最後まで原因を明言しませんでした (>>181)。
[[ツイート]]を引用された
[[Jeff Hodges]]
自身も、

>I'm not working at any company right now and if someone is telling you different, they don't know me very well. This is a weird tweet.

>私は今はどこの会社でも働いていないので、誰かが違うことを吹き込んだとしても、その人は私のことをよく知らない人です。これはおかしなツイートですね。

と書いていました。 [SRC[>>168]]
どの[[ツイート]]を指していたのか不明ですが、
件のコメントと同じように元社員だからと不当に引用か非難でもされて困っていたのでしょう。

[231] 
なお、
この
[[Hacker News]] 
記事の投稿者および「出典」[[ツイート]]を書き込んだ人、
[[ツイート]]主が [[Twitter]] 元社員だと書いた人の3人は、
[[Twitter]] の社員や関係者である(あった)という徴証を見つけられません。




[227] 
この
[[Hacker News]] 
記事にはいろいろな[[プログラミング言語]]や[[ライブラリー]]の状況が報告されています。
また [[Twitter]] とは独立に
[[Objective-C]] のソフトウェアで1件、
不明な言語の製品で1件、同じ原因のトラブルが報告されています。
[SRC[>>220]]

;; [232] [[Twitter]] の大規模障害で明るみに出ただけで、
小規模な事件は毎年起こっている可能性がありそうですね。


[REFS[


- 
[16] [CITE@en-US[Twitter’s Engineers Currently Fixing Widespread Sign-In Issue '''['''Update: Fixed''']''' | [[TechCrunch]]]],
[[Catherine Shu]],
11:21 AM GMT+9•December 29, 2014,
[TIME[2022-06-30T09:55:21.000Z]]
<https://techcrunch.com/2014/12/28/twitters-engineers-currently-fixing-widespread-sign-in-issue/>
-
[17] 
[CITE@en[Twitter skips most of 2015, locks users out of Android app | [[ZDNet]]]], 
[[Chris Duckett]],
Dec. 28, 2014,
[TIME[2022-06-30T11:00:39.000Z]] <https://www.zdnet.com/article/twitter-skips-most-of-2015-locks-users-out-of-android-app/>
--
[18] 
[CITE@en[Twitter skips most of 2015, locks users out of Android app | [[ZDNet]]]],
[[Chris Duckett]],
December 29, 2014 -- 02:29 GMT (18:29 PST),
[TIME[2022-06-30T11:05:17.000Z]], [TIME[2014-12-29T03:01:39.632Z]] <https://web.archive.org/web/20141229030017/http://www.zdnet.com/article/twitter-skips-most-of-2015-locks-users-out-of-android-app/>
-
[27] 
[CITE@en[Twitter Bug Locks Out Many Users - [[Slashdot]]]], 
[[timothy]],
Monday December 29, 2014 @01:01AM,
[TIME[2022-06-30T11:44:18.000Z]] <https://tech.slashdot.org/story/14/12/29/0418246/twitter-bug-locks-out-many-users>
-
[49] 
[CITE@ja[Twitter]], 
[TIME[2022-07-04T07:11:09.000Z]] <https://twitter.com/tef/status/549438197642833920>
-- [50] 非公開 (返信のみ閲覧可能) [TIME[2022-07-04T07:12:12.500Z]]
--
[45] 
[CITE@ja[@gamehawk@mastodon.socialさんはTwitterを使っています: 「@tef Or 2015, depending on how you look at it.」 / [[Twitter]]]], 午後2:39 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-05T08:19:21.000Z]] <https://twitter.com/gamehawk/status/549439664696741889>
-
[30] 
[CITE@en[Twitter kicks Android app users out for five hours due to 2015 date bug | [[Twitter]] | [[The Guardian]]]], 
[[Alex Hern]],
Mon 29 Dec 2014 16.14 GMT,
First published on Mon 29 Dec 2014 16.12 GMT,<https://www.theguardian.com/technology/2014/dec/29/twitter-2015-date-bug>
--
[32] 
[CITE@en-GB[Twitter kicks Android app users out for five hours due to 2015 date bug | Technology | [[The Guardian]]]], [[Alex Hern]], 
Monday 29 December 2014 11.14 EST,
[TIME[2022-06-30T12:35:33.000Z]], [TIME[2014-12-30T02:15:11.317Z]] <https://web.archive.org/web/20141230020656/http://www.theguardian.com/technology/2014/dec/29/twitter-2015-date-bug>
--
[43] 
[CITE@en-GB[Twitter kicks Android app users out for five hours due to 2015 date bug | Technology | The Guardian]], [[Alex Hern]], [TIME[2022-06-30T13:32:01.000Z]], [TIME[2014-12-30T06:14:57.618Z]] <https://web.archive.org/web/20141230061330/http://www.theguardian.com/technology/2014/dec/29/twitter-2015-date-bug>
-- 
[52] 
引用: >>49
-
[48] 
[CITE@en-US[Why [[Twitter]] was down for 5 hours. It’s all about calendars. – Antoine Augusti]], 
[[Antoine Augusti]],
30 December 2014,
[TIME[2022-07-04T07:05:35.000Z]] <https://blog.antoine-augusti.fr/2014/12/twitter-api-app-down-5-hours-calendars/>
-- [51] 引用: >>49
-
[220] 
[CITE@en[If you're using YYYY in your JVM service or %G in anything, fix it now | [[Hacker News]]]], [TIME[2022-07-09T07:22:28.000Z]] <https://news.ycombinator.com/item?id=8810157>



]REFS]

** 障害原因

[113] 
障害原因については、公式な発表が見つけられません。
[[Twitter]]
社員の技術者の[[ツイート]]
(>>152 >>141)
やそれに絡んだ元社員の[[ツイート]]
(>>157 >>176)
は示唆に富んでいるのですが、
断片的な情報しか与えてくれません。

[114] 
各[[媒体]]の記事も公式発表や一般[[利用者]]の症状報告の引用などに終始しており、
独自取材で追求したものは見つけられません。
原因を断定的に述べた[[ツイート]]やそれを引用したニュース記事もあります
(>>44 >>31 >>93) が、
断定した根拠が明らかではなく、
そのまま信用することはできません。

[184] 
それ故に推測を重ねることにはなりますが、
どのようなメカニズムで障害が発生したのか再検討してみます。


[115] 
当時の[[ツイート]]等によれば、

- [116] 一部環境でログイン状態が解除される (>>19)
- [117] 一部環境で新規ログインができない (>>19)
- [118] 一部環境で [[ambtime]] の基準日が1年後に進んでいる (>>20)
- [119] [[Twitter API]] の [[HTTP応答]]の一部の 
[[HTTPヘッダー]]の[[日時]]中の[[年]]だけが1年進んでいる (>>5)

といった症状が報告されています。
>>116, >>117, >>118 は一般の[[利用者]]から見てわかりやすい症状で、
>>119 は証拠となる[[スクリーンショット]]が現存しますから、
一応これらは信用して良いと思われます。

[125] 
まず、これらの現象がいずれも一部の[[クライアント]]のみで確認されていることから、
[[Twitter]] のシステムの一部分でのみ発生していたことがわかります。
また [[HTTPヘッダー]]で不具合が確認されていることから[[クライアント]]側ではなく
[[Twitter]] の[[サーバー]]に主要因がある可能性が高く、
しかも一部の[[HTTPヘッダー]]でのみ起こっていることから、
[[サーバー]]プログラムの一部の処理にのみ[[不具合]]があることがわかります。

[120] 
[[HTTPヘッダー]]について、
[[年]]が1年進んでいて[[曜日]]が進んでいないことから、
[[時計]]は狂っておらず、
現在時刻から[[年]]を得る処理に問題があったと断定して良いでしょう。

[121] 
[[年]]を誤った理由については、
[[UTC]] でちょうど 
[[ISO週暦]]における[[週年]]が切り替わったタイミングで障害が発生していることから、
[[暦年]]と[[週年]]を取り違えた説は有力といえます。
社員の[[意味深]]な[[ツイート]]から、
その点に[[不具合]]があったことは断定して良いでしょう。
他にも複合的な要因はあったかもしれません。

[122] 
当時から現在まで、有名な[[ライブラリー]]等にそのような[[不具合]]が混入していたという情報は見つけられません。
従って当該 [[HTTPヘッダー]]の[[生成]]は [[Twitter]] 
社内の独自の実装によるものだった可能性が高いです。
なぜ [[HTTPの日時形式]]の[[文字列]]の[[生成]]のようなありふれた
(しかし罠もある)
[[プロトコル]]処理を実績のある汎用の[[ライブラリー]]に委ねず独自処理としていたのかは謎です。
技術的水準の不十分な[[プログラマー]]が[[プロトコル]]仕様や[[プログラミング言語]]の仕様を十分理解しないまま、
見よう見まねで書いたコードという可能性も否定できません。
そうだとすると、
[[プロトコル]]仕様に合致しない構文で出力されていたこと
(>>8) も納得できます。



[123] 
[[ambtime]] が誤った理由について、当該表示が
[[Twitter]] サーバー側で生成されたものか、
[[クライアント]]側で生成されたものかは不明です。
[[ambtime]] は現在日時と投稿日時等との[[差]]を求めているものですから、
その現在日時が1年ずれていると、報告されているような表示になります。
[[クライアント]]が独自に現在日時を求めているとすると、
現在日時の元となるのはクライアント動作環境の[[システム時計]]でしょうから
[WEAK[(受信した[[HTTPヘッダー]]を使う合理的理由は考えつきません)]]、
仮にそれで1年前と表示されたなら[[クライアント]]もたまたまサーバーと同じ不具合を抱えていたことになり不自然です
[WEAK[(特に報告は見つけられませんが、 Twitter サーバー側の修正と同時に復旧したとみるべきでしょう)]]。
ということはサーバー側で生成された値を表示していた蓋然性が高いといえます。

[124] 
[[ambtime]] がサーバー側で生成されたとすると、
その生成時に [CODE[Date:]] 用の[[日付]]と同じ方法で得た[[年]]が使われたことになります。

;; [129] 
なお、一部の[[クライアント]]でのみ症状が発生していることや、
障害回復後に尚も[[ツイート]]側の[[日時]]が誤っているという報告や、
それを修正したという報告がないことから、
[[Twitter]] データベース上に記録された[[ツイート]]の[[日時]]は正しかったと推測されます。
(誤って記録されていたなら、それをすべて修正するのはかなり大変な作業でしょうし、
[[Twitter API]] を通じて取得され外部に保存された[[ツイート]]の情報の修正が必要になって、
史実とは比べ物にならない大騒ぎになっていたはずです。)

[126] 
[[ログイン]]の失敗については詳細が明らかではありませんが、
もし「[[ログイン]]それ自体は成功したにも関わらず、
それ以後に[[ログイン]]状態にならない」
という状態だったとすると、
既存の[[ログイン]]状態が失われたという報告とも整合します。
どちらの場合も、
比較に [CODE[Date:]] 用の[[日付]]と同じ方法で得た[[年]]が使われたため、
有効期限を1年近く超過したと判断され、
[[ログイン]]状態とみなされなかったとすれば、
こうした現象を説明できます。
あるいは新規[[ログイン]]については、 [[OAuth 1.0]]
の [CODE[oauth_timestamp]] の検査で失敗した可能性もあります。

;; [127] 他にも説明の方法はあるでしょうし、
どの説明が最も有り得そうか決定するのは困難ですが。

[128] 
[[ambtime]] も[[ログイン]]も、これらの説が正しいと仮定すると、
現在日時と他の日時の[[差]]を求めた結果が実際より1年大きくなっていたことになります。
一般的にはまず[[日時データ型]]または[[整数時刻系]]の値で[[差]]を求めるように思われますから、
(計算結果に[[時間長]]の[[年]]が現れたとしても)
計算中に[[暦年]] (のつもりの[[週年]]) が現れるのは不自然に感じられます。

[316] 
[[サーバー]]から受信した [CODE[Date:]] [[ヘッダー]]を現在時刻として利用していた[[クライアント]]で障害が発生したとする説
(>>259) もあります。
一方で[[システム時刻]]を変更すると挙動が変化したとする報告 (>>254) 
もあって、簡単に説明できるものではなさそうです。

[130] 
この辺はもう少し詳細な実装状況がわからないことには何とも言えそうにないですね。
[WEAK[(そしてそれが明らかになることはおそらくないでしょう。)]]
ただ[[暦年]]と[[週年]]を取り違えるような洗練されていない実装なら、
こうした処理も見通しの悪いコードにだったかもしれません。
正常なヘッダーと異常なヘッダーが混在していた (>>6) 
のも、コードの品質の傍証となるかもしれません。



[131] 
以上をまとめると、[[暦年]]と[[週年]]の取り違えが障害の要因だった可能性は高いのですが、
それだけとは断定はできません。
ましてや1行 ([CODE[YYYY]] と [CODE[yyyy]])
や1文字 ([CODE[G]] と [CODE[Y]])
の誤りだけで発生したと断言できる材料はありません
(その可能性がないともいえませんが)。


** 日本での拡散


[195] 
[[Tatsuhiko Miyagawa]]
は自身の [[Podcast]] (配信[[ラジオ番組]])
[CITE[Rebuild]]
で[TIME[2015-01-02]]付で
[[Naoki Hiroshima]] と [[Kazuho Okui]] 
をゲストに
[SRC[>>234]]、
[TIME[2017-12-04]]付で
[[higepon]]
をゲストに
[SRC[>>192]]、
[[Twitter]]
の障害を紹介しました。


[197] 
[[Tatsuhiko Miyagawa]]
は[[日本]]で知名度のある [[Web]] 系の[[技術者]]で、
[CITE[Rebuild]]
でも他の有名技術者等を招いていました。
業界内では注目されている番組だったと思われます。
自身は米国スタートアップ企業等を転々としており、
本段落執筆 
[WEAK[([TIME[令和4(2022)年7月][2022-07]])]]
時点の [[Twitter]] プロフィールによれば
9社目に在籍しているようです
[SRC[>>191]]。


[196] 
[[Tatsuhiko Miyagawa]]
は[TIME[西暦2014年][2014]]末の障害当時に
[[Twitter]]
元社員の
[[mark mcbride]] (>>157)
の障害関係の[[ツイート]]に対して、
[[GitHub]] で [CODE[%G]] を検索した結果の [[URL]] と[[顔文字]]だけの[[返信]]を投稿していました。
当該[[返信]]ツイートは
[[mark mcbride]] 
も [[RT]]
していましたが、
両者に親交があったのかは不明です。
[SRC[>>191]]

[236] 
[TIME[2015-01-02]]の
[[Tatsuhiko Miyagawa]]
によれば、
次のようなことがありました。
[SRC[>>234]]

- [237] [[Android]] の [[Twitter]] クライアントがおかしくなった。
- [238] [[Twitter]] サーバーの [[HTTP応答]]をみたら、
[CODE[Date:]] [[ヘッダー]]が[TIME[2005年][2005]]になっていた。
[[曜日]]が[TIME[2005年][2005]]とは違っていた。
- [239] [[Android]] の [[Twitter]] クライアントは 
[CODE[Date:]] [[ヘッダー]]を使っている。
-- [240] [[タイムゾーン]]移動で[[時刻]]がずれることがあるので、
[[サーバー]]の[[時刻]]を見て補正している。
-- [241] [[iPhone]] 版はその処理をしていない。 [[Android]] 版だけ。
- [242] [[C]] の [CODE[%Y]] と書くべきところを [CODE[%G]] としていた。
-- [244] [CODE[%G]] は ISO の定める年表記で、今週が何年なのかを表す。
--- [245] [CODE[%G]] の仕様が完全におかしい。
-- [246] [[man]] で [CODE[%G]] が [CODE[%Y]] より上にあるので使ってしまう。
- [243] [[Twitter]] の「中の人のタレコミ情報」。
- [247] [[Java]] だと [CODE[yyyy]] と書くべきところを [CODE[YYYY]]。
- [248] [[Objective-C]] の [CODE[NSDate]] にも同じ問題がある。
- [249] [[Twitter]] は2時間くらいで治った。

[255] 
[TIME[2015-01-02]]の配信 [[Webページ]]の[[リンク集]]では、
当時のニュースサイトの記事 (>>21, >>223) と[[英語]]版 [CITE[Wikipedia]]
の記事
[CSECTION[ISO week date]]
が紹介されました
[SRC[>>234]]。

[193] 
障害当時の[[ツイート]]によれば、
[[Tatsuhiko Miyagawa]]
が独自に [CODE[Date:]] [[ヘッダー]]の誤りを発見していたのは事実のようです
[SRC[>>252]]。

[256] 
そしてそれは [[Twitter]] が [[C]] の [CODE[%G]] を誤用したことに起因し、
[[Android]] [[クライアント]]の独自の[[時刻]]補正処理のために障害につながったのだといいます。
その根拠は [[Twitter]] 社員から得た情報にあるようですが、
会話という性質上、どこからどこまでが [[Twitter]] 社員から知らされたのかは不明瞭です。
しかし確定した情報として断定的に語られています。

[257] 
[[Twitter]] 社員から情報を得たというのが、どのような経路なのかも明かされていません。
現在発見されている社員の[[ツイート]]には [CODE[%G]]
の影響をほのめかすものはありますが、断定的に発表したものはありませんし、
[[Android]] [[クライアント]]の構造に関する情報も見つけられません。
公開されていない[[媒体]]での私的な交友関係で得た情報なのでしょうか。
障害対応に当たった社員と親交があるように見える元社員らも掴んでいなかった情報を得られるルートを持っていたのでしょうか。


[259] 
[[Android]] [[クライアント]]の障害発生のメカニズムは、
なるほどあり得なくはないと思えますが、
情報の出所が不明なままではそのまま信用するのは躊躇されます。
[[Android]] 版 [[Twitter]] アプリ以外の[[クライアント]]の現象にも言及がありません。
他の[[クライアント]]も同じように実装していたのでしょうか。
それとも別のメカニズムで発生したのでしょうか。



[198] 
[TIME[2017-12-04]]のゲストの
[[higepon]]
([[Taro Minowa Higepon]])
は、
当時 [[Twitter]] 社員でしたが [SRC[>>194, >>192]]、
本件はまったく記憶にないといい、
完全に聞き手に回っていました。
話の中で思い出した様子もなく、隠しているようにも思えないので、
まったく関係ない部門に従事していたのでしょうか。
(当時の当該時間帯にはまったく無関係の[[ツイート]]しかありません。)


[200] 
[TIME[2017-12-04]]の
[[Tatsuhiko Miyagawa]]
によれば、
次のようなことがありました。
[SRC[>>192]]

- [201] [[Twitter]] の [[Android]] [[クライアント]]が壊れた。
- [202] [[OAuth 1.0]] の認証では[[クライアント]]が時刻を送り、
[[サーバー]]がその[[時刻]]が狂っているとエラーにする。
- [203] [[C]] の [[strftime]] では、 
[CODE[%Y]] が今の年、 [CODE[%G]] がその週の月曜日の年を返す。
-- [204] ちなみに [[Java]] の time format 関数では 
[CODE[yyyy]] が今の年、 [CODE[YYYY]] がその週の月曜日の年を返す。
-- [205] [[ISO]] で決まっていて、 week number と同じように使う。
- [206] 
[CODE[%G]] を使っていたので
[TIME[2014年][2014]]になっているのに
[TIME[2013年][2013]]のままになった。
- [207] 年明けて2日くらいで次の週になって解消した。

[209] 
[TIME[2017-12-04]]の配信 [[Webページ]]の[[リンク集]]では、
当時のニュースサイトの記事 [SRC[>>30]] が紹介されました
[SRC[>>193]]。
その記事は、本編で語られた[TIME[西暦2014年][2014]]初ではなく、
[TIME[西暦2014年][2014]]末の出来事を報じたものでした。

[208] 
当時の本人の[[ツイート]] (>>252) も[[リンク]]された記事も[TIME[西暦2014年][2014]]末、
しかも前回紹介した[TIME[2015-01-02]]はその直後ですから、
今回で語られたものは誤解 (記憶の劣化) と考えるのが妥当でしょう。
何も見ないで話の流れで喋っているようですから、そういうこともあるでしょう。
しかし[[リンク]]を
[[Webページ]]に掲載した時点で事実関係を誤っていると気づいたはずなのに、
何の注記もしていないのは、不親切、不誠実ではないでしょうか。

[210] 
[TIME[2017-12-04]]の本編で語られた内容には多くの問題があります。

- [212] [[OAuth 1.0]] の処理でエラーになったと断定していますが、
その根拠は示されていません。
-- [221] 実際そうかもしれませんが、推測の域を出ません。
-- [213] [[OAuth 1.0]] 
で[[クライアント]]から送信される[[時刻]]はいわゆる [[Unix time]]
形式の数値です。その取扱いに [CODE[%G]] がどう関与したのか、
断定の前に最低でも説明が必要でしょう (>>128)。
- [214] [CODE[%G]] や [CODE[YYYY]] が表すのは[[週年]]であって、
「その週の月曜日の年」ではありません。
[[週年]]は「その週の日曜日の暦年」になることだってあります。
- [215] [[週年]]や[[週番号]]が [[ISO 8601]] で決まっているのは事実ですし、
[[POSIX]] が [[ISO]] [[国際標準]]であるのも事実ですが、
これを「ISO で決まっている」の一言で片付けるのは不親切ではないでしょうか。
-- [258] この点は前回とも同じ。
-- [216] 
[[Twitter]] 社員が [[POSIX]] に不満を漏らしていたのも事実ですが、
[[Twitter]] のシステムで用いられていたものが [[POSIX]] 
の実装かどうかも根拠が示されていません。
本編中では [[C]] の [CODE[strftime]] だと言っていますが、
[[Twitter]] 社員がそう明言したものは見つけられません。
-- [211] 
わかってて省略しているのか、
聞きかじった知識で紹介しただけなのかはわかりませんが、
この中途半端な説明が悪影響を及ぼしています (>>277, >>284, >>312)。
- [217] 
[TIME[西暦2013年][2013]]と[TIME[西暦2014年][2014]]の取り違えではなく、
[TIME[西暦2014年][2014]]と[TIME[西暦2015年][2015]]の取り違えでした。
- [218] 
[[Twitter]] が数日間不具合を放置したかのように説明されていますが、
実際にはその日のうちに修正されています。
-- [219] 
プライベートを犠牲に必死に復旧に取り組んだ [[Twitter]] 社員への冒涜でしょう。
- [235] 
何より問題なのは、
[TIME[2015-01-02]]と仔細がまったく一致しないレベルで矛盾していることです。
そのことに何の説明もありません。一度紹介したことも忘れてしまっていたのでしょうか。


[222] 
>>217、>>218 は 
[[Apple]] の [[Do Not Disturb]] の不具合との混同が疑われます
(そうだとしても少し違っているのですが)。


[REFS[


-
[250] 
[CITE@ja[from:miyagawa until:2015-01-01 - Twitter検索 / [[Twitter]]]], [TIME[2022-07-09T09:15:04.000Z]], [TIME[2022-07-09T10:14:00.739Z]] <https://twitter.com/search?q=from%3Amiyagawa%20until%3A2015-01-01&src=typed_query&f=live>
--
[252] 
[CITE@ja[Tatsuhiko MiyagawaさんはTwitterを使っています: 「curl -sI http://t.co/f5ups0Pjho | grep date date: Mon, 29 Dec 2015 01:59:20 UTC」 / [[Twitter]]]], 午前10:59 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T10:14:34.000Z]] <https://twitter.com/miyagawa/status/549384170586128385>
---
[253] 
[CITE@ja[Norio NomuraさんはTwitterを使っています: 「@miyagawa こちらの時計を1年進めればhttp://t.co/qOFBKbDgGcと話が通じるのか気になるところ。」 / [[Twitter]]]], 午前11:03 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T10:14:34.000Z]] <https://twitter.com/norio_nomura/status/549385256353009665>
----
[254] 
[CITE@ja[NinjiさんはTwitterを使っています: 「Nice, if I set my phone's date a year in the future, it OAuths fine with Twitter, but /oauth/access_token returns a HTML Maintenance page :V」 / [[Twitter]]]], 午前9:54 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T10:14:34.000Z]] <https://twitter.com/_Ninji/status/549367775349968898>
--
[251] 
[CITE@ja[[[Tatsuhiko Miyagawa]]さんはTwitterを使っています: 「@hiro_asari Protip: using ISO considered harmful.」 / Twitter]], 午前11:32 · 2014年12月29日 [TZ[+09:00]], [TIME[2022-07-09T10:11:19.000Z]] <https://twitter.com/miyagawa/status/549392584637153280>
-
[234] 
[CITE[[[Rebuild]]: 73: It Is 2015 Already (N, naan)]], 
[[Tatsuhiko Miyagawa]],
Jan 02
2015,
[TIME[2022-07-08T08:18:56.000Z]], [TIME[2022-07-09T09:58:40.831Z]] <https://rebuild.fm/73/>
- [194] 
[CITE@ja[[[higepon]]さんはTwitterを使っています: 「さて Twitter を退職してサンフランシスコから東京に戻ってきて3ヶ月がたちました。現在は Google Japan で楽しくお仕事しています。みなさん今後ともよろしくお願いします😀」 / [[Twitter]]]], 午後2:30 · 2017年1月10日 [TZ[+09:00]], [TIME[2022-07-09T05:38:10.000Z]] <https://twitter.com/higeponja/status/818691485797203968>
- [199] [CITE@ja[Taro Minowa Higepon(@higepon)さん / [[Twitter]]]], [TIME[2022-07-09T05:47:24.000Z]], [TIME[2022-07-09T06:05:57.416Z]] <https://twitter.com/higepon>
- [192] [CITE[[[Rebuild]]: 196: Fashionable Udon (higepon)]], 
[[Tatsuhiko Miyagawa]],
Dec 04
2017,
[TIME[2022-06-20T00:29:32.000Z]], [TIME[2022-07-09T05:51:17.938Z]] <https://rebuild.fm/196/>

]REFS]

[260] 
[TIME[2015-01-02]]、
[[ブログ]]で
[[Objective-C]]
における
[CODE[YYYY]] と [CODE[yyyy]] の違いを解説した[[日本語]]の[[ブログ]]記事が公開されました。
[SRC[>>233]]
[[はてなブックマーク]]によるとこの記事は多くの人の目に留まったようです。

[261] 
このブログ記事は、
[TIME[2015-01-02]]の [[Tatsuhiko Miyagawa]] の [[Podcast]] (>>236)
を聴いたことを契機に執筆されたものだといい、
そこで紹介された事実をベースに話が進められます。
[SRC[>>233]]


- [262] [[Podcast]] によれば [[Twiitter]] の [[Android]] クライアントの障害原因は、
サーバーが [CODE[yyyy]] ではなく [CODE[YYYY]] を使ったためである。
- [263] ブログ記事の著者は [[iPhone]] の [[Twitter]] クライアント
[[Echofon]] で [[OAuth]] 認証に失敗する症状を経験した。
- [264] [[Podcast]] によれば、およびブログ記事の著者の追試によれば、
[[Objective-C]] [CODE[NSDateFormatter]] でも 
[CODE[yyyy]] と [CODE[YYYY]] は件の挙動を示す。
-- [267] ただし [[Objective-C]] では
「ISO では無く、 Unicode のフォーマットが採用されています。」 [SRC[>>266]]
-- [268] もっとも
「Unicode のフォーマットでも YYYY は ISO 8601 が採用されてるみたいですが。」 
[SRC[>>269]]

[270] 
そしてブログ記事は当時のニュースサイトの記事 (>>21, >>223) 
にもリンクしていました。 [SRC[>>233]] 
これらは [[Podcast]] の配信ページからリンクされていたものと同じです。
ブログ記事はリンクしているだけで、内容には言及していません。


[271] 
このブログ記事のうち、 [[Twitter]] が [CODE[YYYY]] 
を使ったため障害に発展したという記述は、
引用元のはずの [[Podcast]] にも、
リンクされている他のニュースサイトの記事にもありません。
ブログ記事の著者の誤読でしょうか。

[272] 
[[Objective-C]] の挙動について
[[Apple]]
の公式の
[[Cocoa]]
ドキュメントを調べているのは立派な点です。
[WEAK[(まあ当然やるべきことなのですが、他の記事がちゃんとやっていないことなので。)]]
ブログ記事が
「Unicode のフォーマット」
と呼んでいる [SRC[>>233]] のは、
ドキュメントが
「the format patterns from the Unicode Technical Standard #35」
と書いているものですね。
[SRC[>>266, >>273]]

[274] 
[[Apple]] のドキュメントとブログ記事が参照している 
[[UTS #35]] ([[LDML]])
によると、
[CODE[Y]]
は
「ISO year-week calendar as defined by ISO 8601」
における[[年]]を表します。
[WEAK[(厳密に言えば[[グレゴリオ暦]]以外も想定されているのですが、今回の件には関係してきません。)]]
[SRC[>>269]]
[[Unicode]] も [[ISO 8601]] を採用しているというのはこういうことです。
[[Apple]] のドキュメントも、
「the year (of “Week of Year”), used in the ISO year-week calendar」
だと明記しています。
[SRC[>>266]]

[277] 
ブログ記事が [[Objective-C]] では [[ISO]] ではなく [[Unicode]] 
のフォーマットが採用されているのに、
[[Unicode]] のフォーマットは [[ISO 8601]] を採用してるじゃん、
と言っているのは、これだけ読んでも意味がわかりませんが、
[[Podcast]] が雑に「ISO」と呼んでいる (>>215) 
せいでブログ記事の著者が混乱させられたのでしょう。



[275] 
他の記事が「ISO」とだけ言って曖昧に済ませているところを、
「ISO 8601」ともう少し正確に書き表したのはこのブログ記事の優れているところです。
[[LDML]] と [[Apple]] がそうしているように、
「ISO 8601 の[[週年]]」ともう一言まできっちり書いておけばなお良かったのですが。

;; [287] ただまあ厳密にはこれを [[ISO 8601]] の[[週年]]だと言うことには若干の問題があります
(>>286)。



[REFS[
- [233] [CITE@ja[[[日付]]フォーマット yyyy と YYYY の違い - 強火で進め]], 
[[nakamura001]],
2015-01-02,
[TIME[2022-07-09T09:48:10.000Z]] <https://nakamura001.hatenablog.com/entry/20150102/1420213850>
-- [265] 引用:
--- [266] [CITE@en[Date Formatters]], [TIME[2021-10-29T17:46:37.000Z]], [TIME[2022-07-09T12:30:32.928Z]] <https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfDateFormatting10_4.html>
---- [273] 当時の版に近いもの:
[CITE@en[Data Formatting Guide: Date Formatters]], [TIME[2022-07-09T12:46:41.000Z]], [TIME[2014-06-26T03:45:16.564Z]] <https://web.archive.org/web/20140626034511/https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfDateFormatting10_4.html>
--- [269] [CITE@en-us[UTS #35: Unicode [[LDML]]: Dates]], [TIME[2013-03-15T20:56:42.000Z]], [TIME[2022-07-09T12:37:22.713Z]] <http://www.unicode.org/reports/tr35/tr35-31/tr35-dates.html#Date_Field_Symbol_Table>

]REFS]

[278] 
[TIME[2017-12-22]]には、
[[Swift]] (が使う [[Foundation]] の [CODE[DateFormatter]])
で [CODE[YYYY]] と書くと[TIME[2017-12-31]]が[TIME[西暦2018年][2018]]と出力されることに注意喚起する記事が投稿されました。
[SRC[>>276]]

[283] 
この記事は

>先々週Rebuild.fmを聞いていたところ、以前TwitterのAndroidアプリがこの設定ミスによって5時間使えなくなっていた話をしていました。

と書いており、2回目の方の [[Podcast]] (>>210)
がきっかけになって執筆されたようです。
[SRC[>>276]]
しかもこの記事は本文中で特に言及なく当時のニュース記事 [SRC[>>30]] 
にリンクしていますが、 [[Podcast]] の配信ページからリンクされているのと同じ記事です。

[279] 
[[Objective-C]] も [[Swift]] もどちらも結局利用しているのは [[Apple]]
製の同じ[[ライブラリー]]です。ということでこの記事も以前のブログ記事
[SRC[>>233]] を紹介し、それと同じ問題だと言っていました。


[284] 
この記事はこの挙動を

>これ自体はSwift関係なくISOの仕様です。

と書いています。
[SRC[>>233]]
[[Podcast]] を踏襲して「ISOの仕様」と曖昧で不適切な表現を使っています
(>>215)。
より正確な記載のある 
[[Apple]] のドキュメント [SRC[>>266]]
や
[[Objective-C]] の挙動を紹介したブログ記事 (>>275) 
にリンクしているにも関わらずです。
(ブログ記事の方では ISO ではなく Unicode のフォーマットだと明記しているのにです。)
さすがに読んでもいないページにリンクしているとは思えないのですが・・・。


[281] 
この記事の著者は気づいていないようですが、
この記事とこの記事が参照している同内容の英語記事 [SRC[>>280]] 
の指摘する問題は、[[週初]]の違いが絡んだもう1段階複雑な事案です (>>282)。

[285] 
そして [[LDML]] の [CODE[Y]] の説明は、よく読むとこうあります。
[SRC[>>269]]

> This year designation is used in ISO year-week calendar as defined by ISO 8601, 

[[ISO 8601]] [[週暦]]で使われると書いていますが、
[CODE[Y]] が [[ISO 8601]] [[週年]]だとは書いていません。
細かい点ですが、この違いは重要です。

[286] 
[[ISO週]]は[[月曜日]]が[[週初]]となる[[週]]です。
この記事が扱っているのは

>日曜始まりのLocaleでは2017年12月31日は2018年の最初の週にあたるため、2018と表示されてしまいます。

ということで [SRC[>>276]]、
はじめから[[ISO週]]ではないのです。
従ってこの記事の範囲では [CODE[YYYY]] は「ISOの仕様」にかすってもいません。
「[[LDML]] の仕様」
「[[LDML]] を採用した [[Foundation]] の仕様」
というべきものです。

;; [288] 「ISO」のどれの何であるかを考えることなく、
[[Podcast]] が 「ISO」だと言うからその通りだと信じてしまったのですかね。
[[ISO]] の[[仕様書]]を参照して調べているわけでもないのだから、
[[ISO]] の仕様かどうかなんてどうでもいい問題で、
わざわざ言及しなくてよかったのではないかと思いますが。

;; [289] [[LDML]] の定める書式を使って[[日時]]を文字列化する、
という動作はどう見ても [[Foundation]] の仕様なのですから、
広義の「[[Swift]] の仕様」でいいのではないですかねえ。
なぜ「[[Swift]] の仕様」であることを否定する必要があったのかも謎です。



[REFS[
- [276] [CITE@ja[[[2018年12月31日問題]] - [[Qiita]]]], 
@kazuhiro4949(ヤフー株式会社),
投稿日 2017年12月22日,
更新日 2017年12月24日,
[TIME[2022-07-09T13:00:07.000Z]] <https://qiita.com/kazuhiro4949/items/d8fc27c0a0b6d88f1a80>
]REFS]


[290] 
誰もが口を揃えて言うように、[[日時処理]]は難しいです。
あちこちに罠があります。
だから知見を共有し啓蒙する活動は重要で、貴重です。
そして誰にでも間違いはあります。
ですからもし仮に間違った解説を公表してしまったとしても、
そのこと自体は決して責められるべきではないでしょう。
それもまた避けがたいことではあるのです。

[291] 
しかし出所不明の怪情報を垂れ流したり、
事情を調べもしない(調べる気もない)のにただ非難するだけ、
といったものは話が別です。
影響力が強い人の情報発信なら尚のことです。
ただでさえ複雑な問題に、
どうしてそんな非生産的なことをしてくれるのでしょうか。


* 西暦2017年12月31日バグ

[282] 
[TIME[平成29(2017)年12月][2017-12]]にも[[週年]]と[[暦年]]の混同による[[不具合]]が注意喚起されました。
[SRC[>>280, >>293, >>276]]
今次は大規模な障害は報告されていませんが、
例年のように小規模な不具合はあちこちで発生していたのではないかと予想されます。

[294] 
今次が例年と異なるのは、
[TIME[2017-12-31]]と[TIME[2018-01-01]]が[[日曜日]]と[[月曜日]]だったことです。
従って[[週初]]を[[月曜日]]とする場合 ([[ISO週]]) には問題は露呈せず、
[[週初]]を[[日曜日]]とする場合や[[ロケール]]依存とする場合に異状が発生します。

[295] 
[[週年]]と[[暦年]]を混同したのが不具合の根本原因には違いありませんので、
[[暦年]]を意図していたなら[[暦年]]を表す機能を使うべき
([CODE[%G]] ではなく [CODE[%Y]]、 [CODE[YYYY]] ではなく [CODE[yyyy]])
という修正法も同じです。
しかしこの頃書かれた解説には若干の混乱が見られますから、要注意です。


- [296] ある[[iOS]] プログラマー向けの[[英語]]の解説記事は、
[CODE[YYYY]] ではなく [CODE[yyyy]] を使うべきと説明しました [SRC[>>280]]。
「[[週]]」の説明には読者から指摘が入り [SRC[>>293]]、
[[ロケール]]に依存すると補足が入りました [SRC[>>280]]。
-- [305] [[ISO週]]とは一言も書いておらず、
[[日曜日]]始まりの[[週]]だと正しく説明しています。
-- [297] 
なお 
>>318 や
[[Apple]] の[TIME[西暦2013年][2013]]の不具合
(リンク先: arstechnica.com)
と
[[Twitter]] の[TIME[西暦2014年][2014]]の障害
(リンク先: >>48)
を類似事例として紹介していました。
[SRC[>>280]]
- [298] ある [[Swift]] プログラマー向けの[[日本語]]の解説記事は、
[[Twitter]] の[TIME[西暦2014年][2014]]の障害や同趣旨の英語記事 (>>296)
や以前の日本語記事 (>>233) を紹介しつつ、
「ISOの仕様」
だと説明しました。
[SRC[>>276]]
-- [299] 「ISOの仕様」とするのは誤りです (>>284)。
-- [300] 英語記事 (>>296) からの引用で[[ロケール]]依存の問題と紹介しています。
-- [301] [[Twitter]] の障害原因がこれです、と説明を始めているので、
これでは [[Twitter]] が[[ロケール]]依存の[[週]]の問題を抱えていたと読めてしまいます。
--- [302] 事実そうかもしれませんし、そうではないかもしれませんが、
この記事には根拠が示されていません。
--- [303] [[Twitter]] の障害があったのは [[UTC]] の月曜日でした。
-- [304] [[ロケール]]依存という記述は引用部分にしかないので、
この記事の著者は[[ロケール]]依存という点をあまり重視していないのでしょう。
--
[307] 
当記事 (>>298) を読んでコメントしているブログ記事 [SRC[>>306]]
(著者は[[暦]]の処理の専門家)
は、
---
[308] 
当記事 (>>298) の症状は
「Locale で七曜の最初を何曜日にするかに依存する現象で、
ISO暦週の定義とは関係がないように読めます。」
と指摘し、
--- 
[309] 
その引用する日本語記事 (>>233) 
が「明らかにISO暦週の定義によってい」
ることを踏まえて、
---
[310] 
その引用する日本語記事 (>>233) 
「の方が正しいのではないかと思われます。」
と評しています。
---
[311] 
当記事 (>>298) の現象が [[ISO週]]と無関係というのは正確な指摘です。
そして、その引用する日本語記事 (>>233) の方が正しいという評価も妥当といえます。
---
[313] 
ただし、
「ISO暦週の定義による」とする説明が正しいが、
「ロケール依存の現象でISO暦週とは関係ない」のだとなると、
いったい何が正しいのかわかりませんね。
--
[314] 
その引用する日本語記事 (>>233) は[[ロケール]]に依存しない場合
[WEAK[(または[[ロケール]]依存性が表面化しない場合)]] を扱っていて、
当記事 (>>298) は[[ロケール]]に依存する場合を扱っている、
という違いには、やはり注意しなければなりません。
---
[312] 
当記事 (>>298) がそれを「ISOの仕様」
といって混同しているので、読者もつられて惑わされてしまいます。
---
[315] 
両記事を見比べてどちらが正しいと比較するのは適切ではないのです。
それぞれの題材について、
>>233 はおおむね正しく、
>>298 は解法以外間違っていると別々に評すべきです。







[REFS[
- [280] [CITE@en[Why Why Why Why Your iOS App Might Act Weird around New Year's | App-o-Mat]], 
[[Lou Franco]],
[TIME[2022-07-09T13:20:31.000Z]] <https://app-o-mat.com/post/why-why-why-why>
-- [292] 
[CITE@en[Why Why Why Why Your iOS App Might Act Weird around New Year's | App-o-Mat]], [TIME[2022-07-10T03:05:22.000Z]], [TIME[2017-12-10T19:21:11.850Z]] <https://web.archive.org/web/20171210191643/https://app-o-mat.com/post/why-why-why-why>
-- [293] [CITE@en-US[Why Why Why Why Your iOS App Might Act Weird around New Years : iOSProgramming]], 
[[u/loumf]],
[TIME[2017-12-10T04:16:51+09:00]],
[TIME[2022-07-10T03:05:40.000Z]] <https://www.reddit.com/r/iOSProgramming/comments/7iopyx/why_why_why_why_your_ios_app_might_act_weird/>
- >>276
- [306] 
[CITE@ja[2018年12月31日問題: [[suchowan]]'s blog]], 
2017年12月27日,
[TIME[2022-07-10T03:56:00.000Z]] <https://suchowan.seesaa.net/article/201712article_27.html>


]REFS]


* メモ