[35] [[URL]] には、[DFN[[RUBYB[利用者名]@en[username]]]]と[DFN[[RUBYB[パスワード]@en[password]]]]を記述できる欄があります。

* 仕様書

[REFS[
- [34] [CITE@en[URL Standard]] ([TIME[2017-01-04 18:29:56 +09:00]]) <https://url.spec.whatwg.org/#urls>
-- [64] [CITE@en[URL Standard]] ([TIME[2017-01-04 18:29:56 +09:00]]) <https://url.spec.whatwg.org/#include-credentials>
- [53] [CITE@en[URL Standard]] ([TIME[2017-01-04 18:29:56 +09:00]]) <https://url.spec.whatwg.org/#url-parsing>
- [66] [CITE@en[URL Standard]] ([TIME[2017-01-04 18:29:56 +09:00]]) <https://url.spec.whatwg.org/#urlutils-members>
- [79] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2017-01-05 17:57:01 +09:00]]) <https://html.spec.whatwg.org/#htmlhyperlinkelementutils>
]REFS]

* URL 記録

[36] [[URL記録]]は、
[DFN[[F[[RUBYB[[[利用者名][userinfo]]]@en[username]]]]]]を持ちます。
[[利用者名]]を表します。
値は [[ASCII文字列]]です。初期値は[[空文字列]]です。 [SRC[>>34]]

[37] [[URL記録]]は、
[DFN[[F[[RUBYB[[[パスワード][userinfo]]]@en[password]]]]]]を持ちます。
[[パスワード]]を表します。
値は [[ASCII文字列]]です。初期値は[[空文字列]]です。 [SRC[>>34]]

[65] [[URL]] が[DFN[[F[[RUBYB[[[credentialsを含む]]]@en[includes credentials]]]]]]とは、
[F[利用者名][userinfo]]か[F[パスワード][userinfo]]が[[空文字列]]ではないことをいいます。
[SRC[>>64]]

* URL 文字列

** 構文

[38] 現行仕様である [CITE[URL Standard]] の [[URL文字列]]の構文の定義には、
[F[利用者名][userinfo]]や[F[パスワード][userinfo]]に相当する部分は含まれていません。

[39] つまり、[[著者]]は [[URL文字列]]を記述する時に[F[利用者名][userinfo]]や[F[パスワード][userinfo]]を含めては[MUST[ならない]]とされています。

;; [40] ただし [[URL構文解析器]]の処理の一部には組み込まれていますから、
[[Webブラウザー]]その他の [[URL]] を受け取る[[プログラム]]は、
[F[利用者名][userinfo]]や[F[パスワード][userinfo]]も扱えなければなりません。

[41] これは[F[利用者名][userinfo]]や[F[パスワード][userinfo]]を [[URL]] に含めるのは[[セキュリティー]]上好ましくないという近年の流れに沿った制限だと思われます。

;; [42] しかし [[Unix]] 系環境で動作する[[プログラム]]の[[環境変数]]で [[URL]]
を指定する場合など、[F[利用者名][userinfo]]と[F[パスワード][userinfo]]が活用されている場面もあり、
それらがすべて無くなるとは思えませんが...

-*-*-

[43] 過去の [[URL]] 仕様では、 [[URL文字列]]の [[authority]] 部分
[WEAK[([[URL scheme]]、[CODE[:][URL scheme]]、[CODE[//][authority]] の後に続く部分)]]
に [CODE[@][userinfo]] が含まれる場合、それより後は[[ホストとポート][location.host]]であり、
それより前は [DFN[userinfo]] と呼ばれていました。

[44] [[userinfo]] は、 [CODE[:][userinfo]] が含まれていればそれより前が[F[利用者名][userinfo]]で後が[F[パスワード][userinfo]]、
含まれなければ全体が[F[利用者名][userinfo]]とされていました。

[45] [F[利用者名][userinfo]]や[F[パスワード][userinfo]]は、
それぞれ0個[[以上]]の[[URL単位群]]の列とされていました。

[48] [F[利用者名][userinfo]]や[F[パスワード][userinfo]]は、[[空文字列]]とすることもできます。
しかし[[空文字列]]は既定値ですから、無指定の場合と区別できません。

** 構文解析

[46] [[URLの構文解析]]では、[F[利用者名][userinfo]]や[F[パスワード][userinfo]]の一部とみなされる部分を、
[[userinfo符号化集合]]を使って[[UTF-8パーセント符号化]]します。 [SRC[>>53]]

[47] つまり、[[非ASCII文字]]と多くの[[記号]]は、[[パーセント符号化]]されて
[[URL記録]]の[F[利用者名][userinfo]]や[F[パスワード][userinfo]]となります。

** 文字コード

[27] [[URL文字列]]に[[非ASCII文字]]が含まれる場合、[[URLの構文解析]]の時点で
[[UTF-8パーセント符号化]]されます (>>46)。つまり [[UTF-8]] として扱われます。

[49] [[URL文字列]]に[[パーセント符号化]]が含まれる場合、
[[URL]] の他の部分の場合と同様、元の[[文字コード]]は特に規定されていません。
つまりどの[[文字コード]]か分かりませんし、そもそも[[文字列]]であるかも保証されません。

[50] [F[利用者名][userinfo]]や[F[パスワード][userinfo]]の[[パーセント符号化]]を[[復号]]した後どのように解釈するべきかは、
現行のどの[[仕様書]]でも明文化されていないと思われます。

[51] [[Webブラウザー]]は、 [CODE(URI)@en[http:]] や [CODE(URI)@en[https:]]
で[F[利用者名][userinfo]]や[F[パスワード][userinfo]]が含まれる時、
[[パーセント復号]]して何らかの[[文字コード]]で[[復号]]して、
[[HTTP認証]]に使っているものと思われます。

;; [52] [[HTTP認証]]でどのような[[文字コード]]で[[符号化]]して送信するべきかの問題もあります。
[[基本認証]]や[[ダイジェスト認証]]も参照。

* API

[67] [CODE(DOMi)@en[URL][URL API]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[username][userinfo]]]] [[IDL属性]]の[[取得器]]は、
次のようにしなければ[MUST[なりません]] [SRC[>>66]]。

[FIG(steps)[
= [68] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[利用者名][userinfo]]を返します。
]FIG]

[69] 同じく[[設定器]]は、次のようにしなければ[MUST[なりません]] [SRC[>>66]]。

[FIG(steps)[
= [81] [VAR[新しい値]]を、新しい値を [CODE(IDL)@en[USVString]] と解釈した結果に設定します。
= [70] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[cannot have a username/password/port]]が[[真]]なら、
== [71] ここで停止します。
= [72] [[文脈オブジェクト]]の[F[URL][URLUtils]]と[VAR[新しい値]]について、[[利用者名の設定]]をします。
]FIG]

[73] [CODE(DOMi)@en[URL][URL API]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[password][userinfo]]]] [[IDL属性]]の[[取得器]]は、
次のようにしなければ[MUST[なりません]] [SRC[>>66]]。

[FIG(steps)[
= [74] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[パスワード][userinfo]]を返します。
]FIG]

[75] 同じく[[設定器]]は、次のようにしなければ[MUST[なりません]] [SRC[>>66]]。

[FIG(steps)[
= [82] [VAR[新しい値]]を、新しい値を [CODE(IDL)@en[USVString]] と解釈した結果に設定します。
= [76] [[文脈オブジェクト]]の[F[cannot have a username/password/port]]が[[真]]なら、
== [77] ここで停止します。
= [78] [[文脈オブジェクト]]の[F[URL][URLUtils]]と[VAR[新しい値]]について、[[パスワードの設定]]をします。
]FIG]

[83] [CODE(DOMi)@en[HTMLHyperlinkElementUtils]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[username][userinfo]]]] [[IDL属性]]の[[取得器]]は、
次のようにしなければ[MUST[なりません]] [SRC[>>79]]。

[FIG(steps)[
= [84] [[文脈オブジェクト]]について[[URLの再初期化]]を行います。
= [85] [[文脈オブジェクト]]の[F[URL][URLUtils]]が [CODE[null]] なら、
== [86] [[空文字列]]を返し、ここで停止します。
= [87] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[利用者名][userinfo]]を返します。
]FIG]

[88] 同じく[[設定器]]は、 [CODE(IDL xattr)@en[CEReactions]] と共に、
次のようにしなければ[MUST[なりません]] [SRC[>>79]]。

[FIG(steps)[
= [90] [VAR[新しい値]]を、新しい値を [CODE(IDL)@en[USVString]] と解釈した結果に設定します。
= [89] [[文脈オブジェクト]]について[[URLの再初期化]]を行います。
= [91] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[ホスト][URL host]]が [CODE[null]] か、
[[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[cannot-be-a-base-URL flag]]が[[真]]なら、
== [92] ここで停止します。
= [93] [[文脈オブジェクト]]の[F[URL][URLUtils]]と[VAR[新しい値]]について、[[利用者名の設定]]をします。
= [94] [[文脈オブジェクト]]について[[[CODE(HTMLa)@en[href]]を更新]]します。
]FIG]

[95] [CODE(DOMi)@en[HTMLHyperlinkElementUtils]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[password][userinfo]]]] [[IDL属性]]の[[取得器]]は、
次のようにしなければ[MUST[なりません]] [SRC[>>79]]。

[FIG(steps)[
= [96] [[文脈オブジェクト]]について[[URLの再初期化]]を行います。
= [97] [[文脈オブジェクト]]の[F[URL][URLUtils]]が [CODE[null]] なら、
== [98] [[空文字列]]を返し、ここで停止します。
= [99] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[パスワード][userinfo]]を返します。
]FIG]

[100] 同じく[[設定器]]は、[CODE(IDL xattr)@en[CEReactions]] と共に、
次のようにしなければ[MUST[なりません]] [SRC[>>79]]。

[FIG(steps)[
= [101] [VAR[新しい値]]を、新しい値を [CODE(IDL)@en[USVString]] と解釈した結果に設定します。
= [102] [[文脈オブジェクト]]について[[URLの再初期化]]を行います。
= [103] [[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[ホスト][URL host]]が [CODE[null]] か、
[[文脈オブジェクト]]の[F[URL][URLUtils]]の[F[cannot-be-a-base-URL flag]]が[[真]]なら、
== [104] ここで停止します。
= [105] [[文脈オブジェクト]]の[F[URL][URLUtils]]と[VAR[新しい値]]について、[[パスワードの設定]]をします。
= [106] [[文脈オブジェクト]]について[[[CODE(HTMLa)@en[href]]を更新]]します。
]FIG]

;; [80] [CODE(DOMi)@en[Location]] [[インターフェイス]]には
[CODE(DOMa)@en[username][userinfo]] と [CODE(DOMa)@en[password][userinfo]] はありません。

-*-*-

[54] [VAR[URL記録]]と[VAR[利用者名]]の[DFN[[RUBYB[利用者名の設定]@en[set the username]]]]は、次のようにします [SRC[>>53]]。

[FIG(steps)[
= [55] [VAR[URL記録]]の[F[利用者名][userinfo]]を、[[空文字列]]に設定します。
= [56] [VAR[利用者名]]の各[[符号位置]][VAR[符号位置]]について、
== [57] [VAR[符号位置]]に[[userinfo符号化集合]]による[[UTF-8パーセント符号化]]を適用した結果を、
[VAR[URL記録]]の[F[利用者名][userinfo]]の末尾に追加します。
]FIG]

;; [62] 他に、 [[fetch]] から呼び出されます。

[58] [VAR[URL記録]]と[VAR[パスワード]]の[DFN[[RUBYB[パスワードの設定]@en[set the password]]]]は、次のようにします [SRC[>>53]]。

[FIG(steps)[
= [59] [VAR[URL記録]]の[F[パスワード][userinfo]]を、[[空文字列]]に設定します。
= [60] [VAR[パスワード]]の各[[符号位置]][VAR[符号位置]]について、
== [61] [VAR[符号位置]]に[[userinfo符号化集合]]による[[UTF-8パーセント符号化]]を適用した結果を、
[VAR[URL記録]]の[F[パスワード][userinfo]]の末尾に追加します。
]FIG]

;; [63] 他に、 [[fetch]] から呼び出されます。

* 各 URL scheme における用法

** 利用者名と合言葉

- [8] [CODE(URI)@en[[[ftp:]]]]
- [2] [CODE(URI)@en[[[http:]]]]
- [3] [CODE(URI)@en[[[https:]]]]
- [9] [CODE(URI)@en[[[telnet:]]]]
- [4] [CODE(URI)@en[[[tn3270:]]]]

** 利用者名 (合言葉も使えるのか不明)

- [5] [CODE(URI)@en[[[rlogin:]]]]
- [10] [CODE(URI)@en[[[ssh:]]]]

** 暗号鍵

- [6] [CODE(URI)@en[[[http+aes:]]]]
- [7] [CODE(URI)@en[[[https+aes:]]]]

** その他のプロトコル上の識別子

[FIG(short list)[
- [CODE(URI)@en[[[reload:]]]]
]FIG]

* userinfo 符号化集合

** 仕様書

[REFS[
- [30] [CITE@en[URL Standard]] ([TIME[2016-03-08 02:00:58 +09:00]] 版) <https://url.spec.whatwg.org/#userinfo-encode-set>
]REFS]

** 文字の一覧

[REFS[
- [31] [CITE@en[Character set "userinfo encode set"]] ([TIME[2016-03-08 21:14:51 +09:00]] 版) <https://chars.suikawiki.org/set/%24url%3Auserinfo-encode-set>
]REFS]

** 文脈

[33] [[URLの構文解析]]で使われます。 [[userinfo]] が含まれる入力の場合や、
[[URL]] の[F[利用者名][userinfo]]や[F[合言葉][userinfo]]を設定する時に参照されます。

* 歴史

[REFS[
- [1] [CITE[パスワード保護されたフィードをGoogle Readerからアクセスする方法 : ライフハッカー[日本版], 仕事も生活も上手くこなすライフハック情報満載のブログ・メディア]]
([TIME[2010-01-05 09:11:11 +09:00]] 版)
<http://www.lifehacker.jp/2010/01/20100104google_reader.html>
]REFS]


[11] [CITE[Issue 82250 - chromium - HTTP username:password stripped out from links - An open-source browser project to help move the web forward. - Google Project Hosting]]
([TIME[2012-05-15 12:31:08 +09:00]] 版)
<http://code.google.com/p/chromium/issues/detail?id=82250>

[12] [CITE[Masato Kinugawa Security Blog: CVE-2012-0678: Safariのfeed:// URLのUXSS]]
( ([TIME[2012-11-27 08:37:19 +09:00]] 版))
<http://masatokinugawa.l0.cm/2012/11/safari-feed-url-uxss.html>

[13] [CITE@en[Factor out set the username and password algorithms for use by XMLHttpRe... · 4e2f350 · whatwg/url]]
( ([TIME[2014-10-21 09:49:41 +09:00]] 版))
<https://github.com/whatwg/url/commit/4e2f35062170f11924a35f06abb5e2fb014e48c6>

[14] [CITE@en[Use the set the username/password algorithms · d699900 · whatwg/fetch]]
( ([TIME[2014-10-21 09:51:32 +09:00]] 版))
<https://github.com/whatwg/fetch/commit/d699900add11588f35a1d6c74987f288f975f103>

[15] [CITE@en[Throw if URL includes credentials. Fixes #26. Also more HTTPS. · whatwg/fetch@32ab411]]
([TIME[2015-04-04 11:59:46 +09:00]] 版)
<https://github.com/whatwg/fetch/commit/32ab4119f9aa5d280507d6201b0784cfe5669106>

[16] [CITE@en[479038 – Should the suspicious-auth warning apply to all loads? Should URI userinfo be banned?]]
([TIME[2015-04-05 18:48:09 +09:00]] 版)
<https://bugzilla.mozilla.org/show_bug.cgi?id=479038>

[17] [CITE@en-us[Internet Explorer does not support user names and passwords in Web site addresses (HTTP or HTTPS URLs)]]
([TIME[2015-04-05 18:48:28 +09:00]] 版)
<https://support.microsoft.com/en-us/kb/834489>

[18] [CITE@en[Copy username/password for relative URLs · whatwg/url@06b2e68]]
([TIME[2015-06-10 21:55:33 +09:00]] 版)
<https://github.com/whatwg/url/commit/06b2e6895dff2e6efaeba65f4eb1bc27ecc21581>

[19] [CITE@en[Encode { and } in username/password/path to fix #16. Also acknowledge… · whatwg/url@c296e2f]]
([TIME[2015-06-11 12:55:19 +09:00]] 版)
<https://github.com/whatwg/url/commit/c296e2f8519a1d6614d664708d368a342682c9a1>

[20] [CITE@en[Make it non-conforming to place a username and/or password in a URL. … · whatwg/url@e0c721b]]
([TIME[2015-06-16 15:08:21 +09:00]] 版)
<https://github.com/whatwg/url/commit/e0c721b680d0977013ef2a14ba578388c01bd331>

[21] [CITE@en[Use the username and password encode sets within authority state. Fix… · whatwg/url@7876306]]
([TIME[2015-06-17 16:52:39 +09:00]] 版)
<https://github.com/whatwg/url/commit/78763066648b921c51b0920493c67fc166c3e6f3>

[22] [CITE@en[Bug 26340 – Ignoring username and password from the base URL?]]
([TIME[2015-07-05 11:36:42 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=26340#c2>

[FIG(quote)[
[FIGCAPTION[
[23] [CITE@en[URL scheme sequelpro:// Usage | Sequel Pro]]
([TIME[2015-01-20 10:39:03 +09:00]] 版)
<http://www.sequelpro.com/docs/URL_Scheme>
]FIGCAPTION]

> sequelpro://$SP_PROCESS_ID@chooseItemFromList/item1/item2/…

]FIG]


[24] [CITE@en[Encode more code points for usernames and passwords. Fixes #30. · whatwg/url@9ca26e5]]
([TIME[2015-08-15 11:53:55 +09:00]] 版)
<https://github.com/whatwg/url/commit/9ca26e5b0edc131f9cca81d0fef4ab92815bc289>

[25] [CITE@en[Use "include credentials" from the URL Standard rather than copying i… · whatwg/fetch@2c68504]]
([TIME[2015-08-19 23:49:57 +09:00]] 版)
<https://github.com/whatwg/fetch/commit/2c68504a5ea6c6742212a31dc357ceab12862296>

[FIG(quote)[
[FIGCAPTION[
[26] [CITE[GNU Wget 1.16.2 Manual]]
([TIME[2015-09-14 23:23:19 +09:00]] 版)
<http://www.gnu.org/software/wget/manual/wget.html>
]FIGCAPTION]

> Some proxy servers require authorization to enable you to use them. The authorization consists of username and password, which must be sent by Wget. As with HTTP authorization, several authentication schemes exist. For proxy authorization only the Basic authentication scheme is currently implemented.
> You may specify your username and password either through the proxy URL or through the command-line options. Assuming that the company’s proxy is located at ‘proxy.company.com’ at port 8001, a proxy URL location containing authorization data might look like this:
> http://hniksic:mypassword@proxy.company.com:8001/

]FIG]


[28] [CITE@en[Fix #44: replace "relative flag" with non-null host check · whatwg/xhr@fabeb1a]]
([TIME[2016-01-21 12:13:22 +09:00]] 版)
<https://github.com/whatwg/xhr/commit/fabeb1a5de040041e213ccd68c63a0d694c2879b>

[FIG(quote)[
[FIGCAPTION[
[29] [CITE@ja-jp[Internet Explorer では Web サイト アドレス (HTTP URL および HTTPS URL) に含まれるユーザー名およびパスワードがサポートされない]]
([TIME[2016-03-01 10:03:21 +09:00]] 版)
<https://support.microsoft.com/ja-jp/kb/834489>
]FIGCAPTION]

> Internet Explorer 3.0 ~ 6.0 では HTTP URL および HTTPS URL で次の構文がサポートされています。
> http(s)://username:password@server/resource.ext
> この URL 構文を使用すると、基本認証方式をサポートする Web サイトにユーザー情報が自動的に送信されます。
> この資料の「背景情報」に記載されている問題を抑制するため、Internet Explorer およびエクスプローラーでは、この形式の HTTP URL および HTTPS URL の処理をサポートしないようになりました。エクスプローラーおよび Internet Explorer では、ユーザー情報を含む URL を使用して HTTP サイトまたは HTTPS サイトを開くことはできません。ユーザー情報が HTTP URL または HTTPS URL に含まれている場合、既定で次のタイトルの Web ページが表示されます。
> 無効な構文エラー
> 注: この既定の動作の変更は、他のプロトコルには影響を与えません。たとえば、セキュリティ更新プログラム 832894 をインストールした後でも、FTP URL にはユーザー情報を含めることができます。
> この既定の動作の変更は、セキュリティ更新プログラム 832894 のリリース以降にリリースされたセキュリティ更新プログラム、Service Pack、および Internet Explorer の各バージョンでも実装されています。

]FIG]

[FIG(quote)[
[FIGCAPTION[
[32] [CITE@en[Connection String URI Format — MongoDB Manual 3.2]]
([TIME[2016-10-28 23:53:37 +09:00]])
<https://docs.mongodb.com/manual/reference/connection-string/>
]FIGCAPTION]

> The following connects to a replica set with two members, one on db1.example.net and the other on db2.example.net:
> mongodb://db1.example.net,db2.example.com

]FIG]


[107] [CITE@en[No need for null passwords]]
([[annevk]]著, [TIME[2017-01-04 02:31:30 +09:00]])
<https://github.com/whatwg/url/commit/5e0b05e95a81fdd539c7b1bf97e69b3df701384f>

[108] [CITE@en[Editorial: stop referring to a password alone as credentials]]
([[annevk]]著, [TIME[2017-01-04 18:27:54 +09:00]])
<https://github.com/whatwg/url/commit/240e61d45023b6742d35ac18f14560fcc2ab4bfe>

[109] [CITE@en[Align <a>/<area>.password with the URL Standard]]
([[annevk]]著, [TIME[2017-01-05 23:20:12 +09:00]])
<https://github.com/whatwg/html/commit/165aeecfb1818912219afc50dd2dd1c6ec935ae2>

[FIG(quote)[
[FIGCAPTION[
[110] [CITE[Intent to deprecate: Legacy subresource requests. - Google グループ]]
(2014/11/21 [TIME[2017-01-22 13:12:40 +09:00]])
<https://groups.google.com/a/chromium.org/forum/#!topic/net-dev/bAMVnc1Zyvs>
]FIGCAPTION]

> I'd like to block two kinds of subresource requests from webby documents:
> 1. Subresources with an "legacy" scheme (e.g. "ftp://my-awesome-ftp-server.com/yay.tiff")
> 2. Subresources with credentials (e.g. "http://ima_user:hunter2@example.com/yay.tiff").

]FIG]
