[5] [[ドメイン名]]における[DFN[[RUBYB[ラベル]@en[label]]]]とは、 [CODE(char)[[[.]]]]
で区切られたそれぞれの部分のことです。

* DNS における定義

[11] [[ラベル]]は、 [CODE(ABNF)@en[[[ALPHA]]]], [CODE(ABNF)@en[[[DIGIT]]]], 
[CODE(char)[[[-]]]] の1文字以上の連続です。ただし、先頭1文字と末尾1文字は [CODE(char)[[[-]]]]
であってはなりません。

[FIG(railroad)[
= |
== [CODE[[[ALPHA]]]]
== [CODE[[[DIGIT]]]]
= ?
== *
=== |
==== [CODE[[[ALPHA]]]]
==== [CODE[[[DIGIT]]]]
==== [CODE[[[-]]]]
== |
=== [CODE[[[ALPHA]]]]
=== [CODE[[[DIGIT]]]]
]FIG]

;; [12] 以前は先頭1文字が [CODE(ABNF)@en[[[DIGIT]]]] であることも認められていませんでしたが、
[[RFC 1123]] で緩和されています [SRC[>>66]]。

[1] [[IDN2008]] ではこれを「[[LDHラベル]]」と呼んでいます。
この意味での「[[ラベル]]」の詳細は [[LDHラベル]]の項を参照してください。

** 仕様書

[REFS[
- [67] [CITE@en[RFC 1034 - Domain names - concepts and facilities]] ([TIME[2013-11-15 02:48:06 +09:00]] 版) <http://tools.ietf.org/html/rfc1034#section-3.5>
- [66] [CITE@en[RFC 1123 - Requirements for Internet Hosts - Application and Support]] ([TIME[2013-11-15 03:02:57 +09:00]] 版) <http://tools.ietf.org/html/rfc1123#section-2>
]REFS]

* IDNA における定義

** IDNA2003、IDNA2008 での定義

[1]
> [DFN[[RUBY[ラベル][なふだ]@en[label]]]]は、
[[ドメイン名]]の個々の部分です。
[[ラベル]]は通常[RUBYB[[[点]]]@en[dot]]で区切って示されます。
例えば、[[ドメイン名]] [CODE(example)@en[[[www.example.com]]]]
は、 [CODE(example)@en[[[www]]]]、
[CODE(example)@en[[[example]]]]、
[CODE(example)@en[[[com]]]] の3つの[[ラベル]]で構成されます。
([DEL[[[STD 13]] で[[長さ]][[零]]の[[根ラベル]]が説明されています。]] [INS[[[RFC 1123]] で末尾[RUBYB[[[点]]]@en[dot]]を使った完全な名前の表記法が説明されています。]]
これは明示的に [CODE(example)@en[[[www.example.com.]]]]
のように記述したり、暗示的に
[CODE(example)@en[[[www.example.com]]]]
としたりします。しかし、この[[文書]]では[DEL[[[ラベル]]とは]]考えません。)
[[IDNA]] は [INS[([[RFC 1035]] や [[RFC 2181]] の[[バイナリ列ラベル]]や [[RFC 2673]] の[[ビット列ラベル]]ではなく)]]
[[テキスト]]である[[ラベル]]で使用可能な[[文字]]の[[集合]]を[INS[特定の文脈において]]拡張します。[INS[利用可能な[[文字]]の[[集合]]は文脈によって異なり、次の節で説明します。]]
この[[文書]]では、以後、[Q[[[ラベル]]]]という[[用語]]を[Q[[RUBYB[[[テキスト・ラベル]]]@en[text label]]]]の略、
[Q[[RUBYB[[[各ラベル]]]@en[every label]]]]を[Q[[RUBYB[[[各テキスト・ラベル]]]@en[every text label]]]]の略として使います。

;; [15] 追加と削除は [[IDNA2003]] と [[IDNA2008]] での違いです。

** UTS #46 での定義

[33] [SRC[>>34]]
> a [DFN(en)[label]] is a substring of a domain name. That substring is bounded on both sides by either the start or the end of the string, or any of the following characters, called [DFN[[[label-separators]]]]

** 仕様書

[REFS[
- [13] [[IDNA2003]] [[RFC 3490]] 2.
- [14] [[IDNA2008]] [CITE@en[RFC 5890 - Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework]] 
<http://tools.ietf.org/html/rfc5890#page-7>
- [36] [CITE@en-us[UTS #46: Unicode IDNA Compatibility Processing]]
-- [34] '''<http://unicode.org/reports/tr46/#Notation>'''
-- [56] <http://unicode.org/reports/tr46/#Conformance>
-- [37] <http://unicode.org/reports/tr46/#Validity_Criteria>
]REFS]

* HSTS での定義

>
[69] 
:domain name label:
is that portion of a domain name appearing "between the dots",
i.e., consider "foo.example.com": "foo", "example", and "com" are
all domain name labels.

[REFS[
- [68] [CITE@en[RFC 6797 - HTTP Strict Transport Security (HSTS)]] ([TIME[2014-06-02 05:16:10 +09:00]] 版) <http://tools.ietf.org/html/rfc6797#section-4>
]REFS]

* 分類

[FIG(list)[
- [29] [[テキスト・ラベル]]
-- [17] [[ASCIIラベル]]
--- [16] [[LDHラベル]]
---- [26] [[NR-LDHラベル]]
---- [23] [[R-LDHラベル]]
----- [22] [[XNラベル]]
------ [24] [[Aラベル]]
------ [25] [[偽Aラベル]]
------ [25] [[未検証Aラベル]]
---- [27] [[ACEラベル]]
--- [18] [[非LDHラベル]]
-- [19] [[Uラベル]]
-- [32] [[未検証Uラベル]]
-- [31] [[IDNAラベル]]
-- [28] [[国際化ラベル]]
- [20] [[バイナリー列ラベル]]
- [21] [[ビット列ラベル]]
- [30] [[非ASCIIラベル]]
]FIG]

* UTS #46 における制約

[35] [[UTS #46]] は[[ラベル]]に対していくつかの制約を課しています。

;; [40] この対象は[[テキスト・ラベル]]に相当するものであり、[[バイナリー列ラベル]]や[[ビット列ラベル]]は考慮されていません。

** 共通の制約

- [38] [[NFC]] でなければなりません。 [SRC[>>37]]
- [39] 3文字目と4文字目が [CODE(charname)@en[[[HYPHEN-MINUS]]]] であってはなりません。 [SRC[>>37]]
- [41] 最初と最後が [CODE(charname)@en[[[HYPHEN-MINUS]]]] であってはなりません。 [SRC[>>37]]
- [42] [CODE(charname)@en[[[FULL STOP]]]] を含んではなりません。 [SRC[>>37]]
- [43] [[結合マーク]] ([[General_Category]] が [[Mark]] であるもの) を含んではなりません。 [SRC[>>37]]
- [44] すべての[[符号位置]]の[[IDNA写像表]]における[[状態値]]が次の条件を満たさなければなりません。 [SRC[>>37]]
-- [45] [[移行的処理]]: [[妥当]]
-- [46] [[非移行的処理]]: [[妥当]]または[[偏差]]

[47] >>45 の[[状態値]]は [[UseSTD3ASCIIRules]] の値によって変化します。

** UseSTD3ASCIIRules

[48] [[UseSTD3ASCIIRules]] が[[偽]]であれば [[ASCII文字]]の[[妥当性]]の検証方法は[[実装依存]]となります。例えば [[LDH]] の他に [CODE(char)[[[_]]]] を認めることができます。 [SRC[>>37]]

[49] これは単に[[ASCII文字]]を認めるだけにとどまらず、[[写像]]や[[正規化]]の結果そのような
[[ASCII文字]]に変換される[[非ASCII文字]]を認めることにつながります。

[50] 例えば [CODE(charname)@en[[[LOW LINE]]]] の使用を認めると、
[CODE(charname)@en[[[FULLWIDTH LOW LINE]]]] も認めることとなります。

[51] またいくつかの[[非ASCII文字]]は[[正準分解]]が [[UseSTD3ASCIIRules]] 
が[[真]]だと認められない[[ASCII文字]]となるため、 [[UseSTD3ASCIIRules]]
が[[真]]の時は使用禁止となりますが、[[偽]]の時は使用禁止になりません。
そのような[[文字]]は [[disallowed_STD3_valid]] に分類されています。
[[disallowed_STD3_valid]] の[[文字]]は、 [[UseSTD3ASCIIRules]] が[[偽]]であっても、
対応する[[ASCII文字]]が認められないときにはやはり禁止しなければなりません。 [SRC[>>37]]

** 推奨

[FIG(list)[
- [52] [[bidi規則]]に従うべきです。 [SRC[>>37]]
- [53] [[CONTEXTJ]] な[[符号位置]]についての [[IDNA2008]] の制約に従うべきです。 [SRC[>>37]]
]FIG]

** 追加の制約

[57] 実装は更に追加で制約を加えたり、警告を出したりしても構いません。
例えば、次のような制約が考えられます [SRC[>>56]]。

[FIG(list)[
- [58] 特定の[[用字系]]の組み合わせの[[ラベル]]を認めない ([[Safari]]) [SRC[>>56]]
- [59] [[利用者]]が指定した[[言語]]以外の[[文字]]の[[ラベル]]を認めない ([[IE]]) [SRC[>>56]]
- [60] 特定の[[混乱可能文字]]の[[ラベル]]を認めない ([[Firefox]]) [SRC[>>56]]
- [61] [[Google Safe Browsing API]] で検出された[[ラベル]]を認めない [SRC[>>56]]
- [62] [[IDNA2008]] の妥当性の要件 ([[Uラベル]]参照) を満たさない[[ラベル]]を認めない [SRC[>>56]]
- [63] [[ToASCII]] すると[[ラベル]]の妥当性の要件を満たさない [[ToUnicode]] によって作られた[[ラベル]]を認めない [SRC[>>56]]
- [54] [[混乱可能文字]]の処理については [[UTR #36]] を参照することを強く推奨します。 [SRC[>>37]]
-- [CSECTION@en[[[Restriction Level 3, Moderately Restrictive]]]] [SRC[>>56]]
- [55] [[識別子]]に使うべきではない[[文字]]の処理については [[UTS #39]] を参照することを強く推奨します。 [SRC[>>37]]
-- [64] [CSECTION@en[[[Table 4, Candidate Characters for Exclusion]]]] [SRC[>>56]]
-- [65] [CSECTION@en[[[Table 5, Recommended Scripts: Limited Use]]] [SRC[>>56]]
]FIG]

* メモ

[3]
[PRE(ABNF)[
domain = subdomain / " "
subdomain = label *("." label)
label = letter [ [ldh-str] let-dig ]
ldh-str = 1*let-gid-hyp
let-dig-hyp = let-dig / "-"
let-dig = letter / digit
letter = <"A" / ... / "Z">
digit = <"0" / ... / "9">
]PRE]

[4]
[PRE(ABNF)[
domain = subdomain / " "
subdomain = label *("." label)
label = ALPHA [*(ALPHA / DIGIT / "-") (ALPHA / DIGIT)]
ldh-str = 1*(ALPHA / DIGIT / "-")
]PRE]