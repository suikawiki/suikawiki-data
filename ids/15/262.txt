[5] [DFN[[CODE(JS)@en[[[document.close]]]]]] [[メソッド]]は、
[CODE(JS)@en[[[document.open]]]] により作成した[[文書]]に [[EOF]]
を挿入します。

* 仕様書

[REFS[
- [2] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#dom-document-close>
]REFS]

* 処理

[3] [CODE(DOMi)@en[[[Document]]]] [[インターフェイス]]の
[DFN[[CODE(DOMm)@en[[[close]]]]]] [[メソッド]]は、次のようにしなければ[['''なりません''']]
[SRC[>>2]]。
[FIG(steps)[
= [[文書]]が[[HTML文書]]でなければ、
[CODE(DOMe)@en[[[InvalidStateError]]]] [[例外]]を投げて停止します。
= [[文書]]の[[構文解析器]]がないか、それが [[script-created parser]] でないなら、
ここで停止します。
= [[文書]]の[[構文解析器]]の[[入力ストリーム]]の終わりに[[明示的「EOF」文字]]を挿入します。
= [[pending parsing-blocking script]] があれば、ここで停止します。
= [[字句化器]]を走らせ、 [[emit]] された[[字句]]を処理します。
[[字句化器]]が[[明示的「EOF」文字]]に到達するか、
[[イベントループをスピン]]するまで処理を続けます。
]FIG]

[7] [[スピン]]が発生する状況を整理すると、[[字句化器]]の停止するのは
[[EOF]] [[文字]]まで (つまり最後まで) 処理が進んだ場合と、
[CODE(HTMLe)@en[[[script]]]] [[要素]]の処理でそれ以上進めなくなったら、
ということになります。
(特別なことを要求されているように思えますが、通常通り処理できるところまで進むだけでOKです。)

;; [4] [[fetch]] 待ちの[[スクリプト]]があるなど[[構文解析]]が継続できなくなったら、
[[構文解析器]]は[[イベントループをスピン]]します。

* レンダリング

[6] [[構文解析器]]を通じて[[文書]]や [[busy indicator]] の表示に影響をあたえることがあります。

;; [[レンダリングの開始]]も参照。

* 歴史

[1] [CITE@en[Web Applications 1.0 r4241  Make document.close() more evil.]] ([TIME[2009-10-21 17:31:00 +09:00]] 版) <https://html5.org/r/4241>