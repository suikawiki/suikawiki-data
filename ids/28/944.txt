* 仕様書

[REFS[
- [2] [CITE@en[RFC 8216 - HTTP Live Streaming]] ([TIME[2018-04-11 20:05:57 +09:00]]) <https://tools.ietf.org/html/rfc8216#section-2>
- [4] [CITE@en[RFC 8216 - HTTP Live Streaming]] ([TIME[2018-04-11 20:05:57 +09:00]]) <https://tools.ietf.org/html/rfc8216#section-3>
]REFS]

* 媒体セグメント (HLS)

[5] [DFN[[RUBYB[媒体セグメント]@en[Media Segment]]]]は、
[[URL]] と、
省略可能な[[バイト範囲]]によって指定されます。 [SRC[>>4]]

[3] データは [[HTTP]] で伝送する[SHOULD[べき]]ですが、
一般に[[資源]]を要求に応じて転送できる[RUBYB[[[信頼]]できる]@en[reliable]][[プロトコル]]であれば、
どんなものでも使えます。 [SRC[>>2]]

[8] [[媒体セグメント]]は、それぞれ固有の[[整数]]である[DFN[[RUBYB[媒体連番]@en[Media Sequence Number]]]]を持ちます。
[[媒体プレイリスト]]の最初の[[媒体セグメント]]の[[媒体連番]]は、
[N[0]] または[[プレイリスト]]で宣言された値です。
その他の[[媒体セグメント]]の[[媒体連番]]は、
直前の[[媒体セグメント]]の[[媒体連番]]に [N[1]] 加えたものです。 [SRC[>>4]]

[7] [[媒体セグメント]]の時間の長さ ([[duration]]) は、
[[媒体プレイリスト]]の [CODE[EXTINF]] タグで表されます [SRC[>>4]]。

** データ

[12] [[媒体セグメント]]は、[[仕様書]]で定められたいずれかの[[媒体形式]]でなければ[MUST[なりません]]。
それ以外の形式の輸送は未定義です。 [SRC[>>4]]

[13] [[媒体形式]]によっては[[媒体セグメント]]の[[構文解析]]の前に[[構文解析器]]初期化のための共通の[[バイト列]]が必要となります。
これを[DFN[[RUBYB[媒体初期化区]@en[Media Initialization Section]]]]といいます。
[[媒体初期化区]]は、
[CODE[EXT-X-MAP]] [[タグ]]で指定できます。
[[媒体初期化区]]は[[標本データ]]を含んでは[MUST[なりません]]。 [SRC[>>4]]

[9] [[媒体セグメント]]は、
前の[[媒体連番]]の[[媒体セグメント]]の末尾からの続きの符号化ビット列を伝搬しなければ[MUST[なりません]]。
ここで、[[タイムスタンプ]]や [[Continuity Counter]] のような系列は中断なく連続していなければ[MUST[なりません]]。
ただし、[[媒体プレイリスト]]の最初の[[媒体セグメント]]と、
非連続と明示的に示された[[媒体セグメント]]を除きます。
そうでない非連続性は、 [[playback error]] となります。
[SRC[>>4]]

[10] [[動画]]を含む[[媒体セグメント]]は、
[[動画]]の[[復号器]]を初期化し[[媒体セグメント]]の最終[[フレーム]]を含む連続した[[フレーム]]群を[[復号]]するに十分な情報を含む[SHOULD[べきです]]。
[[媒体セグメント]]中のすべての[[フレーム]]を[[復号]]できる十分な情報が[[媒体セグメント]]に含まれる場合に、
[RUBYB[[[ネットワーク効率性]]]@en[network efficiency]]が最適化されます。
[SRC[>>4]]

[11] 例えば [[H.264]] [[動画]]を含む[[媒体セグメント]]は、
[[IDR]] ([[Instantaneous Decoding Refresh]]) を含む[SHOULD[べき]]です。
最初の [[IDR]] までの[[フレーム]]は[[ダウンロード]]されても捨てられるかもしれません。
[SRC[>>4]]

*** MPEG2 TS

[14] [[ISO/IEC 13818]] [[MPEG-2 Transport Stream]] を使うことができます
[SRC[>>4]]。

[15] [[MPEG2 TS]] の[[媒体初期化区]]は、
[[PAT]] ([[Program Association Table]]) の後に
[[PMT]] ([[Program Map Table]]) を続けたものです。 [SRC[>>4]]

[16] [[Transport Stream Segments]] は、
[[MPEG-2 Program]] を1つだけ含まなければ[MUST[なりません]]。
[[Multi-Program Transport Streams]] の [[playback]] は未定義です。 [SRC[>>4]]

[17] 各 [[Transport Stream Segment]] は、 
[[PAT]] と [[PMT]] を含むか、または [CODE[EXT-X-MAP]] [[タグ]]を持たなければ[MUST[なりません]]
[SRC[>>4]]。

[18] [[媒体セグメント]]の最初の2つの [[Transport Stream]] パケット群は、
[CODE[EXT-X-MAP]] [[タグ]]がない場合には、
[[PAT]] と [[PMT]] である[SHOULD[べき]]です。 [SRC[>>4]]



** 文脈

[6] [[媒体セグメント]]は、
[[媒体プレイリスト]]に含まれます [SRC[>>4]]。

* メモ

[1] [CITE@en[Media Source Extensions™]]
([TIME[2016-11-17 04:05:37 +09:00]])
<https://w3c.github.io/media-source/#media-segment>