[15] [DFN[はてなグループ]]は、[[株式会社はてな]]の[[グループウェア]] [[Webサービス]]です。

[16] [[はてなダイアリー]]や[[はてなグループ]]の機能をグループ内で使うことができます。

[24] [[はてな]]社内でも業務に用いているようです。

* 編集権限

[30] [[有料オプション]]利用中であれば、
[[グループ日記]]の編集権限を[[はてなID]]や所属[[グループ]]により設定できます。

* 良い点

[7] グループ日記は他の[[グループウェア]]にはあまりない良い機能です。

[13] メール投稿できます。 [[cron]] のログファイルの送信先を投稿アドレスにしておくと便利です。

[19] [[IDコール]]便利。

[20] [[はてなスター]]良い。

* 問題点

[1] ほとんどメンテナンスされていないようで、時代遅れ感があります。
[[あしか]] ([[BTS]]) などは低機能過ぎて[[はてな]]社内でも使われていません。

[2] [CODE[<meta name=referrer>]] を適切に設定することができないので
(日記などで個別に設定することはできますが、グループ全体で漏れなく設定するのが難しい。)、
社内情報共有ツールのように利用するのが中々難しいです。

[57] >>2 はその後改善されたようで、非公開グループからリンクしても[[リファラー]]がつかないようになったみたいです。
[[はてな]]さんの社内グループからリンクされているのが[[リファラー]]でわかっちゃったりしたのも、
すっかり過去のことになりましたw

[3] [[HTTPS]] でもアクセスができますが、[[素のHTTP]]が標準状態です。
[[HTTPS]] 限定にするためには個別に[[はてな]]に依頼する必要があります
(有料オプションが必要)。
そうしていないと、 [[HTTPS]] でアクセスしてもいつのまにか[[リンク]]で
[[HTTP]] に戻されている罠があります。

[4] メンバーが退会すると、その人の日記には (他のメンバーも) アクセスできなくなります。

[5] 新規メンバーを追加するとその人に送られる通知メールがわかりにくいことに定評があります。

[6] [[IDコール]]は日記を書いていないメンバーには送れません。

[8] [[IDコール]]はメンバーが増えると面倒になります。「メンバー全員」やメンバーの特定グループ、のような送り方ができず、
名前を列挙する必要があります。

[17] 同じ[[日]]の他の記事の編集で意図せず[[IDコール]]が送られてしまうというひどい[[仕様]]があります。

[18] [[IDコール]]を送るかどうかを都度選択できません。
(他の人の[[日記]]の [[URL]] で[[トラックバック]]が送信されるのは回避テクニックがありますが、面倒です。)

[9] [[スタコメ]]の可視範囲はグループメンバーと連動していません。

[49] グループ内全文検索機能がありますが、
[[スタコメ]]は検索対象に入っていません。


[10] コメントでは [[IDコール]]が使えません。

[11] 標準設定ではコメント通知メールが送られません。つまりコメントされてもなかなか気づけません。

[12] 記事のサイズ制限が意外と厳しいです。長めの実行ログなどを貼るといつのまにか途中から途切れています。

[14] キーワード名を変更できません。

[21] [[スマートフォン]]からは操作しにくいです。

[22] 閲覧権限がない [[URL]] を開くと問答不要で[[はてなグループ]]全体の[[トップページ]]に[[リダイレクト]]されてしまいます。
[[はてなID]]で[[ログイン]]していない状態で [[URL]] を開いた時、[[ログイン]]して元の
[[URL]] に戻るのが面倒です。

[23] 他の人が書いた記事のソース ([[はてな記法]]) を[[コピペ]]して再利用したいことがよくありますが、
正規の方法が無いので、グループメンバーに編集権限を与えるのが定石となっています。何かがおかしい。

[51] 
[CODE['''['''http:[VAR[...]]:title''']''']]
によって[[リンク先]]の [[Webページ]]の
[CODE[title]] を表示できますが、その場で取得しているらしく、
表示に非常に時間がかかることがあります。 (次から速くなるので、たぶんキャッシュされています。
しかし数日?で消えてしまうので、また時間がかかるようになります。)

[52]
[CODE['''['''http:[VAR[...]]:title''']''']]
は [[TLS拡張]]や [[cipher suite]]
次第で正しく取得できません。近年の [[Webサイト]]は
[[HTTPS化]]が進んでいますが、それにつれて取得できないサイトが増えているようです。
(以前は[CITE[はてなブックマーク]]も正しく取得できないことが多かったのですが、
そちらは改善され、[CITE[はてなグループ]]は放置されているようです。)

[53]
[CODE['''['''http:[VAR[...]]:title''']''']]
で指定された [[URL]] の[[応答]]の
[CODE[Location:]] が不正な [[URL]] を含むとき、
それを含む[[はてなグループ]]のページが [CODE[500]] エラーとなるようです。
[TIME[2017-09-30T15:57:08.700Z]]

* 有料オプション

[58] 
有料オプションを申し込むと、[[はてなポイント]]が毎月自動で引き落とされていきます。

[59] 
[CITE[はてなダイアリー]]の有料オプションははてなダイアリープラスという名前に改称されましたが、
[CITE[はてなグループ]]はそのままでした。

** 解除時

[41] 
有料オプションが無効になったプライベートグループは、
閲覧はできても変更はできない状態になるようです。

[42] 
編集のページは、 [CODE[200]] のままエラーメッセージの [[HTML]] が返されるようになります。
編集画面を通じて[[はてな記法]]のテキストを取得できなくなりますが、 [CODE[export]] 
にはアクセスできるので、グループ日記の[[はてな記法]]原文は得られます
(また[[その場編集]]モードで記事の一部の[[はてな記法]]の取得も可能です)。

[44] そのため編集履歴にアクセスする方法もなくなってしまいますが、
[CODE[[[/]]keywordlog?klid=[VAR[{id}]]]] のようなページ自体は生きているので、
順にたどって取得していくこと自体は可能です。

[43] 
[CODE[[[/]]filelist]] は [CODE[200]] のエラーメッセージの [[HTML]] が、
個別のファイルの [[URL]] は [CODE[403]] が返されるようになります。


* Web サイト

** グループ日記

[38] [[グループ日記]]の設定で、
「日記モード」と
「日記モード・見出し別ページ」
のいずれかを選ぶことができます。既定値は後者です。

[39] 日記の見出しごとの [[URL]] は、
前者では [CODE[https://{group}.g.hatena.ne.jp/{user}/{YYYYMMDD}#{id}]]、
後者では [CODE[https://{group}.g.hatena.ne.jp/{user}/{YYYYMMDD}/{id}]]
となります。これは見出しに対する[[はてなスター]]の [[URL]] でもあります。
[[はてなスター]]は両者を異なる [[URL]] として扱うので、
モードを変えると見出しごとの[[はてなスター]]は見えなくなります。

[40] 
なお [CODE[http:]] と [CODE[https:]] も[[はてなスター]]は別の [[URL]]
として扱いますので、どちらを表示するかにより、
[[スター]]が見えたり見えなかったりします。

** キーワード

[45] 
[[キーワード]]の [[URL]] は [CODE[/keyword/{keyword}]]
のようになります。 [VAR[{keyword}]] は[[キーワード]]を[[パーセント符号化]]したものですが、
[CODE[/]] を [CODE[%2F]] に符号化すると [CODE[404]] になります。 [CODE[/]]
のままとしなければなりません。

[46] 
[CODE[/keywordlog?klid={id}]] のような [[URL]] で履歴にアクセスできます。
ここにはすべての編集履歴が保存されています (削除したキーワードがどうなるのかは不明)。
ただしグループ作成時に自動作成される「リンク集」キーワードの初期状態は、
履歴に含まれません。

[47] 
存在しないIDを指定した時でも、 [CODE[class]] が [CODE[day]]
の[[要素]]が表示されないだけで、ページ自体は [CODE[200]]
になって意味のない (エラーメッセージですらない) [[HTML文書]]が返されます。

[48] 
[[はてな記法]]の[[ソースコード]]が [CODE(HTMLe)@en[textarea]]
[[要素]]に含まれていますが、内容が削除されて[[空文字列]]になったときはこの
[CODE(HTMLe)@en[textarea]] [[要素]]が出力されないようです。

** エクスポート

[25] [[Web API]] は提供されていません。

[26] 編集権限がある[[グループ日記]]については、
[CODE[https://[VAR[{group}]].[[g.hatena.ne.jp]]/[VAR[{user}]]/source]] で [[CSV]] 形式、
[CODE[https://[VAR[{group}]].[[g.hatena.ne.jp]]/[VAR[{user}]]/export]] で [[XML]] 形式でデータを保存できます
(日記の設定ページからリンクされています)。
日付、題名、本文、コメントが入っています。 [[CSV]] には body と text の2つの本文が入っていますが、違いは謎です。
本文は[[はてな記法]]の原文になっています。
コメントは [[CSV]] では謎の区切り文字列が使われています。
編集権限がないと[[グループ日記]]トップページに[[リダイレクト]]されます。

[FIG[ [28] [CODE[export]] の [[XML文書]]
- [CODE(XMLe)@en[diary]]
-- [CODE(XMLe)@en[day]] 0個[[以上]]
--- [CODE[date]] [[属性]] = [CODE[{YYYY}-{MM}-[DD}]]
--- [CODE[title]] [[属性]] = 文字列
--- [CODE[body]] 1個
---- [[はてな記法]]本文
--- [CODE[comments]] 0個または1個
---- [CODE[comment]] 1個以上
----- [CODE[username]] 1個
------ [[はてなID]]または名前
----- [CODE[body]] 1個
----- [CODE[timestamp]] 1個
------ [[Unix time]]
]FIG]

[29] [CODE[username]] は[[はてなユーザー]]以外のコメントの時は[[利用者]]入力の値
(省略不可)、[[はてなユーザー]]の時は[[はてなID]]となります。
どちらかを判別する方法はありません。

[54] 
管理権限のあるグループの[[キーワード]]は、
[CODE[http://[[g.hatena.ne.jp]]/source?gname=[VAR[{group}]]&download=1&encode=utf8]]
([CODE[https:]] 不可)
のような [[URL]] で [[CSV]] 形式で取得可能です。
ただし取得できるのはキーワード名と[[はてな記法]]の本文ソースデータだけです。
(更新日時、編集履歴などは含まれません。)

[27] 編集権限のない[[グループ日記]]や[[キーワード]]の[[はてな記法]]データは、
おそらく取得できません。編集ページにアクセスしても、[[リダイレクト]]されます。
[CODE[/keywordlog?klid={id}]] のような履歴の [[URL]] に直接アクセスしても、
[[リダイレクト]]されます。

** ファイル

[31] [[ファイル]]一覧の [[HTML]] 版の [[URL]] は
[CODE[https://{group}.g.hatena.ne.jp/filelist?of={offset}]]
([VAR[group]] はグループの名前、 [VAR[offset]] は[[0基準]]の先頭ファイルの[[索引]])
です。

[32] [[ファイル]]一覧の [[RSS 2.0]] 版の [[URL]] は
[CODE[https://{group}.g.hatena.ne.jp/filelist?mode=rss&page={page}]]
([VAR[group]] はグループの名前、[VAR[page]] は[[1基準]]の[[ページ番号]])
です。

[33] [CODE(XMLe)@en[channel]] [[要素]]の
[CODE[openSearch:totalResults]] [[要素]]に全ファイル数が、
[CODE[openSearch:startIndex]] [[要素]]に現[[ページ番号]] ([[1基準]]) が、
[CODE[openSearch:itemsPerPage]] [[要素]]に1つのページの最大ファイル数 ([N[20]] 固定?) が入ります。

[36] 最終ページを超えると、 [CODE(XMLe)@en[item]] [[要素]]のない空の[[フィード]]になります。

[34] 各 [CODE(XMLe)@en[item]] [[要素]]の
[CODE(XMLe)@en[title]] [[要素]]と
[CODE(XMLe)@en[description]] [[要素]]に[[ファイル名]]が、
[CODE(XMLe)@en[link]] [[要素]]に [[URL]] が、
[CODE(XMLe)@en[pubDate]] [[要素]]に[[タイムスタンプ]]が、
[CODE(XMLe)@en[enclosure]] [[要素]]の
[CODE(XMLa)@en[length]] [[属性]]に[[ファイルサイズ]]が、
[CODE(XMLa)@en[url]] [[属性]]に [[URL]] が、
[CODE(XMLa)@en[type]] [[属性]]に [[MIME型]]が (不明なら[[空文字列]]) 入ります。

[37] [[ファイル]]機能が使えない無料のグループでは、
[[RSS]] の [[URL]] でも、
[[HTML]] のエラーページが表示されます。
[[状態符号]]は [CODE[200]] です (!)。

[35] [[ファイル]]の [[URL]] の[[応答]]では、
[CODE(HTTP)@en[Content-Disposition:]] の [CODE(MIME)@en[filename]] に[[ファイル名]]が、
[CODE(HTTP)@en[Content-Type:]] に[[MIME型]]が (不明なら [CODE(MIME)@en[application/octet-stream]])、
[CODE(HTTP)@en[Last-Modified:]] [[ヘッダー]]に[[タイムスタンプ]]が入ります。

[[ファイル名]]に[[非ASCII文字]]が含まれる場合、 [[UTF-8]]
で[[パーセント符号化]]された値になります。 ([[RFC 5987]] 形式ではなく、
[[引用文字列]]です。)

* 関連

[50] [[はてなブログ グループ]]とは無関係です。

* メモ

[55] [CITE[2019年末を目処に、はてなグループの提供を終了する予定です - はてなグループ日記 - 機能変更、お知らせなど]]
([TIME[2019-07-04 11:41:28 +09:00]])
<https://hatena.g.hatena.ne.jp/hatenagroup/20190703/1562137447>

[56] [CITE[はてなグループ終了に寄せて - #生存戦略 、それは - subtech]]
([TIME[2019-07-04 11:59:46 +09:00]])
<https://subtech.g.hatena.ne.jp/secondlife/20190704/1562203081>