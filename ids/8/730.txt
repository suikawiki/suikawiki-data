[23] [[イベント]]は、[DFN[[RUBYB[[[既定動作]]]@en[default action]]]]を持つことがあります。
[[既定動作]]は[[イベントリスナー]]の実行後に処理される動作です。
[[イベント]]が[DFN[[RUBYB[[[取り消し可能]]]@en[cancelable]]]]
([DFN[[CODE(DOMa)@en[[[cancelable]]]]]] [[IDL属性]]) なら、
[DFN[[RUBYB[[[取り消し]]]@en[cancel]]]]
([DFN[[CODE(DOMm)@en[[[preventDefault]]]]]] [[メソッド]])
することができます。

* 仕様書

[REFS[
- [12] [CITE@en-US[DOM Standard]] ([TIME[2015-01-14 18:37:27 +09:00]] 版) <https://dom.spec.whatwg.org/#canceled-flag>
- [6] [CITE@en-US[DOM Standard]] ([TIME[2015-01-14 18:37:27 +09:00]] 版) <https://dom.spec.whatwg.org/#dom-event-cancelable>
- [8] [CITE@en-US[DOM Standard]] ([TIME[2015-01-14 18:37:27 +09:00]] 版) <https://dom.spec.whatwg.org/#dom-event-preventdefault>
- [11] [CITE@en-US[DOM Standard]] ([TIME[2015-01-14 18:37:27 +09:00]] 版) <https://dom.spec.whatwg.org/#dom-event-defaultprevented>
- [13] [CITE@en-US[DOM Standard]] ([TIME[2015-01-14 18:37:27 +09:00]] 版) <https://dom.spec.whatwg.org/#concept-event-dispatch>
]REFS]

* 取り消し可能性

[7] [[イベントオブジェクト]]は、[[取り消し可能]]かどうかの状態を持ちます。
[CODE(DOMa)@en[[[cancelable]]]] [[IDL属性]]は、初期化時に与えられた値を返さなければ[['''なりません''']] [SRC[>>6]]。

;; 初期化後にこれを変更することはできません。

[24] [[利用者エージェント]]が[[発火]]する[[イベント]]については、
[[イベント型]]と文脈によって[[取り消し可能]]か否かが予め決められています。

* 取り消し

[10] [[イベントオブジェクト]]は、[DFN[[RUBYB[[[取り消し済みフラグ]]]@en[canceled flag]]]]なる状態を持ちます [SRC[>>12]]。
初期値は未設定です [SRC[>>12]]。 [DFN[[CODE(DOMa)@en[[[defaultPrevented]]]]]]
[[IDL属性]]は、[[取り消し済みフラグ]]が設定されているか否かを返さなければ[['''なりません''']]
[SRC[>>11]]。

[9] [[イベントオブジェクト]]の [DFN[[CODE(DOMm)@en[[[preventDefault]]]]]] [[メソッド]]は、
[[取り消し可能]]なら、[[取り消し済みフラグ]]を設定しなければ[['''なりません''']]
[SRC[>>8]]。

[15] [[イベントハンドラー]]が[[偽]]を返した時も、
[[取り消し済みフラグ]]が設定されます。

;; [[イベントハンドラー]]を参照。

[14] [[イベント]]の [[dispatch]] は、[[イベントリスナー]]を実行し終えたら、
[[イベント]]の[[取り消し済みフラグ]]が設定されていれば[[偽]]、
設定されていなければ[[真]]を返さなければ[['''なりません''']] [SRC[>>13]]。
つまり、 [[dispatch]] は取り消されなかったかどうかを返します。

* 既定動作

[16] [DFN[[RUBYB[既定動作]@en[default action]]]]は、[[イベント]]の処理直後に実行される処理です。

[20] [[既定動作]]の多くは、[[イベント]]が[[取り消し]]された場合には実行されません。
[[既定動作]]が規定されている[[イベント]]の多くは、[[取り消し可能]]です。

[19] この用語は [[W3C DOM]] 時代にはありましたが [SRC[>>17, >>18]]、現在の [[DOM Standard]]
では定義されていません。現在は[[アルゴリズム]]形式で厳密に[[利用者エージェント]]の挙動を規定するのが主流となっているため、
曖昧な「[[既定動作]]」という語が必要なくなったのでしょう。

[22] ただし [[HTML Standard]] など [[DOM Standard]] 以前から存在する仕様書には、
まだ[[既定動作]]という用語が残っています。そのような[[既定動作]]は、
[[イベント]]の [[dispatch]] の後に[[イベント]]が[[取り消し]]されていなければ、
同じ[[タスク]]で引き続き実行することが求められているようです。

[21] [[既定動作]]は色々な[[イベント]]に対して存在していますが、特に象徴的なのは
[CODE(DOMe)@en[[[click]]]] [[イベント]]の[[既定動作]]といえる[[活性化動作]]でしょう。
例えば [CODE(HTMLe)@en[[[a]]]] [[要素]]の[[ハイパーリンク]]が[[クリック]]され、
その [CODE(DOMe)@en[[[click]]]] [[イベント]]が[[取り消し]]されなければ、
その[[ハイパーリンク]]を辿ることになります。
もっとも現在[[活性化動作]]は[[既定動作]]としてではなく、専用の[[アルゴリズム]]によって動作が規定されており、それは >>22 よりも複雑なものとなっています。

* 歴史

[5] [CITE[Bug 127903 &#8211; <a> link tags intercept events meant for form submit buttons]] ([TIME[2007-02-17 21:54:24 +09:00]] 版) <https://bugzilla.mozilla.org/show_bug.cgi?id=127903>
([[名無しさん]] [WEAK[2007-02-17 13:00:51 +00:00]])

[4] [CITE@en[WICD Core 1.0]]
( ([TIME[2010-08-17 16:51:00 +09:00]] 版))
<http://www.w3.org/TR/WICD/#hyperlinking>

[1]
[CITE[Safari の event.stopPropagation() や event.preventDefault() がウソ実装のままである件 ]] <http://www.remus.dti.ne.jp/~a-satomi/nikki/2005/06a.html#d27n03>
([[名無しさん]] [sage] [WEAK[2005-06-26 23:06:31 +00:00]])

[2]
[[WinIE7]] は [CODE(DOMm)@en[[[preventDefault]]]] を実装していません。
代わりに [CODE(DOMa)@en[[[returnValue]]]] があります。

[3] [CITE[XML Events 2]]
( ([TIME[2010-12-18 05:25:20 +09:00]] 版))
<http://www.w3.org/TR/xml-events2/#section-preventDefault-element>

[REFS[
- [17] [CITE@en-US[Document Object Model (DOM) Level 3 Events Specification]] ([TIME[2015-02-08 23:16:57 +09:00]] 版) <https://dvcs.w3.org/hg/dom3events/raw-file/tip/html/DOM3-Events.html#glossary-default-action>
- [18] [CITE@en-US[Document Object Model (DOM) Level 3 Events Specification]] ([TIME[2015-02-08 23:17:32 +09:00]] 版) <https://dvcs.w3.org/hg/dom3events/raw-file/tip/html/DOM3-Events.html#event-flow-default-cancel>
]REFS]

[25] [CITE@en[Explain in many different ways that events cannot cause actions. Fixe… · whatwg/dom@24ab873]]
([TIME[2015-08-04 14:00:45 +09:00]] 版)
<https://github.com/whatwg/dom/commit/24ab873d17669b5c1994a3dd92a27d29b1dd03e4>

[26] [CITE@en[12230 – Some synthetic events cause actions]]
([TIME[2015-08-04 14:03:39 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=12230>