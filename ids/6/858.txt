#?SuikaWiki/0.9
- Subject: lock/database file の無限?増殖
- Priority: high
- Status: closed
- Category: WikiDatabase
- Creation-Date: 2003-06-20T22:38:11+00:00

[1] [CODE(perl)[Yuki::YukiWikiDBMeta]]
使ってますが、 lock file が無限? に増殖してってます。

この前の suffix 拡張のときに enbug してしまったか、それともぶったぎり関連(謎)で死ななかったのか。

[2] 類似だけどたぶん別の問題として、
[CODE(perl)[Yuki::YukiWikiDBMeta]] の補助データベースのファイルが、
[CODE(file)[規定名.Un|x時刻]] って感じの変なファイルが増殖してってます。

こっちの問題は多分、たまに修正時刻が保存されない問題
(あ、場筒井にスレ立ってないや。) と関連してるんでしょう。

[3] 混雑した時に timing の問題で一時ファイル残ったりするんでしょうか? よくわかりません...
- [4] とかってたらこの >>3 を保存した時にも日付が保存されず、変なファイルが2つも出来た。。。
- [5] とかいう >>4 こそ。
- [6] とりあえず補助データベースの旧ファイル削除なぜか [CODE[Permission denied]] が出ることはわかった。もちろん読取専用とかになってはいない。
- [7] >>6 Windoze は糞であるとかいう落ちは無いよね?
- [8] 仕方ないので、一時ファイル置換型 lock もどきじゃなくて、直接上書き保存するようにしておきます。
- [9] こうするとなぜか、今のところは変なエラーにはならないみたいです。
- [10] [CODE(wiki)[Yuki::YukiWikiDBNS]] で typo 発見。やっぱり >>1 で enbug したぽ。
- [11] [WEAK[2003-06-28 10:48:17 +00:00]] ''[[わかば]]'': で、 >>9 も元に戻してみました、今のところ上手く動いてるぽです。
- [12] >>10 と思ったんだけど、 typo じゃないや。
- [13] >>12 じゃあ何で直ったんだ?
- [14] 結局振り出しに戻ったわけですが、今のところ増殖はしてません。ますます謎です。
- [15] [WEAK[2003-06-28 10:59:10 +00:00]] ''[[名無しさん]]'': とりあえずもうしばらく様子を見ますか。そいから、前者については lock filename 辺りを書き直したほうがいい。どのみち。
- [16] [WEAK[2003-07-02 07:21:43 +00:00]] ''[[名無しさん]]'': >>14 少し時間が経ってみたら、やっぱり元の木阿弥ぽです。
- [17] [WEAK[2003-07-26 07:34:11 +00:00]] ''[[わかば]]'': とりあえず [CODE(wiki)[Yuki::YukiWikiDBNS]] のファイル名生成部分を書き直しました。これでしばらく様子を見ましょう。
- [18] また、多分この問題が原因で SuikaWiki の referer database が壊れていたので CVS から手 patch 的に復元しました。こんなことがあるから、この問題は深刻です。
- [19] [WEAK[2003-07-27 05:26:46 +00:00]] ''[[わかば]]'': >>17 しばらくどころか1日経たないうちに2度も Referer DB が破壊されちまいました。致命的なんで接尾辞導入前の 1.3 に戻しました。
- [20] [WEAK[2003-07-27 22:54:33 +00:00]] ''>>19'': 戻ったけどまた起こった。元からある問題なのか、 Yuki::YukiWikiDBNS または Yuki::YukiWikiDBMeta で enbug してしまったのか。
- [21] [WEAK[2003-07-28 06:01:05 +00:00]] ''[[わかばたんだよもん]]'': lock 部分を分離して再実装した [CODE(perl)[Yuki::YukiWikiDB_Lock]] を試作してみました。とりあえず試用中。

[22] >>21 は正式には 
[CODE(perl)[SuikaWiki::DB::Util::Lock]]
という名前になりました。

[23] >>22 の module 
はここ2,3日ちゃんと動いてるみたいですし、
もう問題ないだろうということでこの
bug は close します。
- [24] [WEAK[2003-09-14 11:55:51 +00:00]] ''[[名無しさん]]'': Referer database がまた壊れちゃいました。しかも原因不明。 lock はもう完璧なはずなのになあ。
