

* 仕様書

[REFS[
- [9] [CITE@en[DeviceOrientation Event Specification]] ([TIME[2016-08-19 00:30:43 +09:00]]) <https://w3c.github.io/deviceorientation/spec-source-orientation.html>
-- [11] [CITE@en[DeviceOrientation Event Specification]] ([TIME[2016-08-19 00:30:43 +09:00]]) <https://w3c.github.io/deviceorientation/spec-source-orientation.html#deviceorientation>
]REFS]

* イベント

[10] 
[FIG(short list)[
- [CODE(DOMe)@en[deviceorientation]]
- [CODE(DOMe)@en[devicemotion]]
- [CODE(DOMe)@en[compassneedscalibration]]
]FIG]

[15] [CODE(DOMi)@en[Window]] [[インターフェイス]]の
[DFN[[CODE(DOMa)@en[ondeviceorientation]]]] [[IDL属性]]は、
[CODE(DOMe)@en[deviceorientation]] [[イベント]]の[[イベントハンドラーIDL属性]]です
[SRC[>>11]]。

* [CODE(DOMi)@en[DeviceOrientationEvent]] インターフェイス

[17] [DFN[[CODE(DOMi)@en[DeviceOrientationEvent]]]] [[インターフェイス]]は、
[CODE(DOMi)@en[Event]] [[インターフェイス]]を[[継承]]しています。
[[文書環境]]に[[晒され]]ています。
[DFN[[CODE(DOMi)@en[DeviceOrientationEventInit]]]] [[辞書]]は、
[CODE(DOMi)@en[EventInit]] [[辞書]]を[[継承]]しています。 [SRC[>>11]]

[18] 両者は、次の[[IDL属性]]/[[辞書メンバー]]を持ちます。
[FIG(short list)[
- [CODE(DOMa)@en[alpha]]
- [CODE(DOMa)@en[beta]]
- [CODE(DOMa)@en[gamma]]
- [CODE(DOMa)@en[absolute]]
]FIG]

[19] [DFN[[CODE(DOMa)@en[alpha]]]], [DFN[[CODE(DOMa)@en[beta]]]],
[DFN[[CODE(DOMa)@en[gamma]]]] は、 [CODE(IDL)@en[[[long]][[?][nullable]]]] 型であり、
[[辞書]]における既定値は [CODE[null]] です。 [SRC[>>11]]

[20] [DFN[[CODE[absolute]]]] は、 [CODE(IDL)@en[boolean]] 型であり、
[[辞書]]における既定値は[[偽]]です。 [SRC[>>11]]


* 処理

[12] [[DeviceOrientation Event]] に対応する[[利用者エージェント]]は、
[[装置]]の[RUBYB[方向]@en[orientation]]が変化した時、これを通知しなければ[MUST[なりません]]。
方向が[RUBYB[大きく]@en[significant]]変化した時に通知する[SHOULD[べきです]]。
「大き」いとする基準は[[実装]]依存ですが、1°の変更を最大の[[閾値]]とする[SHOULD[べきです]]。
加えて、[[Webページ]]が十分新しいデータを持っていないと判断できるときにも、
通知できます。 [SRC[>>11]]

[21] 次のようにしなければ[MUST[なりません]] [SRC[>>11]]。
[FIG(steps)[
= [22] [VAR[α]]、[VAR[β]]、[VAR[γ]]、[VAR[絶対]]を決定します。
= [14] 
@@ [VAR[窓]]を、 [CODE(DOMi)@en[Window]] に設定します。
= [13] [[イベントを発火]]します。
[FIG(list members)[
: [VAR[[[インターフェイス][イベントインターフェイス]]]] : [CODE(DOMi)@en[DeviceOrientationEvent]]
: [VAR[[[名前][イベント型]]]] : [DFN[[CODE(DOMe)@en[deviceorientation]]]]
: [VAR[[[対象][イベント対象]]]] : [VAR[窓]]
: [CODE(DOMa)@en[alpha][DeviceOrientationEvent]] : [VAR[α]]
: [CODE(DOMa)@en[beta][DeviceOrientationEvent]] : [VAR[β]]
: [CODE(DOMa)@en[gamma][DeviceOrientationEvent]] : [VAR[γ]]
: [CODE(DOMa)@en[absolute][DeviceOrientationEvent]] : [VAR[絶対]]
]FIG]
]FIG]

[32] [[装置]]の[[方向]]は、[[地球座標枠]]から[[装置座標枠]]への[[変換][変換 (数学)]]として表します
[SRC[>>11]]。

[23] [[座標]]の[RUBYB[[[変換][変換 (数学)]]]@en[transformation]]は、
[[地球座標枠]] ([VAR[X]], [VAR[Y]], [VAR[Z]]) から[[装置座標枠]] ([VAR[x]], [VAR[y]], [VAR[z]])
へと次の通り[[回転]]させるものです [SRC[>>11]]。

[FIG(steps)[
= [25] [VAR[装置座標枠]]を、[[地球座標枠]]に揃えます。
= [26] [VAR[装置座標枠]]の [VAR[z]] 軸を [VAR[α]] [[°]] [[回転]]させます。
= [27] [VAR[装置座標枠]]の [VAR[x]] 軸を [VAR[β]] [[°]] [[回転]]させます。
= [29] [VAR[装置座標枠]]の [VAR[y]] 軸を [VAR[γ]] [[°]] [[回転]]させます。
= [30] [VAR[装置座標枠]]を返します。
]FIG]

[24] [[回転]]は、[[右手系]]によります。すなわち、[[軸]]の[[正]]の[[回転]]とは、
[[軸]]の[[正]]方向をみたとき[[時計回り]]となる[[回転]]をいいます。 [SRC[>>11]]

[28] ただし、
[VAR[α]] [[∈]] [ [N[0]], [N[360]] ),
[VAR[β]] [[∈]] [ [N[-180]], [N[180]] ),
[VAR[γ]] [[∈]] [ [N[-90]], [N[90]] ) の範囲内とします。 [SRC[>>11]]

[31] すなわち、この ([VAR[α]], [VAR[β]], [VAR[γ]]) は
[[Z-X'-Y"]] 型 [[intrinsic][自転]] [[Tait-Bryan angles]] です。 [SRC[>>11]]

[33] [VAR[絶対]]は、[[地球座標枠]]基準の値を得られる場合、[[真]]とします。
それが叶わず何らかの基準を定めて用いる場合は、[[偽]]とします [SRC[>>11]]。

[34] [VAR[α]], [VAR[β]], [VAR[γ]] の値のいずれかまたはすべてが得られない場合は、
[CODE[null]] とすることができます [SRC[>>11]]。

* 歴史

[1] [CITE@en[DeviceOrientation Event Specification]]
( ([TIME[2011-06-28 16:41:24 +09:00]] 版))
<http://www.w3.org/TR/2011/WD-orientation-event-20110628/>

[2] [CITE@en[DeviceOrientation Event Specification]]
( ([TIME[2011-12-01 22:34:51 +09:00]] 版))
<http://www.w3.org/TR/2011/WD-orientation-event-20111201/>

[3] [CITE@en[DeviceOrientation Event Specification]]
( ([TIME[2012-06-14 06:21:37 +09:00]] 版))
<http://dev.w3.org/geo/api/spec-source-orientation.html>

[FIG(quote)[
[FIGCAPTION[
[4] [CITE[Intent to deprecate: Insecure usage of powerful features - Google グループ]]
([TIME[2015-02-28 11:14:59 +09:00]] 版)
<https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/2LXKVWYkOus>
]FIGCAPTION]

> We want to start applying the concepts in https://w3c.github.io/webappsec/specs/powerfulfeatures/ to features that have already shipped and which do not meet the (new, not present at the time) requirements. 

]FIG]


[5] [CITE@en[DeviceOrientation Event Specification]]
([TIME[2014-08-28 19:28:23 +09:00]] 版)
<http://w3c.github.io/deviceorientation/spec-source-orientation.html>

[6] [CITE@en[DeviceOrientation: next steps?]]
([[Mandyam, Giridhar]] 著, [TIME[2015-07-07 09:08:51 +09:00]] 版)
<https://lists.w3.org/Archives/Public/public-geolocation/2015Jul/0003.html>

[7] [CITE@en-us[Detecting device orientation - MDC]]
([TIME[2010-01-21 13:30:20 +09:00]] 版)
<https://developer.mozilla.org/en/Detecting_device_orientation>

[8] [CITE@en[DeviceOrientation Event Specification]]
([TIME[2016-08-18 00:27:48 +09:00]])
<https://www.w3.org/TR/2016/CR-orientation-event-20160818/>

[16] [CITE@en[w3c/deviceorientation: W3C Device Orientation spec]]
([TIME[2016-10-30 21:03:22 +09:00]])
<https://github.com/w3c/deviceorientation>