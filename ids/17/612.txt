* 仕様書

[REFS[
- [2] [CITE@en[RFC 6455 - The WebSocket Protocol]] ([TIME[2015-03-11 20:42:50 +09:00]] 版) <http://tools.ietf.org/html/rfc6455#section-3>
]REFS]

* 構文

[3] [[URL scheme]]、[CODE[[[://]]]]、 [[authority]]、[[path]]、
省略可能な [[query]] で構成されます。 [[query]] がある場合は、
直前に [CODE[[[?]]]] が必要です。 [SRC[>>2]]

[FIG(railroad)[
= [[URL scheme]]
= [CODE[[[://]]]]
= [[authority]]
= [[path]]
= ?
== [CODE[[[?]]]]
== [[query]]
]FIG]

[12] [[素片識別子]]を使っては[['''なりません''']] [SRC[>>2]]。

* URL scheme

[4] [[URL scheme]] は、 [CODE(URI)@en[[[ws]]]] または [CODE(URI)@en[[[wss]]]]
です [SRC[>>2]]。

[10] [CODE(URI)@en[[[wss]]]] であれば、当該 [[URL]] は[DFN[[RUBYB[「保安」]@en["secure"]]]]であり、
[DFN[[[the secure flag is set]]]] といいます [SRC[>>2]]。

* authority

[5] [[authority]] は、[[ホスト]]と、省略可能な [[port]] です。
[[port]] がある場合は直前に [CODE[[[:]]]] が必要です。 [SRC[>>2]]

[FIG(railroad)[
= [[ホスト]]
= ?
== [CODE[[[:]]]]
== [[port]]
]FIG]

[6] [[ホスト]]と [[port]] は、 [[RFC 3986]] の定義が参照されています [SRC[>>2]]。
現実には [[URL Standard]] に従い解釈されるものと思われます。

[9] [CODE(URI)@en[[[ws:]]]] の[[既定のポート]]は [CODE[[[80]]]]、
[CODE(URI)@en[[[wss:]]]] の[[既定のポート]]は [CODE[[[443]]]] です [SRC[>>2]]。

* 資源名

[7] [[path]] は、 [[RFC 3986]] [CODE(ABNF)@en[[[path-abempty]]]] です [SRC[>>2]]。

[8] [[query]] は、 [[RFC 3986]] [CODE(ABNF)@en[[[query]]]] が参照されています [SRC[>>2]]。

[11] [DFN[[RUBYB[資源名]@en[resource name]]]]は、
[FIG(list)[
= [[path]] が空なら、 [CODE[[[/]]]]
= [[path]]
= [[query]] が非空なら、 [CODE[[[?]]]]
= [[query]]
]FIG]
... を連結したものです [SRC[>>2]]。

* 妥当性

[13] [[WebSocket接続の確立]]は、 [CODE(URI)@en[[[ws:]]]]/[CODE(URI)@en[[[wss:]]]]
[[URL]] が妥当なものであるかどうか確認し、非妥当なら失敗します。

[14] どのような検査か完全に明記はされていませんが、[[素片識別子]]が含まれる場合や、
[[ポート]]が数値でない文字列の場合、[CODE[[[//]]]] が含まれない場合などが該当しそうです。

;; [15] [[WebSocket]] の [[RFC]] は [[RFC 3986]] を参照しているので[[非ASCII文字]]は使えないことになりますが、
実際には [[URL Standard]] に従い[[構文解析]]・[[正準化]]が行われた後の [[URL]]
が使われますから、[[非ASCII文字]]は[[正準化]]の段階で [[ASCII文字]]に変換されています。

* HTTP URL への変換

[16] [[WebSocket接続の確立]]は、相当する [CODE(URI)@en[[[http:]]]]/[CODE(URI)@en[[[https:]]]]
[[URL]] を使うことがあります。これは [CODE(URI)@en[[[ws:]]]]/[CODE(URI)@en[[[wss:]]]]
にそれぞれ相当するものと思われますが、明記はされていません。

* 歴史

[REFS[
- [1] [CITE@en[draft-ietf-hybi-thewebsocketprotocol - The WebSocket protocol]] 
<http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol#section-3>
]REFS]