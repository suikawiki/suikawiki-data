[4] [CODE(DOMi)@en[[[window.URL]]]] [[オブジェクト]]の [DFN[[CODE(DOMm)@en[[[createObjectURL]]]]]]
[[メソッド]]は、与えられた [CODE(DOMi)@en[[[Blob]]]] を表す [[Blob URL]]
作成し、返します。

* 仕様書

[REFS[
- [11] [CITE[File API]] ([TIME[2015-04-17 16:25:21 +09:00]] 版) <https://w3c.github.io/FileAPI/#dfn-createObjectURL>
]REFS]

* 処理

[12] 次のようにしなければ[['''なりません''']] [SRC[>>11]]。
[FIG(steps)[
= [13] [CODE(DOMi)@en[[[Blob]]]] が1つ[[引数]]として指定されたものと解釈します。
= [14] 指定された [CODE(DOMi)@en[[[Blob]]]] の[[読み取り可能性状態]]が [CODE[[[CLOSED]]]] なら、
== [16] 指定された [CODE(DOMi)@en[[[Blob]]]] の [[Blob URLのUnicode直列化]]を返します。
= [15] そうでない場合、
== [21] 指定された [CODE(DOMi)@en[[[Blob]]]] の [[Blob URLのUnicode直列化]]を得ます。
== [18] [[Blob URL Store]] に項目を追加します。
[FIG(list members)[
:[[URL]]:得られた [[URL]]
:[CODE(DOMi)@en[[[Blob]]]]:指定された [CODE(DOMi)@en[[[Blob]]]]
]FIG]
== [17] 得られた [[URL]] を返します。
]FIG]

;; [19] [CODE[[[CLOSED]]]] の場合、 [[URL]] は返されますが、
[[Blob URL Store]] には追加されていませんから、参照しても[[ネットワークエラー]]になります。

* テストケース

[10] デモ:

[REFS[
- [3] [CITE[window.URL.createObjectURL]] ([TIME[2011-09-19 20:09:05 +09:00]] 版) <http://suika.fam.cx/~wakaba/-temp/test/dom/url/createobjecturl-1.html>
]REFS]

* 関連

[5] [[URL]] を破棄する [CODE(DOMm)@en[[[revokeURLObject]]]] [[メソッド]]もあります。

[20] [CODE(DOMm)@en[[[createFor]]]] とは違って、[[自動revoke]]は行われません。

;; [22] とはいえ[[文書のunload]]が行われる時には結局すべて破棄されます。
[[文書]]が [[unload]] されずに開かれ続けるなら[[メモリリーク]]ですが、
そうでなければ致命的な問題というわけではありません。


* 歴史

[6] [[Firefox]] 4 以降で [[prefix]] 無しで実装されています。

[REFS[
- [7] [CITE@en[Using files from web applications - MDN]] ([TIME[2011-09-19 19:56:34 +09:00]] 版) <https://developer.mozilla.org/en/Using_files_from_web_applications#Using_object_URLs>
]REFS]

[8] [[WebKit]] では [CODE(DOMi)@en[[[window.webkitURL]]]] で [[prefix]] 無しで実装されています。

[1] [[Firefox]] ではこんな値になりました [TIME[2011-09-19T11:10:32.200Z]]:
[PRE(URI example code)[
moz-filedata:71f89f18-c11d-496c-83c9-f24da88689a5
]PRE]

[2] [[Chrome]] ではこんな値になりました [TIME[2011-09-19T11:10:59.500Z]]
[PRE(URI example code)[
blob:http://suika.fam.cx/6ff6e0e9-51d5-41e2-8752-411cbfc3fc7a
]PRE]

;; [[起源]]を [[URL]] 内に入れておきたいという意図かな。

[9] [CITE@en[''''''[''''''FileAPI'''''']'''''' createObjectURL isReusable proposal]]
( ([[Adrian Bateman]] 著, [TIME[2011-12-14 09:52:04 +09:00]] 版))
<http://lists.w3.org/Archives/Public/public-webapps/2011OctDec/1499.html>

* メモ

[23] [[イベントハンドラー内容属性]]では [CODE[URL]] が [CODE(JS)@en[[[document.URL]]]]
と解釈されてしまうので、
[FIG[
[PRE(HTML example code)[
<p onclick=" window.URL.createObjectURL (...) ">
]PRE]
]FIG]
... のように [CODE(JS)@en[window.]] を補う必要があります。