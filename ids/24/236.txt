* 仕様書

[REFS[
- [1] '''[CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-04-25 04:40:19 +09:00]] 版) <https://html.spec.whatwg.org/#discard-a-document>'''
- [3] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-04-25 04:40:19 +09:00]] 版) <https://html.spec.whatwg.org/#unloading-document-cleanup-steps>
- [2] [CITE[File API]] ([TIME[2015-04-17 16:25:21 +09:00]] 版) <https://w3c.github.io/FileAPI/#BlobURLStore>
]REFS]

* 文書を捨てる

[7] [[閲覧文脈]]が[DFN[[RUBYB[[[文書]]を捨てる]@en[discard a [CODE(DOMi)@en[Document]]]]]]際は、次のようにしなければ[['''なりません''']] [SRC[>>1]]。
[FIG(steps)[
= [[文書]]の [[''salvageable'']] を[[偽]]に設定します。
= [[unloading document cleanup steps]] を実行します。
= [[文書のabort]]を実行します。
= [[文書]]に関連付けられた[[タスク]]をすべて実行せずに削除します。
= [[文書]]の[[子供閲覧文脈]]すべてを、[[閲覧文脈を捨てる]]こととします。
= [[文書]]の[[閲覧文脈]]から[[文書]]への[[強い参照]]を破棄します。
]FIG]

* unloading document cleanup steps

[4] [DFN[[[unloading document cleanup steps]]]] とは、次のものです。

[FIG(steps)[
= [[文書]]の [CODE(DOMi)@en[[[Window]]]] の [CODE(DOMi)@en[[[WebSocket]]]] [[コンストラクター]]から作られた [CODE(DOMi)@en[[[WebSocket]]]] があれば、
== そのすべての [[make disappear]] を実行します [SRC[>>3]]。
== [[文書]]の [[''salvageable'']] を[[偽]]に設定します [SRC[>>3]]。
= [[文書]]の [[''salvageable'']] が[[偽]]なら、
== [[文書]]の [CODE(DOMi)@en[[[Window]]]] の [CODE(DOMi)@en[[[EventSource]]]] [[コンストラクター]]から作られた [CODE(DOMi)@en[[[EventSource]]]] があれば、そのすべての [[forcibly close]] を実行します [SRC[>>3]]。
== [[文書]]の [CODE(DOMi)@en[[[Window]]]] の[[活性タイマーのリスト]]を空にします [SRC[>>3]]。
= [[文書]]の [[Blob URL Store]] の [[Blob URL]] をすべて削除します [SRC[>>2]]。
]FIG]

;; [5] [[ワーカー]]はこの手順では破棄されません。

;; [6] [[WebRTC]] でも同様の処理が必要でしょうか?

* 歴史

[33] [CITE@en[Bug 12837 – Define unloading document cleanup steps]]
([TIME[2015-05-05 19:49:05 +09:00]] 版)
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=12837>