* 仕様書

[REFS[
- [1] [CITE@en[RFC 6455 - The WebSocket Protocol]] ([TIME[2015-03-11 20:42:50 +09:00]] 版) <http://tools.ietf.org/html/rfc6455#section-5>
-- [2] '''[CITE@en[RFC 6455 - The WebSocket Protocol]] ([TIME[2015-03-11 20:42:50 +09:00]] 版) <http://tools.ietf.org/html/rfc6455#section-5.6>'''
- [11] [CITE@en[RFC 6455 - The WebSocket Protocol]] ([TIME[2015-03-11 20:42:50 +09:00]] 版) <http://tools.ietf.org/html/rfc6455#section-6>
- [14] [CITE@en[RFC 6455 - The WebSocket Protocol]] ([TIME[2015-03-11 20:42:50 +09:00]] 版) <http://tools.ietf.org/html/rfc6455#section-8>
]REFS]

* 意味

[4] [DFN[[RUBYB[[[データフレーム]]]@en[data frame]]]]は、[[応用]]や[[拡張]]のデータを伝搬するものです [SRC[>>2]]。

[5] [DFN[[RUBYB[テキストフレーム]@en[text frame]]]]は、[[テキスト]]データを表します。

[6] [DFN[[RUBYB[バイナリーフレーム]@en[binary frame]]]]は、[[バイナリー]]データを表します。

* 構文

[3] [CODE[[[opcode]]]] は、[[テキストフレーム]]が [CODE[[[1]]]]、
[[バイナリーフレーム]]が [CODE[[[2]]]] です。また[[継続フレーム]]は [CODE[[[0]]]]
です ([[WebSocketフレーム]]を参照)。 [CODE[0x3]]-[CODE[0x7]] は、予約されています。 [SRC[>>2]]

[8] [[テキストフレーム]]の[[payload data]] は、 [[UTF-8]] 符号化されたテキストデータです。
個別の[[フレーム]]のデータは [[UTF-8]] データの一部分かもしれませんが、
全体としては妥当な [[UTF-8]] バイト列となっていなければ[['''なりません''']]。 [SRC[>>2]]

[10] [[バイナリーフレーム]]の [[payload data]] は、任意の[[バイナリー]]データです。
解釈は[[応用]]に委ねられます。 [SRC[>>2]]

;; [9] [[拡張データ]]も[[テキスト]]または[[バイナリー]]に指定されるということなのでしょうか?

* 文脈

[7] [[クライアント]]も[[サーバー]]も、[[WebSocket接続の確立]]の後、
[[[CODE(HTTP)[Close]]フレーム]]を送信するまで、任意の時機に[[データフレーム]]を送信できます
[SRC[>>1]]。

* 送信

[12] [[WebSocket接続]]において[DFN[[RUBYB[WebSocketメッセージ送信]@en[Send a WebSocket Message]]]]するには、
次のようにしなければ[['''なりません''']] [SRC[>>11]]。
[FIG(steps)[
= 送信するデータを含む単一の[[フレーム]]または[[断片化]]された[[フレーム]]群を作成します
([[WebSocketフレーム]]参照)。最初の[[フレーム]]の [CODE[[[opcode]]]] は、
データの種別により、[[テキストフレーム]]または[[バイナリーフレーム]]とします。
= 送信元が[[クライアント]]であれば、[[マスク]]します ([[WebSocketフレーム]]参照)。
= [[WebSocket拡張]]を用いる場合は、その規定に従い適宜処理します。
= [[フレーム]](群)を転送します。
]FIG]

[13] [[WebSocket接続]]の状態が [CODE[[[OPEN]]]] でなければ (なくなれば)、
この手順は停止しなければ[['''なりません''']] [SRC[>>11]]。

* 処理

[15] [[UTF-8]] データが妥当でない時は、[[WebSocket接続失敗]]としなければ[['''なりません''']]
[SRC[>>14]]。
