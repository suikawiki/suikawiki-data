[1] [[Webブラウザー]]には、[[文字コード]]の指定のためのメニューがあるのが普通でした。


* 概要

[2] [[文字コード指定メニュー]]は、
[[文字コード]]を選択して[[再読込]]を実行するものです。

;; [4] [[HTTPヘッダー]]や[[HTML文書]]内の[[文字コード]]の指定は、無視されます。

[11] 変更のためのメニューとしてはもちろん、
[[文書の[F[文字符号化]]]]を[[利用者]]に提示するための欄としても機能していました。
[TIME[西暦1990年代]]は
[[Webブラウザー]]の一般[[利用者]]も最低限の[[文字コード]]の知識が必要な時代でした。

[23] 
現在では主要な[[Webブラウザー]]がこのメニューを廃止してしまいました。
そのため古くからある一部の[[Webページ]] (稀に近年作られたごく一部の
[[Webページ]])
が[[文字コード]]を誤判定して[[文字化け]]して表示されても、
一般の[[利用者]]が修正することすらできなくなってしまいました。

[24] 
明らかに [[Web非互換]]で有害な変更であるにも関わらず、
主要な [[Webブラウザー事業者]]らは廃止を強行し、
被害を無視しています。

* 挙動

[3] 実際の処理はどの仕様でも規定されていませんが、 [[HTML構文解析器]]における
[[change the encoding]] による [[navigate]] に相当する操作
(当該ページ読み込みに使ったデータを使った読み込み、
またはそれができない場合同じ [[fetch]] 条件を使った読み込みを
[[a known definite encoding]] 指定付きで実行) することが期待されていると思われます。

;; [5] [[HTML文書]]に限らず、[[XML文書]]や[[テキストファイル]]にも適用されます。

[10] 適用対象は[[文書]]だけであり、 [[XHR]] や
[[JavaScript]] ファイルや [[CSS]] ファイルなどには適用されません。
(ただし明示されないとき既定値が[[文書の[F[文字符号化]]]]になることで間接的に適用される場合はあります。)



[31] 
[[Chrome]] では、[[利用者]]が手動で[[文字コード]]を指定すると、
以後その[[タブ]]では ([[著者]]による明示的な指定があっても無視して)
その指定に従うようです。他の[[タブ]]には伝播しません。
[[起源]]の違いにも左右されないように見えます。 [TIME[2015-08-28T03:35:12.500Z]]




* 選択肢の提示

[32] 
[[GUI]] 系の古典的な [[Webブラウザー]]の多くは、「表示」などのメニュー項目の下に、
対応している[[文字コード]]の一覧を提示してそこから選択させていました。

[33] 
何に対応するか、そのうち何を表示するかは完全に [[Webブラウザー]]次第で、
動作する [[OS]] 等によっても異なることがありました。

;; [34] 何らかの設計思想により、例えば [[ISO-2022-JP]] は自動判定を信用し、
自動的に選択されている場合以外は手動で選択できなくする、という制限を加えている実装もありました。

[35] 
ただこの実装方法は[[利用者]]に[[文字コード]]の深い知識がなければ正しい選択が困難です。

[36] 
[[charset sniffing]] 等の知識によって候補となる[[文字コード]]を絞り込んで優先的に表示し、
それ以外も必要なら選択できるようにするのが好ましいでしょう。

-*-*-

[46] 
[[フレーム]]内の[[文書]]の場合は、[[フレーム]]外の[[文書]]とは独立して[[文字コード]]を修復したいことがあります。
[[Webブラウザー]]は、
[[右クリック]]の[[文脈メニュー]]などの手段で[[フレーム]]単位で[[文字コード指定メニュー]]を提供する必要があります。

[47] 
[[フレーム]]外の[[文書]]の[[文字コード指定メニュー]]は、必ずしもすべての[[子孫]]の[[フレーム]]にその効果を波及させる必要はないと考えられますが、
[[環境符号化]]としての伝播があった場合は[[フレーム]]外の[[再読み込み]]によって自動的に[[子孫]]も指定された[[文字コード]]に変更されるのが適切な動作でしょう。

-*-*-

[44] 
[[CLI]] のツールや[[プログラミング言語]]の[[ライブラリー]]などは、
呼び出し時の[[オプション]]等の方法で[[文字コード]]を指定できるようになっていることが多いです。
[[対話的]]ではないとしても、[[文字コード指定メニュー]]と同等の機能を提供するものといえます。
[SEE[ [[encoding sniffing algorithm]] ]]

[45] 
その他の種類の[[利用者エージェント]]や[[Webブラウザー]]も、それぞれの[[媒体]]に適した[[利用者インターフェイス]]により、
同等の機能を提供する必要があります。

-*-*-

[6] [[文字コード]]を誤認識することによる[[脆弱性]]を発生させることを意図した攻撃を防ぐため、
[[UTF-7]] など危険性の高い[[文字コード]]を候補に含めることは望ましくないと考えられています。
また近年では[[文字コード]]の誤認識を[[利用者]]が修正せざるを得ない状況は減ってきており、
[[Webブラウザー]]上の[[文字コード指定メニュー]]の扱いも小さくなっています。

[8] 歴史的には大量の[[文字コード]]の選択肢を並べるのが一般的でした。

[7] 現在では、 [CITE[Encoding Standard]] で規定されている[[文字符号化]]
([[replacement]] を除く。) を基礎に、
[CITE[Encoding Standard]]
が対応しきれていない地域の[[文字コード]]を若干補った程度のもののみを候補に挙げるのが好ましいと考えられます。

[9] 他に「自動判定」や「自動判定 (日本語)」や「自動判定 (ロシア語)」
が必要かもしれません。

[16] 
その後時代が進み、[[サーバー]]が [CODE[UTF-8]] を機械的に
[CODE[Content-Type:]] に指定することが増えたため、
古くからある[[HTML文書]]や[[テキストファイル]]の実際の[[文字コード]]と食い違うケースが散見されるようになりました。
現代ではこれを無視させるために[[文字コード指定メニュー]]の需要がむしろ高まっています。


* メニュー廃止の被害

[22] 
[[平成時代]]後期から[[令和時代]]初期の頃になって、 主要な [[Webブラウザー]]は次々と[[文字コード指定メニュー]]を[[廃止]]してしまいました。

[84] 
それによる被害報告が多くありますが、 [[Webブラウザー事業者]]らは黙殺しています。

[29] 
今となっては[[文字化け]]する [[Webページ]]の絶対数は少ないので、
無視し続ければ過去の遺産として無かったことにできると考えているのでしょう。

[85] 
実事例は[[Webブラウザーによる文字コード判定の失敗事例集]]参照。

-*-*-

[60] 
いつのまにか [[Chrome]] の[[文字コード]]選択メニューがなくなって、
[[文字化け]]しているページを正しく表示する方法がなくなってしまった。。。
[TIME[2017-11-06T15:33:49.600Z]]



[81] 
[CITE@en[No way to see UTF-8 file '''['''41308220''']''' - Chromium]], [TIME[2025-11-08T11:46:37.000Z]] <https://issues.chromium.org/issues/41308220>


[14] 
[[Firefox]] の文字コード指定メニューなくなっちゃった?
[[Firefox]] の [[Chrome]] に対する数少ない優れた点を削ってどうすんのよ。。。
[TIME[2021-07-05T10:06:16.100Z]]

[17] 
[[Internet Archive]] で[[90年代]]東アジアのウェブサイトがまともに表示できないところが多くて辛い。。。
当時からブラウザーの文字コードメニューで文字化けを治すのが普通の操作みたいになってたようなあれだから、
ブラウザーにメニューがなくなって自動判定も働かない (or 間違った文字コード指定がついてる)
ともうお手上げなんだよなあ。

[18] 
近年の[[Webプラットフォーム]]開発の人達は[[Web互換性]]を忘れてしまったみたいで、
これじゃあ百年後に昔のウェブサイトは見れなくなるんじゃないかと思っていたけど、
もう既に20年前のウェブページがまともに見れなくなってしまったんだよなあ。

[19] 
[[Internet Archive]] にしかないサイトはまあ仕方がないとしても、
現役サイトでも長年放置されてるところが表示できなくなってるのは困りもの。

;; [20] 意外と[[Google検索]]ではちゃんと文字コード判定できてて、
[[Google検索]]に出てくるのに[[Chrome]]で表示できないとかいう地獄。
[TIME[2022-10-19T09:38:55.000Z]]

[21] 
ちょっと前までは [[Chrome]] で見れなくても [[Firefox]] なら文字コードメニューで表示できたのに。
[[Firefox]] はただでさえシェアが減ってるのに存在意義を自ら削ってるのやばいだろ。

-*-*-

[25] 
こういう[[非互換変更]]を強行した 
[[Webブラウザー事業者]]の主要開発者らはほとんど欧米人で、
もう[[文字化け]]は遠い昔の記憶になってしまっているんですよねえ。
[[アジア]]ではまだたまに遭遇する身近な事象だというのに。
こういうのも一種の[[欧米中心主義]]なのでしょうか。

[30] 
[[欧米人]]にとっては[[文字化け]]が仮にあるとしても一部の文字だけで、
ほとんどの [[ASCII文字]]は読めてしまいますからね。
[[アジア]]のように言語の[[文字]]の大部分が関係ない[[文字]]に見えるという状況を体験していないのでしょう。

[26] 
まあそういう無意識的な偏見だけでなく、
古いものはとっとと捨ててしまえという
[[IT業界]]の悪習から来てる所はありそうですよね。

[27] 
古いページが残っていても新しいものはどんどん増えていき、
新しいものの方が参照されやすいという局所性と相まって、
古いページが見られる割合はどんどん下がっていく
(が皆無になるわけではないし、希少性が上がるということは貴重になるということでもある)
のに、
割合が低いから切り捨ててもいいという判断を
[[Webブラウザー事業者]]が安易にしすぎるところがよろしくない。
近年の傾向だと特に [[Google]] の従業員はそういうところがあり、
[[Mozilla]] はそうでもないが何年かして結局最後に [[Google]] 
に追随する感がある。

[28] 
[[文字コード変更メニュー]]の場合あって困ることないんだから、
[[Firefox]] には残しておいた方が [[Firefox]] でないと正しく表示されないページがあります、って優位性のアピールに使えるのにねえ。
自分たちで必要な機能を削っておいて、 [[Firefox]] のシェアが減って困ってます、っていわれてもな。
自業自得やん。こっちはもっと困ってるんだよ。

;; [68] 最近良く見かけるパターンは、[[平成時代]]初期、中期くらいに作られた頁で、
最近管理者が設定変更したのかサーバー実装が変更にでもなったのか、
[CODE[[[charset]]=[[UTF-8]]]] が一律で付与されているパターン。
[[HTML]] にはそれと矛盾している [CODE[charset]] が明記されているケースもあるし、
されていないケースもある。当時は [[HTTP]] [CODE[charset]] なしでも
[CODE[meta]] ないし自動判定でうまくいっていたか、
万一誤判定されても容易に[[文字コード変更メニュー]]で修復できた。
今はどうにもならない。
[[著者]]は古い頁を頻繁に見に来ているわけではないから気づいていないのだろうし、
場合によっては[[著者]]が死亡していてサーバー上の頁だけが残存していることだってある。
しかし [[Webブラウザー事業者]]には人の心がないのでそんなものは
Web 上の割合のごくわずかだからと切り捨ててしまうのである。

;; [69] こんなことになるくらいなら [CODE[charset=[[UTF-8]]]] は無指定とみなしてほしい。
勝手に機械的にデフォルトで設定するなら意味がないのだから。それが嫌なら[[文字コード変更メニュー]]くらい実装しろよ糞ブラウザー


[48] [CITE[Hong Kong IBM]], [TIME[2025-11-26T04:38:31.000Z]], [TIME[1999-11-10T08:17:32.257Z]] <https://web.archive.org/web/19991110081712/http://www.hk.ibm.com/>

[49] >>48 [[Big5]]。 [CITE[Firefox]] は [[windows-874]],
[CITE[Chrome]] は [[gbk]] と誤認。





* 歴史

[12] [[参照処理モデル]]確立以前の [[Webブラウザー]]はシステムの文字コードで表示するのが基本で、
優れた実装はそれ以外にも沢山の[[文字コード]]を変換して表示できるという世界でした。

[13] それすら不完全で、例えば[[日本語]]の [[Windows]] 版 [[Netscape Navigator]]
の[[文字コード指定メニュー]]には世界各地のいろいろな[[文字コード]]が示されてはいましたが、
[[ISO 8859-1]] を選んでも[[シフトJIS]]で[[ビット組合せ]]が同じ[[半角カナ]]が[[表示される][文字化け]]という有様でした。

[897] [CITE@en[943252 – Move nsCharsetMenu and charsetTitles.properties to comm-central]]
( ([TIME[2014-01-08 20:49:42 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=943252>







[38] 
[CITE@en[Character Encoding Menu in 2014]], [[Henri Sivonen]], [TIME[2021-01-18T07:54:59.000Z]], [TIME[2025-05-16T10:10:09.228Z]] <https://hsivonen.fi/encoding-menu/>

[37] 
[CITE@en[Text Encoding Menu in 2021]], [[Henri Sivonen]], [TIME[2021-08-24T14:12:16.000Z]], [TIME[2025-05-16T10:09:44.331Z]] <https://hsivonen.fi/encoding-menu-2021/>



[39] [CITE@en[The Text Encoding Submenu Is Gone]], [[Henri Sivonen]], [TIME[2021-08-24T13:53:33.000Z]], [TIME[2025-05-16T10:10:28.784Z]] <https://hsivonen.fi/no-encoding-menu/>


[40] 
>>39 完全になくなったと思いきやかわりの機能が追加されてた。しかし隠されてて気づくはずがない。


[41] >>39

>If we removed the feature, we’d remove a reason for these users to stay with Firefox. Safari and Gnome Web still have more elaborate encoding override UI built in (the list of encodings in both is questionably curated but the lists satisfy the Japanese use cases), and there are extensions for Chrome.


これわかってるのに敢えて削除するんだからもう [[Firefox]] 
は顧客の需要を勘案する気がないってことだよね。そりゃあシェアが減る一方だよ。



[42] 
計測したらあんまり使われていないし上手く使われていませんでした、って当たり前じゃんね。新しいサイトは問題ないんだから。
たまにしか遭遇しないんだから。
日常から使い慣れてるとしたらこの30年は何だったんだって話だよ。


[43] [CITE[【Google Chrome】文字化けで困った時は、テキストエンコーディングを使おう|かげさんの111から始まるHistory]], [TIME[2025-05-21T12:23:44.000Z]] <https://kage3.cocolog-nifty.com/blog/2019/12/post-fb8610.html>






[15] >>40 その代わりの「修復」機能、それが効くのは運が良いごく一部の場合だけで、
使えないことの方が多いです。ないよりましだけど、あるからといって元の問題の解決に全然なっていない、
対処しましたアピールにしかなっていない無駄開発。最初からメニューをなくさなければこんな問題にはならなかったのに。
[SEE[ [[Webブラウザーによる文字コード判定の失敗事例集]] ]]
