* 仕様書

[REFS[
- [1] [CITE@en[RFC 7540 - Hypertext Transfer Protocol Version 2 (HTTP/2)]] ([TIME[2015-05-15 10:14:54 +09:00]] 版) <https://tools.ietf.org/html/rfc7540#section-6.7>
]REFS]

* 意味

[2] [CODE[[[PING]]]] [[フレーム]] ([[フレーム型]] [CODE[[[0x6]]]])
は、[[送信者]]からの最小 [[RTT]] を計測したり、
[[idle]] [[接続]]がまだ機能するか判断したりするためのものです [SRC[>>1]]。

* 構文

[10] [[ストリーム識別子]]は [CODE[[[0x0]]]] でなければなりません。
[CODE[[[PING]]]] [[フレーム]]は[[ストリーム]]に関連付けられません [SRC[>>1]]。

[7] 次の[[フラグ]]があります。

[8] [CODE[[[ACK]]]] ([CODE[[[0x1]]]] = 第0ビット) は、
設定されていれば、[CODE[[[PING]]]] [[応答]]であることを表します。 [SRC[>>1]]

[14] 返信以外で [CODE[[[ACK]]]] フラグ付きの [CODE[[[PING]]]] [[フレーム]]を送信しても良いのかどうかは不明です。

[FIG(packet)[
:width:8

= 1 [CODE[[[ACK]]]]
= 1 0
= 1 0
= 1 0
= 1 0
= 1 0
= 1 0
= 1 0
]FIG]

[4] [[payload]] は、8バイトの[RUBYB[不透明データ]@en[opaque data]]を含まなければ[['''なりません''']]。
[[送信者]]は任意の値を選ぶことができ、任意の形で使うことができます。
[CODE[[[PING]]]] [[応答]]の場合は、返信元となる[[フレーム]]と同じ
[[payload]] データを含まなければ[['''なりません''']]。 [SRC[>>1]]

[FIG(packet)[
:width:32

= 32 不透明データ
]FIG]

* 文脈

[3] [CODE[[[PING]]]] [[フレーム]]は、どちらの[[エンドポイント]]からも送ることができます
[SRC[>>1]]。

* 処理

[11] [CODE[[[PING]]]] [[フレーム]]の[[ストリーム識別子]]が [CODE[[[0x0]]]]
でなければ、 [[接続エラー]] [CODE[[[PROTOCOL_ERROR]]]] としなければ[['''なりません''']]
[SRC[>>1]]。

[12] [CODE[[[PING]]]] [[フレーム]]の [[payload]] の長さが 8 でなければ、
[[接続エラー]] [CODE[[[FRAME_SIZE_ERROR]]]] としなければ[['''なりません''']] [SRC[>>1]]。

[5] [CODE[[[ACK]]]] フラグの設定されていない [CODE[[[PING]]]]
[[フレーム]]を受信したら、 [CODE[[[ACK]]]] [[フレーム]]を設定した
[CODE[[[PING]]]] ([CODE[[[PING]]]] 応答) を送信しなければ[['''なりません''']]。 [[payload]]
は同じでなければ[['''なりません''']]。 [SRC[>>1]]

[9] [CODE[[[PING]]]] [[応答]]に返信しては[['''なりません''']] [SRC[>>1]]。

[6] [CODE[[[PING]]]] 応答は、他の[[フレーム]]より高い優先度とする[['''べきです''']] [SRC[>>1]]。

* セキュリティー

[16] [CODE[[[PING]]]] [[フレーム]]の送信頻度や [[payload]] の値は、
実装方法次第で [[fingerprinting vector]] となるかもしれません。

* 関連

[13] [[WebSocket]] には [[Pingフレーム]]と [[Pongフレーム]]があります。

[15] [[HTML]] の [CODE(HTMLa)@en[[[ping]]]] [[属性]]や [[HTTP]]
の [CODE(HTTP)@en[[[Ping-From:]]]]/[CODE(HTTP)@en[[[Ping-To:]]]] [[ヘッダー]]とは無関係です。
