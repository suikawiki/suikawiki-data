* 仕様書

[REFS[
- [2] [CITE@en[RFC 7540 - Hypertext Transfer Protocol Version 2 (HTTP/2)]] ([TIME[2015-05-15 10:14:54 +09:00]] 版) <https://tools.ietf.org/html/rfc7540#section-5.3>
]REFS]

* 意味

[6] [[エンドポイント]]は、送信能力が限られる時に送信する[[ストリーム]]を選ぶために[[優先度]]を使うことができます。 [SRC[>>2]]

[5] [[エンドポイント]]は、[[優先度]]付けにより、
[[peer]] が[[並行]]する[[ストリーム]]の中で本[[ストリーム]]に[[資源]]を割り当てる際にどの程度優先するべきかを表明できます。 [SRC[>>2]]

[8] 明示的に[[優先度]]を設定すると、[[優先度]]付けの入力として使われますが、
他の[[ストリーム]]に対する相対的な[[ストリーム]]の転送処理順序を保証するわけではありません。
[[優先度]]の表明は提案に過ぎません。 [SRC[>>2]]

* 設定

[3] [[クライアント]]は、[[ストリーム]]を開く [COCDE[[[HEADERS]]]]
[[フレーム]]に優先度情報を含めることで、新しい[[ストリーム]]に[[優先度]]を設定できます
[SRC[>>2]]。

[4] [CODE[[[PRIORITY]]]] [[フレーム]]を送信することで、[[ストリーム]]の[[優先度]]を変更できます。
[[依存性]]を設定することにより、当該[[ストリーム]]が指定された[[ストリーム]]の[[依存ストリーム]]となります。 [SRC[>>2]]

[9] [[優先度]]情報はメッセージから省略することができ、
既定値が使われます [SRC[>>2]]。

* 依存性

[10] [[ストリーム]]には、他の[[ストリーム]]への[RUBYB[[[依存性]]]@en[dependency]]を明示的に指定できます。
[[依存性]]を含めることは、 ([[依存ストリーム]]にではなく) 指定された[[ストリーム]]へと[[資源]]を割り当てたいことを表明します。 [SRC[>>2]]

[11] 他の[[ストリーム]]に依存しない[[ストリーム]]は、[[ストリーム]] [CODE[0x0]]
に依存するものとします。[[ストリーム]] [CODE[0x0]] は[[依存性]]の[[木]]の[[根]]となります。
[SRC[>>2]]

[12] 他の[[ストリーム]]に依存する[[ストリーム]]は、[DFN[[RUBYB[依存ストリーム]@en[dependent stream]]]]です。
他の[[ストリーム]]に依存されている[[ストリーム]]は、
[DFN[[RUBYB[[[親ストリーム]]]@en[parent stream]]]]です。 [SRC[>>2]]

[14] ある[[ストリーム]]が他の[[ストリーム]]に[[依存性]]を割り当てると、
元の[[ストリーム]]が他の[[ストリーム]]の[[親ストリーム]]となります。 [SRC[>>2]]

[16] [[依存性]]の挿入時に[RUBYB[排他的]@en[exclusive]]フラグを設定すると、
その[[ストリーム]]が[[親ストリーム]]の唯一の[[依存ストリーム]]となり、
元の[[依存ストリーム]]は (あれば) 挿入された[[ストリーム]]の[[依存ストリーム]]となります。
[SRC[>>2]]

[15] 同じ[[親ストリーム]]を持つ[[依存ストリーム]]は、
互いに順序を持ちません。 [SRC[>>2]]

[13] [[木]]に属さない[[ストリーム]] ([[idle]] 状態の[[ストリーム]]など)
は、[[既定優先度]]となります [SRC[>>2]]。

[7] [[親ストリーム]]が[RUBYB[再優先度付け]@en[reprioritize]]されると、
[[依存ストリーム]]も[[親ストリーム]]と共に移動します [SRC[>>2]]。

[18] [[ストリーム]]が自身に依存することはできず、
[[ストリームエラー]] [CODE[[[PROTOCOL_ERROR]]]] としなければ[['''なりません''']]。
[SRC[>>2]]

[19] 祖先の[[ストリーム]]を[[依存ストリーム]]に依存させる場合は、
まずその祖先[[ストリーム]]の[[依存ストリーム]]をその祖先[[ストリーム]]の[[親ストリーム]]へと移動してから、
その祖先[[ストリーム]]の移動を行います。
[[依存性]]の移動を行っても、[[重み]]は変わりません。 [SRC[>>2]]

* 資源の割り当て

[17] [[依存性]]木における[[依存ストリーム]]には、
その[[親ストリーム]]や[[祖先]]のすべてが閉じられるか、
それ以上の進捗ができなくなったかの場合に限り、
[[資源]]を割り当てる[['''べきです''']] [SRC[>>2]]。

* 重み

[20] [[依存ストリーム]]は、 1 [[以上]] 256 [[以下]]の[[整数]]の[DFN[[RUBYB[重み]@en[weight]]]]が割り当てられます [SRC[>>2]]。 

[21] 同じ[[親ストリーム]]を持つ[[ストリーム]]には、
[[重み]]の比率によって[[資源]]を割り当てる[['''べきです''']] [SRC[>>2]]。

* 歴史

[REFS[
- [1] [CITE@en[Say something rather vague about priority to at least acknowledge it … · whatwg/fetch@600ccb7]]
([TIME[2015-05-11 11:23:34 +09:00]] 版)
<https://github.com/whatwg/fetch/commit/600ccb7e4279a2c795cbba1c93edc53f8a14db03>
]REFS]