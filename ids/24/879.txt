[24] [DFN[[CODE(DOMi)@en[[[Worker]]]]]] [[インターフェイス]]は、
[[専用ワーカー]]を作成し、通信するための [[API]] を提供するものです。

;; [25] [[ワーカー]]一般については[[ワーカー]]の項を参照。

* 仕様書

[REFS[
- [2] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#worker>
]REFS]

* 状態

[1] [CODE(DOMi)@en[[[EventTarget]]]] の状態に加えて、次の状態があります。
[FIG(list members)[
:関連付けられた[[ワーカー]]:
:暗黙の [CODE(DOMi)@en[[[MessagePort]]]]:
]FIG]

* 構築子

[3] [CODE(DOMi)@en[[[Worker]]]] [[構築子]]は、次のようにしなければ[['''なりません''']]
[SRC[>>2]]。
[FIG(steps)[
= [4] [CODE(DOMi)@en[[[DOMString]]]] の[[引数]]が1つ指定されたと解釈します。
= [5] [[利用者エージェント]]の方針次第で [CODE(JS)@en[[[SecurityError]]]]
[[例外]]を[[投げ]]て停止しても構いません。
= [6] [[引数]]に、
[[入口設定群オブジェクト]]の[[API基底URL]]に関して[[URLの解決]]を適用します。
= [7] 失敗なら、 [CODE(DOMe)@en[[[SyntaxError]]]] [[例外]]を[[投げ]]て停止します。
= [8] [[URL scheme]] が [CODE(URI)@en[[[data:]]]] ''以外''で
[[URLの起源]]が[[現職設定群オブジェクト]]の[[起源]]と[[同じ起源]]でないなら、
== [9] [CODE(DOMe)@en[[[SecurityError]]]] [[例外]]を[[投げ]]て停止します。
= [10] 新しい [CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]] を作成します。
= [11] [[ワーカー環境設定群オブジェクトを設定]]し、
[[環境設定群オブジェクト]]を得ます。解決して得られた [[URL]]
と作成した [CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]] を使います。
= [12] [CODE(DOMi)@en[[[Worker]]]] を作成します。
= [13] [CODE(DOMi)@en[[[Worker]]]] と [CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]]
を関連付けます。
= [14] [CODE(DOMi)@en[[[MessagePort]]]] を作成します。
[[所有者]]は[[現職設定群オブジェクト]]とします。 [CODE(DOMi)@en[[[Worker]]]] と関連付けます。
= [15] [CODE(DOMi)@en[[[MessagePort]]]] を作成します。
[[所有者]]は先程得られた[[環境設定群オブジェクト]]とします。
[CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]] と関連付けます。
= [16] 両ポートを [[entangle]] します。
= [17] [CODE(DOMi)@en[[[Worker]]]] を返します。
]FIG]

[18] 更に、[[並列に]]、次のようにしなければ[['''なりません''']] [SRC[>>2]]。
[FIG(steps)[
= [19] 最初の [CODE(DOMi)@en[[[MessagePort]]]] の [[port message queue]]
を有効にします。
= [20] [[現職設定群オブジェクト]]から [[relevant [CODE(DOMi)@en[Document]] objects to add]]
を得て、 [CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]] の[[ワーカーの[CODE(DOMi)@en[Document]]群]]に追加します。
= [21] [[現職設定群オブジェクト]]の[[大域オブジェクト]]が
[CODE(DOMi)@en[[[WorkerGlobalScope]]]] なら、
== [22] [[現職設定群オブジェクト]]の[[大域オブジェクト]]の[[ワーカーのワーカー群]]に [CODE(DOMi)@en[[[DedicatedWorkerGlobalScope]]]] を追加します。
= [23] 解決して得られた [[URL]] と先程作成した[[環境設定群オブジェクト]]、
[[現職設定群オブジェクト]]の [[referrer source]] を使って、
[[run a worker]] を実行します。
]FIG]

;; [26] [[ワーカー]]の[[コンストラクター]]は、他に
[CODE(DOMi)@en[[[SharedWorker]]]] と [CODE(DOMi)@en[[[ServiceWorker]]]] があります。
