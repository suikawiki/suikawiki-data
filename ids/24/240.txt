* 代替

[18] [[HTTPS]] を使うべきです。

* 仕様書

[REFS[
- [12] [CITE@en[RFC 8164 - Opportunistic Security for HTTP/2]] ([TIME[2017-05-11 15:47:35 +09:00]]) <https://tools.ietf.org/html/rfc8164>
]REFS]

* プロトコル

[13] [CODE(URI)@en[http:]] [[URL]] によって表される本来[[素のHTTP]]で行われるべき
[[HTTP]] アクセスを、 [[HTTPS]] ([[HTTP/2]] over [[TLS]]) [[転送路]]を使って行うものです。

;; [14] [[プロトコル]]としては同じ [[HTTPS]] であっても、
[CODE(URI)@en[https:]] [[URL]] によって表される [[HTTPS]]
アクセスとは、異なるものです。本手法を使っても、 ([CODE(URI)@en[https:]]
[[URL]] によって表される [[HTTPS]] アクセスで防げる) すべての攻撃を防げるわけではありません。

-*-*-

[19] [[起源サーバー]]は、
プロトコルの識別子を[[代替サービス]]として[[広告]]します。
ここで、[[プロトコル]]は、 [[TLS]] を使うもの (例えば [CODE[h2][HTTP/2]]) とします。
[[プロトコル]]は、[[資源]]の [[scheme][URL scheme]] を明示的に示すものでなければ[MUST[なりません]]。 [SRC[>>12]]

;; [20] [[HTTP/1.1]] は[[要求対象]]に[[絶対URL]]を指定することを認めてはいますが、
([[プロキシサーバー]]ではなく) [[起源サーバー]]に対して指定することは認めていませんので、
該当しません [SRC[>>12]]。

[21] [[クライアント]]は、そのような[[代替サービス]]の[[広告]]を受信したら、
以後その[[起源]]への[[要求]]を指定された[[代替サービス]]経由で送信して構いません。
[SRC[>>12]]

[23] [[クライアント]]は、[[代替サービス]]の接続の準備が完了するまで、
[[要求]]の送信を遅延させることができます。その場合、接続に失敗したら、
通常の[[平文]]の接続で送信することになります。 [SRC[>>12]]

[22] [[クライアント]]は、まず [CODE[OPTIONS]] 
[[要求]]のような繊細な情報が少ない[[要求]]を送信して、
[[代替サービス]]が無いか確認することもできます。 [SRC[>>12]]

[24] [[クライアント]]は、既知の[[代替サービス]]の[[満期]]が近い時、
[CODE[OPTIONS]] [[要求]]のようなものを予め送信しておき、
[[代替サービス]]情報を更新することもできます。 [SRC[>>12]]

-*-*-

[25] [[クライアント証明書]]は、意味を持ちません。
[[クライアント]]は、
[[クライアント証明書]]を指定しては[MUST[なりません]]。 [SRC[>>12]]

[26] [[サーバー]]は、同じ[[ポート]]で [CODE(URI)@en[https:]] も提供する場合に、
[[証明書要求]]することができます。
しかし、[[クライアント]]が[[証明書]]を提供しない場合にも、
[[ハンドシェイク][TLSハンドシェイク]]を[RUBYB[中断]@en[abort]]しては[MUST[なりません]]。 [SRC[>>12]]

* 批判

[16] 中途半端な[[セキュリティー]]しか提供できない本技術は
[[HTTPS]] への移行を遅らせるものだとして、
好ましくないと考える人もいます。

* 実装

[15] [[Firefox]] が実装しています。

[17] 他の [[Webブラウザー]]が実装するかどうかは不明です。

* 歴史

[1] [CITE@en[draft-ietf-httpbis-http2-encryption-01 - Opportunistic Security for HTTP]]
([TIME[2015-04-24 04:11:58 +09:00]] 版)
<https://tools.ietf.org/html/draft-ietf-httpbis-http2-encryption-01>

[FIG(quote)[
[FIGCAPTION[
[2] [CITE@en[meetings/04-21-minutes.md at gh-pages · w3ctag/meetings]]
([TIME[2015-05-06 15:35:03 +09:00]] 版)
<https://github.com/w3ctag/meetings/blob/gh-pages/2015/04-sfo/04-21-minutes.md>
]FIGCAPTION]

> Mark: Only Mozilla is implementing Opportunistic Encryption '''['''not shipped it''']'''
> Alex: '''['''We on the Chrome team are adamently against Opportunistic Encryption because it doesn't solve any problems''']'''
> Mark: The IETF is generally enthusiastic about Opportunistic Security
> Mark: The W3C is much less excited about Opportunistic Security

]FIG]


[3] [CITE@en[draft-ietf-httpbis-http2-encryption-04 - Opportunistic Security for HTTP]]
([TIME[2016-03-17 20:22:27 +09:00]] 版)
<https://tools.ietf.org/html/draft-ietf-httpbis-http2-encryption-04>

[4] [CITE@en[draft-ietf-httpbis-http2-encryption-07 - Opportunistic Security for HTTP]]
([TIME[2016-10-26 22:24:53 +09:00]])
<https://tools.ietf.org/html/draft-ietf-httpbis-http2-encryption-07>

[5] [CITE@en[RFC 8164 - Opportunistic Security for HTTP/2]]
([TIME[2017-05-11 14:53:24 +09:00]])
<https://tools.ietf.org/html/rfc8164>

[6] [CITE@en[1301117 - Update Opportunistic Security for HTTP]]
([TIME[2017-05-11 15:54:14 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=1301117>

[7] [CITE@en[1003448 - http/2 alt-svc support]]
([TIME[2017-05-11 16:04:15 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=1003448>

[8] [CITE@en[1172615 - opportunistic encryption potentially perturbing certificate verification telemetry]]
([TIME[2017-05-11 16:05:57 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=1172615>

[9] [CITE@en[1148885 - Opportunistic Encryption does not work with HTTP/2 proxy]]
([TIME[2017-05-11 16:06:42 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=1148885>

[10] [CITE@en[742610 - Remove opportunistic caching support from nsHttpChannel]]
([TIME[2017-05-11 16:07:06 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=742610>

[11] [CITE@en[1148328 - (CVE-2015-0799) Server certificate verification bypass with Alt-Svc]]
([TIME[2017-05-11 16:07:53 +09:00]])
<https://bugzilla.mozilla.org/show_bug.cgi?id=1148328>