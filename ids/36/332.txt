[413] 
[[和暦]]の実装の中には、
最初の[[元号]]である[[大化]]より前の時代をすべて[[大化]]として扱い、
[[建元]]前は0年や負の年 (-1年、-2年、...) とするものもあります。
あまり一般的な[[紀年法]]ではありませんし、
意図せず、または実装の便宜上採られた方法と思われます。
適切な年の表現方法とは思われませんから、
これに倣うべきではありません。
[SEE[ [[元号一覧]]、[[大化]]、[[日本古代の日時]], [[CLDRの和暦]] ]]

[880] 
[[iOS]]
には[[和暦]]を[[使うよう設定][計算機システムにおける暦の指定]]していると、
[[元号年]]の年数部分が[[西暦年]]と解釈され、
それが[[元号]]として表示されて[[大化]]のマイナス六百何十年となる
(例えば平成27年 → 西暦27年 → 大化-617年となる)
問題があるようです。
[SRC[>>879, >>877, >>878]]
複数の[[写真]]系[[アプリ]]で報告されていますが、
[[プラットフォーム]]側の問題なのか、
特定[[アプリ]]の実装上の (ありがちな) 問題なのか不明です。
生成された[[画像]]の [[Exif]]
データに本来[[元号年]]たる誤った[[西暦年]]が書き込まれるらしく、
発症していると報告された[[アプリ]]に原因があるとも限りません。
[[写真]]系[[アプリ]]以外への影響も不明です。
なお、
この問題に言及する
[[Webページ]]や
[[SNS]]
の投稿には、「-」を見落としているものも複数ありました。

;; [883] それにしてもこの被害報告はあちこちでみられ、
[[iPhone]] を[[和暦]]設定で使っている人は案外多いようです。

[14] 
[[iOS]] アプリの開発者は、 [[OS]] の設定を[[和暦]]にして正常に動作することを必ず確認するべきです。
複数人で開発しているなら、日頃から開発メンバーの何人かは[[西暦]]、
何人かは[[和暦]]に設定しておくのがいいでしょう。
[[和暦]]で異常動作する箇所や。
設定に応じて[[和暦]]になるべきなのに[[西暦]]のままになってしまう箇所の洗い出しに便利です。



[882] 
その他、
[[大化]]元年より前の日付を適切に扱えない実装もみられるようです [SRC[>>881]]。
0年や負の年の扱いに問題があるか、
最初の[[紀年法]]たる[[大化]]より前に[[紀年法]]が用意されておらず問題が起こっているのでしょうか。

-*-*-

[1] 
逆パターンで、
[[西暦年]]を最新の[[元号]]たる[[令和]] (または[[平成]])
と誤認することによる障害も報告されています
[SRC[>>3, >>2, >>4]]。




[REFS[
- [5] [CITE@ja[[[iPhone]]のカレンダー設定を和暦にしていると、日付と曜日がずれる問題が起こる - odawaraの「はてな de メモ」]], 
2011-06-13,
[TIME[2020-02-18 11:19:09 +09:00]] <https://odawara.hatenadiary.org/entry/20110613/1307946819>
- [879] [CITE@ja[tako@お財布0円さんはTwitterを使っています: 「iOS7にアップデートしたらカメラロールを撮影年別表示できるようになったんだけど、一枚だけ千年以上前に撮影されてた。 http://t.co/6yAP8GIWYp」 / Twitter]], 
午前10:33 · 2013年9月21日,
[TIME[2020-01-27 21:41:02 +09:00]] <https://twitter.com/kutarcom/status/381229620663554050>
- [877] [CITE@ja[【[[iPhone]]】iOSのバグ対策、iPhoneの写真が「大化」年号表示になる時の対処方法。 | Cohtaro.com]], 
2015年1月13日,
[TIME[2020-01-27 21:43:54 +09:00]] <http://cohtaro.com/2015/01/3690>
- [881] [CITE@ja[平成最後の年頭にあたりmacOSの改元対応を考える - 新・OS X ハッキング!(231) | [[マイナビ]]ニュース]], 
[[海上忍]],
2019/01/16 08:00,
[TIME[2020-01-27 21:54:36 +09:00]] <https://news.mynavi.jp/article/osxhack-231/>
- [878] [CITE@ja[[[iPhone]]写真の日付問題は|これで解決|【厳選5技】]], 
2019年10月21日,
[TIME[2020-01-27 21:48:47 +09:00]] <https://happiness-repair.com/media/know-how/893/>
- [3] [CITE@ja[来店予約がなぜか「4038年」に、くら寿司アプリで和暦対応の不具合か | 日経 xTECH(クロステック)]], [[日経 xTECH(クロステック)]], 
2020/02/03 20:10,
[TIME[2020-02-06 16:01:34 +09:00]] <https://tech.nikkeibp.co.jp/atcl/nxt/news/18/07007/>
- [2] [CITE[くら寿司の予約アプリで4038年になった理由 - Windows 2000 Blog]], 
2020年02月04日,
[TIME[2020-02-06 16:01:04 +09:00]] <http://blog.livedoor.jp/blackwingcat/archives/1993655.html>


[FIG(quote)[
[FIGCAPTION[
[4] [CITE@en-us[‎くら寿司 公式アプリ Produced by EPARK on the App Store]]
([TIME[2020-02-06 16:04:23 +09:00]])
<https://apps.apple.com/jp/app/%E3%81%8F%E3%82%89%E5%AF%BF%E5%8F%B8-%E5%85%AC%E5%BC%8F%E3%82%A2%E3%83%97%E3%83%AA-produced-by-epark/id942355925?l=en>
]FIGCAPTION]

> 3.0.10Feb 3, 2020
> ver 3.0.10
> ・端末設定による不具合の修正
>  暦法設定を「和暦」に設定している場合、4038年(OSによっては4008年)として予約を受け付けてしまう不具合を修正しました

]FIG]

]REFS]

[NOTE[
[10] 
[[Android]]
でこの種の報告がないので、
[[iOS]] や [[Apple]]
製品の品質が低いのかと誤解しそうですが、
[[Android]]
が[[和暦]]に対応していないため問題が顕在化していないと思われます。
[[Android]]
が対応したら同様の問題が多発する、
あるいはそれが懸念されるから対応できないのかもしれません。

[11] 
なんにせよ[[和暦]]に対応しない [[Google]] の日本市場の軽視が透けて見えるようです。
この点では [[Apple]] の対応がずっと進んでいます。
(世界的に見ても[[日本]]の [[iOS]] シェアは高いといわれていますから、
両者の姿勢がこうなるのも当然かもしれません。)
]NOTE]

;; [12] どちらかといえば、
全世界対応の [[iOS]] で日本市場向けの[[地域化]]にしっかり取り組もうとしている
[[Apple]]
にあまり非はなく、
[[日本]]市場向けの[[日本]]企業の製品であるにも関わらず[[和暦]]対応の動作確認すら怠っている[[日本]]の一部アプリ開発者の技術レベルの低さによってもたらされた障害のような感があります。




[6] [[現代日本の紀年法]]

[FIG(quote)[
[FIGCAPTION[
[588] [CITE@ja[はてなブックマーク - 「喜多方ラーメン」誤表示、原因は12年前の… JR東:朝日新聞デジタル]]
( ([TIME[2016-06-21 10:52:24 +09:00]]))
<https://b.hatena.ne.jp/entry/www.asahi.com/articles/ASJ6N3GRCJ6NUGTB002.html>
]FIGCAPTION]

> 某所にて、2016年と平成16年(2004年)のデータ出力ミスとの説を見かけた。

]FIG]


[7] [CITE@ja[Google、令和2年を西暦2002年と誤認する | LARTHの日記 | [[スラド]]]], 
2020年02月22日 2時52分,
[TIME[2020-02-22 11:47:42 +09:00]] <https://srad.jp/~LARTH/journal/636976/>

[8] >>7 は [[PDF]] のみ言及していますが、 [[HTML]] でも誤認されているようです。
[[Google検索]]が「令和」の元号に対応しておらず 
(「平成」に対応しているかは不明)、
「2年」を[[2桁西暦年]]と解釈して
「2002/02/17」
のように表示しているようです。



[FIG(quote)[
[FIGCAPTION[
[463] [CITE@ja[【iPhone】iOSのバグ対策、iPhoneの写真が「大化」年号表示になる時の対処方法。 | Cohtaro.com]]
([TIME[2016-02-03 10:45:41 +09:00]] 版)
<http://cohtaro.com/2015/01/3690>
]FIGCAPTION]

> 最近メインで使っているカメラアプリ「Cortex Cam」で撮影した写真の日付けがごっそり「大化」(大化改新などの年号)になってしまうので困っていました。
> 対処方法をネットで調べてみたのですがでてきません。
> 根本的な原因がiOSのバグらしいこと。「平成27年」が0027年に変換されて、大化617年に再計算されるということで打つ手なし。かと思ったのですが、設定をいじってみたら問題解決できました。

]FIG]


[9] 
とある [[Webサイト]]の[[日付入力]]欄 (おそらく何か欧米製の[[JavaScriptフレームワーク]]の[[ウィジェット]]そのまま利用)
は、
自由入力 + プルダウンのカレンダーからの選択の2通りの入力が可能なものでした。
自由テキスト入力の方に「R3/1/2」と書いてみたら、
「0003/01/02」
に正規化されたようでした。

このシステムがこの入力をどう処理したのか画面からはわかりませんでしたが、
西暦3年と誤認されてそうで怖いですね。

きっと欧米人か経験の浅い日本人が作ったもので (偏見)、ここに数字以外が入力されるはずがない、
西暦以外が入力されるはずがない、
と勝手に思い込んでこういう作りにしちゃったんでしょう。

[13] 
欧米人が作ったならまあ仕方ないかなあという気がしますが、
日本人技術者が仕様を決めて日本人開発者が作って日本企業が検収してるのだとしたら、
もっと仕事をしっかりしろよ、と。




