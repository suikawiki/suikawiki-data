* 仕様書

[REFS[
- [56] [CITE@en-us[UAX #9: Unicode Bidirectional Algorithm]], [TIME[2020-03-07 07:23:12 +09:00]] <https://unicode.org/reports/tr9/>
- [70] 
[CITE[The Unicode Standard, Version 13.0 - ch23.pdf]], [TIME[2020-03-09T17:53:52.000Z]], [TIME[2020-12-13T07:28:31.667Z]] <https://www.unicode.org/versions/latest/ch23.pdf#G27446>
- [11] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#requirements-relating-to-the-bidirectional-algorithm>
]REFS]

* 日本語

[55] [CITE@ja[[[自動車]]側面の文字の向きは - トラパシ鉄道模型掲示板5]], [TIME[2020-09-26T12:24:16.000Z]], [TIME[2016-08-17T11:23:54.582Z]] <https://web.archive.org/web/20160817112220/http://b5.spline.tv/tprr5/?message=101>

同じ[[行]]の[[右横書き]]中に[[左横書き]]が混在する [[bidi]] の事例あり。


[64] [CITE@ja[「爪哇」第162号 現地邦人企業商店広告多数入 ジャワスラバヤ市・爪哇日報社 昭和8年 : 古書 古群洞 kogundou@jcom.zaq.ne.jp]], [[kogundou]], [TIME[2020-12-09T04:15:28.000Z]] <https://kogundou.exblog.jp/240733547/>

南洋倉庫株式会社広告:
日本語会社名、
英語会社名は[[左横書き]]。
その次の日本語文は[[右横書き]]。
その次の日本語詳細事項は[[右上縦書き]]。


[65] [CITE@ja[大満洲國詳図 二百万分一 9色刷 訂正十版 小林又七編纂 兵用図書 昭和8年 : 古書 古群洞 kogundou@jcom.zaq.ne.jp]], [[kogundou]], [TIME[2020-12-09T04:42:22.000Z]] <https://kogundou.exblog.jp/240710607/>

題字は[[右横書き]]、その直下の[[縮尺]]を表す直線は左から右へ進み、添えられているのは[[左横書き]]の[[算用数字]]。

凡例は右側に記号、左側に[[右横書き]]の説明文。
標高の色の意味を表す「[R[高度表]]」は左側に例示、右側に数値 (グラフの縦軸に当たる部分が左側例示の右辺、その右側に[[算用数字]]で[[左横書き]]のメートル数)。

地名は[[右横書き]]。[[上縦書き]]や[[斜め書き]]もあるが少ない。
[[右横書き]]の[[上ルビ]]、[[下ルビ]]は[[右横書き]]。
「[L[HAR-BIN]]」
だけ[[ラテン文字]]併記で[[左横書き]]。

[66] [CITE@ja[満蒙紹介(満蒙略図/大連市パノラマ写真/大連港図/他折込附図附表多)非売 大正10年 : 古書 古群洞 kogundou@jcom.zaq.ne.jp]], [[kogundou]], [TIME[2020-12-09T05:08:48.000Z]] <https://kogundou.exblog.jp/240629341/>

全体的に[[右横書き]]と[[右上縦書き]]。

鉄道車両の紹介ページだけ[[左横書き]]の[[日本語]]で、
[[左横書き]]の[[算用数字]]の[[西暦年]]や記号とともに、
車両の変遷が左から右へと新しく並べられている。


* 鏡像化

[57] 
[[左横書き]]と[[右横書き]]で、
[[グリフ]]が変化する[[文字]]もあります。
[SEE[ [[鏡像化]] ]]

- [[L4]]
- [[上位層プロトコル]]依存
-- [[HL6]]

* ECMA モデル

[SEE[ [[ECMA Technical Report TR/53]] ]]

* bidi 文字

[60] 
[[JIS X 0221-1:2001]]
[CSECTION[附属書F (参考) 代替書式文字]] F.1.3

[68] [CODE[Bidi_Control]]

* Unicode bidi アルゴリズム

[58] 
[[Unicode Consortium]]
の[[仕様書]]
[DFN[UAX #9]]
で
[[bidi]]
処理の[[アルゴリズム]]が規定されています。

[69] 
[[bidi overrides]],
[[bidi embeddings]],
[[bidi isolates]]
は、
[[paired stateful controls]]
です。
[SRC[>>70]]

[71] 
[[bidi overrides]],
[[bidi embeddings]],
[[bidi isolates]]
は、
[CODE[Default_Ignorable_Code_Point]]
です。
未対応の場合でも、
可視的な[[グリフ]]を表示する[RUBYB[べき][should]]ではありません。
[SRC[>>70]]


** Unicode ルビ文字との関係

[SEE[ [[interlinear annotation]] ]]

* bidi 検査

[46] [[Stringprep]] には [[bidi]] 文字の検査があります。

[45] [[IDNA2008]] と一部の [[PRECIS]] [[プロファイル]]では [[Bidi Rule]]
が使われます。

;; [[Bidi Rule]] 参照。

* CSS における bidi

[19] [[CSS]] では [CODE(CSS)@en['[[unicode-bidi]]']] と [CODE(CSS)@en['direction']] の2つの[[特性]]が
[[bidi]] に関わります。 [[Unicode]] の [[bidi]] に関する[[文字]]と合わせて、 [[Unicode]]
の [[bidi]] アルゴリズムに従って[[レンダリング]]されます。

[54] [CITE@en[CSS Writing Modes Level 4]], [TIME[2020-09-05T23:08:25.000Z]], [TIME[2020-09-06T01:35:44.029Z]] <https://drafts.csswg.org/css-writing-modes/#text-direction>

* HTML における bidi

[75] 
[[RFC 2070]],
[[SI 4281]]

** 双方向アルゴリズム書式付け文字

[21] [[HTML]] でいう[DFN[[RUBYB[双方向アルゴリズム書式付け文字]@en[bidirectional-algorithm formatting characters]]]]は、
[[Unicode]] の [CODE[[[Bidi_Char]]]] のうち [[Implicit Directional Formatting Characters]]
3文字を除いた9文字とされています [SRC[>>11]]。いずれも [[Unicode]] の [[bidi]] アルゴリズムで動作が定義されている[[文字]]です。

[REFS[
- [20] [CITE@en[Character set "$html:bidirectional-algorithm-formatting-characters"]] ([TIME[2014-01-13 09:06:21 +09:00]] 版) <http://chars.suikawiki.org/set?expr=%24html%3Abidirectional-algorithm-formatting-characters>
]REFS]

** 双方向アルゴリズム書式付け文字範囲

[22] [DFN[[RUBYB[[[双方向アルゴリズム書式付け文字範囲]]]@en[bidirectional-algorithm formatting character ranges]]]]とは、次の各範囲です [SRC[>>11]]。
[FIG[
- [23] [[HTML要素]]の[[null名前空間]]の[[属性]]それぞれ
- [24] [[HTML要素]]の[[子供]]の [CODE(DOMi)@en[[[Text]]]] を連結し次のように分割した範囲それぞれ
-- [25] [CODE(HTMLe)@en[[[br]]]] [[要素]]があればそこで範囲を分割する
-- [26] [[語句内容]]でない[[フロー内容]]である[[HTML要素]]があればそこで範囲を分割する
]FIG]

** 著者に対する要件

[27] [[双方向アルゴリズム書式付け文字範囲]]においては、[[双方向アルゴリズム書式付け文字]]は次のように対になっていなければ[['''なりません''']]
[SRC[>>11]]。
[FIG[
- [28] [CODE(charname)@en[[[LRE]]]] / [CODE(charname)@en[[[RLE]]]] があれば、対応する [CODE(charname)@en[[[PDF]]]] があること
- [29] [CODE(charname)@en[[[LRO]]]] / [CODE(charname)@en[[[RLO]]]] があれば、対応する [CODE(charname)@en[[[PDF]]]] があること
- [30] [CODE(charname)@en[[[LRI]]]] / [CODE(charname)@en[[[RLI]]]] / [CODE(charname)@en[[[FSI]]]] 
があれば、対応する [CODE(charname)@en[[[PDI]]]] があること
]FIG]

[34] つまり [[CSS]] によって[[要素]]ごとに適用される規定 (>>18) と矛盾する形でこれらの[[文字]]を使うと[[レンダリング]]結果が予測しづらくなってしまいますから、
[[要素]]の入れ子関係とこれらの[[文字]]の入れ子関係が整合的でなければならないのです。

[31] しかしこれらの[[文字]]を直接使うよりは、 [CODE(HTMLa)@en[[[dir]]]] [[属性]]、
[CODE(HTMLe)@en[[[bdi]]]] [[要素]]、 [CODE(HTMLe)@en[[[bdo]]]] [[要素]]を使うことが[RUBYB[勧められています]@en[encouraged]]。
[SRC[>>11]]

;; [39] とはいえ[[属性値]]では[[文字]]を使うしかありません。

** 処理モデル

[13] [[HTML]] の[[レンダリング]]における [[bidi]] の扱いに関しては、 [CODE(CSS)@en['[[unicode-bidi]]']], 
[CODE(CSS)@en['[[direction]]']], [CODE(CSS)@en['[[content]]']] といった [[CSS]] の[[特性]]を介して
[[Unicode]] の [[bidi]] アルゴリズムに従うものとして定義されています [SRC[>>11]]。

[14] [[利用者エージェント]]は、
- [15] [[CSS]] を実装し、 >>13 や[[著者]]による指定に従う
- [16] >>13 の[[利用者エージェントスタイルシート]]に対応しているかのように実装するものの、
[[著者]]による [[CSS]] の指定には対応しない
- [17] [[CSS]] 以外の[[スタイル言語]]で、同等のものを実装する

... のいずれかの形で実装することを求められています [SRC[>>11]]。

[18] [[HTML]] の中では、 [CODE(HTMLa)@en[[[dir]]]] [[属性]]、 [CODE(HTMLe)@en[[[bdi]]]] [[要素]]、
[CODE(HTMLe)@en[[[bdo]]]] [[要素]]、 [CODE(HTMLe)@en[[[br]]]] [[要素]]、[CODE(HTMLe)@en[[[pre]]]]
[[要素]]、[CODE(HTMLe)@en[[[textarea]]]] [[要素]]、 [CODE(HTMLe)@en[[[wbr]]]] [[要素]]について [[bidi]]
に関わる[[レンダリング]]の規定があります。

[REFS[
- [32] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#bidi-rendering>
- [33] [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#br-wbr-content>
]REFS]

[35] [[CSS]] 以外で[[レンダリング]]される場面についても規定があります。
[REFS[
- [38] [CODE(DOMm)@en[[[drawText]]]]
-- [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#text-preparation-algorithm>
- [36] [CODE(HTMLe)@en[[[title]]]] [[要素]]
-- [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#the-title-element>
- [37] [[UI]] 要素各種
-- [CITE@en-US-x-hixie[HTML Standard]] ([TIME[2014-01-09 07:29:06 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#text-rendered-in-native-user-interfaces>
]REFS]

* 歴史

[59] 
[[JIS X 0211]]
1.
6.1.1
8.3.138 [CODE(charname)@en[SRS]]
F.6
F.7

[1]
[CITE[Authoring HTML for Middle Eastern Content]] <http://www.microsoft.com/globaldev/handson/dev/Mideast.mspx>
([[名無しさん]] [sage])

[2]
[CITE[Exploring Better Source Editing for Bidirectional XHTML and XML]] <http://www.sw.it.aoyama.ac.jp/2005/pub/IUC28-bidi/IUC28.html>
([[名無しさん]] [sage])

[3]
[CITE[Hebrew characters in XML and XHTML]] <http://www.nirdagan.com/hebrew/characters/#test>
([[名無しさん]])

[4]
[CITE[Authoring HTML for Middle Eastern Content]] <http://www.microsoft.com/globaldev/handson/dev/Mideast.mspx>
([[名無しさん]] [WEAK[2006-12-20 23:31:24 +00:00]])


[5]
[CITE@en-US[Internationalization Best Practices: Handling Right-to-left Scripts in XHTML and HTML Content -- (Editors' copy)]] ([TIME[2006-07-27 02:17:07 +09:00]] 版) <http://www.w3.org/International/geo/html-tech/tech-bidi.html>

[6] [CITE[Revision of UBA for improved display of URL/IRIs - Google Docs]]
( ([TIME[2011-07-23 14:30:01 +09:00]] 版))
<https://docs.google.com/document/d/1c8-svx7og0qBUfGBobw7LYfOcNeDVPYbNVMNpSqYCFo/edit?hl=en>
(cache <http://suika.fam.cx/gate/2007/schema/schema/6ab74bc21022f5cc9bfd95a62c76046a/prop.html>

[7] [CITE@en[Web Applications 1.0 r5754   Define conformance criteria around bidi formatting characters]]
( ([TIME[2011-01-10 18:55:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5753&to=5754>

[8] [CITE@en[Web Applications 1.0 r7783     Update HTML in preparation for Unicode 6.3]]
( ([TIME[2013-03-30 08:20:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7782&to=7783>

[9] [CITE[Widget Interface]]
( ([TIME[2013-10-29 00:58:56 +09:00]] 版))
<http://www.w3.org/TR/widgets-apis/#getting-localizable-strings>

[10] [CITE@en-US[Additional Requirements for Bidi in HTML]]
([TIME[2010-03-05 16:28:54 +09:00]] 版)
<http://www.w3.org/TR/2010/WD-html-bidi-20100304/>

[12] [CITE[IRC logs: freenode / #whatwg / 20101111]]
( ([TIME[2010-11-19 23:02:05 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20101111#l-254>

[40] [CITE@en-US[Notifications API Standard]]
( ([TIME[2014-02-11 16:20:34 +09:00]] 版))
<http://notifications.spec.whatwg.org/#direction-0>

[41] [CITE@en[Additional Requirements for Bidi in HTML & CSS]]
( ([TIME[2015-07-16 21:26:45 +09:00]] 版))
<http://www.w3.org/TR/2015/NOTE-html-bidi-20150721/>

[42] [CITE@en[IRIs and bidirectional formatting characters]]
([[Anne van Kesteren]] 著, [TIME[2015-08-25 19:28:17 +09:00]] 版)
<https://lists.w3.org/Archives/Public/www-international/2015JulSep/0126.html>

[43] [CITE@en[Add a section on rendering URLs with some advice around bidirectional… · whatwg/url@d1152b9]]
([TIME[2015-08-27 11:53:08 +09:00]] 版)
<https://github.com/whatwg/url/commit/d1152b94a16ae91e1f72d128fd5ef589635f0e7c>

[44] [CITE@en[Tweak the bidirectional rendering note and add a dependency on UTS36.… · whatwg/url@e67f9dd]]
([TIME[2015-09-02 11:24:50 +09:00]] 版)
<https://github.com/whatwg/url/commit/e67f9dd7a1106d867862d3b5d9f044388f84909e>

[47] [CITE@en[CSV on the Web: Use Cases and Requirements]]
([TIME[2016-02-21 17:43:46 +09:00]] 版)
<https://www.w3.org/TR/2016/NOTE-csvw-ucr-20160225/#UC-SupportingRightToLeftDirectionality>

[48] [CITE@en[Remove document conformance requirements for bidi characters]]
([[zcorpan]]著, [TIME[2016-08-11 02:53:58 +09:00]])
<https://github.com/whatwg/html/commit/fe9dce390338a7f8941ba504d5aab7d56f2099f4>

[49] [CITE@en[Use of ZWJ · Issue #2 · w3c/i18n-discuss]]
([TIME[2017-04-12 23:36:37 +09:00]])
<https://github.com/w3c/i18n-discuss/issues/2>

[50] [CITE[XLIFF Version 2.0]]
([TIME[2014-08-06 01:00:00 +09:00]])
<http://docs.oasis-open.org/xliff/xliff-core/v2.0/os/xliff-core-v2.0-os.html#d0e9515>

[51] [CITE@en[Micropub]]
([TIME[2017-05-21 23:18:57 +09:00]])
<https://micropub.net/draft/#h-bidirectional-text>



[52] [CITE@en[Activity Streams 2.0]]
([TIME[2017-05-21 23:50:36 +09:00]])
<https://w3c.github.io/activitystreams/core/#biditext>

[53] [CITE@en[Restructure URL rendering section and add additional guidance]]
([[estark37]]著, [TIME[2019-04-04 23:49:46 +09:00]])
<https://github.com/whatwg/url/commit/8809598ddfd1d935432c8a0cad53f13d70e24bc6>

[61] [CITE@en-us[UAX #44: Unicode Character Database]]
([TIME[2020-03-06T22:23:11.000Z]], [TIME[2020-10-21T08:58:43.231Z]])
<https://www.unicode.org/reports/tr44/#BidiTest_txt>

[62] [CITE@en[WebVTT: The Web Video Text Tracks Format]], [TIME[2019-12-16T16:42:48.000Z]], [TIME[2020-10-23T14:41:11.908Z]] <https://w3c.github.io/webvtt/#webvtt-cue-text-alignment>

[63] [CITE@ja[20150322「第2回アラビア語入門講座@東京」を終えての画像]]
([TIME[2020-11-10T06:09:43.000Z]])
<https://ameblo.jp/a-cstokyo/image-12005152382-13253675869.html>

[FIG(quote)[
[FIGCAPTION[
[67] [CITE@en-US[Fribidi -]]
([TIME[2020-12-11T12:17:15.000Z]])
<http://fribidi.org/>
]FIGCAPTION]

> GNU FriBidi is an implementation of the Unicode Bidirectional Algorithm (bidi).

]FIG]

[72] [CITE@en[Browsers ignoring Bidi Embedding Controls is probably not web-compatible · Issue #20 · w3c/unicode-xml · GitHub]], [TIME[2020-12-17T09:09:19.000Z]] <https://github.com/w3c/unicode-xml/issues/20>


[73] [CITE@ja[日本の心・さいき(佐伯) : アラビア語・・・]]
([TIME[2020-12-20T12:15:19.000Z]])
<http://blog.livedoor.jp/mt221414/archives/52184053.html>

[74] [CITE@ja[単位をたずねて三千粁?~青梅編 - ことばマガジン:朝日新聞デジタル]]
([[The Asahi Shimbun Company]], [TIME[2020-12-25T07:41:40.000Z]])
<http://www.asahi.com/special/kotoba/archive2015/photo/photo.html%3Fphoto=%252FS2007%252Fupload%252F2012110500008_18.JPG.html>

[76] [CITE@EN-US[Middle Eastern Language Issues]], [TIME[2021-01-29T09:08:34.000Z]], [TIME[2001-04-13T17:58:29.269Z]] <https://web.archive.org/web/20010413175141/http://www.microsoft.com/globaldev/mideast/meissues.asp>
