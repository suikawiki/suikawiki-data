* 定義

** IDNA2003 の定義

[6]

> [[STD 13]] は[DFN[[RUBYB[[[ドメイン名]]] @en[domain name]]]]と[DFN[[RUBYB[[[ホスト名]]] @en[host name]]]]について話していますが、
多くの人はこれらの語を交換可能に用いています。更に、
[[STD 13]] はあまり明瞭ではなかったので、
これらの語それぞれの正確な定義を知っていると思っている多くの人々の間でも定義が食い違っていたりもします。
この[[文書]]では、一般に、[DFN[[RUBYB[[[ドメイン名]]] @en[domain name]]]]という[[用語]]を使います。
[[STD 3]] で定義されている[[ホスト名]]構文の制限に言及する時には、
明示的に [[STD 3]] を[[引用]]します。

;; [[RFC 3490]] 2.

** IDNA2008 の定義

>The base DNS specifications [RFC1034] [RFC1035] discuss "domain
names" and "hostnames", but many people use the terms
interchangeably, as do sections of these specifications.  Lack of
clarity about that terminology has contributed to confusion about
intent in some cases.  These documents generally use the term "domain
name".  When they refer to, e.g., hostname syntax restrictions, they
explicitly cite the relevant defining documents.

;; [21] [CITE@en[RFC 5890 - Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework]]
<http://tools.ietf.org/html/rfc5890#page-7>

* 構文

[FIG(railroad)[
= [[ラベル]]
= *
== [CODE[.]]
== [[ラベル]]
= ?
== [CODE[.]]
]FIG]

** ASCII ドメイン名の定義

[11]  [SRC[>>12]]
>
[PRE(BNF)[
<domain> ::= <subdomain> | " "
<subdomain> ::= <label> | <subdomain> "." <label>
]PRE]

[13] [CODE(BNF)@en[<label>]] については、[[ラベル]]の項を参照してください。

[15] この定義では、 [CODE(example)@en[www.example.com.]] のように [CODE(char)[[[.]]]]
で終わるものは [CODE(ABNF)@en[<[[domain]]>]] ではありません。

*** 仕様書

- [18] [CITE@en[RFC 952 - DoD Internet host table specification]]
<http://tools.ietf.org/html/rfc952>
- [12] [[RFC 1034]] <http://tools.ietf.org/html/rfc1034#section-3.5>
- [19] [CITE@en[RFC 1123 - Requirements for Internet Hosts - Application and Support]] 
<http://tools.ietf.org/html/rfc1123#section-2>

** Web での定義

[16] [[HTML]] の[[妥当な電子メール・アドレス]]の[[ドメイン名]]部分では、
[CODE(ABNF)@en[[[ldh-str]]]] を [CODE(char)[[[.]]]] でつなげたものを定義として採用しています。
詳しくは[[妥当な電子メール・アドレス]]の項を参照してください。

[17] この定義は、 >>11 の定義よりも少し緩くて、[[ラベル]]の1文字目に[[数字]]や [CODE(char)[[[-]]]]
が使える点が異なっています。

** HSTS の定義

>
[32] 
:domain name:
is also referred to as "DNS name" and is defined in [RFC1035] to
be represented outside of the DNS protocol itself (and
implementations thereof) as a series of labels separated by dots,
e.g., "example.com" or "yet.another.example.org".  In the context
of this specification, domain names appear in that portion of a
URI satisfying the reg-name production in "Appendix A.  Collected
ABNF for URI" in [RFC3986], and the host component from the Host
HTTP header field production in Section 14.23 of [RFC2616].
>
NOTE:  The domain names appearing in actual URI instances and
matching the aforementioned production components may or
may not be a fully qualified domain name.

[REFS[
- [31] [CITE@en[RFC 6797 - HTTP Strict Transport Security (HSTS)]] ([TIME[2014-06-02 05:16:10 +09:00]] 版) <http://tools.ietf.org/html/rfc6797#section-4>
]REFS]

** IDN での定義

[14] [[国際化ラベル]]を4種類の[[ラベル分離子]] ([[点]]) のいずれかでつなげたものです。[[IDN]] の項を参照。

* 比較と正規化

[33] [[ドメイン名]]の[[比較]]や[[パターン]]の記述には、いくつかの方法があります。

[FIG(short list)[
- [[ASCII大文字・小文字不区別]]
- [[ドメイン一致]]
- [[既知HSTSホストドメイン一致]]
- [[HTTPS]] の [[identity]] の検査
]FIG]

[1] [[Cookie]] の [CODE(HTTP)@en[[[Domain]]]] [[属性]]の[[構文解析]]では、
[[属性値]]である[[ドメイン名]]は[[小文字]]に[[正準化]]されます。

;; [CODE(HTTP)@en[[[Domain]]]] 参照。

* レンダリング

[23] [[ASCII文字]]のみからなる[[ドメイン名]]は、[[ラテン文字]]の通常の表記と同じく、 [[ltr]]
に[[レンダリング]]されるのが普通です。[[ラベル]]の順序も[RUBYB[[[ネットワーク順]]]@en[network order]]のまま
[[ltr]] で[[レンダリング]]、つまり[[小エンディアン]]で表記されるのが普通です。

[22] [[ラベル]]に [[rtl]] [[文字]]が含まれる場合、[[ドメイン名]]の一部分が [[rtl]]
に[[レンダリング]]される可能性が生じます。[[ネットワーク順]]が [CODE[ABC.DEF]]
のとき、
[PRE(code example)[
CBA.FED
]PRE]
と
[PRE(code example)[
FED.CBA
]PRE]
... の2種類の[[レンダリング]]が考えられ、どちらも行われているとされています。
このどちらが正しいとも規定はされておらず、[[利用者エージェント]]に委ねられています。
[SRC[>>24]]

** 仕様書

- [24] [CITE@en[RFC 5894 - Internationalized Domain Names for Applications (IDNA): Background, Explanation, and Rationale]] ([TIME[2011-02-05 07:34:29 +09:00]] 版) <http://tools.ietf.org/html/rfc5894#section-4.1>

* ドメイン名の構造

[FIG(short list)[
- [[根ドメイン]]
- [28] [[TLD]]
- [29] [[SLD]]
- [[public suffix]]
- [[naked domain]]
]FIG]

* 特殊なドメイン名

[FIG(short list)[
- [25] [CODE@en[[[localhost]]]]
- [26] [CODE@en[[[localhost.localdomain]]]]
- [27] [CODE@en[[[location.request]]]]
]FIG]

* 名前空間としてのドメイン名

[2] [[DNS]] によって[[解決]]する[[プロトコル]]としての[[ドメイン名]]でなく、
それを流用した[[名前空間]]の[[識別子]]としての[[ドメイン名]]が使われることもあります。

;; [7] [[URL]] の一部として[[名前空間]]に使われる場合については、
[[URL]] を参照。

[20] [[小エンディアン]]より[[大エンディアン]]の方が使いやすいとして、
[[ラベル]]の順序を入れ替えて使うことがあります。詳しくは[[逆ドメイン名]]を参照。

[34] 逆順にしないで使う場面としては次のものがあります。
[FIG(short list)[
- [[Vendor Domain Name]]
- [CODE(822)@en[[[List-ID:]]]]
- [[メッセージID]]
]FIG]

* メモ

[3] [[アメリカ]]のドメイン名は国名を省略可能とか説明しているトンデモ本がいまだに存在しているのを知って唖然としましたが。
しかもそれがなんとか検定の教科書だったりするからなんともやるせない。
- [4] [SAMP[組織名.属性.国名]]という階層化がさも世界共通 (で米国が例外) という感じの説明が跡を絶たないのもなんともはや。[[汎用JPドメイン]]が始まってからもずいぶん経つっていうのに。
- [5] >>3-4 米国はインターネット発祥の地、米国慢性という自虐思想だよね、あるいみ。

[8] [CITE@en[RFC 5321 - Simple Mail Transfer Protocol]]
([TIME[2009-09-09 02:12:56 +09:00]] 版)
<http://tools.ietf.org/html/rfc5321#section-4.5.3.1.2>

[9] [CITE[Squid 2.6.STABLE21 Configuration File: allow_underscore]]
([TIME[2008-07-22 05:54:52 +09:00]] 版)
<http://www.squid-cache.org/Versions/v2/2.6/cfgman/allow_underscore.html>

[10] [CITE@en[RFC 6021 - Common YANG Data Types]]
([TIME[2010-10-07 04:53:03 +09:00]] 版)
<http://tools.ietf.org/html/rfc6021>


[30] [CITE@en[RFC 6761 - Special-Use Domain Names]]
( ([TIME[2013-06-27 22:35:13 +09:00]] 版))
<http://tools.ietf.org/html/rfc6761>

[FIG(quote)[
[FIGCAPTION[
[35] [CITE[DeleGate reference manual version 9.9]]
([TIME[2014-09-29 00:34:55 +09:00]] 版)
<http://www.delegate.org/delegate/Manual.htm>
]FIGCAPTION]

> 
> Special names "-"and "-.-", when it is used in the "host:port" part of URL, means the host and port of the DeleGate itself. And URL "http://-.-/-/" is reserved for a entry point of a control page of DeleGate. 
> Another reserved name is "mypro.xyz". An access to "http://mypro.xyz" is interpreted to your proxy server like "http://-.-". If the proxy is chained, you can access to upstream proxies by prefixing the hop count N from your client, as "http://N.mypro.xyz", as "http://2.mypro.xyz" for example. This feature can be enabled or disabled by the HTTPCONF=mypro.xyz parameter.

]FIG]
