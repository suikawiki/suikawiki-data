* 仕様書

[REFS[
- [12] [CITE@en[RFC 7232 - Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests]] ([TIME[2014-09-11 10:02:44 +09:00]] 版) <https://tools.ietf.org/html/rfc7232#section-3.3>
]REFS]

* 歴史

[305] [CITE[Request Headers in the HTTP protocol]]
( ([TIME[2001-11-29 11:01:38 +09:00]] 版))
<http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#if-modified-since>

[REFS[
- [306] [CITE@en[RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1]] ([TIME[2012-01-09 20:55:20 +09:00]] 版) <http://tools.ietf.org/html/rfc2616#section-14.25>
]REFS]

[FIG(quote)[
[FIGCAPTION[
[11] RFC 2068・2616 (HTTP/1.1) 14.28 If-Unmodified-Since
]FIGCAPTION]

> The If-Unmodified-Since request-header field is used with a method to
make it conditional. If the requested resource has not been modified
since the time specified in this field, the server [DEL[should]] [INS[SHOULD]] perform the
requested operation as if the If-Unmodified-Since header were not present.

[CODE(HTTP)[If-Unmodified-Since]] 要求頭欄は、それを[[条件付]]とする[[方式]]と共に使います。
要求された[[資源]]がこの欄に指定された時刻から修正されていなければ、
[[サーバー]]は、 [CODE(HTTP)[If-Unmodified-Since]] 頭がなかった場合のように要求された操作を行う'''べきです'''。

> If the requested variant has been modified since the specified time,
the server MUST NOT perform the requested operation, and MUST return
a 412 (Precondition Failed).

要求された[[変種]]が指定されたい時刻より修正されているなら、
サーバーは要求された操作を行っては'''ならず'''、
[CODE(HTTP)[[[412]]]] (前条件失敗) を返さなければ'''なりません'''。

>
-If-Unmodified-Since = "If-Unmodified-Since" ":" HTTP-date

> An example of the field is:

この欄の例:

>
-If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT

> If the request normally (i.e., without the If-Unmodified-Since
header) would result in anything other than a 2xx [INS[or 412]] status, the
If-Unmodified-Since header [DEL[should]] [INS[SHOULD]] be ignored.

要求が通常なら (つまり、 [CODE(HTTP)[If-Unmodified-Since]] 頭がなければ)
[CODE(HTTP)[[[2xx]]]] または [CODE(HTTP)[[[412]]]] 状態以外のものとなるならば、
[CODE(HTTP)[If-Unmodified-Since]] 頭は無視する'''べきです'''。

> If the specified date is invalid, the header is ignored.

指定された日付が不当なら、この頭は無視します。

[INS[
> The result of a request having both an If-Unmodified-Since header
field and either an If-None-Match or an If-Modified-Since header
fields is undefined by this specification.

[CODE(HTTP)[If-Unmodified-Since]] 頭欄ならびに [CODE(HTTP)[If-None-Match]]
頭欄または [CODE(HTTP)[If-Modified-Since]] 頭欄のいずれかの両者を有する要求の結果はこの仕様書では未定義とします。
]INS]
]FIG]

[FIG(quote)[
[FIGCAPTION[
[10] RFC 2326 12.23 If-Modified-Since
]FIGCAPTION]

> The If-Modified-Since request-header field is used with the DESCRIBE
and SETUP methods to make them conditional. If the requested variant
has not been modified since the time specified in this field, a
description will not be returned from the server (DESCRIBE) or a
stream will not be set up (SETUP). Instead, a 304 (not modified)
response will be returned without any message-body.

[1] [CODE(HTTP)@en[[[If-Modified-Since:]]]] [[要求頭欄]]は、
[CODE(HTTP)@en[[[DESCRIBE]]]] [[メソッド]]や [CODE(HTTP)@en[[[SETUP]]]]
[[メソッド]]で用いて、その[[要求]]を[[条件付]]とします。
要求された[RUBY[[[異体]]] [variant]]がこの欄で指定された時刻以後修正されていないなら、
[[鯖]]は[RUBYB[[[記述]]]@en[description]]を返さない ([CODE(HTTP)@en[[[DESCRIBE]]]]) か、
または[[ストリーム]]を設定しません ([CODE(HTTP)@en[[[SETUP]]]])。
その代わりに、[CODE(ABNF)@en[[[message-body]]]] 無しの [CODE(HTTP)[[[304]]]]
(無修正) [[応答]]を返します。

>
- [2]   If-Modified-Since = "If-Modified-Since" ":" HTTP-date

> An example of the field is:
- [3]     If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT
]FIG]

** [CODE(HTTP)@en[length]] 引数

[6] 90年代後半の[[Webブラウザー]]は [DFN[[CODE(HTTP)@en[[[length]]]]]]
[[引数]]を [CODE(HTTP)@en[[[If-Modified-Since:]]]] [[ヘッダー]]に含めることがありました。

[REFS[
- [4] ''Nonstandard HTTP Headers'' <http://web.archive.org/web/20020610043404/http://www.dais.is.tohoku.ac.jp/~kabe/WWW/nonstdhdr.html#If_Modified_Since_length>
]REFS]

[5] >>4 [[WinIE3.0]]2 と [[NC]] 4.01 では確かに [CODE(HTTP)[[[length]]]] 引数がつきました。

[7]
[[Apache]] は[[時間帯]]以降 ([CODE(HTTP)@en[[[length]]]] も含めて)
無視するようになって要るそうです。

[9]
>>5 [[WinIE 7]] と [[Firefox]] は (たぶん) つけないようです。

* 実装

[307] 
Last-Modified が If-Modified-Since と一致すると IE6 は他がなにあってもキャッシュを使っちゃう。
ETag とか Vary とかつけてみたけど無視される。