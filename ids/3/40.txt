[7] [DFN[[RUBYB[[[エスケープシーケンス]]]@en[escape sequence]]]]は、
[CODE(charname)@en[[[ESCAPE]]]] から始まり、0個[[以上]]の[[中間バイト]]と1つの[[終端バイト]]によって構成される[[バイト列]]です。
[[ISO/IEC 2022]] [[符号拡張法]]に従う[[文字集合]]の指定や、
[[制御機能]]の[[呼び出し]]などに用います。

* 仕様書

[REFS[
- [19] [[ISO/IEC 10646]]
-- [18] 旧版: [[JIS X 0221:2007]] 16
]REFS]

* 意味

[15]
>
:エスケープシーケンス (escape sequence):
[[符号拡張手順]]において[[制御]]のために[[使用]]する一つ以上の[[ビット組合せ]]。
先頭の[[ビット組合せ]]は、[[制御文字]] [CODE(charname)[[[ESCAPE]]]]
([CODE(jcharname)[[[エスケープ]]]]) を[[表現]]する。
- 参考 この規格では、 [CODE(charname)[[[ESCAPE]]]] は、
常に[[制御文字]]として[[引用]]される。
[SRC[[[JIS X 0202]]:1998 4.13]]

[1] 
>
:3.1 エスケープシーケンス (escape sequence):
[[符号拡張手順]]において[[制御]]のために使用する一つ以上の[[ビット組合せ]]。
先頭の[[ビット組合せ]]は、
[[制御文字]] [CODE(charname)@en[[[ESCAPE]]]] 
([CODE(jcharname)@en[[[エスケープ]]]]) 
を[[表現]]する。
[SRC[[[JIS X 0201]]:1997 3.1]]

* 構文

[10]
[SRC[[[JIS X 0202]]:1998 13.1]]:
- [CODE(ABNF)[[DFN[エスケープ・シーケンス]] := [CODE(charname)[[[ESCAPE]]]] *I F]]
-- [[バイト列]]。[[8ビット符号]]では8ビット、[[7ビット符号]]では7ビットの列。
- [CODE(ABNF)[[DFN[I]] := %x20-2F [CODE(comment)[;; [[中間バイト]]]]]]
- [CODE(ABNF)[[DFN[F]] := %x30-7E [CODE(comment)[;; [[終端バイト]]]]]]

[11]
[[エスケープ・シーケンス]]を構成する各[[ビット組合せ]]は、
それ単独で出現した時の意味とは無関係で、
[[エスケープ・シーケンス]]全体だけで意味が決まります。
[SRC[[[JIS X 0202]]:1998 13.1]]

[12]
>>10 に当てはまらない[[バイト]]が[[エスケープ・シーケンス]] (のようなもの)
に含まれるかもしれません。
[[応用]]は[[誤り]]を識別して回復する手段を提供する必要があるかもしれませんが、
それは [[ISO/IEC 2022]] の適用範囲外とされています。
[SRC[[[JIS X 0202]]:1998 13.1]]

[3] '''エスケープ・シーケンスの種類''':
エスケープ・シーケンスは、 [CODE(charname)@en[[[ESC]]]]
の直後の[[ビット組合せ]]により次の通り分類されます
[SRC[[[JIS X 0202]]:1998 13.2.1, 13.2.2]]。
,種類,[CODE(charname)@en[[[ESC]]]] の次のビット組合せ,機能
,[CODE@en[[[0F]]]],[CODE(char)[02/00]],[[告知]] ([CODE(charname)@en[[[ANNOUNCE CODE STRUCTURE]]]])
,[CODE@en[[[1F]]]],[CODE(char)[02/01]],[[C0]] [[指示]] ([CODE(charname)@en[[[C0-DESIGNATE]]]])
,[CODE@en[[[2F]]]],[CODE(char)[02/02]],[[C1]] [[指示]] ([CODE(charname)@en[[[C1-DESIGNATE]]]])
,[CODE@en[[[3F]]]],[CODE(char)[02/03]],[[単独制御機能]]
,[CODE@en[[[4F]]]],[CODE(char)[02/04]],[[複数バイト図形文字集合]][[指示]]
,[CODE@en[[[5F]]]],[CODE(char)[02/05]],[CODE(charname)@en[[[DESIGNATE OTHER CODING SYSTEM]]]]
,[CODE@en[[[6F]]]],[CODE(char)[02/06]],[CODE(charname)@en[[[IDENTIFY REVISED REGISTRATION]]]]
,[CODE@en[[[7F]]]],[CODE(char)[02/07]],(予約)
,[CODE@en[[[8F]]]],[CODE(char)[02/08]],[[G0]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 94-SET]]]])
,[CODE@en[[[9F]]]],[CODE(char)[02/09]],[[G1]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 94-SET]]]])
,[CODE@en[[[10F]]]],[CODE(char)[02/10]],[[G2]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 94-SET]]]])
,[CODE@en[[[11F]]]],[CODE(char)[02/11]],[[G3]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 94-SET]]]])
,[CODE@en[[[12F]]]],[CODE(char)[02/12]],[[G0]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 96-SET]]]])
,[CODE@en[[[13F]]]],[CODE(char)[02/13]],[[G1]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 96-SET]]]])
,[CODE@en[[[14F]]]],[CODE(char)[02/14]],[[G2]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 96-SET]]]])
,[CODE@en[[[15F]]]],[CODE(char)[02/15]],[[G3]] [[指示]] ([CODE(charname)@en[[[G0-DESIGNATE 96-SET]]]])
,[CODE@en[[[Fp]]]],[CODE(char)[03/00]]〜[CODE(char)[03/15]],[[私用制御機能]]
,[CODE@en[[[Fe]]]],[CODE(char)[04/00]]〜[CODE(char)[05/15]],[[C1]] [[制御機能]]
,[CODE@en[[[Fs]]]],[CODE(char)[06/00]]〜[CODE(char)[07/14]],[[標準単独制御機能]]

([CODE@en[[[12F]]]] は [[ISO/IEC 2022]] では予約)

*誤り処理

[8] 00/00〜01/15, 07/15〜15/15 が謝って含まれた場合
[[応用]]は誤り状態の識別手段及び誤り状態からの回復手段を
提供する必要があるかもしれませんが、その様な要件は
ISO/IEC 2022 の範囲外とするとされています。 ([[JISX0202]]:1998 13.1 備考参照。)

[1] >>8 エスケープ・シーケンスに出現し得ないバイトが出てきた場合だけでなく、未知のエスケープ・シーケンスが出てきた場合の回復はどうですかね? 
これも実装依存ですかね?


* 文脈

[13] [[ISO/IEC 2022]] による[[文字列]]の[[符号化]]の他にも、
次の場面で[[エスケープシーケンス]]が用いられます。

[FIG(short list)[ [14] その他の[[エスケープシーケンス]]の用法
- [[公式公開識別子]] ([CODE[CHARSET]])
- [[ISO 9660]]
]FIG]

* ISO/IEC 10646 におけるエスケープシーケンス

[16] 
[[ISO/IEC 10646]]
は[[エスケープシーケンス]]の用法を規定しています。
([[Unicode]] には相当する規定がありません。)
[SEE[ 構文については[[制御文字]] ]]

[17] 
[[ISO/IEC 2022]] の[[符号拡張制御機能]] 
([[指示シーケンス]]、[[単独シフト]]、[[固定シフト]])
の 
[[ISO/IEC 10646]]
における利用は禁止されています。
この規定は曖昧ですが、
[[図形文字集合]]の[[指示]]が禁止されているものとみられます。
[SEE[ [[制御文字]] ]]

;; [35] 禁止されたものが使われた時の挙動は不明です。

[30] 
[[ISO/IEC 10646]]
は[[エスケープシーケンス]]の用法について4通りを自身で特に定めています。
これらは、
「ISO/IEC 2022 のエスケープシーケンスを使う場合」、
「ISO/IEC 6429 のエスケープシーケンスを使う場合」
といった限定がついていて、
使う、使わないは判断が委ねられているようです (利用者に? 実装者に?)。

[31] 
現実問題としてこれらや、その他の[[エスケープシーケンス]]、
[[制御シーケンス]]が使われるのは極めて稀です。
いわゆる[[ANSIエスケープシーケンス]]が[[端末エミュレーター]]の類で使われる程度でしょうか。

-*-*-

[33] 
[[ISO/IEC 10646]]
は、
[CODE(charname)@en[DOCS]]
の用法を2通り定めていました。

[2] 
[[ISO/IEC 10646]]
は、
[[エスケープシーケンス]]によって[[符号化表現]]と[[実装水準]]を識別できるとしていました。
[[ISO/IEC 2022]] [[符号化文字データ要素]]中でも
[[ISO/IEC 10646]] [[符号化文字データ要素]]中でも利用できるとしていました。
[SRC[>>18]]

- [4] [CODE(charname)@en[ESC]] 2/5 2/15 4/0 - [[UCS-2]] [[実装水準1]]
- [5] [CODE(charname)@en[ESC]] 2/5 2/15 4/1 - [[UCS-4]] [[実装水準1]]
- [9] [CODE(charname)@en[ESC]] 2/5 2/15 4/2 - [[UCS-2]] [[実装水準2]]
- [20] [CODE(charname)@en[ESC]] 2/5 2/15 4/3 - [[UCS-4]] [[実装水準2]]
- [21] [CODE(charname)@en[ESC]] 2/5 2/15 4/4 - [[UCS-2]] [[実装水準3]]
- [22] [CODE(charname)@en[ESC]] 2/5 2/15 4/5 - [[UCS-4]] [[実装水準3]]

[32] 
[[ISO/IEC 10646]]
は、
[[ISO/IEC 10646]]
から
[[ISO/IEC 2022]]
への切り替えに
[CODE(charname)@en[ESC]] 2/5 4/0
を使うとしていました。
[[ISO/IEC 2022]] [[符号化文字データ要素]]中でも
[[ISO/IEC 10646]] [[符号化文字データ要素]]中でも利用できるとしていました。
[SRC[>>18]]

;; [34] 
[[ISO/IEC 2022]] [[符号化文字データ要素]]中での利用が想定された理由は謎です。

;; [36] 
[CODE(charname)@en[DOCS]]
は、
標準的な復帰のエスケープシーケンスである
[CODE(charname)@en[ESC]] 2/5 4/0
で
[[ISO/IEC 2022]]
に復元できる場合とできない場合を区別し、
できないシステムへの切り替えの
[CODE(charname)@en[DOCS]]
の[[中間バイト]]に
[CODE[2/15]]
を含めるとしていました。
[[ISO/IEC 10646]]
は標準的な[[エスケープシーケンス]]で
[[ISO/IEC 2022]]
に復帰しますが、
詰め込みオクテットがある [SEE[ [[制御文字]] ]]
ために、標準的な[[エスケープシーケンス]]の[[ビット組合せ]]自体が出現するとは限りません。
そのために
[CODE[2/15]]
が入っています [SRC[>>18]]。

[37] 
[[ISO/IEC 10646]]
状態で[[エスケープシーケンス]]や[[制御シーケンス]]で変更した状態が、
[[ISO/IEC 2022]]
に移行した後や、
その後で再び
[[ISO/IEC 10646]]
に戻った時にも維持されているのかどうかはよくわかりません。

-*-*-

[23] 
[[ISO/IEC 10646]]
は、
[[制御シーケンス]] [CODE(charname)@en[IUCS]]
で、
[[ISO/IEC 10646]]
が定める[[部分集合]]を識別できるとしていました。
[[ISO/IEC 6429]] [[符号化文字データ要素]]中でも
[[ISO/IEC 10646]] [[符号化文字データ要素]]中でも利用できるとしていました。
[SRC[>>18]]

;; [24] 
[[ISO/IEC 6429]] [[符号化文字データ要素]]中での利用が想定された理由は謎です。
[[ISO/IEC 2022]] 状態で使ってから
[[ISO/IEC 10646]] を[[指示]]しても、状態は保持されるのでしょうか。

-*-*-

[25] 
[[ISO/IEC 10646]]
は、
[[ISO/IEC 10646]] と併用する[[制御機能]]の識別に、
[[ISO/IEC 2022]] における[[制御文字集合]]の[[指示シーケンス]]と同じ形の識別シーケンスが使えるとしていました。
[[ISO/IEC 6429]] [[符号化文字データ要素]]中でも
[[ISO/IEC 10646]] [[符号化文字データ要素]]中でも利用できるとしていました。
[SRC[>>18]]

- [26] [CODE(charname)@en[ESC]] 2/1 [VAR[F]] - [[C0文字集合]]
- [27] [CODE(charname)@en[ESC]] 2/2 [VAR[F]] - [[C1文字集合]]

[28] [[JIS X 0211]] [[制御機能]]はそれぞれ
[CODE[4/0]],
[CODE[4/3]]
を
[VAR[F]]
として使います。それ以外は [[ISO-IR]] に登録された[[終端バイト]]とします。
[SRC[>>18]]


;; [29] 
[[ISO/IEC 2022]] [[符号化文字データ要素]]中での利用が想定された理由は謎です。
[[ISO/IEC 2022]] 状態で使ってから
[[ISO/IEC 10646]] を[[指示]]しても、状態は保持されるのでしょうか。



* 関連

[6] [[C1]] を[[エスケープシーケンス]]として表す場合、 [[CSI]]
で始まる[[制御シーケンス]]全体を[[エスケープシーケンス]]と呼ぶことがあります。

