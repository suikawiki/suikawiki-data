* 仕様書

[REFS[
- [18] [CITE@en[RFC 7230 - Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing]] ([TIME[2014-10-21 22:50:09 +09:00]] 版) <https://tools.ietf.org/html/rfc7230#section-6.3>
]REFS]

* 接続オプション [CODE(HTTP)[keep-alive]]

[19] [[接続オプション]] [DFN[[CODE(HTTP)@en[[[keep-alive]]]]]]
は、[[プロトコルの版]]が [[HTTP/1.0]] である
[[HTTP接続]]において[[持続的接続]]機能を有効にすることを指定するものです。

[22] [[HTTP/1.0]] [[メッセージ]]の [CODE(HTTP)@en[[[Connection:]]]]
[[ヘッダー]]に [CODE(HTTP)@en[[[close]]]] が指定されておらず、
[CODE(HTTP)@en[[[keep-alive]]]] が指定されていれば、
[[受信者]]は[[接続]]を閉じずに次の[[要求]]と[[応答]]の組に当該
[[HTTP接続]]を再利用できます [SRC[>>18]]。

;; [20] [[持続的接続]]を参照。

[21] このオプションは [[HTTP/1.1]] [[接続]]では使えません。 [[HTTP/1.1]]
[[メッセージ]]で指定されていても、無視されます。

;; [[HTTP/1.1]] では既定の状態で[[持続的接続]]が有効です。

* 歴史

** RFC 2068

[FIG(quote)[
[FIGCAPTION[
[10] RFC 2068 (HTTP/1.1) 19.7.1.1 The Keep-Alive Header
]FIGCAPTION]

> When the Keep-Alive connection-token has been transmitted with a
request or a response, a Keep-Alive header field MAY also be
included. The Keep-Alive header field takes the following form:

[CODE(HTTP)[Keep-Alive]] [CODE(ABNF)[connection-token]]
が要求または応答で転送されるとき、 [CODE(HTTP)[Keep-Alive]]
頭欄をも含めて'''構いません'''。 [CODE(HTTP)[Keep-Alive]]
頭欄は、次の書式を取ります。

>
- Keep-Alive-header = "Keep-Alive" ":" 0# keepalive-param
- keepalive-param = param-name "=" value

> The Keep-Alive header itself is optional, and is used only if a
parameter is being sent. HTTP/1.1 does not define any parameters.

[CODE(HTTP)[Keep-Alive]] 頭自体は省略可能で、引数が送られるときのみ使用します。
HTTP/1.1 は引数を定義しません。

> If the Keep-Alive header is sent, the corresponding connection token
MUST be transmitted. The Keep-Alive header MUST be ignored if
received without the connection token.

[CODE(HTTP)[Keep-Alive]] 頭が送られる場合、対応する接続字句を転送しなければ'''なりません'''。
[CODE(HTTP)[Keep-Alive]] 頭は、接続字句なしで受信した場合には無視しなければ'''なりません'''。
]FIG]

** RFC 2616

[16] [[RFC 2616]] は [CODE(HTTP)@en[[[Keep-Alive:]]]] [[ヘッダー]]を
[[hop-by-hop header]] に分類していました [SRC[>>15]]。

[REFS[
- [15] [CITE@en[RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1]] ([TIME[2014-09-07 04:14:53 +09:00]] 版) <http://tools.ietf.org/html/rfc2616#section-13.5.1>
- [17] [CITE@en[RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1]] ([TIME[2014-09-07 04:14:53 +09:00]] 版) <http://tools.ietf.org/html/rfc2616#section-19.6.2>
]REFS]

** RFC 4229

[12] [[RFC 4229]] は [[RFC 2068]] を出典に [[IANA登録簿]]に登録しています [SRC[>>4, >>11]]。

[13] 状態は「[[標準]]」とされています。

;; [14] これは [[RFC 723x]] 出版後も変わっていません。 [TIME[2014-11-04T15:43:59.000Z]]

[REFS[
- [4] [CITE@en[RFC 4229 - HTTP Header Field Registrations]] ([TIME[2014-11-02 09:53:20 +09:00]] 版) <http://tools.ietf.org/html/rfc4229#section-2.1.59>
- [11] [CITE[Message Headers]] ([TIME[2014-10-31 18:26:49 +09:00]] 版) <http://www.iana.org/assignments/message-headers/message-headers.xhtml>
]REFS]

* 例

- [1] [SAMP(HTTP)[Keep-Alive: timeout=25, max=85]]
- [2] [CODE(HTTP)[Keep-Alive: 300]]

* メモ

- [3] >>2 は [[Mozilla]], >>3 は [[Apache]]

[5]
[CITE[kinnekoの日記 - IE は KeepAlive をうまく処理できない?]] ([CODE[2007-02-11 10:02:17 +09:00]] 版) <http://d.hatena.ne.jp/kinneko/20051214/p4>
([[名無しさん]])

[6]
[CITE@ja[世界初オタク系SNS『オタバ』公式ブログ: 【Internet Explorer系ブラウザについて】]] ([CODE[2006-10-29 16:47:05 +09:00]] 版) <http://otaba.seesaa.net/article/10637205.html>
([[名無しさん]])

[7]
[CITE[最速インターフェース研究会 :: 最近IE6でWikipedia日本語版の表示が異常に遅いのはKeepAliveのせい]] ([TIME[2007-02-11 10:05:32 +09:00]] 版) <http://la.ma.la/blog/diary_200702101610.htm>

[8] [CITE[Apache HTTP Server Project]]
( ([TIME[2011-05-28 00:58:55 +09:00]] 版))
<http://httpd.apache.org/docs/1.3/misc/known_client_problems.html#broken-keepalive>


[9] [CITE@en[RFC 7230 - Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing]]
( ([TIME[2014-06-07 01:59:35 +09:00]] 版))
<https://tools.ietf.org/html/rfc7230#appendix-A.1.2>