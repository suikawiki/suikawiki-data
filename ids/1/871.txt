[32] 
[DFN[[CODE(charname)@en[DOCS]]]]
([DFN[[CODE(charname)@en[DESIGNATE OTHER CODING SYSTEM]]]])
は、
[[ISO/IEC 2022]] や
[[ISO/IEC 2022]] 以外の[[文字コード]]体系を相互に切り替える[[エスケープシーケンス]]です。

* 意味

[37] 
[CODE(charname)@en[[[DOCS]]]] は [[ISO/IEC 2022]]
以外の[[符号化システム]]を[[指示]]し、同時に[[呼出]]すことができます。
他の[[符号化システム]]は[[文字符号]]以外のものも構いません。
[SRC[[[JIS X 0202]]:1998 15.4.1]]


* 構文

[35] 
:[[名前]]:[CODE(charname)@en[[[DESIGNATE OTHER CODING SYSTEM]]]]
:[[日本語通用名称]]:[CODE(jcharname)[[[他の符号化システムの指示]]]]
:[[略号]]:[CODE(charname)@en[[[DOCS]]]]
:[[符号化表現]]:[CODE(char)@en[[CODE(charname)@en[[[ESC]]]] 02/05 *[VAR[[[I]]]] [VAR[[[F]]]]]]

[36] 
仕様書:
- [[JIS X 0202]]:1998
-- [CSECTION[15.4 他の符号化システムの指示 (DOCS)]]



[39] 
'''終端バイト''':
[[符号化システム]]は (必要なら[[中間バイト]]と)
[[終端バイト]]で識別されます。
[[終端バイト]] [[Ft]] は [[ISO-IR]] 
に登録されます。





[34] 
[[ISO/IEC2022]] 1994 15.4

=DOCS = ESC %x25 [I] F  ;; DESIGNATE OTHER CODING SYSTEM
=I = I-foreign / %x20-2E
=I-foreign = %x2F
=F = %x40-%x7E

ISO/IEC 2022 に適合しない符号化体系 Coding System
を指示・呼び出ししたり、 ISO/IEC 2022 に戻ってきたりします。

=return-to-ISO2022 = ESC %x25 %x40

ESC 02/05 04/00 で戻ってきたときには、[[告知]], [[指示]],
[[呼び出し]]の状態は元に戻ります。[[現在位置]]など他の状態が
戻るかは未定義です。

中間バイトが 02/15 の時は、呼び出された符号化体系は
ISO/IEC 2022 に復帰するのに return-to-ISO2022 を使いません。
他の方法で戻ってきたとしても上述の状態も戻るかは未定義ですし、
そもそも戻る方法が無いかもしれません。

他の中間バイトを使うか、または中間バイト無しの時は、
return-to-ISO2022 を使って ISO/IEC 2022 に復帰できます。

[17] [DFN@en[[CODE[5F]]]] 型[[エスケープ・シーケンス]]は、
[[符号化システム]]の[[指示]]
([CODE(charname)@en[[[DESIGNATE OTHER CODING SYSTEM]]]])
に使われます。

[18] 
仕様書:
- [[JIS X 0202]]:1998
--[CSECTION[表 3.b nF 型エスケープ・シーケンス及び対応機能]]


[19] 
- [CODE(ABNF)[[DFN[エスケープ・シーケンス]] /= 5F 型エスケープ・シーケンス]]
- [CODE(ABNF)[[DFN[5F 型エスケープ・シーケンス]] := DOCS / 5F 型予約エスケープ・シーケンス]]
- [CODE(ABNF)[[DFN@en[DOCS]] := 標準 DOCS / 私用 DOCS [CODE(comment)[;; [CODE(charname)@en[[[DESIGNATE OTHER CODING SYSTEM]]]]]]]]
- [CODE(ABNF)[[DFN[標準 DOCS]] := [CODE(charname)@en[[[ESC]]]] %x25 [%x2F__&&]&&__ [%x21-23 *[[I]]__&&]&&__ [[Ft]]]]
- [CODE(ABNF)[[DFN[私用 DOCS]] := [CODE(charname)@en[[[ESC]]]] %x25 *[[I]] [[Fp]]]]
- [CODE(ABNF)[[DFN[5F 型予約エスケープ・シーケンス]] := [CODE(charname)@en[[[ESC]]]] %x21 (%x20 / %x24-2E / %x2F (%x20 / %x24-2F)) *[[I]] [[Ft]]]]
- [CODE(ABNF)[[DFN@en[I]] := %x20-2F [CODE(comment)[;; 中間バイト]]]]
- [CODE(ABNF)[[DFN@en[Fp]] := %x30-3F [CODE(comment)[;; 私用終端バイト]]]]
- [CODE(ABNF)[[DFN@en[Ft]] := %x40-7E [CODE(comment)[;; 標準終端バイト]]]]







* 標準復帰あり DOCS (ESC 02/05 Ft)

[44] 
[CODE(charname)@en[ESC]] [N[2/5]] [VAR[F]] 
は[[標準復帰]]で
[[ISO/IEC 2022]]
に切り替えられるものとされます。

,*ESC 02/05,*4  ,*5  ,*6  ,*7
,0        ,000
,1        ,108
,2        ,178
,3        ,131
,4        ,145
,5        ,160
,6        ,161
,7        ,196
,8        ,188
,9        ,
,10       ,
,11       ,
,12       ,
,13       ,
,14       ,
,15       ,   ,   ,   ,---

,*[[ISO-IR]],*[[エスケープシーケンス]],*符号化システム
,---,ESC 02/05 04/00,[[ISO/IEC 2022]]
,108,ESC 02/05 04/01,[[NAPLPS]]
,178,ESC 02/05 04/02,[[UTF-1]]
,131,ESC 02/05 04/03,Data Syntax I of [[CCITT]] Rec. T.101.
,145,ESC 02/05 04/04,Data Syntax II of CCITT Rec. T.101.
,160,ESC 02/05 04/05,Photo-Videotex Data Syntax of CCITT Recommendation T.101.
,161,ESC 02/05 04/06,Audio Data Syntax of CCITT Recommendation T.101.
,196,ESC 02/05 04/07,[[UTF-8]] with standard return (実装水準指定なし)
,186,ESC 02/05 04/08,VEMMI Data Syntax of (draft) ITU-T Recommendation


* 標準復帰なしのDOCS (ESC 02/05 02/15 Ft)

[45] 
[CODE(charname)@en[ESC]] [N[2/5]] [N[2/15]] [VAR[F]] 
は[[標準復帰]]で
[[ISO/IEC 2022]]
に切り替えられ''ない''ものとされます。

,*ESC 02/05 02/15,*4  ,*5  ,*6  ,*7
,0        ,162
,1        ,163
,2        ,125
,3        ,174
,4        ,175
,5        ,176
,6        ,177
,7        ,190
,8        ,191
,9        ,192
,10       ,193
,11       ,194
,12       ,195
,13       ,
,14       ,
,15       ,   ,   ,   ,---

,*[[ISO-IR]],*[[エスケープシーケンス]],*符号化システム,*[[ISO/IEC 2022]] 復帰
,162,ESC 02/05 02/15 04/00,"ISO/IEC 10646:1993, UCS-2, Level1",ESC U+0025 U+0040
,163,ESC 02/05 02/15 04/01,"ISO/IEC 10646:1993, UCS-4, Level1",ESC U+0025 U+0040
,125,ESC 02/05 02/15 04/02,Virtual Terminal Service Transparent Set,復帰なし
,174,ESC 02/05 02/15 04/03,"ISO/IEC 10646:1993, UCS-2, Level2",ESC U+0025 U+0040
,175,ESC 02/05 02/15 04/04,"ISO/IEC 10646:1993, UCS-4, Level2",ESC U+0025 U+0040
,176,ESC 02/05 02/15 04/05,"ISO/IEC 10646:1993, UCS-2, Level3",ESC U+0025 U+0040
,177,ESC 02/05 02/15 04/06,"ISO/IEC 10646:1993, UCS-4, Level3",ESC U+0025 U+0040
,190,ESC 02/05 02/15 04/07,"UTF-8 level 1, without standard return",ESC U+0025 U+0040
,191,ESC 02/05 02/15 04/08,"UTF-8 level 2, without standard return",ESC U+0025 U+0040
,192,ESC 02/05 02/15 04/09,"UTF-8 level 3, without standard return",ESC U+0025 U+0040
,193,ESC 02/05 02/15 04/10,"UTF-16 level 1, without standard return",ESC U+0025 U+0040
,194,ESC 02/05 02/15 04/11,"UTF-16 level 2, without standard return",ESC U+0025 U+0040
,195,ESC 02/05 02/15 04/12,"UTF-16 level 3, without standard return",ESC U+0025 U+0040


[2] [[終端バイト]] [[7/14]] については[[空集合 (ISO/IEC 2022)]]参照。

* 旧仕様の DOCS (終端バイトと符号のビット数)

[10] 
初期の [[ISO 2022]] 
では[[終端バイト]]が[[指示]]・[[呼び出し]]する[[符号]]の[[ビット数]]によって割り当てることになっていました。
すなわち、
[SRC[>>9]]

- 3/[VAR[c]] ([VAR[[[Fp]]]]) - 任意のビット数
- 4/[VAR[c]] - 7ビット[[未満]]
- 5/[VAR[c]] - 7ビット
- 6/[VAR[c]] - 8ビット
- 7/[VAR[c]] - 8ビット[[超]]

[11] 
ビット長の異なるデータをどのように混在させる想定だったのかは不明です。

[12] 
当時の [[ISO 2022]] には [[ISO 2022]] への復帰のシーケンスが規定されていませんでした。
[[ISO 2022]] 自身の[[7ビット符号]]と[[8ビット符号]]の切り替えの方法も用意されていませんでした。

;; [33] 標準復帰あり・なしの概念もありませんでした。

[16] 
[[JIS X 4151]]
が
[SAMP(SGML)[ESC 2/5 4/0]] を未登録の128文字の文字集合と説明するのは、
この時代の仕様に基づく説明っぽいです。
[SEE[ [[公開テキスト指示シーケンス]] ]]


[20] 
実際にはこの規定に基づき [[ISO-IR]] に登録された[[終端バイト]]は1つもありません。


[REFS[
- [9] [CITE[[[ECMA-35]]_1st_edition_december_1971.pdf]], [TIME[2021-01-16T09:57:02.000Z]], [TIME[2022-05-01T05:17:03.679Z]] <https://www.ecma-international.org/wp-content/uploads/ECMA-35_1st_edition_december_1971.pdf#page=17>
]REFS]



* libmoe の DOCS

[26] 
[[文字コード]]変換ライブラリー [[libmoe]] は [[ISO/IEC 2022]] 
と他のいくつかの[[文字コード]]体系に対応しており、
[CODE(charname)@en[DOCS]] の独自構文 ([[私用終端バイト]])
で相互に切り替えられます。
[SRC[>>5]]

;; [29] [CODE[mbconv]] という変換プログラムが付属する他、
[[w3m]] を機能拡張した [[w3mmee]] という [[Webブラウザー]]でも利用されています。

;; [30] 更新が停止して久しいですが、公式サイトのソースコードの他、
現在でも [[Ubuntu]] のパッケージが提供されていてすぐに利用できます。
[TIME[2022-05-05T03:13:35.400Z]]

[27] 
[[ISO/IEC 2022]], [[UTF-8]], [[UTF-16]]
以外は独自の構文:

[CODE(charname)@en[ESC]] [N[2/5]] [N[2/1]] [VAR[I]] [VAR[Fp]]

... を使います。 [SRC[>>5]]


[24] [SRC[>>5]]

- [N[2/0]] [N[3/0]] : [CODE[x-moe-internal]]
- [N[2/0]] [N[3/1]] : [[KOI8-R]]
- [N[2/0]] [N[3/2]] : [[KOI8-U]]
- [N[2/0]] [N[3/3]] : [[Windows-1250]]
- [N[2/0]] [N[3/4]] : [[Windows-1251]]
- [N[2/0]] [N[3/5]] : [[Windows-1252]]
- [N[2/0]] [N[3/6]] : [[Windows-1253]]
- [N[2/0]] [N[3/7]] : [[Windows-1254]]
- [N[2/0]] [N[3/8]] : [[Windows-1255]]
- [N[2/0]] [N[3/9]] : [[Windows-1256]]
- [N[2/0]] [N[3/10]] : [[Windows-1257]]
- [N[2/0]] [N[3/11]] : [[Windows-1258]]
- [N[2/0]] [N[3/12]] : [[シフトJIS]] ([[左側]]は [[ASCII]], [N[0xF0]] - [N[0xFF]] は不存在)
- [N[2/0]] [N[3/13]] : [[Shift_JISX0213]] ([[左側]]は [[ASCII]])
- [N[2/0]] [N[3/14]] : [[Big5]]
- [N[2/0]] [N[3/15]] : [[Johab]]
- [N[2/1]] [N[3/0]] : [[UHC]]
- [N[2/1]] [N[3/1]] : [[EUC-TW]]
- [N[2/1]] [N[3/2]] : [[x-euc-jisx0213-packed]] ([[EUC-JISX0213]] + [[JIS X 0212]])
- [N[2/1]] [N[3/3]] : [[GBK]]
- [N[2/1]] [N[3/4]] : [[GB 18030]]
- [N[2/1]] [N[3/5]] [[以上]] : [N[2/0]] [N[3/0]] と同等

[28] 
[[エスケープシーケンス]]は [[ISO/IEC 2022]] 以外でも利用できます。
[CODE(charname)@en[DOCS]] を超えて状態が持続します。
[[左側]]は [[ISO/IEC 2022]] 以外でも[[指示シーケンス]]や[[固定シフト]]が解釈されます。
[[右側]]は不可解でよくわかりません。


[25] 出力の符号化 ([[ISO/IEC 2022]] 系のもの以外を含む。) で表現できないとき、
[CODE(charname)@en[ESC]] [N[2/5]] [N[2/1]] [N[2/0]] [N[3/0]]
が使われます。適宜 [CODE(charname)@en[ESC]] [N[2/5]] [N[4/0]]
が入ることもあれば、入らないまま [[ISO/IEC 2022]]
[[指示シーケンス]]が現れることもあります (この辺は若干挙動が怪しい)。

[REFS[
-[5] [CITE[Kiyokazu in (hopefully) hacker mode (multi octet character encoding handling library)]], [TIME[2020-10-25T00:25:49.000Z]] <http://pub.ks-and-ks.ne.jp/prog/libmoe/>
-- [23] [CITE@ja[多符号化対応w3m]], [TIME[2022-05-04T09:47:33.000Z]] <http://pub.ks-and-ks.ne.jp/prog/w3mmee/>
-- [22] [CITE[Mapping of Unicode into ISO 2022]], [TIME[2022-05-04T09:45:48.000Z]] <http://pub.ks-and-ks.ne.jp/prog/unicode-vs-iso2022/>

]REFS]

* ISO/IEC 2022 の DOCS

[40] 
'''ISO/IEC 2022 の終端バイト''':
[[中間バイト]]なし、[[終端バイト]] [CODE(char)[04/00]]
(つまり [CODE(char)@en[[CODE(charname)@en[[[ESC]]]] 02/05 04/00]])
は [[ISO/IEC 2022]] の[[符号化システム]]を[[指示]]します。
他の[[符号化システム]]を使用中にこの[[エスケープ・シーケンス]]を使うと、
[[ISO/IEC 2022]] が[[指示]]され、前に [[ISO/IEC 2022]]
から他の[[符号化システム]]を[[呼出]]した時点の状態に復帰します。
前の状態とは、[[告知]]機能 ([CODE(charname)@en[[[ACS]]]]) 
により設定した状態と[[符号化図形文字集合]]と[[符号化制御機能集合]]の[[指示]]・[[呼出]]しの状態を指します。
[[現在位置]]などがどうなるかは [[ISO/IEC 2022]]
の範囲外とされています。
[SRC[[[JIS X 0202]]:1998 15.4.2]]

この[[エスケープ・シーケンス]]は [[ISO-IR]]
の登録の範囲外になっているようです。

[41] 
'''標準復帰''':
第2[[中間バイト]]が [CODE(char)[02/15]]
かどうかにより、 >>40 が使用できるか区別されます。

[CODE(char)[02/15]] でない [CODE(charname)@en[[[DOCS]]]]
で他の[[符号化システム]]を[[呼出]]すと、
[[ISO/IEC 2022]] に復帰するために >>40
を使用できます。

[CODE(char)[02/15]] な [CODE(charname)@en[[[DOCS]]]]
を使う他の[[符号化システム]]は、 [[ISO/IEC 2022]]
に復帰するために >>40 を使用しません。 
(別の方法で復帰できるかもしれませんし、できないかもしれません。)
復帰できたとしても [[ISO/IEC 2022]]
の状態 ([[告知]]、[[指示]]、[[呼出]]し) は不定とされています。

[SRC[[[JIS X 0202]]:1998 15.4.2]]

[42] 
[[ISO/IEC 2022]] [[符号化システム]]に復帰するためには >>40
を使うことが望ましいとされています。
[SRC[[[JIS X 0202]]:1998 15.4.1]]

[43] 
[[ISO/IEC 2022]] は復帰したときに [CODE(charname)@en[DOCS]] 
で移行したときの状態に戻るとしていますが、
他の符号化システム内で[[エスケープシーケンス]]やそれと同等の仕組みが利用可能なときに、
そこで変更した状態も復帰時に破棄して元の状態が復元されるべきなのかどうか、
よくわかりません。
[[ISO/IEC 2022]] が復帰時に復元すると明記しているのだからそれに戻るべきという解釈もあり得ますし、
[[ISO/IEC 10646におけるエスケープシーケンス]]のように [[ISO/IEC 2022のエスケープシーケンス]]を利用すると規定しているものは
[[ISO/IEC 2022]] の状態を参照・編集しているのだから復帰してもそれが破棄されるのはおかしいという解釈もあり得ます。
なぜか標準復帰あり・なしの2種類ある [[UTF-8]] がその違いを踏まえているという解釈もあり得ますが、
[[UTF-1]], [[UCS-2]], [[UTF-16]], [[UCS-4]] は各1種類しかないのがネックです。


* Unicode の DOCS

[31] [[UTF-1]], [[UTF-8]], [[UCS-2]], [[UTF-16]], [[UCS-4]] 
の[[終端バイト]]が登録されています。

[7] 
UCS 系符号化体系では ISO/IEC 2022 への復帰に ESC(U+001B) U+0025 U+0040
を使います。 [[UCS-2]], [[UTF-16]] では 0x001B 0x0025 0x0040 に、
[[UCS-4]] では 0x0000001B 0x00000025 0x00000040 になります。
[[UTF-8]] では 0x1B 0x24 0x40 になります。



[6] [[ISO/IEC 10646におけるエスケープシーケンス]]も参照。


[21] 
いくつかの実装が [[UTF-8]] に対応しています。 
[SRC[>>5, >>8, >>23]]
それを利用した[[Web頁]]もあります [SRC[>>22]]。



[8] [CITE[Man page of CONSOLE_CODES]], [TIME[2022-04-29T09:33:30.000Z]], [TIME[2022-04-30T10:06:40.770Z]] <https://linuxjm.osdn.jp/html/LDP_man-pages/man4/console_codes.4.html>

- ESC 2/5 G
- ESC 2/5 3/8 (旧式)

[SEE[ [[VT][VT100]] ]]

* NAPLPS の DOCS

[46] 
[[ISO-IR]] 108
ESC 02/05 04/01	
[[NAPLPS]]
([[標準復帰]]あり)

[53] [SEE[ [[VT][VT100]] ]]

- [54] [CODE(charname)@en[ESC]] [N[2/5]] [N[3/0]] - 
[CODE(charname)@en[DECTCS]] (Exit NAPLPS)
- [55] [CODE(charname)@en[ESC]] [N[2/5]] [N[3/4]] -
[CODE(charname)@en[DECSCCS]] (Enter NAPLPS)


* Videotex の DOCS

[47] 
([[標準復帰]]あり)

- [48] [[ISO-IR]] 131
ESC 02/05 04/03	
Data Syntax I of CCITT Rec. T.101.
- [49] [[ISO-IR]] 145
ESC 02/05 04/04
Data Syntax II of CCITT Rec. T.101.
- [50] [[ISO-IR]] 160
ESC 02/05 04/05
Photo-Videotex Data Syntax of CCITT Recommendation T.101.
- [51] [[ISO-IR]] 161
ESC 02/05 04/06
Audio Data Syntax of CCITT Recommendation T.101.
- [52] [[ISO-IR]] 186
ESC 02/05 04/08
VEMMI Data Syntax of (draft) ITU-T Recommendation


* VTS の DOCS

[4] [[ISO-IR]] 125 
[CODE(charname)@en[ESC]] [N[02/05]] [N[02/15]] [N[04/02]]
Virtual Terminal Service Transparent Set は、
8ビットの1バイト符号化文字集合で、 ISO [[OSI]] 仮想端末規格で利用します。
仮想端末サービス (VTS) の利用者が VTS の適用範囲外たる意味を
一部又は全部の値に割り当てます。 VTS はその意味や解釈の責任を有しません。
ISO/IEC 2022 符号化体系に復帰する手段はありません。
(ISO 9040, ISO 9041)

* 

[57] [SEE[ [[VT][VT100]] ]]

- [56] [CODE(charname)@en[ESC]] [N[2/5]] [N[3/8]] -
[CODE(charname)@en[DECHPPCL]] (Enter HP PCL emulation mode)


* 文脈

[1] [[SGML]] の[[公式公開識別子]]の[[公開文指示シーケンス]]における [CODE(char)[DOCS]] の用法についての話は [CODE(WikiPage)[[[CHARSET]]]] を参照。

[59] 
[[ISO/IEC 2022 character transfer syntax]] では使えません。
[SRC[[[ISO/IEC 2022]] A.3.2]]

* 関連

[38] 
[[ISO/IEC 2022]] を使用する場面によっては、
使用する[[符号化システム]]を指定する方法が別途用意されているかもしれません。
また、 [[ISO/IEC 2022]] にも [[ISO/IEC 2022]]
[[符号化データ要素]]列の終わりを示す
[CODE(charname)@en[[[CMD]]]] という[[制御機能]]があります。
このようなものを使用して [[ISO/IEC 2022]]
とそれ以外を区別できる環境では、それを使って構いません。
特別そのような方法が用意されていない場合は、
[CODE(charname)@en[[[DOCS]]]] を使って[[符号化システム]]を切換えることにしても構いません。

* メモ






[3] [CITE[Compound Text Encoding]], [TIME[2010-12-20T07:36:19.000Z]], [TIME[2022-04-30T07:37:11.422Z]] <https://www.x.org/releases/X11R7.6/doc/xorg-docs/specs/CTEXT/ctext.html#Non_Standard_Character_Set_Encodings>


- [13] [CITE[Digital Ansi-Compliant Print Protocol Lev 2 Program. Ref. Man. - PPLV2PMB.PDF]], [TIME[1995-08-31T14:32:02.000Z]], [TIME[2022-05-02T12:20:35.927Z]] <http://sup.xenya.si/sup/info/digital/MDS/jun99/Cd3/PRINTER/PPLV2PMB.PDF#page=108>
-- [14] <http://sup.xenya.si/sup/info/digital/MDS/jun99/Cd3/PRINTER/PPLV2PMB.PDF#page=160>
-- [15]  <http://sup.xenya.si/sup/info/digital/MDS/jun99/Cd3/PRINTER/PPLV2PMB.PDF#page=170>
