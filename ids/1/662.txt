[24] [DFN[[RUBYB[[[フレーム]]]@en[frame]]]]は、[[文書]]中に他の[[文書]]を埋め込むものです。
[[フレーム]]を表す[[閲覧文脈]]を、[[入れ子閲覧文脈]]といいます。

* 仕様書

[REFS[
- [51] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#the-iframe-element>
- [20] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2015-05-06 10:42:35 +09:00]] 版) <https://html.spec.whatwg.org/#active-frame-element>
- [44] [CITE@en-GB-x-hixie[HTML Standard]] ([TIME[2016-05-20 22:03:07 +09:00]]) <https://html.spec.whatwg.org/#browsing-context-container>
]REFS]

* フレーム (Web)

- [1] ''段組は愚かなのだろうか?'' <http://pc2.2ch.net/test/read.cgi/hp/1043588207/> 段組云々とかいいながら実際はフレームがテーマなわけだが。
- [2] >>1 用語が混乱しててわかりにくいよなあ

[3]
フレームの大きさを [CODE(HTMLa)[[[noresize]]]] で固定する奴、
あれが激しく使いづらいですよねぇ。
糞著者は自分と違った大きさの窓で読んでる人のことも考えて欲しい。 Scroll bar 消す奴も同罪。

これ、ブラウザ側に無効化機能がついていないのも不思議。
([[Mr.Anonymous]] [WEAK[2004-05-27 13:01:32 +00:00]])

[4]
HTML のフレームは presentation だけで
semantics がないという問題を抱えているので、
こんなのを考えてみた。

[PRE(XML)[
<frameset
  xmlns:docs="http://profile.example/">
  <frame rel="docs:contents"
    src="toc"/>
  <frame rel="docs:body"
    src="page1"/>
</frameset>
]PRE]

フレーム内の文書では、
[SAMP(XML)[<anchor href="page2" rel="next docs:body">Next</anchor>]]
とでもしておきます。

[SAMP(XMLa)[rel]] 属性は [[QName]] 並びで、リンクを辿る時には [CODE(HTMLa)[[[target]]]] 属性のように作用します。フレームの [CODE(XMLa)[rel]] 値と一致するものが見つかれば、そこに表示すると言う寸法。

([[Mr.Anonymous]] [WEAK[2004-05-27 13:09:08 +00:00]])

[5]
[SAMP(XMLa)[rel]] 属性の中に一つもフレームと一致するものがなければ、
現在の文書(群)とは関係のない文書へのリンクということで、 [SAMP(HTML)[[[_top]]]] なり [SAMP(HTML)[[[_blank]]]] なりで表示すれば OK (どちらにするかはスタイルシートで制御)。
([[Mr.Anonymous]] [WEAK[2004-05-27 13:11:57 +00:00]])

[6]
[CITE[frameは本当に便利か - 駄的HTML改善計画]] <http://car.s35.xrea.com/better/frame.php>

[10]
[CITE[Frames]] ([CODE[2007-02-28 00:19:09 +09:00]] 版) <http://web.archive.org/web/19970613221220/www82.netscape.com/comprod/products/navigator/version_2.0/frames/index.html>
([[名無しさん]])


[11]
>>10 みてもやっぱり、アイディアはよかったと思うんだけどね。。。
([[名無しさん]] [WEAK[2007-02-27 15:34:11 +00:00]])

[12] [CITE@en[MAMA: Frames - Opera Developer Community]] ([TIME[2008-11-25 20:37:51 +09:00]] 版) <http://dev.opera.com/articles/view/mama-frames/>

[13] しかし [[CSS]] を使ったいわゆる[[擬似フレーム]]は、結構メジャーになったとはいえ、
いまいちなんか微妙なんですよねー。

[16] [CITE[HTML5: Frames — Anne’s Weblog]] ([TIME[2009-02-17 10:44:00 +09:00]] 版) <http://annevankesteren.nl/2009/02/html5-frames>

* フレームによる無断埋め込み

[14] [CITE@ja[偽「松阪市公式HP」 | Okumura's Blog]] ([TIME[2009-02-11 09:36:10 +09:00]] 版) <http://oku.edu.mie-u.ac.jp/~okumura/blog/node/2354>

>単に本物の松阪市ホームページをフレームで表示しているだけ

>県警によれば「事件性はない」が,刑事事件にならないからといって,民事訴訟だってありうるし,いずれにしても善良な市民のすることではないので,真似しないこと。

新聞記事: <http://image.blog.livedoor.jp/info_matsusaka/imgs/0/3/0341de4b.JPG>

[15] >>14 単に[[警察]]が判断しただけで[[判例]]でもなんでもありませんが、
単に[[フレーム]]として埋め込んだという事実だけでは問題ないという判断が下されたことは興味深いです。

* 要素

[7] 次の[[要素]]があります。
[FIG(list short)[
- [CODE(HTMLe)@en[[[iframe]]]] ★
- [CODE(HTMLe)@en[[[frame]]]] ★
- [CODE(HTMLe)@en[[[frameset]]]]
- [CODE(HTMLe)@en[[[noframes]]]]
- [CODE(HTMLe)@en[[[object]]]] ★
- [CODE(HTMLe)@en[[[embed]]]] ★
]FIG]

[47] 「★」が[[閲覧文脈包含子]]となり得るものです。

* 閲覧文脈包含子

[45] [[入れ子閲覧文脈]]の「[[親]]」に当たるものを、[[閲覧文脈包含子]]といいます。
[[フレーム]]を作る[[要素]]に当たります。

[46] [[閲覧文脈包含子]]は、次の状態を持ちます。
[FIG(list members)[
: [F[入れ子閲覧文脈]] :
: [F[内容文書]] :
]FIG]

* 処理

[62] [CODE(HTMLe)@en[[[iframe]]]] [[要素]]や [CODE(HTMLe)@en[[[frame]]]]
[[要素]]が[[文書に挿入]]されたら、次のようにしなければ[['''なりません''']] [SRC[>>51, >>20]]。
[FIG(steps)[
= [27] [[文書]]が[[閲覧文脈]]を持たなければ、停止します。
= [28] [[入れ子閲覧文脈]]の[[閲覧文脈の作成]]を実行します。
= [29] [[閲覧文脈名]]を、 [CODE(HTMLa)@en[[[name]]]] [[属性]]があれば[[属性値]]、なければ[[空文字列]]に設定します。
= [30] [[属性]]の処理を''初回''実行します。
]FIG]

[63] [CODE(HTMLe)@en[[[iframe]]]] [[要素]]や [CODE(HTMLe)@en[[[frame]]]]
[[要素]]が[[文書から削除]]されたら、次のようにしなければ[['''なりません''']] [SRC[>>51, >>20]]。
[FIG(steps)[
= [[要素]]が[[入れ子閲覧文脈]]を持つなら、[[閲覧文脈を捨てる]]処理を実行します。
]FIG]

;; [64] [[文書のunload]]ではなく[[文書を捨てる]]が実行されます。

[21] [[属性]]の変更時には、次に示す[[属性]]の処理が呼び出されます。

;; [CODE(HTMLe)@en[[[iframe]]]], [CODE(HTMLe)@en[[[frame]]]] も参照。

[67] [DFN[[RUBYB[[[[CODE(HTMLe)@en[iframe]]属性の処理]]]@en[process the [CODE(HTMLe)@en[iframe]] attributes]]]]/[DFN[[RUBYB[[[[CODE(HTMLe)@en[frame]]属性の処理]]]@en[process the [CODE(HTMLe)@en[frame]] attributes]]]]は、
次のようにしなければ[['''なりません''']] [SRC[>>51, >>20]]。
[FIG(steps)[
= [[要素]]の[[入れ子閲覧文脈]]の[[活性文書]]の [[completely loaded]] が設定されていないなら、
== [VAR[置換]]を、[[真]]とします。
= それ以外で、[[要素]]の[[入れ子閲覧文脈]]の[[セッション履歴]]が[[文書]]を1つだけ含み、
それが[[初期「[CODE(URI)@en[about:blank]]」文書]]なら、
== [VAR[置換]]を、[[真]]とします。
= それ以外なら、
== [VAR[置換]]を、[[偽]]とします。
= [37] [[要素]]が [CODE(HTMLe)@en[[[iframe]]]] で、
[[要素]]に [CODE(HTMLa)@en[[[srcdoc]]]] [[属性]]があれば、
== [31] 次の通り [[navigate]] します。
[FIG(list members)[
:[VAR[[[navigate]] する[[閲覧文脈]]]]:[[要素]]の[F[[[入れ子閲覧文脈]]]]
:[VAR[新しい[[資源]]]]:
[FIG(list members)[
[FIGCAPTION[
[32] [[応答]]
]FIGCAPTION]
:[F[[[URLリスト]]]]:([CODE(URI)@en[[[about:srcdoc]]]])
:[F[[[HTTPS状態]]]]: [[要素]]の[F[[[節点文書]]]]の[F[[[HTTPS状態]]]]
:[F[[[CSPリスト]]]]: [[要素]]の[F[[[節点文書]]]]の[F[[[CSPリスト]]]]
:[F[[[ヘッダーリスト]]]]:
[FIG(list members)[
:[CODE(HTTP)@en[[[Content-Type]]]]:[CODE(MIME)@en[[[text/html]]]]
: [CODE(HTTP)@en[Referrer-Policy]] : [[要素]]の[F[節点文書]]の[F[参照元ポリシー]]
]FIG]
:[F[[[本体]]]] ([[文字列]]):[[要素]]の [CODE(HTMLa)@en[[[srcdoc]]]] [[属性値]]
]FIG]
:[VAR[[[始点閲覧文脈]]]]:[[要素]]の[F[[[節点文書]]]]の[F[[[閲覧文脈]]]]
:[VAR[[[置換有効]]]]:[VAR[置換]]
:[VAR[[[[CODE(HTMLe)@en[iframe]] [CODE(HTMLa)@en[srcdoc]]文書]]]]:[[真]]
]FIG]
= [36] それ以外で、[[要素]]に [CODE(HTMLa)@en[[[src]]]] [[属性]]が無く、本処理が''初回''実行なら、
== [[タスク]]を[[タスクキュー]]に追加します。
[FIG(list members)[
[FIGCAPTION[
[[タスク]]
]FIGCAPTION]
:[[タスク源]]:[[DOM操作タスク源]]
:処理:
[FIG(steps)[
= [42] [[要素]]が [CODE(HTMLe)@en[[[iframe]]]] なら、
== [[iframe load event steps]] を実行します。
= それ以外なら、
== [[単純イベントを発火]]します。
[FIG(list members short)[
[FIGCAPTION[
[[単純イベント]]
]FIGCAPTION]
:[[イベント型]]:[CODE(DOMe)@en[[[load]]]]
:[[イベント対象]]:[[要素]]
]FIG]
]FIG]
]FIG]
= それ以外なら、
== [VAR[[[URL]]]] を、 [CODE(URI)@en[[[about:blank]]]] に設定します。
== [[要素]]に [CODE(HTMLa)@en[[[src]]]] [[属性]]があり、値が[[空文字列]]''以外''なら、
=== [[要素の基底URL]]に対して [CODE(HTMLa)@en[[[src]]]] [[属性値]]で [[URLの解決]]を行います。
=== 成功なら、 [VAR[[[URL]]]] を、解決した [[URL]] に設定します。
== [41] 
[[祖先閲覧文脈]]で[[活性文書]]の[[文書の番地]]と [VAR[[[URL]]]] が同じものがあるなら、ここで停止します。ただしここで [[URLの比較]]に当たり[[素片識別子]]は無視します。
== [[navigate]] します。
[FIG(list members)[
:[[navigate]] する[[閲覧文脈]]:[[要素]]の[[入れ子閲覧文脈]]
:新しい[[資源]]:[[URL]] は、[VAR[[[URL]]]]
:[[始点閲覧文脈]]:[[要素]]の[[節点文書]]の[[閲覧文脈]]
:[[置換有効]]:[VAR[置換]]
]FIG]
]FIG]

[HISTORY[
[22] かつては、 [CODE(HTMLe)@en[[[frame]]]] [[要素]]については、
なぜか再帰的な埋め込みが抑制されていませんでした。
]HISTORY]

;; [23] [CODE(HTMLe)@en[[[frame]]]] [[要素]]の2回目以降の呼び出しで
[CODE(HTMLa)@en[[[src]]]] [[属性]]が指定されていない場合
(>>42) についてなぜか [[HTML Standard]] では規定がありません。

* 利用者インターフェイス

[26] [CODE(HTMLa)@en[[[sandbox]]]] も参照。

* 歴史

[9] [[フレーム]]は [[Netscape Navigator 2.0]] が最初に実装しました。

[8] 旧 [[HTML WG]] は [[XFrames]] を提案しましたが、受け入れられませんでした。

[17] 
2009年になってようやく初めて、[[フレーム]]の[[レンダリング]]が [[HTML5]]
仕様書で正確に定義されました。

;; [CITE@en[(X)HTML5 Tracking]] ([TIME[2009-07-26 19:00:30 +09:00]] 版) <http://html5.org/tools/web-apps-tracker?from=2758&to=2759>

[18] [CITE@en[(X)HTML5 Tracking]]
([TIME[2009-08-22 21:14:18 +09:00]] 版)
<http://html5.org/tools/web-apps-tracker?from=2758&to=2759>

[19] [CITE@en[Web Applications 1.0 r8518     Be more explicit about viewport rendering sizes (rendered and not)]]
( ([TIME[2014-03-01 09:11:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8517&to=8518>

[33] [CITE@en[Add 'HTTPS state' to settings objects · whatwg/html@6de5241]] ([TIME[2015-09-29 23:41:32 +09:00]] 版) <https://github.com/whatwg/html/commit/6de524157fcf341e10efb3eec634bcf7325e6ee4>

[34] [CITE@en[Add and populate global object's "CSP list" · whatwg/html@479dfbf]] ([TIME[2015-11-06 23:05:57 +09:00]] 版) <https://github.com/whatwg/html/commit/479dfbf1ff68b746ed3f81cc7415165e3342709e>

[35] [CITE@en[Move 'HTTPS state' from Window to Document · whatwg/html@68390ce]] ([TIME[2015-11-06 23:23:56 +09:00]] 版) <https://github.com/whatwg/html/commit/68390cea99f9f19881a16e1c8adaf1b130b4d1cc>

* 関連

[25] [[パケット]]としての[[フレーム]] ([[WebSocketフレーム]]や[[HTTP/2フレーム]])
とは無関係です。

[38] [CITE@en[Remove <iframe seamless> · whatwg/html@1490eba]]
([TIME[2016-02-04 19:25:00 +09:00]] 版)
<https://github.com/whatwg/html/commit/1490eba4dba5ab476f0981443a86c01acae01311>

[39] [CITE@en[URLs are parsed and produce records · whatwg/html@30bc255]]
([TIME[2016-02-14 23:07:40 +09:00]] 版)
<https://github.com/whatwg/html/commit/30bc2557105ad62881ec9670f253febbc9761b44>

[40] [CITE@en[Add recursion check to frame elements · whatwg/html@edb786b]]
([TIME[2016-03-23 21:27:57 +09:00]] 版)
<https://github.com/whatwg/html/commit/edb786b16cf5690fe9211fb28fb29cded2249dc1>

[43] [CITE@en[Regression fix: define source browsing context for iframe and frame]]
( ([[annevk]]著, [TIME[2016-05-03 23:24:09 +09:00]]))
<https://github.com/whatwg/html/commit/a714902e66d4d9d967d7e3e7505c6fdfb365015d>