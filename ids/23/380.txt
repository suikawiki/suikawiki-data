[8] [DFN[[CODE(URI)@en[[[oauth_callback]]]]]] は、 [[OAuth 1.0]]
において[[コールバック]]の [[URL]] を指定する[[引数]]です。

* 仕様書

[REFS[
- [1] '''[CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-2.1>'''
- [6] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-2.2>
- [16] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-4.13>
]REFS]

* 意味

[2] [CODE(URI)@en[[[oauth_callback]]]] [[引数]]は、[[クライアント]]が[[一時credentials要求]]で[[鯖]]に指定します
[SRC[>>1]]。
この[[引数]]は[['''必須''']]です [SRC[>>1]]。

[3] その値は、[[資源所有者認可]]の完了時に[[鯖]]が[[資源所有者]]を[[リダイレクト]]して戻す先の[[絶対URL]]
を表します [SRC[>>1]]。

[4] [[クライアント]]が[[コールバック]]を受信できない時や、[[コールバック]]の [[URL]]
を他の方法で指定する時には、値を [CODE(URI)[[[oob]]]] としなければ[['''なりません''']] [SRC[>>1]]。

;; [5] [CODE[oob]] は「out-of-band configuration」を表します [SRC[>>1]]。

[7] [[資源所有者認可]]において[[資源所有者]]がアクセスを認めたら、
[[資源所有者]]は [CODE(URI)@en[[[oauth_callback]]]] その他の方法で指定された[[コールバック]]
[[URL]] に[[リダイレクト]]されます [SRC[>>6]]。その場合 [[query]]
に[[引数]]が追加されます。あるいは [CODE[[[oob]]]]
の場合は、[[リダイレクト]]のかわりに[[検証符号]]が表示されます [SRC[>>6]]。

;; [[資源所有者認可]]を参照。

;; [9] [CODE(URI)@en[[[oauth_callback]]]] は[[必須]]ですが、[[鯖]]はその他の方法で[[コールバック]]先を決定しても良いようです。

* セキュリティー

[11] [[鯖]]は、指定された[[コールバックURL]]が適切なものであるか注意して確認する必要があります。

[10] 実装によっては、サービス固有の管理画面で[[コールバックURL]]
を指定したり、認める[[コールバック]] [[URL]] のパターンを指定できたりすることがあります。

[12] [CODE(URI)@en[[[javascript:]]]] や [CODE(URI)@en[[[data:]]]]
のような [[URL]] が指定されるのを認めてしまうと、
意図しない[[起源]]で[[スクリプト]]が実行されるなど[[セキュリティー]]上の問題が生じる虞があります。

[13] 一般的でない [[URL scheme]] が指定されるのを無条件に認めてしまうと、
第三者への意図しない情報漏洩の注入の機会を生じさせてしまうかもしれず、
[[鯖]]は十分注意しなければなりません。

[EG[
[14] 例えば[[スマートフォンアプリ]]向けの [[URL scheme]]
の指定を認めると、悪意のある第三者が他の[[スマートフォンアプリ]]の [[URL scheme]]
を使う[[スマートフォンアプリ]]を配布し、[[コールバックURL]]
へのアクセスを“乗っ取る”ことができるかもしれません。
]EG]

[15] [[改行]]が含まれる [[URL]] を指定された場合にそれをそのまま 
[[HTTP]] [CODE(HTTP)@en[[[Location:]]]] [[ヘッダー]]に使い、
悪意のある[[クライアント]]が任意の [[HTTPヘッダー]]を指定することを認めてしまう、
といったことがないよう[[鯖]]は注意が必要です。

[17] [[OAuth]] [[クライアント]]は、[[コールバックURL]]へのアクセスが[[資源所有者]]の意思に基づき[[資源所有者認可]]から[[リダイレクト]]されてきたものであり、
[[CSRF]] によって意図せず発生させられたものでないことを確認する必要があります [SRC[>>16]]。
[[一時credentials要求]]を [[OAuth]] [[クライアント]]に送信させた[[資源所有者]]と[[コールバックURL]]
にアクセスしてきた[[資源所有者]]が同一であることは [[OAuth]]
仕様としては保証されませんから、 [[OAuth]] [[クライアント]]側で確認が必要です。

;; [18] [[コールバックURL]]には [CODE(URI)@en[[[oauth_verifier]]]] [[引数]]が追加されて[[リダイレクト]]される
[[URL]] となりますが、悪意のある第三者が正当な方法で得た [CODE(URI)@en[[[oauth_verifier]]]]
[[引数]]を付けた [[URL]] を用意することが可能ですから、
[CODE(URI)@en[[[oauth_verifier]]]] が有効な値であるかどうかと [[CSRF]]
であるか否かは無関係です。