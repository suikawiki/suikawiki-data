* 仕様書

[REFS[
- [4] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-2.3>
- [1] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-3>
-- [6] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-3.1>
-- [18] [CITE@en[RFC 5849 - The OAuth 1.0 Protocol]] ([TIME[2014-12-28 14:19:21 +09:00]] 版) <http://tools.ietf.org/html/rfc5849#section-3.2>
]REFS]

* 意味

[2] [RUBYB[[[認証された要求]]]@en[authenticated request]]には、 [[クライアント]]を表す[[クライアントcredentials]]と、
[[資源所有者]]を表す[[トークンcredentials]]を含めます [SRC[>>1]]。

[3] [[認証された要求]]の作成に当たっては[[鯖]]の設定に関する事前の知識が必要です。
[[クライアント]]が[[鯖]]の要求する設定をどう[[発見]]するかは [[OAuth]]
仕様の範囲外とされています。 [SRC[>>1]]

[5] [[トークン要求]]では、[[クライアント]]が[[鯖]]に[[認証された要求]]を送信しますが、
この時は[[クライアントcredentials]]と共に ([[トークンcredentials]]のかわりに)
[[一時credentials]]を使います [SRC[>>4]]。

* 作成

[7] [[認証された要求]]は、[[HTTP要求]]に次のように[[引数]]を加えて作成します [SRC[>>6]]。

[FIG(steps)[
= [8] 次の[[引数]]を用意します。
=- [9] [CODE(HTTP)@en[[[oauth_consumer_key]]]] は、[[クライアントcredentials]]の[[識別子]]とします。
=- [10] [CODE(HTTP)@en[[[oauth_token]]]] は、[[資源所有者]]を関連付けるための[[トークン]]の値とします。
[[資源所有者]]と関連付けない場合には、省略して構いません。
=- [11] [CODE(HTTP)@en[[[oauth_signature_method]]]] は、
[[クライアント]]が使う[[署名方式]]の名前とします。
=- [12] [CODE(HTTP)@en[[[oauth_timestamp]]]] は、[[タイムスタンプ]]とします。
ただし [CODE(HTTP)@en[[[oauth_signature_method]]=[[PLAINTEXT]]]] なら、
省略して構いません。
=- [13] [CODE(HTTP)@en[[[oauth_nonce]]]] は、[[nonce]] 値とします。
ただし [CODE(HTTP)@en[[[oauth_signature_method]]=[[PLAINTEXT]]]] なら、
省略して構いません。
=- [14] [CODE(HTTP)@en[[[oauth_version]]]] は、[CODE(HTTP)[[[1.0]]]] とします。
省略しても構いません。
= [15] 用意した[[引数]]を、[[転送方式]]のいずれかにより[[要求]]に追加します。
= [16] [CODE(HTTP)@en[[[oauth_signature]]]] の値を計算します。
= [17] [CODE(HTTP)@en[[[oauth_signature]]]] [[引数]]を >>15 で選択した[[転送方式]]により[[要求]]に追加します。
]FIG]

* [RUBYB[検証]@en[verify]]

[19] [[鯖]]は、[[認証された要求]]を受信したら、次のように[RUBYB[妥当性検証]@en[validate]]しなければ[['''なりません''']] [SRC[>>18]]。
[FIG(list)[
- [20] [[要求]]の[[署名]]を独自に計算し、 [CODE(HTTP)@en[[[oauth_signature]]]]
で指定された値と比較します。
- [21] [[署名方式]]として [CODE(HTTP)@en[[[HMAC-SHA1]]]] や
[CODE(HTTP)@en[[[RSA-SHA1]]]] が使われていれば、
[CODE(URI)@en[[[oauth_nonce]]]], [CODE(URI)@en[[[oauth_timestamp]]]],
[CODE(URI)@en[[[oauth_token]]]] の値 (あれば) の組み合わせについて、
以前[[クライアント]]が使ったものと一致していないことを確認します。
- [22] [CODE(URI)@en[[[oauth_token]]]] があれば、
[[クライアント]]の[[認可]]の範囲と状態を[RUBYB[検証]@en[verify]]します。
- [23] [CODE(URI)@en[[[oauth_version]]]] があれば、値が [CODE(URI)[[[1.0]]]]
か確認します。
]FIG]

[24] この[RUBYB[検証]@en[verification]]に失敗した場合には、
適切な[[状態符号]]で[[応答]]を返す[['''べきです''']]。
[[payload body]] に拒絶の理由の詳細を含めて構いません。 [SRC[>>18]]

[27] [CODE(URI)@en[[[oauth_timestamp]]]] がある程度古ければ、
[[鯖]]は拒絶しても構いません。

[25] 未対応の[[引数]]、未対応の[[署名方式]]、[[引数]]の不足、
[[OAuth]] [[引数]]の重複が見られる時は、 [CODE(HTTP)[[[400]]]]
[[応答]]を返す[['''べきです''']] [SRC[>>18]]。

[26] 非妥当な[[クライアントcredentials]]、
非妥当な[[トークン]]や[[満期]]した[[トークン]]、
非妥当な[[署名]]、
非妥当な [[nonce]] や使用済みの [[nonce]] の時は、
[CODE(HTTP)[[[401]]]] [[応答]]を返す[['''べきです''']] [SRC[>>18]]。
