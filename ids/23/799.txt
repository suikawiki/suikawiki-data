* 仕様書

[REFS[
- [4] [CITE@en[RFC 6125 - Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)]] ([TIME[2015-03-13 22:27:53 +09:00]] 版) <https://tools.ietf.org/html/rfc6125#section-6.4.3>
- [14] [CITE@en[RFC 6125 - Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)]] ([TIME[2015-03-13 22:27:53 +09:00]] 版) <https://tools.ietf.org/html/rfc6125#section-7.2>
]REFS]

* RFC 6125

[12] [[RFC 6125]] は [[TLS]] において[[証明書]]を使って [[service identity]]
を検証する方法を規定しており、その中で[[ワイルドカード文字]]を含む[[ドメイン名]]の解釈についても規定しています。
この規定は、 [[RFC 6125]] を採用する仕様にのみ適用されます。

;; [[service identity]] も参照。

;; [13] [[HTTPS]] 仕様は現在事実上メンテナンスされていない状態にあり、
[[RFC 6125]] を採用するとは明記されていないものの、
[[RFC 6125]] に反する挙動がセキュリティーホールとみなされた例 (>>3) もあります。

** ワイルドカードの使用

[15] [[証明書]]で[[ワイルドカード文字]]は使用する[['''べきではありません''']]。
[[ワイルドカード証明書]]はドメイン内のすべてのホストを自動的に認めてしまうものなので、
管理者にとっては便利かもしれませんが、危険も伴うものです。また、
既存の[[アプリケーション]]は[[ワイルドカード文字]]を認める位置が不明瞭であったり、
差異があったりします。[[Aラベル]]や [[Uラベル]]での[[ワイルドカード文字]]の扱いを定義した仕様もありませんでした。 [SRC[>>14]]

;; [25] しかし[[後方互換性]]その他の理由で[[ワイルドカード]]が必要な仕様は、
[[ワイルドカード]]の使用を続けても構いません。 [SRC[>>14]]

[16] [[ワイルドカード文字]]の使い方には次のようなバリエーションがあり、
仕様や実装により扱いの違いが生じていることがあります [SRC[>>14]]。
[FIG(list)[
- [17] 最左ラベル全体 ([CODE[*.example.com]])
- [18] 最左ラベルの一部 ([CODE[fo*.example.com]])
- [19] 最左でないラベルの一部または全部 ([CODE[www.*.example.com]])
- [20] [[public suffix]] の一部または全部を表すもの ([CODE[*.co.uk]])
- [21] ラベル中に複数含まれる ([CODE[f*b*r.example.com]])
- [22] 複数のラベルに含まれる ([CODE[*.*.example.com]])
]FIG]

[23] 実装が[[Uラベル]]や[[Aラベル]]に[[ワイルドカード文字]]を含めたり、
検査したりすることは[RUBYB[強く非推奨]@en[strongly discouraged]]です。
ただし[[最左ラベル]]が[[ワイルドカード文字]]でそれ以外が
[[NR-LDHラベル]]、[[Aラベル]]、[[Uラベル]]であるのは構いません。 [SRC[>>14]]

[EG[
[24] 例えば [CODE[xn--kcry6tjko*.example.org]] は問題ありますが、
[CODE[*.xn--kcry6tjko.example.org]] は問題ありません。 [SRC[>>14]]
]EG]

** 比較

[5] [[クライアント]]は、[[ラベル]]の一部または全部が[[ワイルドカード文字]]
[CODE[[[*]]]] である[[DNSドメイン名]]が識別子として[[証明書]]に示されている時に、
[[参照識別子]]と[[一致]]するか次の通り検査することができます [SRC[>>4]]。

[6] [RUBYB[最左ラベル]@en[left-most label]]以外に[[ワイルドカード文字]]が含まれる識別子が[[証明書]]に示されていても、
一致するか調べる[['''べきではありません''']] [SRC[>>4]]。

[EG[
[7] [CODE[bar.*.example.net]] との一致を調べるべきではありません [SRC[>>4]]。
]EG]

[8] [[証明書]]に示されている識別子の最左ラベル全体が[[ワイルドカード文字]]の時は、
[[参照識別子]]の最左ラベル以外と比較する[['''べきではありません''']] [SRC[>>4]]。

[EG[
[9] [CODE[*.example.com]] は [CODE[foo.example.com]] と一致しますが、
[CODE[bar.foo.example.com]] や [CODE[example.com]] とは一致しません [SRC[>>4]]。
]EG]

[10] [[証明書]]に示されている識別子の[[ワイルドカード文字]]が含まれる[[ラベル]]にその他の文字が含まれる場合に、
一致するか調べても構いません。 [SRC[>>4]]

[11] [[証明書]]に示されている識別子の[[Uラベル]]や[[Aラベル]]に[[ワイルドカード文字]]が含まれている時は、
一致するか調べる[['''べきではありません''']] [SRC[>>4]]。

* 歴史

[1] [CITE@en[159483 – cert name matching: RFC 2818 vs. backwards compatibility (wildcards)]]
([TIME[2015-03-16 12:47:58 +09:00]] 版)
<https://bugzilla.mozilla.org/show_bug.cgi?id=159483>

[2] [CITE[IETF - TLS - RFC 2818 wildcard rationale]]
([TIME[2015-03-16 11:57:01 +09:00]] 版)
<http://ietf.10.n7.nabble.com/RFC-2818-wildcard-rationale-td246010.html>

[3] [CITE@en[903885 – (CVE-2014-1492) Hostname matching code violates RFC 6125 for IDNA]]
([TIME[2015-03-23 23:20:36 +09:00]] 版)
<https://bugzilla.mozilla.org/show_bug.cgi?id=903885>