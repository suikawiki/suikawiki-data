head	1.30;
access;
symbols
	suikawiki3-final:1.30
	before-db-leaffile:1.6
	after-upgrade-to-suikawiki-3:1.3
	before-fork-suikawiki3:1.3
	after-restore-20040122:1.3;
locks; strict;
comment	@# @;


1.30
date	2008.07.03.04.05.48;	author wakaba;	state Exp;
branches;
next	1.29;

1.29
date	2008.03.27.02.43.19;	author wakaba;	state Exp;
branches;
next	1.28;

1.28
date	2008.03.23.02.44.14;	author wakaba;	state Exp;
branches;
next	1.27;

1.27
date	2007.08.18.02.46.18;	author wakaba;	state Exp;
branches;
next	1.26;

1.26
date	2007.08.08.02.34.13;	author wakaba;	state Exp;
branches;
next	1.25;

1.25
date	2007.05.08.02.45.00;	author wakaba;	state Exp;
branches;
next	1.24;

1.24
date	2007.05.03.02.34.48;	author wakaba;	state Exp;
branches;
next	1.23;

1.23
date	2007.01.18.02.24.07;	author wakaba;	state Exp;
branches;
next	1.22;

1.22
date	2007.01.13.02.31.16;	author wakaba;	state Exp;
branches;
next	1.21;

1.21
date	2006.11.08.02.14.28;	author wakaba;	state Exp;
branches;
next	1.20;

1.20
date	2006.04.23.02.18.46;	author wakaba;	state Exp;
branches;
next	1.19;

1.19
date	2006.03.03.02.13.39;	author wakaba;	state Exp;
branches;
next	1.18;

1.18
date	2006.02.03.02.14.40;	author wakaba;	state Exp;
branches;
next	1.17;

1.17
date	2005.09.03.02.08.30;	author wakaba;	state Exp;
branches;
next	1.16;

1.16
date	2005.07.18.02.08.08;	author wakaba;	state Exp;
branches;
next	1.15;

1.15
date	2005.07.08.02.06.45;	author wakaba;	state Exp;
branches;
next	1.14;

1.14
date	2005.05.31.02.06.19;	author wakaba;	state Exp;
branches;
next	1.13;

1.13
date	2005.04.08.02.06.12;	author wakaba;	state Exp;
branches;
next	1.12;

1.12
date	2005.04.03.02.05.24;	author wakaba;	state Exp;
branches;
next	1.11;

1.11
date	2004.11.27.02.05.28;	author wakaba;	state Exp;
branches;
next	1.10;

1.10
date	2004.08.18.02.11.49;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2004.07.23.02.04.15;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2004.06.08.02.08.57;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2004.05.13.02.08.31;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2004.03.31.02.00.54;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2004.03.23.02.01.36;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2004.03.18.02.01.12;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.18.00.11.10;	author w;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.28.10.14.28;	author make;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.27.07.25.01;	author make;	state Exp;
branches;
next	;


desc
@@


1.30
log
@auto-committed
@
text
@

* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

[21] '''仕様書'''
- [[XML基底]]
-- [6] [CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<IW:XMLBase:"#syntax">
-- [25] [CITE@@en[Errata in REC-xmlbase-20010627]] 
<http://www.w3.org/2001/06/xmlbase-errata#E01>
(詳細は[[XML基底]]の項を参照。)

[[#comment]]


** 属性値

[44] '''適当な属性値'''

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]は、
''後述の処理の後に''[[RFC 2396]] [[URI参照]]として処理されます。
[SRC[XML基底 3]]

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]で使うことのできる[[文字]]は、
[[XML]]の一般の場合と同じです。 [SRC[XML基底 3.1]]

[[属性値]]から[[URI参照]]に変換するためには、
- [[非ASCII文字]]
- [CODE(char)@@en[[[U+0000]]]]〜[CODE(char)@@en[[[U+0020]]]]
- [CODE(char)@@en[[[U+007F]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]],
[CODE(char)[[["]]]], [CODE(char)[[[{]]]], [CODE(char)[[[}]]]],
[CODE(char)[[[|]]]], [CODE(char)[[[\]]]], [CODE(char)[[[^]]]],
[CODE(char)[[[`]]]]

を[[UTF-8]]で[[百分率符号化]]します。 [SRC[XML基底 3.1]]

;; 詳しくは[[XML//URI]]および[[IRI]]の項を参照。

[52] '''RFC 3986との関係'''

[[RFC 3986]]の新しい構文では、[[命名権者]]部に[[百分率符号化]]や新しい[[IP番地]]のための構文が認められていますが、
[[RFC 2396]]や[[RFC 2732]]では認められていません。
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3986]]の[[URI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3986]]
に従って解釈する実装も不適合にはなりません。

[53] '''RFC 3987との関係'''

[[RFC 3987]]も[[RFC 3986]]にあわせた新しい構文を採用していますから、
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3987]]の[[IRI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3987]]
に従って解釈する実装も不適合にはなりません。

;; なお、 >>44 の[[URI参照]]に変換するために[[逃避]]しなければならない[[文字]]の種類は、
[[RFC 3987]]の[[算法]]で規定されたものと一致しています。

[42] '''意味不定の場合'''

- [43] [[XML基底]]仕様を直接または間接に参照する[[応用]]''以外''では、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の動作は未定義です。
[SRC[XML基底 1]]
- [40] 値が[[妥当]]な[[URI参照]]にならない場合の動作は、
[[応用]]依存です。 [SRC[XML基底正誤表 E03]]

[20] >>40
(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

;; 
[45]
[[XML基底]] 3では[[RFC 2396]] [[URI参照]]として解釈するとしていますが、
同3.1の[[逃避]]に関する[[RFC 2732]]も参照しています。
字面通り厳密に解釈すると結局[[RFC 2732]]拡張は使えないことになってしまいますが、
本当にそれでよいのでしょうか。[[RFC 3986]]が発行された今、
早急に改訂するべきです。

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)


[75]
実のところ、[[XML基底]]仕様書には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性値]]がある処理の後 [[RFC 2396]]
[[URI参照]]として''処理される'' (実装に。) という説明があるだけで、
[[著者]]が [CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性]]にどのような値を指定してよいのか、
どのような値を指定することが期待されているのかがまったく規定されていません。
([[名無しさん]])


[[#comment]]


** 基底URIの算出

[46] [SRC[XML基底 4]]
- ある[[要素]]の[[基底URI]]は、次の順に決定します。
== その[[要素]]に[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]があれば、
それによって指定された[[基底URI]]。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[要素]]中の文字列[[内容]]の[[基底URI]]は、
その[[要素]]の[[基底URI]]です。
- [CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- その他の[[属性]]の[[基底URI]] ([[既定属性]]を含みます。)
の[[基底URI]]は、その付されている[[要素]]の[[基底URI]]です。
- [[処理指令]]の[[内容]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[文字]]、[[内部実体]]、[[属性]]に個別に[[基底URI]]を指定する方法はありません。

[47] [[システム識別子]]における[[基底URI]]については、
[[XML]]の仕様書に規定があります。
([[XML//URI//基底]]の項を参照。)

[48] [CODE(XML)@@en[[[xmlns]]]]系[[属性]]については特に例外が規定されていないので、
>>46 の原則通りになりますが、[[名前空間URI]]が[[絶対URI参照]]で''ない''時にどう処理されるのかは[[XML]]系仕様書では定義していません。
[SRC[XML基底 附属書C (参考)]]

[[#comment]]


** 相対参照の解決

[49] [[XML基底]]仕様書には[CSECTION@@en[4 Resolving Relative URIs]]という章がありますが、
[[基底URI]]の決定方法の説明だけで、[[相対URI参照]]の[[解決]]の方法は何ら規定していないようです。

[[XML基底]]仕様からの引用規格に[[RFC 2396]]および[[RFC 2732]]がありますし、
本文中でも再三引用されていますから、それらで定義された方法で[[解決]]すると解釈するのが自然でしょう。

[50] '''RFC 3986との関係'''

[[RFC 3986]]の[[相対参照]]の[[解決]]方法には[[RFC 2396]]のものと違いがあります。
問題となる変更点は2つあります。
- [[素片識別子]]''だけ''の[[参照]]
-- [[RFC 2396]]における[[素片識別子]]''だけ''の[[URI参照]]は、
同じ[[文書]]内での[[参照]]です。[[基底URI]]に対してではなく、
[[文書]]自体に対して解釈されます。
-- [[RFC 3986]]における[[素片識別子]]''だけ''の[[URI参照]]は、
[[基底URI]]に対するものとして解釈されます。
- 非階層的[[URI]]
-- [[RFC 2396]]では、[[相対URI]]は階層的な[[URI]]に関して定義されており、
[[基底URI]]が階層的でない場合は使うことができません。
-- [[RFC 3986]]では、どんな[[URI]]に対しても[[相対参照]]とその[[解決]]方法が定義されています。

;; 
[54]
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]が[[RFC 2396]]によれば階層的ではなく、[[相対URI]]を使えないにも関わらず、
[[属性値]]が[[相対URI]]の場合はどうなるのでしょうか。
>>40 が適用されるのでしょうか。
(その場合は[[RFC 3986]]の動作をしても[[適合]]します。)

;; [[XML基底]]を参照する仕様の1つ、[[RDF/XML]] (2004年版)
は、[[RFC 2396]]の[[同文書参照]]も[[基底URI]]に対して解釈すると規定しています。

;; [CITE[RDF/XML Syntax Specification (Revised)]] 
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#section-baseURIs>

[51] '''RFC 3987との関係'''

>>44 の通り、[[IRI参照]]の多くはそのまま[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]として使うことができますが、
[[逃避]]して[[URI参照]]にして処理すると定義されていますから、
[[解決]]は[[IRI参照]]としてではなく、変換後の[[URI参照]]として行われます。

[[#comment]]


** XML名前空間およびスキーマとの関係

[41] '''XML名前空間を使わない場合'''

[[XML名前空間]]を使わない場合、
[[名前]]が[CODE(XMLa)@@en[[[xml]]:[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[3] '''XML名前空間を使う場合'''

[[XML名前空間]]を使う場合、
[[名前空間名]]が[CODE(URI)@@en[[[http://www.w3.org/XML/1998/namespace]]]]
([[名前空間接頭辞]]は[CODE(XML)@@en[[[xml]]]])
で[[局所名]]が[CODE(XMLa)@@en[[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。

[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[55] '''XML Schemaによる定義'''

[[XML Schema]]による定義 <http://www.w3.org/2001/xml.xsd>
(執筆時点での最新版は <http://www.w3.org/2005/08/xml.xsd>)
では、[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]は[[データ型]][CODE(XML)@@en[[QN[xs:[[anyURI]]] [http://www.w3.org/2001/XMLSchema]]]]として[[宣言]]されています。
また、[[属性集合]][CODE(XML)@@en[[QN[[[xml]]:[[specialAttrs]]] [http://www.w3.org/XML/1998/namespace]]]]
に含まれています。

[[#comment]]


** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[59]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[60]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[61]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[[#comment]]


** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]


*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]


*** [CODE(XMLa)@@en[xml:base]] 属性 (Atom)

[62]
[[Atom 1.0]]のすべての[[要素]]には、[[XML基底]]で規定された
[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]を持って'''構いません'''。
[[RFC 3986]] にある[[基底URI]] ([[基底IRI]])
として使われます。

;; 出典: [[RFC 4287]] <urn:ietf:rfc:4287> 
[CSECTION@@en[2. Atom Document]]

[63]
>>62 [[RFC 2396]]を参照する[[XML基底]]仕様を参照しながら、
[[RFC 3986]]の機能を持つといい、[Q@@en[or [[IRI]]]]
とまで書いていますが、いったいどう理解しろというのでしょう。

[[#comment]]


** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[[#comment]]


** メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。

([[名無しさん]])

[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
の値を制約したりできなくなるというおはなし。
([[名無しさん]] [WEAK[2005-04-05 00:21:13 +00:00]])

[56]
[[正準XML]] (1.0) 仕様によって特定の[[要素]]以下を[[直列化]]する際には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を含め、
[CODE(XML)@@en[[[xml]]]][[名前空間]]に属する[[属性]]がその[[要素]]の[CODE(XPath)@@en[[[ancestor-or-self]]]]のうちの一番近くにあるものが[[指定]]されます。
[SRC[正準XML 2.4]]

([[名無しさん]])

[57]
[[排他的XML正準化 1.0]]仕様では >>56 の規定を適用しないことになっています。
([[名無しさん]])

[58]
[[XInclude]]では[CODE(InfoProp)[[[基底URI]]]]との整合性を保持するために[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を追加することがあります。
([[名無しさん]])

[70]
[CITE@@en[xml:base in M12N]] ([[Shane McCarron]] 著, [CODE[2007-07-13 21:52:09 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-xhtml2/2007Jul/0024.html>
([[名無しさん]])

[73]
[CITE@@EN[XML Base (Second Edition)]] ([CODE[2008-03-20 00:21:54 +09:00]] 版) <http://www.w3.org/TR/2008/PER-xmlbase-20080320/>
([[名無しさん]])

[74]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2008-02-13 01:15:07 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/13246>
([[名無しさん]])

[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
-- [CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]]	,(なし)	,固有識別子	,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]


** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]


** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[33]
[[WinIE]] ([[MSHTML]]) において、 [CODE(HTMLe)[[[base]]]]
要素が [CODE(HTMLe)[[[head]]]] 中に存在する場合、
- [CODE(HTMLe)[[[body]]]] の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[head]]]] 内の要素の内、
[CODE(HTMLe)[[[base]]]] の弟の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の弟や [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[previousSibling]]]]
は直近の兄です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の兄や [CODE(HTMLe)[[[base]]]]
が含まれます。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(HTMLe)[[[body]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[html]]]] です。
- [CODE(HTMLe)[[[html]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[head]]]] と [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には弟や [CODE(HTMLe)[[[body]]]] の内容も含まれます。
[CODE(HTMLe)[[[base]]]] の[[終了タグ]]はありません。
[CODE(HTMLe)[[[head]]]] の[[終了タグ]]は含まれます。
- [CODE(HTMLe)[[[head]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には [CODE(HTMLe)[[[body]]]] の内容は含まれません。

([[WinIE 6]] on [[Windows XP]] [[SP2]] で確認)

参考: [CITE[agenda 2002-03(下旬) - Personnel]] <http://members.jcom.home.ne.jp/jintrick/Personal/d20023l.html#d18_19>

([[名無しさん]])

[34]
>>33

>>3 のように [CODE(HTMLe)[[[body]]]] 内に複数
[CODE(HTMLe)[[[base]]]] を入れてみると、それ以降がすべて
[CODE(HTMLe)[[[base]]]] に飲み込まれます。
[CODE(HTMLe)[[[base]]]] の終了タグがあっても無視されます。

([[名無しさん]] [WEAK[2005-05-29 07:33:55 +00:00]])

[35]
>>34 のテスト: <http://suika.fam.cx/gate/cvs/*checkout*/www/test/html/base/base-in-body.html>
([[名無しさん]] [sage])

[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい

[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>

([[名無しさん]] [sage])

[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>

([[名無しさん]] [WEAK[2005-09-02 03:35:49 +00:00]])

[64]
[CITE[「base要素でいろいろ」@@水無月ばけらのえび日記]] <http://bakera.jp/hatomaru.aspx/ebi/topic/2697>
([[名無しさん]] [WEAK[2006-11-05 23:44:46 +00:00]])

[[#comment]]


** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>

[39]
[[libwww]]の[[HTML]][[構文解析器]]は1996年7月20日のRelease 4.1b3で[CODE(HTMLe)@@en[[[base]]]]を実装しました。
([[名無しさん]] [sage])

[[#comment]]


** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>
 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]

[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]


** メモ

[65]
[CITE@@en[crisp’s blog &#187; Blog Archive &#187; Broken parsers; the importance of BASE]] ([CODE[2007-01-12 23:43:01 +09:00]] 版) <http://therealcrisp.xs4all.nl/blog/2007/01/06/broken-parsers-the-importance-of-base/>
([[名無しさん]] [WEAK[2007-01-12 14:45:56 +00:00]])

[66]
[CITE@@en[Useful CSS Snippets - webSemantics]] ([[Mike Foskett]] 著, [CODE[2007-01-13 16:06:46 +09:00]] 版) <http://www.websemantics.co.uk/tutorials/useful_css_snippets/#base>
([[名無しさん]])

[67]
今朝の #whatwg より ([[JST]]):

>
- 08:15 <Hixie> about 5% of sites have 1 <base> tag, apparently
- 08:16 <Hixie> 0.03% have 2
- 08:16 <Hixie> 0.0017% have 3
- 08:16 <Hixie> and a few thousand have more than 3
- 08:18 <Hixie> so we're talking about a few million pages here
- 08:18 <Hixie> with 2 or more <base> elements

([[名無しさん]] [WEAK[2007-05-01 02:57:59 +00:00]])

[68]

>
- 08:19 <Hixie> oh actually this was only counting _different_ values for <base>
- 08:19 <Hixie> so a few million pages use two different values for <base>

([[名無しさん]] [WEAK[2007-05-01 02:59:14 +00:00]])

[69]
[CITE[Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-05-01 06:53:18 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/10460>
([[名無しさん]] [WEAK[2007-05-04 04:39:41 +00:00]])

[71]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[72]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[[#comment]]


* メモ

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。
([[名無しさん]])@


1.29
log
@auto-committed
@
text
@d91 10
a416 1

d418 1
a418 1
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [TIME[2008-02-13 01:15:07 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/13246>
a419 1

@


1.28
log
@auto-committed
@
text
@d403 4
d408 2
a409 2
[73]
[CITE@@EN[XML Base (Second Edition)]] ([TIME[2008-03-20 00:21:54 +09:00]] 版) <http://www.w3.org/TR/2008/PER-xmlbase-20080320/>
@


1.27
log
@auto-committed
@
text
@d403 6
a676 1

d678 1
a678 1
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [TIME[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
a679 1

@


1.26
log
@auto-committed
@
text
@a398 1

d400 1
a400 1
[CITE@@en[xml:base in M12N]] ([[Shane McCarron]] 著, [TIME[2007-07-13 21:52:09 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-xhtml2/2007Jul/0024.html>
a402 1

d666 10
@


1.25
log
@auto-committed
@
text
@d399 6
a664 1

d666 1
a666 1
[CITE[Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [TIME[2007-05-01 06:53:18 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/10460>
a667 1

@


1.24
log
@auto-committed
@
text
@d651 1
d653 3
a655 5
[68]

>
-08:19 <Hixie> oh actually this was only counting _different_ values for <base>
-08:19 <Hixie> so a few million pages use two different values for <base>
d658 5
@


1.23
log
@auto-committed
@
text
@a633 1

d635 1
a635 1
[CITE@@en[Useful CSS Snippets - webSemantics]] ([[Mike Foskett]] 著, [TIME[2007-01-13 16:06:46 +09:00]] 版) <http://www.websemantics.co.uk/tutorials/useful_css_snippets/#base>
d637 22
@


1.22
log
@auto-committed
@
text
@d631 1
a631 1
[CITE@@en[crisp’s blog &#187; Blog Archive &#187; Broken parsers; the importance of BASE]] ([TIME[2007-01-12 23:43:01 +09:00]] 版) <http://therealcrisp.xs4all.nl/blog/2007/01/06/broken-parsers-the-importance-of-base/>
d633 5
@


1.21
log
@auto-committed
@
text
@a578 1

a582 1

d629 5
@


1.20
log
@auto-committed
@
text
@d1 638
a638 630
* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

[21] '''仕様書'''
- [[XML基底]]
-- [6] [CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<IW:XMLBase:"#syntax">
-- [25] [CITE@@en[Errata in REC-xmlbase-20010627]] 
<http://www.w3.org/2001/06/xmlbase-errata#E01>
(詳細は[[XML基底]]の項を参照。)

[[#comment]]


** 属性値

[44] '''適当な属性値'''

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]は、
''後述の処理の後に''[[RFC 2396]] [[URI参照]]として処理されます。
[SRC[XML基底 3]]

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]で使うことのできる[[文字]]は、
[[XML]]の一般の場合と同じです。 [SRC[XML基底 3.1]]

[[属性値]]から[[URI参照]]に変換するためには、
- [[非ASCII文字]]
- [CODE(char)@@en[[[U+0000]]]]〜[CODE(char)@@en[[[U+0020]]]]
- [CODE(char)@@en[[[U+007F]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]],
[CODE(char)[[["]]]], [CODE(char)[[[{]]]], [CODE(char)[[[}]]]],
[CODE(char)[[[|]]]], [CODE(char)[[[\]]]], [CODE(char)[[[^]]]],
[CODE(char)[[[`]]]]

を[[UTF-8]]で[[百分率符号化]]します。 [SRC[XML基底 3.1]]

;; 詳しくは[[XML//URI]]および[[IRI]]の項を参照。

[52] '''RFC 3986との関係'''

[[RFC 3986]]の新しい構文では、[[命名権者]]部に[[百分率符号化]]や新しい[[IP番地]]のための構文が認められていますが、
[[RFC 2396]]や[[RFC 2732]]では認められていません。
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3986]]の[[URI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3986]]
に従って解釈する実装も不適合にはなりません。

[53] '''RFC 3987との関係'''

[[RFC 3987]]も[[RFC 3986]]にあわせた新しい構文を採用していますから、
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3987]]の[[IRI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3987]]
に従って解釈する実装も不適合にはなりません。

;; なお、 >>44 の[[URI参照]]に変換するために[[逃避]]しなければならない[[文字]]の種類は、
[[RFC 3987]]の[[算法]]で規定されたものと一致しています。

[42] '''意味不定の場合'''

- [43] [[XML基底]]仕様を直接または間接に参照する[[応用]]''以外''では、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の動作は未定義です。
[SRC[XML基底 1]]
- [40] 値が[[妥当]]な[[URI参照]]にならない場合の動作は、
[[応用]]依存です。 [SRC[XML基底正誤表 E03]]

[20] >>40
(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

;; 
[45]
[[XML基底]] 3では[[RFC 2396]] [[URI参照]]として解釈するとしていますが、
同3.1の[[逃避]]に関する[[RFC 2732]]も参照しています。
字面通り厳密に解釈すると結局[[RFC 2732]]拡張は使えないことになってしまいますが、
本当にそれでよいのでしょうか。[[RFC 3986]]が発行された今、
早急に改訂するべきです。

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)

[[#comment]]


** 基底URIの算出

[46] [SRC[XML基底 4]]
- ある[[要素]]の[[基底URI]]は、次の順に決定します。
== その[[要素]]に[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]があれば、
それによって指定された[[基底URI]]。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[要素]]中の文字列[[内容]]の[[基底URI]]は、
その[[要素]]の[[基底URI]]です。
- [CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- その他の[[属性]]の[[基底URI]] ([[既定属性]]を含みます。)
の[[基底URI]]は、その付されている[[要素]]の[[基底URI]]です。
- [[処理指令]]の[[内容]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[文字]]、[[内部実体]]、[[属性]]に個別に[[基底URI]]を指定する方法はありません。

[47] [[システム識別子]]における[[基底URI]]については、
[[XML]]の仕様書に規定があります。
([[XML//URI//基底]]の項を参照。)

[48] [CODE(XML)@@en[[[xmlns]]]]系[[属性]]については特に例外が規定されていないので、
>>46 の原則通りになりますが、[[名前空間URI]]が[[絶対URI参照]]で''ない''時にどう処理されるのかは[[XML]]系仕様書では定義していません。
[SRC[XML基底 附属書C (参考)]]

[[#comment]]


** 相対参照の解決

[49] [[XML基底]]仕様書には[CSECTION@@en[4 Resolving Relative URIs]]という章がありますが、
[[基底URI]]の決定方法の説明だけで、[[相対URI参照]]の[[解決]]の方法は何ら規定していないようです。

[[XML基底]]仕様からの引用規格に[[RFC 2396]]および[[RFC 2732]]がありますし、
本文中でも再三引用されていますから、それらで定義された方法で[[解決]]すると解釈するのが自然でしょう。

[50] '''RFC 3986との関係'''

[[RFC 3986]]の[[相対参照]]の[[解決]]方法には[[RFC 2396]]のものと違いがあります。
問題となる変更点は2つあります。
- [[素片識別子]]''だけ''の[[参照]]
-- [[RFC 2396]]における[[素片識別子]]''だけ''の[[URI参照]]は、
同じ[[文書]]内での[[参照]]です。[[基底URI]]に対してではなく、
[[文書]]自体に対して解釈されます。
-- [[RFC 3986]]における[[素片識別子]]''だけ''の[[URI参照]]は、
[[基底URI]]に対するものとして解釈されます。
- 非階層的[[URI]]
-- [[RFC 2396]]では、[[相対URI]]は階層的な[[URI]]に関して定義されており、
[[基底URI]]が階層的でない場合は使うことができません。
-- [[RFC 3986]]では、どんな[[URI]]に対しても[[相対参照]]とその[[解決]]方法が定義されています。

;; 
[54]
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]が[[RFC 2396]]によれば階層的ではなく、[[相対URI]]を使えないにも関わらず、
[[属性値]]が[[相対URI]]の場合はどうなるのでしょうか。
>>40 が適用されるのでしょうか。
(その場合は[[RFC 3986]]の動作をしても[[適合]]します。)

;; [[XML基底]]を参照する仕様の1つ、[[RDF/XML]] (2004年版)
は、[[RFC 2396]]の[[同文書参照]]も[[基底URI]]に対して解釈すると規定しています。

;; [CITE[RDF/XML Syntax Specification (Revised)]] 
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#section-baseURIs>

[51] '''RFC 3987との関係'''

>>44 の通り、[[IRI参照]]の多くはそのまま[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]として使うことができますが、
[[逃避]]して[[URI参照]]にして処理すると定義されていますから、
[[解決]]は[[IRI参照]]としてではなく、変換後の[[URI参照]]として行われます。

[[#comment]]


** XML名前空間およびスキーマとの関係

[41] '''XML名前空間を使わない場合'''

[[XML名前空間]]を使わない場合、
[[名前]]が[CODE(XMLa)@@en[[[xml]]:[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[3] '''XML名前空間を使う場合'''

[[XML名前空間]]を使う場合、
[[名前空間名]]が[CODE(URI)@@en[[[http://www.w3.org/XML/1998/namespace]]]]
([[名前空間接頭辞]]は[CODE(XML)@@en[[[xml]]]])
で[[局所名]]が[CODE(XMLa)@@en[[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。

[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[55] '''XML Schemaによる定義'''

[[XML Schema]]による定義 <http://www.w3.org/2001/xml.xsd>
(執筆時点での最新版は <http://www.w3.org/2005/08/xml.xsd>)
では、[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]は[[データ型]][CODE(XML)@@en[[QN[xs:[[anyURI]]] [http://www.w3.org/2001/XMLSchema]]]]として[[宣言]]されています。
また、[[属性集合]][CODE(XML)@@en[[QN[[[xml]]:[[specialAttrs]]] [http://www.w3.org/XML/1998/namespace]]]]
に含まれています。

[[#comment]]


** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[59]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[60]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])


[61]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])


[[#comment]]


** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]


*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]

*** [CODE(XMLa)@@en[xml:base]] 属性 (Atom)

[62]
[[Atom 1.0]]のすべての[[要素]]には、[[XML基底]]で規定された
[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]][http://www.w3.org/XML/1998/namespace]]]][[属性]]を持って'''構いません'''。
[[RFC 3986]] にある[[基底URI]] ([[基底IRI]])
として使われます。

;; 出典: [[RFC 4287]] <urn:ietf:rfc:4287> 
[CSECTION@@en[2. Atom Document]]

[63]
>>62 [[RFC 2396]]を参照する[[XML基底]]仕様を参照しながら、
[[RFC 3986]]の機能を持つといい、[Q@@en[or [[IRI]]]]
とまで書いていますが、いったいどう理解しろというのでしょう。

[[#comment]]

** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[[#comment]]


** メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。

([[名無しさん]])

[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
の値を制約したりできなくなるというおはなし。
([[名無しさん]] [WEAK[2005-04-05 00:21:13 +00:00]])

[56]
[[正準XML]] (1.0) 仕様によって特定の[[要素]]以下を[[直列化]]する際には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を含め、
[CODE(XML)@@en[[[xml]]]][[名前空間]]に属する[[属性]]がその[[要素]]の[CODE(XPath)@@en[[[ancestor-or-self]]]]のうちの一番近くにあるものが[[指定]]されます。
[SRC[正準XML 2.4]]

([[名無しさん]])

[57]
[[排他的XML正準化 1.0]]仕様では >>56 の規定を適用しないことになっています。
([[名無しさん]])

[58]
[[XInclude]]では[CODE(InfoProp)[[[基底URI]]]]との整合性を保持するために[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を追加することがあります。
([[名無しさん]])

[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
-- [CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]]	,(なし)	,固有識別子	,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]


** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]


** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[33]
[[WinIE]] ([[MSHTML]]) において、 [CODE(HTMLe)[[[base]]]]
要素が [CODE(HTMLe)[[[head]]]] 中に存在する場合、
- [CODE(HTMLe)[[[body]]]] の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[head]]]] 内の要素の内、
[CODE(HTMLe)[[[base]]]] の弟の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の弟や [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[previousSibling]]]]
は直近の兄です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の兄や [CODE(HTMLe)[[[base]]]]
が含まれます。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(HTMLe)[[[body]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[html]]]] です。
- [CODE(HTMLe)[[[html]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[head]]]] と [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には弟や [CODE(HTMLe)[[[body]]]] の内容も含まれます。
[CODE(HTMLe)[[[base]]]] の[[終了タグ]]はありません。
[CODE(HTMLe)[[[head]]]] の[[終了タグ]]は含まれます。
- [CODE(HTMLe)[[[head]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には [CODE(HTMLe)[[[body]]]] の内容は含まれません。

([[WinIE 6]] on [[Windows XP]] [[SP2]] で確認)

参考: [CITE[agenda 2002-03(下旬) - Personnel]] <http://members.jcom.home.ne.jp/jintrick/Personal/d20023l.html#d18_19>

([[名無しさん]])

[34]
>>33

>>3 のように [CODE(HTMLe)[[[body]]]] 内に複数
[CODE(HTMLe)[[[base]]]] を入れてみると、それ以降がすべて
[CODE(HTMLe)[[[base]]]] に飲み込まれます。
[CODE(HTMLe)[[[base]]]] の終了タグがあっても無視されます。

([[名無しさん]] [WEAK[2005-05-29 07:33:55 +00:00]])

[35]
>>34 のテスト: <http://suika.fam.cx/gate/cvs/*checkout*/www/test/html/base/base-in-body.html>
([[名無しさん]] [sage])

[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい

[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>

([[名無しさん]] [sage])

[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>

([[名無しさん]] [WEAK[2005-09-02 03:35:49 +00:00]])

[[#comment]]


** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>

[39]
[[libwww]]の[[HTML]][[構文解析器]]は1996年7月20日のRelease 4.1b3で[CODE(HTMLe)@@en[[[base]]]]を実装しました。
([[名無しさん]] [sage])

[[#comment]]


** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>
 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]

[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]


** メモ

[[#comment]]


* メモ

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。
@


1.19
log
@auto-committed
@
text
@a0 1

d309 17
@


1.18
log
@auto-committed
@
text
@d1 614
a614 456


* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

XML Base を使う場合は、[[相対URI参照]]の解決は、
= その要素の [CODE(XMLa)[xml:base]] 属性の値
= その要素の親・先祖の [CODE(XMLa)[xml:base]] 属性の値
= 上位プロトコルによる URI 参照の値

により行われます。

この属性の値は、
- 同じ要素の他の属性値
- 子 [CODE(XML)[#text]]
- 子孫要素
- 子孫[[処理命令]]

に影響します。特に、 [CODE(XMLa)[xml:base]] 
属性の値は''相対 URI でも構わない''ので、その解決にも使われます。
(逆に言えば、子孫の相対 URI 参照の解決には先祖要素の
[CODE(XMLa)[xml:base]] 属性を絶対 URI 
が得られるまで遡り続けないといけないということです。)

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)

URI 参照に使えない文字が入っている場合は [[UTF-8]]
にして [[escape]] し''ないといけません''。
(最初から非 URI 文字は含めてはならないと言ってしまえば良いのに、そうしないのはどうせ守らない人が出るのと、
[[IRI]] の絡みでしょうか。) → [[XML//URI]] を参照。

[20]
E03 <http://www.w3.org/2001/06/xmlbase-errata#E03> によれば、妥当な URI 参照でない場合の処理は応用依存だそうです。

(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

[[#comment]]


** 仕様書

- [21] ''XML Base'' <http://www.w3.org/TR/xmlbase/>
- [22] ''Errata in REC-xmlbase-20010627'' <http://www.w3.org/2001/06/xmlbase-errata>
- [6] ''XML Base [日本語訳]'' <http://www.toyfish.net/docs/xmlbase/>: Errata 未反映なので注意
[[#comment]]


*** Errata による修正

[25]
:E01:[Q[文書または外部実体]]が[Q[文書実体または外部実体]]に改められました。
:E02:注意として、 [[XML Schema]] 
のような外部的方法で既定属性値を与えることによる問題への言及が追加されました。
妥当性を検証する処理器であっても、[[情報集合]]を構築した後に
[CODE(XMLa)[xml:base]] 属性を追加すると、
[CODE(infoprop)[基底 URI]] 特性との同期が崩れます。
:E03:妥当な URI 参照ではない値の [CODE(XMLa)[xml:base]]
属性がある要素の基底 URI は応用依存と追記されました。


** スキーマ等との関係

[3] この属性自体は、 
[[XML名前空間]]を使わない場合も使うことが出来ます。
また、 [CODE(XML)[[[xml]]]] 
名前空間は暗黙の宣言がなされていますから、
[CODE(XMLa)[[[xmlns]]:xml]] 
属性による陽な宣言なしで使うことが出来ます。

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。

[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[[#comment]]


** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[[#comment]]


** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]


*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]


** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[[#comment]]


** メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。

([[名無しさん]])

[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
の値を制約したりできなくなるというおはなし。
([[名無しさん]] [WEAK[2005-04-05 00:21:13 +00:00]])

[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
-- [CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]]	,(なし)	,固有識別子	,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]


** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]


** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[33]
[[WinIE]] ([[MSHTML]]) において、 [CODE(HTMLe)[[[base]]]]
要素が [CODE(HTMLe)[[[head]]]] 中に存在する場合、
- [CODE(HTMLe)[[[body]]]] の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[head]]]] 内の要素の内、
[CODE(HTMLe)[[[base]]]] の弟の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の弟や [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[previousSibling]]]]
は直近の兄です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の兄や [CODE(HTMLe)[[[base]]]]
が含まれます。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(HTMLe)[[[body]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[html]]]] です。
- [CODE(HTMLe)[[[html]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[head]]]] と [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には弟や [CODE(HTMLe)[[[body]]]] の内容も含まれます。
[CODE(HTMLe)[[[base]]]] の[[終了タグ]]はありません。
[CODE(HTMLe)[[[head]]]] の[[終了タグ]]は含まれます。
- [CODE(HTMLe)[[[head]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には [CODE(HTMLe)[[[body]]]] の内容は含まれません。

([[WinIE 6]] on [[Windows XP]] [[SP2]] で確認)

参考: [CITE[agenda 2002-03(下旬) - Personnel]] <http://members.jcom.home.ne.jp/jintrick/Personal/d20023l.html#d18_19>

([[名無しさん]])

[34]
>>33

>>3 のように [CODE(HTMLe)[[[body]]]] 内に複数
[CODE(HTMLe)[[[base]]]] を入れてみると、それ以降がすべて
[CODE(HTMLe)[[[base]]]] に飲み込まれます。
[CODE(HTMLe)[[[base]]]] の終了タグがあっても無視されます。

([[名無しさん]] [WEAK[2005-05-29 07:33:55 +00:00]])

[35]
>>34 のテスト: <http://suika.fam.cx/gate/cvs/*checkout*/www/test/html/base/base-in-body.html>
([[名無しさん]] [sage])

[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい

[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>

([[名無しさん]] [sage])

[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>

([[名無しさん]] [WEAK[2005-09-02 03:35:49 +00:00]])

[[#comment]]


** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>


[39]
[[libwww]]の[[HTML]][[構文解析器]]は1996年7月20日のRelease 4.1b3で[CODE(HTMLe)@@en[[[base]]]]を実装しました。
([[名無しさん]] [sage])


[[#comment]]


** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>
 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]

[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]


** メモ

[[#comment]]


* メモ

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。
@


1.17
log
@auto-committed
@
text
@d392 3
d396 2
a397 6
[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>
a400 1

d412 6
@


1.16
log
@auto-committed
@
text
@d383 8
d392 4
a395 3
[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい
d397 2
a398 2
[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>
d400 1
a400 1
([[名無しさん]] [sage])
@


1.15
log
@auto-committed
@
text
@d383 11
d444 1
a444 2
([[名無しさん]])

@


1.14
log
@auto-committed
@
text
@a2 1

a378 1

a382 1

d429 6
a434 1
* メモ@


1.13
log
@auto-committed
@
text
@d213 2
d216 3
a218 6
[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
a221 1

d319 66
@


1.12
log
@auto-committed
@
text
@d204 2
d207 3
a209 6
[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。
d212 10
@


1.11
log
@auto-committed
@
text
@d1 358
a358 328
* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

XML Base を使う場合は、[[相対URI参照]]の解決は、
= その要素の [CODE(XMLa)[xml:base]] 属性の値
= その要素の親・先祖の [CODE(XMLa)[xml:base]] 属性の値
= 上位プロトコルによる URI 参照の値

により行われます。

この属性の値は、
- 同じ要素の他の属性値
- 子 [CODE(XML)[#text]]
- 子孫要素
- 子孫[[処理命令]]

に影響します。特に、 [CODE(XMLa)[xml:base]] 
属性の値は''相対 URI でも構わない''ので、その解決にも使われます。
(逆に言えば、子孫の相対 URI 参照の解決には先祖要素の
[CODE(XMLa)[xml:base]] 属性を絶対 URI 
が得られるまで遡り続けないといけないということです。)

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)

URI 参照に使えない文字が入っている場合は [[UTF-8]]
にして [[escape]] し''ないといけません''。
(最初から非 URI 文字は含めてはならないと言ってしまえば良いのに、そうしないのはどうせ守らない人が出るのと、
[[IRI]] の絡みでしょうか。) → [[XML//URI]] を参照。

[20]
E03 <http://www.w3.org/2001/06/xmlbase-errata#E03> によれば、妥当な URI 参照でない場合の処理は応用依存だそうです。

(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

[[#comment]]

** 仕様書
- [21] ''XML Base'' <http://www.w3.org/TR/xmlbase/>
- [22] ''Errata in REC-xmlbase-20010627'' <http://www.w3.org/2001/06/xmlbase-errata>
- [6] ''XML Base [日本語訳]'' <http://www.toyfish.net/docs/xmlbase/>: Errata 未反映なので注意
[[#comment]]

*** Errata による修正
[25]
:E01:[Q[文書または外部実体]]が[Q[文書実体または外部実体]]に改められました。
:E02:注意として、 [[XML Schema]] 
のような外部的方法で既定属性値を与えることによる問題への言及が追加されました。
妥当性を検証する処理器であっても、[[情報集合]]を構築した後に
[CODE(XMLa)[xml:base]] 属性を追加すると、
[CODE(infoprop)[基底 URI]] 特性との同期が崩れます。
:E03:妥当な URI 参照ではない値の [CODE(XMLa)[xml:base]]
属性がある要素の基底 URI は応用依存と追記されました。

** スキーマ等との関係


[3] この属性自体は、 
[[XML名前空間]]を使わない場合も使うことが出来ます。
また、 [CODE(XML)[[[xml]]]] 
名前空間は暗黙の宣言がなされていますから、
[CODE(XMLa)[[[xmlns]]:xml]] 
属性による陽な宣言なしで使うことが出来ます。

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。


[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)


[[#comment]]

** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[[#comment]]

** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]

*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]

** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[[#comment]]

** メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??


[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
--[CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]],(なし),固有識別子,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨

[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]

** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]

** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]

** 仕様書から

*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。

** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[[#comment]]

** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>

[[#comment]]

** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>

 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]
[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]

** メモ

[[#comment]]

@


1.10
log
@auto-committed
@
text
@a0 3
#?SuikaWiki/0.9


d53 2
a54 1
:E02:注意として、 [[XML Schema]] のような外部的方法で既定属性値を与えることによる問題への言及が追加されました。
d57 1
a57 1
[CODE(infop)[基底 URI]] 特性との同期が崩れます。
d72 1
a72 1
また、 [[XML基底]]仕様書にも注記がありますが、 
d75 1
a75 1
[[妥当性]]を検証しない処理器で正しい値が得られませんから、好ましくありません。
d78 3
a80 1
[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、又は直接指定するべきだとされています。 (<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)
d85 14
d150 1
a150 1
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XMLSchema]] も示してありますが、こちらも同じ状況です。)]]
d161 2
a162 1
[7] XML Base は [[XLink]] と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。
d169 1
a169 1
[PRE[
d182 1
a182 1
[PRE[
d207 2
a208 1
- [[HTML 2.0]]: [[RFC 1866]] 5.2.2. Base Address: BASE
d210 1
a210 1
12.4 Path information: the BASE element
@


1.9
log
@auto-committed
@
text
@d185 1
a185 1
[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]は、
d192 1
d211 1
a211 2
両方の属性が存在する
DTD では、両方省略可能になっています)。
d217 4
a220 3
[16] HTML 4 仕様書・DTD によれば、この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが、
外部参照を持つ要素の前になければなりません。
d222 1
a222 1
外部参照を持ち得る要素型は、 [CODE(HTMLe)[[[script]]]],
d224 2
a225 1
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
d266 2
a267 1
[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の [CODE(HTMLe)[base]] 
@


1.8
log
@auto-committed
@
text
@d188 7
a194 1
仕様書: <IW:HTML4:"struct/links.html#edef-BASE">
d198 4
a201 3
:[[終了タグ]]:禁止 ([[HTML4]] 以前, [[ISO-HTML]])
:[[内容模型]]:[CODE(XML)[[[EMPTY]]]]
:出現文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
d204 2
a205 2
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2.0], [HTML 4]"
,[CODE(HTMLa)[[[id]]]],(なし),固有識別子,[[Microsoft Word]]
a207 1

d209 2
a210 1
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、両方の属性が存在する
d213 4
d230 8
a237 2
[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] を参照してください。
d239 1
a247 5
[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、ということです。
([[名無しさん]])

a249 1

a251 1

d262 5
d268 1
a268 1
** メモ
d270 1
a270 1
- [8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の [CODE(HTMLe)[base]] 要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。 [CODE(HTMLe)[[[basefont]]]] 要素と同じですね。
d273 3
a275 1
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI を使う文脈でどの基底 URI (たとえば画像用の基底 URI) を使うのかを選べるようにしたらどうかという案もありました。
d278 1
a278 1
([[名無しさん]])
d281 28
@


1.7
log
@auto-committed
@
text
@d198 1
@


1.6
log
@auto-committed
@
text
@d1 262
a262 216
#?SuikaWiki/0.9


* xml:base 属性 (XML Base)

[1] [[XMLBase]] は [[HTML]] の [CODE(HTML)[BASE]]
要素を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

XML Base を使う場合は、[[相対URI]]の解決は、
= その要素の [CODE(XML)[xml:base]] 属性の値
= その要素の親・先祖の [CODE(XML)[xml:base]] 属性の値
= 上位プロトコルによる URI の値

により行われます。

この属性の値は、
- 同じ要素の他の属性値
- 子 [CODE(XML)[#text]]
- 子孫要素
- 子孫[[処理命令]]

に影響します。特に、 [CODE(XML)[xml:base]] 
属性の値は''相対 URI でも構わない''ので、その解決にも使われます。
(逆に言えば、子孫の相対 URI の解決には先祖要素の
[CODE(XML)[xml:base]] 属性を絶対 URI が得られるまで遡り続けないといけないということです。)

[2] [CODE(XML)[xml:base]] 属性の値の定義は URI 参照ですから、
[CODE(URI)[#]] [[断片]]をつけても構いません。
(意味は無いですが。)

URI に使えない文字が入っている場合は [[UTF-8]]
にして [[escape]] し''ないといけません''。
(最初から非 URI 文字は含めてはならないと言ってしまえば良いのに、そうしないのはどうせ守らない人が出るのと、
[[IRI]] の絡みでしょうか。)

[3] この属性自体は、 [[XML名前空間]]を使わない場合も使うことが出来ます。
また、 [[xml]] 名前空間は暗黙の宣言がなされていますから、
[[xmlns]]:xml 属性なしで使うことが出来ます。

[CODE(XML)[xmlns]] 系属性の値も [[URI]] 参照で、相対 URI
の可能性があります (常識的な仕様とは思えません:))。
しかしこの URI は単なる識別子で、解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の XHTML 1 の [[DTD]]
にはこの属性は定義されていませんから、そのままでは使えません。

XHTML 2.0 [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

また、 [[XML基底]]仕様書にも注記がありますが、 
[CODE(XML)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、[[妥当性]]を検証しない
processor で正しい値が得られませんから、好ましくありません。

- ''XML Base'' <http://www.w3.org/TR/xmlbase/>
- ''Errata in REC-xmlbase-20010627'' <http://www.w3.org/2001/06/xmlbase-errata>
- [6] ''XML Base [日本語訳]'' <http://www.toyfish.net/docs/xmlbase/>: Errata 未反映なので注意
- [7] XML Base は [[XLink]] と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[9] XML 基底を使うとして、
[PRE[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

- [11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、又は直接指定するべきだとされています。 (<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[20]
>>2 E03 <http://www.w3.org/2001/06/xmlbase-errata#E03> によれば、妥当な URI 参照でない場合の処理は応用依存だそうです。
([[名無しさん]])
[[#comment]]


** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XMLSchema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]


** メモ

[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

仕様書: <IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]]:禁止 ([[HTML4]] 以前, [[ISO-HTML]])
:[[内容模型]]:[CODE(XML)[[[EMPTY]]]]
:出現文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2.0], [HTML 4]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、両方の属性が存在する
DTD では、両方省略可能になっています)。

[16] HTML 4 仕様書・DTD によれば、この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが、
外部参照を持つ要素の前になければなりません。
[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は、 [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] を参照してください。

HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、ということです。
([[名無しさん]])

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** メモ

- [8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の [CODE(HTMLe)[base]] 要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。 [CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI を使う文脈でどの基底 URI (たとえば画像用の基底 URI) を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>
([[名無しさん]])
[[#comment]]


@


1.5
log
@auto-committed
@
text
@d94 4
d210 2
a211 2
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI を使う文脈でどの基底 URI (たとえば画像用の基底 URI) を使うのかを選べるようにしたらどうかという案もありました。

@


1.4
log
@auto-committed
@
text
@d1 213
a213 176
#?SuikaWiki/0.9
*xml:base 属性 (XML Base)

[1] [[XMLBase]] は [[HTML]] の [CODE(HTML)[BASE]]
要素を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

XML Base を使う場合は、[[相対URI]]の解決は、
=その要素の [CODE(XML)[xml:base]] 属性の値
=その要素の親・先祖の [CODE(XML)[xml:base]] 属性の値
=上位プロトコルによる URI の値

により行われます。

この属性の値は、
-同じ要素の他の属性値
-子 [CODE(XML)[#text]]
-子孫要素
-子孫[[処理命令]]

に影響します。特に、 [CODE(XML)[xml:base]] 
属性の値は''相対 URI でも構わない''ので、その解決にも使われます。
(逆に言えば、子孫の相対 URI の解決には先祖要素の
[CODE(XML)[xml:base]] 属性を絶対 URI が得られるまで遡り続けないといけないということです。)

[2] [CODE(XML)[xml:base]] 属性の値の定義は URI 参照ですから、
[CODE(URI)[#]] [[断片]]をつけても構いません。
(意味は無いですが。)

URI に使えない文字が入っている場合は [[UTF-8]]
にして [[escape]] し''ないといけません''。
(最初から非 URI 文字は含めてはならないと言ってしまえば良いのに、そうしないのはどうせ守らない人が出るのと、
[[IRI]] の絡みでしょうか。)

[3] この属性自体は、 [[XML名前空間]]を使わない場合も使うことが出来ます。
また、 [[xml]] 名前空間は暗黙の宣言がなされていますから、
[[xmlns]]:xml 属性なしで使うことが出来ます。

[CODE(XML)[xmlns]] 系属性の値も [[URI]] 参照で、相対 URI
の可能性があります (常識的な仕様とは思えません:))。
しかしこの URI は単なる識別子で、解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の XHTML 1 の [[DTD]]
にはこの属性は定義されていませんから、そのままでは使えません。

XHTML 2.0 [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

また、 [[XML基底]]仕様書にも注記がありますが、 
[CODE(XML)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、[[妥当性]]を検証しない
processor で正しい値が得られませんから、好ましくありません。

-''XML Base'' <http://www.w3.org/TR/xmlbase/>
-''Errata in REC-xmlbase-20010627'' <http://www.w3.org/2001/06/xmlbase-errata>
- [6] ''XML Base [日本語訳]'' <http://www.toyfish.net/docs/xmlbase/>: Errata 未反映なので注意
- [7] XML Base は [[XLink]] と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[9] XML 基底を使うとして、
[PRE[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]
の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]
は >>9 と同じように解釈されるのかなあ??

- [11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、又は直接指定するべきだとされています。 (<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)
[[#comment]]

** xml:base 属性 (型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XMLSchema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]

** メモ
[[#comment]]

* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

仕様書: <IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]]:禁止 ([[HTML4]] 以前, [[ISO-HTML]])
:[[内容模型]]:[CODE(XML)[[[EMPTY]]]]
:[[親要素:[CODE(HTMLe)[[[head]]]]
:[[属性]]: 
,属性名,値の型,既定値,意味,出典
,[CODE(HTMLa)[[[href]]]],[[絶対URI]],(選択必須),基底 URI,[HTML 4]
,[CODE(HTMLa)[[[target]]]],[CODE(SGML)[%[[FrameTarget]]]],(選択必須),既定の対象枠,[HTML 4] 非推奨

[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、両方の属性が存在する
DTD では、両方省略可能になっています)。

[16] HTML 4 仕様書・DTD によれば、この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが、
外部参照を持つ要素の前になければなりません。
[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は、 [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] を参照してください。

HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]

**メモ
- [8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の [CODE(HTMLe)[base]] 要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。 [CODE(HTMLe)[[[basefont]]]] 要素と同じですね。
[[#comment]]

* メモ
@


1.3
log
@auto-commited
@
text
@d113 1
a113 1
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XMLSchema]] も示してありますが、こちらも同じ状況です。)]]
d122 55
a176 2
*メモ
- [8] [[不思議マーク付け]]的には、 [CODE(HTML)[BASE]] 要素は次の [CODE(HTML)[BASE]] 要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。 [CODE(HTML)[BASEFONT]] 要素と同じですね。
@


1.2
log
@auto-commited
@
text
@d89 31
a119 1
- [11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、又は直接指定するべきだとされています。 (<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)
@


1.1
log
@pre-namespace
@
text
@d55 1
a55 1
また、 XML Base 仕様書にも注記がありますが、 
d62 28
a89 2
- [6] ''XML Base [日本語訳]'' <http://www.toyfish.net/docs/xmlbase/>: Errata 未反映なので注意
- [7] XML Base は [[XLink]] と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。
d92 2
a93 2
*メモ
- [8] [[不思議マーク付け]]的には、 [CODE(HTML)[BASE]] 要素は次の [CODE(HTML)[BASE]] 要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。 [CODE(HTML)[BASEFONT]] 要素と同じですね。
@

