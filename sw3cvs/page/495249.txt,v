head	1.29;
access;
symbols
	suikawiki3-final:1.29
	before-db-leaffile:1.2
	after-upgrade-to-suikawiki-3:1.1
	before-fork-suikawiki3:1.1
	after-restore-20040122:1.1;
locks; strict;
comment	@# @;
expand	@b@;


1.29
date	2008.11.03.02.43.58;	author wakaba;	state Exp;
branches;
next	1.28;

1.28
date	2008.09.18.03.02.14;	author wakaba;	state Exp;
branches;
next	1.27;

1.27
date	2007.11.08.02.30.49;	author wakaba;	state Exp;
branches;
next	1.26;

1.26
date	2007.08.03.02.32.15;	author wakaba;	state Exp;
branches;
next	1.25;

1.25
date	2007.07.31.02.29.37;	author wakaba;	state Exp;
branches;
next	1.24;

1.24
date	2007.07.08.02.35.33;	author wakaba;	state Exp;
branches;
next	1.23;

1.23
date	2007.06.13.02.45.06;	author wakaba;	state Exp;
branches;
next	1.22;

1.22
date	2007.02.03.02.22.29;	author wakaba;	state Exp;
branches;
next	1.21;

1.21
date	2007.01.31.02.21.15;	author wakaba;	state Exp;
branches;
next	1.20;

1.20
date	2007.01.27.02.21.59;	author wakaba;	state Exp;
branches;
next	1.19;

1.19
date	2006.12.31.02.16.00;	author wakaba;	state Exp;
branches;
next	1.18;

1.18
date	2006.10.31.02.14.54;	author wakaba;	state Exp;
branches;
next	1.17;

1.17
date	2006.04.23.02.17.11;	author wakaba;	state Exp;
branches;
next	1.16;

1.16
date	2006.03.31.02.08.59;	author wakaba;	state Exp;
branches;
next	1.15;

1.15
date	2006.03.23.02.09.39;	author wakaba;	state Exp;
branches;
next	1.14;

1.14
date	2006.01.08.02.10.16;	author wakaba;	state Exp;
branches;
next	1.13;

1.13
date	2005.11.18.02.13.58;	author wakaba;	state Exp;
branches;
next	1.12;

1.12
date	2005.10.08.02.10.29;	author wakaba;	state Exp;
branches;
next	1.11;

1.11
date	2005.08.13.02.06.15;	author wakaba;	state Exp;
branches;
next	1.10;

1.10
date	2005.07.13.02.08.35;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2005.07.08.02.06.33;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2005.04.27.02.12.49;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2005.04.23.02.07.32;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2005.03.13.02.05.53;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2005.02.27.02.06.15;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2005.02.03.02.06.09;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.23.02.07.25;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2004.04.08.02.00.49;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.03.02.02.08;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.29
log
@auto-committed
@
text
@[19] [DFN@@en[[ABBR[IRI]]]] ([DFN@@en[Internationalized Resource Identifiers]]) は、
利用可能な[[文字]]の種類を [[ASCII]] ベースから [[Unicode]] ベースへと拡張した、
[[URI]] の[[超集合]]である[[識別子]] (の仕様) です。

* 仕様

[49] 現時点で最新かつ正式な [[IRI]] の仕様は、 [[IETF]] の[[提案標準]]である
[[RFC 3987]] です。 [[RFC 3987]] は2004年12月に [[IESG]] に承認され、
2005年1月に [[RFC]] として発行されました。

- [[RFC 3987]] ([[IETF]] [[提案標準]]) <urn:ietf:rfc:3987>、<http://www.ietf.org/rfc/rfc3987.txt>

** IRI に関する様々な仕様と定義

[1] [[IRI]] の [[RFC]] ([[RFC 3987]]) が発行される前、あるいは発行された後にも、
[[URI]]/[[IRI]] 的なものを使う仕様の中には、 [[IRI]] 仕様を先取りして、あるいは独自に、
[[IRI]] のようなものを定義したり、 [[IRI]] の [[Internet Draft]]を参照したりしていました。
特に [[W3C]] の仕様書では、数多くの「[[IRI]] のようなもの」が定義されていました。

[50] たとえ実質的に同じ定義であったとしても、人為的なミス、仕様の改訂、政治的問題、
その他の理由で混乱が起こる危険性はあるので、困ったことですね、
などと昔ここに書いていたのですが、実際各仕様が定義している内容には少しずつ「ずれ」がある上、
その「ずれ」が[[遺物拡張IRI]] (旧称: [[XML資源識別子]]など) や [[HTML 5]] の [[URL]]
のような派生仕様を生み出すまでに至り、既に混乱は極まっている感があります。

*** 「IRI」や「IRI 参照」を定義している仕様

[13] '''RFC 3987 IRI''':
[[IETF]] で標準化された、“最も正しい”「[[IRI]]」や「[[IRI参照]]」の定義です。
両者は[[百分率符号化]]によって [[RFC 3986]] の [[URI]] や [[URI参照]]に変換できる文字列であり、
[[ABNF]] で構文が定義されています。

[52] 実は [[RFC 3987]] をよく読むと、 [[ABNF]] で表現されていない構文上の制約が本文中に含まれています。
[[RFC 3987]] を引用している仕様の中には、「[[RFC 3987]] の [[ABNF]] [[生成規則]]に[[一致]]するもの」
のような参照の仕方をしているものがありますが、それでは [[ABNF]]
に含まれない制約が厳密には参照されていないことになるので、要注意です。

- [[RFC 3987]] ([[IETF]] [[提案標準]])
<urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>

[53] [[RFC 3987]] になる前の古い [[Internet Draft]] には、最終版とは異なる定義をしているものもあります。
古い [[Internet Draft]] を参照している仕様は要注意です。

[54] また、現在改訂の作業が進められており、 [[Internet Draft]] も発行されています
([[draft-duerst-iri-bis]])。改訂版には元々の [[IRI]] だけではなく、[[遺物拡張IRI]]
の定義も含まれています。

[2] '''XPointer IRI 参照''': 「[[IRI]]」を [[URI]] の拡張で [[Unicode]] [[文字]]が使えるものと概念的に定義した上で、
[[XPointer]] [[指示子]]を「[[IRI参照]]」で使う方法や、[[IRI参照]]を [[URI参照]]に変換する方法を規定しています。

;; 用語として定義されているのは「[[IRI]]」ですが、実際規定があるのは
「[[IRI参照]]」 (と「[[URI参照]]」) です。 [[RFC 2396]]
時代の「[[URI]]」には[[素片識別子]]が含まれていないためでしょうか。

それによると、 [[XPointer]] [[指示子]]を [[IRI参照]]中で使う場合、 [CODE(char)[[[%]]]]
は[[百分率符号化]]を行わなければ[['''なりません''']]が、その他の[[文字]]はしても[['''構わない''']]のみです。

また、 [[IRI参照]]から [[URI参照]]への変換では、 [[RFC 2396]] と [[RFC 2732]]
で [[URI参照]]中に認められない[[文字]]を[[百分率符号化]]することになっています。

[55] [[XPointer]] [[指示子]]中には任意の [[Unicode]] [[文字]]
([CODE(char)[[[U+0000]]]] 〜 [CODE(char)[[[U+10FFFF]]]]、除外なし)
がそのまま使えることになっています。従って、
- [[XPointer]] [[IRI参照]]は [[RFC 3987]] [[IRI参照]]や[[遺物拡張IRI参照]]で認められていない
[[Unicode]] [[文字]]を含むことがあります。
- [[XPointer]] [[IRI参照]]では[[素片識別子]]内に [CODE(char)[#]]
を含むことがあります ([[RFC 3987]] [[IRI参照]]では不可)。
- [[XPointer]] [[IRI参照]]では [[authority]] [[部品]]以外でも
[CODE(char)[[['''[''']]]] や [CODE(char)[[[''']''']] を含むことがあります
([[RFC 3987]] [[IRI参照]]では不可)。

- [CITE@@en[XPointer Framework]] ([[W3C]] [[勧告]])
-- [CSECTION@@en[B. Escaping and Encoding of reserved IRI characters]],
[CSECTION@@en[C. Escaping and Encoding of reserved URI characters]]
<http://www.w3.org/TR/2003/REC-xptr-framework-20030325/#dt-iri>

[3] '''XML 名前空間 IRI 参照''':
[[XML名前空間 1.1]] の第1版は、当時 [[RFC 3987]] が出版されていなかったため、
[[RFC 3987]] になる前の [[Internet Draft]] である
[[draft-duerst-iri-03]] と [[draft-duerst-iri-05]] を参照しつつ
(どちらも non-normative reference)、独自に [[IRI参照]]を定義しています。

それによると、「[[IRI参照]]」は、 [[hostname]] 部品があればそれに
[[IDNA]] [[ToASCII]] 演算 (≒ [[Punycode]] [[符号化]]) を施し、「追加文字」
を[[百分率符号化]]した結果、[[URI参照]]が得られる[[文字列]]です。

「追加文字」とは、[[Unicode]] の[[非ASCII文字]]から[[私用域]]や[[非文字]]や[[代理組]]の[[符号位置]]を除外したものです。

[56] この定義は実際上 (何が [[IRI参照]]で何が [[IRI参照]]ではないかという点で)
[[draft-duerst-iri-05]] と一致していることになっています (未検証)。
なお、「[[URI参照]]」の定義は明らかにされていません。[[XML名前空間 1.1]]
第1版の仕様書の参考文献には [[RFC 2396]] と [[RFC 2732]]
が挙がっているのですが、両者は本文中のどこからも参照されていません。

[57] [[draft-duerst-iri-05]] と [[RFC 3987]] の定義は異なるようです (未検証)。
そのため、
- [[XML名前空間 1.1]] [[IRI参照]]には [[query]] 部品であっても[[私用域]]の[[文字]]を含めることができません
([[RFC 3987]] [[IRI参照]]では可)。
- [[XML名前空間 1.1]] [[IRI参照]]には [[RFC 3987]] 本文中の追加の構文上の制約が適用されません。
- [[XML名前空間 1.1]] における「[[URI参照]]」が [[RFC 2396]] + [[RFC 2732]]
の定義によると仮定すると、 [[RFC 2396]] + [[RFC 2732]] と [[RFC 3986]]
の「[[URI参照]]」の定義の違いが [[XML名前空間 1.1]] [[IRI参照]]と
[[RFC 3987]] [[IRI参照]]の違いになります。例えば、 [[authority]] 部品内で[ [百分率符号化]]された[[ホスト名]]を用いることは
[[RFC 3987]] では認められていますが、 [[XML名前空間 1.1]] では認められないことになります。

- [CITE@@EN[Namespaces in XML 1.1]] ([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[9 Internationalized Resource Identifiers (IRIs)]]
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>

[58] なお、[[XML名前空間 1.1]] は既に改訂されており、
第2版では [[RFC 3987]] を直接参照しています。
第1版における [[IRI]] の定義は第2版からは削除されています。

[4] '''XInclude IRI 参照''':
[[XInclude 1.0]] の第1版は、当時 [[RFC 3987]] が出版されていなかったため、
[[RFC 3987]] になる前の [[Internet Draft]] である
[[draft-duerst-iri-11]] を参照しつつ
(non-normative reference)、独自に [[IRI参照]]を定義しています。

それによると、「[[IRI参照]]」は、
[[Unicode]] の[[非ASCII文字]]のうち、[[私用域]]の[[文字]]や[[非文字]]と[[代理組]]の[[符号位置]]を除外したものを[[百分率符号化]]した結果が
[[URI参照]]になる[[文字列]]です。

[59] 「[[URI参照]]」の定義は明記されていませんが、文脈によると少なくても
[[RFC 2396]] によっているようです。更に、 [[RFC 2396]] だけでなく
[[RFC 2732]] もこの仕様書から normative reference として参照されています。

[60] [[XInclude]] [[IRI参照]]も [[XML名前空間 1.1]] [[IRI参照]] (>>3) も
[[RFC 2396]] + [[RFC 2732]] の [[URi参照]]に基づき定義されているとみなすと、
[[XInclude]] [[IRI参照]]は [[XML名前空間 1.1]] [[IRI参照]]のほぼ[[部分集合]]になりますが、
- [[XInclude]] [[IRI参照]]の定義は [[XML名前空間 1.1]] [[IRI参照]]の定義と異なり
[[IDNA]] [[ToASCII]] を行っていませんので、 [[XInclude]] では [[IDN]] 
を使うことができません ([[RFC 2396]] + [[RFC 2732]] の構文に一致しませんので)。

[61] なお、 [[XInclude]] 1.0 第1版では「[[IRI参照]]に変換されるもの」も定義されています
(>>62)。

[64] この部分の規定は[[正誤票]]の PEX17 で削除され、 [[XML 1.1]]
の [[XML資源識別子]]を使うという規定に置き換わっています (>>65)。

- [CITE@@en[XML Inclusions (XInclude) Version 1.0]]
-- [CSECTION@@en[4.1.1 Escaping of href attribute values]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>

*** 「IRI に変換されるもの」や「IRI 参照に変換されるもの」を定義している仕様

[62] '''XInclude IRI 参照に変換されるもの''':
[[XInclude]] 1.0 第1版では「[[IRI参照]]」を定義していますが (>>4)、
[CODE(XMLa)@@en[[[href]]]] [[属性値]]を [[IRI参照]]に変換する方法も定義しています。

それによると、 [[IRI参照]]に変換するためには[[属性値]]の次の[[文字]]を[[百分率符号化]]しなければ[['''なりません''']]。
- [CODE(char)[[[U+0020]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]], [CODE(char)[[["]]]]
- [CODE(char)[[[{]]]], [CODE(char)[[[}]]]], [CODE(char)[[[|]]]],
[CODE(char)[[[\]]]], [CODE(char)[[[^]]]], [CODE(char)[[[`]]]]

[63] この部分の規定は[[正誤票]]の PEX17 で削除され、 [[XML 1.1]]
の [[XML資源識別子]]を使うという規定に置き換わっています (>>65)。

- [CITE@@en[XML Inclusions (XInclude) Version 1.0]] ([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[4.1.1 Escaping of href attribute values]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>

[27] '''XLink IRI 参照に変換されるもの''':
[[XLink 1.1]] の当初の [[WD]] は、 [CODE(XMLa)@@en[[[href]]]] [[属性]]の値は [[RFC 3987]]
の [[IRI参照]]か、 [CODE(char)[[[U+0020]]]] を[[百分率符号化]]すると
[[RFC 3987]] [[IRI参照]]になるものでなければ[['''ならない''']]と規定していました。
この規定は [[XLink 1.0]] との[[後方互換性]]のためとされています。

[73]
- [[XLink 1.0]] が定義していた [[URI参照]]に変換されるもの (>>9) より認められる範囲が狭まっています。
(ただし [[RFC 2396]] と [[RFC 3986]]/[[RFC 3987]] の構文上の違いがあるので、
[[XLink 1.1]] [[IRI参照]]に変換されるものは [[XLink 1.0]] [[URI参照]]に変換されるものの完全な[[部分集合]]にはなっていません。)
- [[XLink 1.1]] の新しい [[CR]] では、「[[XML資源識別子]]」という名前がついて、
内容も変わっています (>>28)。新しい定義の方が、 [[XLink 1.0]] の定義により近い形になっています。

- [CITE@@en[XML Linking Language (XLink) Version 1.1]] ([DEL[[[W3C]] [[作業原案]]]] (改訂済))
-- [CSECTION@@en[5.4 Locator Attribute ([CODE(XMLa)@@en[href]])]]
<http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>

*** 「URI に変換されるもの」、「URI 参照に変換されるもの」を定義している仕様

[10] '''HTML 4.01 URI 誤り処理''':
[[HTML 4]] は[[著者]]に対しては [[URI]] しか認めていませんが、
informative な附属書中で、[[利用者エージェント]]が[[非ASCII文字]]を含む
[[URI]] [[属性値]]の処理に関して、
= まずは [[UTF-8]] として[[百分率符号化]]し、試してみる
= 古い[[文書]]に対応したい[[利用者エージェント]]は、前項が失敗した場合、
[[文書]]の[[文字符号化]]を使って[[百分率符号化]]し、試してみる

という方法を述べています (1項目は推奨されており、2項目は note での言及、
ただしどちらも informative)。

;; なお、 [[HTML 4]] は「[[URI参照]]」の意味で「[[URI]]」という語を使っていると見られる上、
[[RFC 1738]]、[[RFC 1808]]、[[RFC 2396]] をいずれも normative
に参照しており、混乱しています。

[70]
- [[HTML 4]] のこの解説は必ずしも実情に合っておらず、
[[HTML 5]] の「[[URL]]」の定義は異なったものとなっています (>>69)。
- [[XPath 2.0]]/[[XQuery 1.0]] にはこの解説に基づいたと称する[[関数]]
[CODE@@en[fn:[[escape-html-uri]]]] が定義されていますが、
この関数が行うのは [CODE(char)[[[U+0020]]]] 〜 [CODE(char)[[[U+007E]]]]
''以外''の[[百分率符号化]]であって、 [[HTML 4]] の解説とは[[制御文字]]の扱いが含まれている点が異なります。
そもそも [[XPath 2.0]]/[[XQuery 1.0]] には [[IRI参照]] (実際には[[遺物拡張IRI参照]]的なもの)
から [[URI参照]]に変換する[[関数]] [CODE@@en[fn:[[iri-to-uri]]]] もあるので、
[[URI参照]]で認められない [[ASCII]] [[文字]]を[[百分率符号化]]しない 
[CODE@@en[fn:[[escape-html-uri]]] の存在意義は疑問です。

- [[HTML 4]] ([[W3C]] [[勧告]])
-- [CSECTION@@en[B.2.1 Non-ASCII characters in URI attribute values]]
<IW:HTML4:"appendix/notes.html#h-B.2.1">
- [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] ([[W3C]] [[勧告]])
--[CSECTION@@en[7.4.12 fn:escape-html-uri]]
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>

[7] '''XML システム識別子''':
[[XML]] の[[システム識別子]]は、 [[URI参照]]に変換できるものと定義されています。
(なお、 1.0 1e E76 以後、[[システム識別子]]に[[素片識別子]]が現れるのは[[誤り]]とされています。)
厳密な定義は正誤票で何度も重ねて訂正され、各版で内容が微妙に異なっています。

,版,参照する [[URI]] 仕様,[[百分率符号化]]しなければならない[[文字]]
,1.0 1e,[[RFC 2396]] になる前の [[Internet Draft]] ([[RFC 1738]] と [[RFC 1808]] も参照、3ついずれも informative),[[非ASCII文字]]
,1.0 1e E49,同上,[[非ASCII文字]]、[[RFC 2396]] 2.2 節 [[reserved]] 文字
,1.0 1e E66,[[RFC 2396]]、[[RFC 2732]],[[非ASCII文字]]
,1.0 1e E78、1.0 2e、1.0 2e E5,[[RFC 2396]]、[[RFC 2732]],"[[非ASCII文字]]、[[RFC 2396]] 2.4 節除外文字 (ただし [CODE(char)[#]], [CODE(char)[[[%]]]], [CODE(char)[[['''[''']]]], [CODE(char)[[[''']''']]]] を除く)"
,1.0 2e E26、1.0 2e E43、1.0 3e、1.1 1e,同上,"[CODE(char)[[[U+0000]]]]-[CODE(char)[[[U+001F]]]], [CODE(char)[[[U+007F]]]], [CODE(char)[[[U+0020]]]], [CODE(char)[[[<]]]], [CODE(char)[[[>]]]], [CODE(char)[[[U+0022]]]], [CODE(char)[[[{]]]], [CODE(char)[[[}]]]], [CODE(char)[[[|]]]], [CODE(char)[[[U+005C]]]], [CODE(char)[[[^]]]], [CODE(char)[[[`]]]], [CODE(char)[[[U+0080]]]] 以上"
,1.0 4e E14、1.0 4e、1.1 1e E22、1.1 2e,[[RFC 3986]],同上

- 1.0 1e E49 の修正は誤った変更です (reserved は [[URI]] で使え’'る''[[文字]])。
- 1.0 1e では「[[URI]]」とありましたが、 1e [[正誤票]] E88 で「[[URI参照]]に置き換えられています。
- 1.0 2e と 1.0 3e の間で実質的な変更はありません。

-[CITE[Extensible Markup Language (XML) 1.0]]
([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/1998/REC-xml-19980210#dt-sysid>
-- [CITE@@en[Errata in REC-xml-19980210]] ([TIME[2000-10-07 09:19:21 +09:00]] 版)
---E88 <http://www.w3.org/XML/xml-19980210-errata#E88>
---E78 <http://www.w3.org/XML/xml-19980210-errata#E78>
---E76 <http://www.w3.org/XML/xml-19980210-errata#E76>
---E66 <http://www.w3.org/XML/xml-19980210-errata#E66>
---E49 <http://www.w3.org/XML/xml-19980210-errata#E49>
-[CITE@@EN[Extensible Markup Language (XML) 1.0 (Second Edition)]]
([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/2000/REC-xml-20001006#dt-sysid>
-- [CITE@@en[Errata in REC-xml-20001006]] ([TIME[2004-11-25 20:26:49 +09:00]] 版)
--- E5 <http://www.w3.org/XML/xml-V10-2e-errata#E5>
--- E26 <http://www.w3.org/XML/xml-V10-2e-errata#E26>
--- E43 <http://www.w3.org/XML/xml-V10-2e-errata#E43>
- [CITE@@EN[Extensible Markup Language (XML) 1.0 (Third Edition)]]
([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>
-- [CITE@@en[Errata in REC-xml-20040204]] ([TIME[2006-08-10 00:48:41 +09:00]] 版)
<http://www.w3.org/XML/xml-V10-3e-errata#E14>
- [CITE@@EN[Extensible Markup Language (XML) 1.1]]
([DEL[[[W3C]] [[勧告]]]] (改訂済))
-- [CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
-- [CITE@@en[Errata in REC-xml11-20040204]] ([TIME[2006-08-10 00:48:58 +09:00]] 版) <http://www.w3.org/XML/xml-V11-1e-errata#E22>
- [CITE@@en[Extensible Markup Language (XML) 1.0 (Fourth Edition)]]
([[W3C]] [[勧告]])
--[CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/2006/REC-xml-20060816/#dt-sysid>
-[CITE@@en[Extensible Markup Language (XML) 1.1 (Second Edition)]]
([[W3C]] [[勧告]])
--[CSECTION@@en[4.2.2 External Entities]]
<http://www.w3.org/TR/2006/REC-xml11-20060816/#dt-sysid>

[22] '''RDF/XML:1999 (XML 1.0 1e の処理の参照)''':
[[RDF]] の1999年の仕様では、[[生成規則]]上の [CODE(ABNF)@@en[[[URI-reference]]]]
は [[XML]] における[[文字列]]であり、 [[RFC 2396]] に従って解釈するとされていました。
構文上は [[URI]] として正しくない[[文字列]]も認められていたことになります。
Note では、 [[XML]] (の最新版) を引用しつつ、[[非ASCII文字]]は[[百分率符号化]]して
[[URI]] として解釈することが実装に勧められています。

;; なお、この仕様書は「[[URI]]」と「[[URI参照]]」の両方の語が現れますが、
「[[URI参照]]」という語が現れるのは[[生成規則]]の名前だけで、
基本的に両者を区別していないようです。

- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
([DEL[[[W3C]] [[勧告]]]] (改訂済))
--<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>

[9] '''XLink/XML 基底/XML 署名 URI 参照に変換されるもの''':
[[XLink]] [CODE(XMLa)@@en[xlink:[[href]]]] [[属性]]や
[CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性]]や 
[[XML署名]]の [CODE(XMLa)@@en[[[URI]]]] [[属性]]の値は、
次の[[文字]]を[[百分率符号化]]した後、
[[RFC 2396]] [[URI参照]]として解釈されることになっています。
- [[非ASCII文字]]
- [[RFC 2396]] 2.4節除外文字 ([CODE(char)[#]], [CODE(char)[[[%]]]],
[CODE(char)[[['''[''']]]], [CODE(char)[[[''']''']]]] を除く。)

[72] [[百分率符号化]]する[[文字]]の種類の規定では [[RFC 2396]] と
[[RFC 2732]] に基づいているのですが、「[[URI参照]]」の定義としては
[[RFC 2396]] しか参照していません。仕様書中の文言を厳密に解釈するなら、
[[authority]] [[部品]]中であっても [CODE(char)[[['''[''']]]], [CODE(char)[[[''']''']]]]
は使えないことになります。

[32] [[SVG 1.0]]、[[SVG 1.1]] は、 [[SVG]] [[文書]]で用いられる
[CODE(XMLa)@@en[xlink:[[href]]]] [[属性]]について、
[[XLink 1.0]] を参照しつつも [[XLink 1.0]] と同じことを再度規定しています。

[8]
- [[XLink]]/[[XML基底]]/[[XML署名]]
[[URI参照]]に変換されるものは [[XML]] [[システム識別子]]における
[[URI参照]]に変換されるもの (1.0 2e 以降、1.1、>>7) とほぼ同じですが、
「[[URI参照]]」の定義が [[RFC 2396]] だけを参照している点が異なります。
- [[XLink]]/[[XML基底]]/[[XML署名]] [[URI参照]]に変換されるものは、
[[XLink 1.1]] [[CR]] で定義され (>>28)、
[[XML基底]]第2版の [[PER]] が参照 (>>74)
している [[XLink]] [[XML資源識別子]]とほぼ同じですが、
「[[IRI参照]]」ではなく、[[RFC 2396]] の「[[URI参照]]」を参照している点が異なります。

-[CITE[XML Linking Language (XLink) Version 1.0]] ([[W3C]] [[勧告]])
--[CSECTION@@en[5.4 Locator Attribute ([CODE(XMLa)@@en[href]])]]
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
-[CITE[XML Base]] ([[W3C]] [[勧告]])
--[CSECTION@@en[3.1 URI Reference Encoding and Escaping]]
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
-[CITE[XML-Signature Syntax and Processing]] ([[W3C]] [[勧告]])
--[CSECTION@@en[4.3.3.1 The [CODE(XMLa)@@en[URI]] Attribute]]
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
- [[SVG 1.0]] ([[W3C]] [[勧告]])
--[CSECTION@@en[5.3.2 URI reference attributes]]
<http://www.w3.org/TR/2001/REC-SVG-20010904/struct.html#xlinkRefAttrs>
-[[SVG 1.1]] ([[W3C]] [[勧告]])
--[CSECTION@@en[5.3.2 URI reference attributes]]
<http://www.w3.org/TR/2003/REC-SVG11-20030114/struct.html#xlinkRefAttrs>

[11] '''WebCGM URI に変換されるもの''':
[[WebCGM]] 第2版は、 [[WebCGM]] [[処理器]]が [[URI]] の解釈の際に[[非ASCII文字]]を[[百分率符号化]]しなければならないと規定しています。

この仕様書は [[RFC 2396]] (だけ) を参照していますが、「[[URI参照]]」
という言葉を使わず、「[[URI]]」を「[[URI参照]]」も含めた意味で使っているようです。

処理の規定の部分では [[XML 1.0]]  第2版の[[システム識別子]]の処理の規定 (>>7)
を採用すると述べられているのですが、なぜかそれを参照するだけに留まらずにわざわざ独自の規定を行っており、
その規定が [[XML 1.0]] 第2版のものではなく、 [[XML 1.0]] 
第1版と同じで[[非ASCII文字]]しか[[百分率符号化]]しないものとなっています。

[76]
- なお、この部分の規定は第1版にはありませんでした。
- [[RFC 2732]] は参照されていません。従って、厳密には [[XML 1.0]] の (正誤票適用時も含めた)
どの版とも一致しません。

- [[WebCGM]] 第2版 ([[W3C]] [[勧告]])
-- [CITE[WebCGM Intelligent Content]] [CSECTION@@en[3.1.1.4 Non-ACSII Characters in URIs]]
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>

[33] '''WebCGM 2.0 URI 参照に変換されるもの''':
[[WebCGM]] の新しい版である [[WebCGM]] 2.0 の仕様書では、前版の記述 (>>11)
と違って [[RFC 3986]] と [[RFC 3987]] を参照し、
「[[URI参照]]」という言葉を使ってより明確な形の規定に改められています。

;; ただし、「[[URI]]」という用語は「[[URI参照]]」と必ずしも区別されていないように見受けられます。

さて、この新しい規定では、 [[WebCGM]] における [[URI]] ([[URI参照]]ではなく。)
は [[RFC 3987]] 3.1 節の[[百分率符号化]]を施した後、
[[RFC 3986]] [[URI参照]] ([[URI]] ではなく。) にならなければならないとされています。

;; [[RFC 3987]] 3.1節には [[ASCII]] 範囲内の [[URI]] で使えない文字を[[百分率符号化]]して[['''構わない''']]ことになっていますが、
それが適用されるか否かには全く言及していません。

加えて、[[百分率符号化]]の適用例が示されているのですが、
その中には、[[百分率符号化]]以外の [CODE(char)[[[%]]]] が
[CODE(char)[%25]] になるという怪しい例が含まれています。

-[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
([DEL[[[W3C]] [[会員提出]]]] (改訂済))
-- [CSECTION@@en[3.1.1.4 Non-ASCII characters in URIs]]
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
- [CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([[W3C]] [[勧告]])
-- [CSECTION@@en[3.1.1.4 Non-ASCII characters in URIs]]
<http://www.w3.org/TR/2007/REC-webcgm20-20070130/WebCGM20-IC.html#webcgm_3_1_1_4>、
- [CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([[OASIS]] [[標準]]) 
-- [CSECTION@@en[3.1.1.4 Non-ASCII characters in URIs]]
<http://docs.oasis-open.org/webcgm/v2.0/OS/WebCGM20-IC.html#webcgm_3_1_1_4>

[31] '''XML 型録 URI 正規化''':
[[XML型録]]仕様書では、[[正規化]]と称して、[[型録処理器]]に対する入力や[[型録]]中で示された
[[URI参照]]のようなものを [[URI参照]]に変換する処理を定義しています。
定義されている処理の内容は、 [[XLink 1.0]] 等 (>>8) と同じです。
「[[URI参照]]」の定義として [[RFC 2396]] を参照している点も同じです。

[[XML型録]]で定義されている値が [[URI参照]]の[[属性]]については、
本文の定義に従うなら [[RFC 2396]] の [[URI参照]]なのですが、
2003年以降の仕様に含まれる [[XML Schema]] や [[RELAX NG]]
の[[スキーマ]]では [CODE(XML)@@en[[[anyURI]]]] となっています。

- [[XML型録]] ([[OASIS]] 仕様)
-- [CSECTION@@en[System Identifier and URI Normalization]]
<IW:XMLCatalog:"#sysid-norm">

*** 「XML 資源識別子」、「遺物拡張 IRI」、「遺物拡張 IRI 参照」を定義・参照している仕様

[66] 名前と内容と定義文書が頻繁に変わる'''これ'''は、そもそも
[[W3C]] の [[XML中核WG]] が [[XML]] 関連仕様の [[URI]]/[[IRI]]
の定義を統一するべく、作業を始めました。
はじめは [[XRI]] という名前でしたが、 [[OASIS]] の同名の仕様との衝突を避けるため、
[DFN[[[XML資源識別子]]]] ([DFN@@en[XML Resource Identifier]]、[[XMLRI]] とも)
に改名されました。
[[XLink 1.1]] で定義するつもりだったり (>>28)、
[[XML 1.1]] で定義するつもりだったり (>>65) した後、
[[Internet Draft]] が出版されました。その頃名前は [DFN@@en[[[HRRI]]]] 
(確か、 [DFN@@en[Human Readable Resource Identifiers]]) でした。
それが [[RFC 3987]] の改訂版となる [[Internet Draft]] に吸収され、
[[HRRI]] のような積極的に使いたくなる名前は避けるべきだとして
[DFN[[[遺物拡張IRI]]]] ([DFN@@en[Legacy Extended IRI]]、[DFN@@en[[[LEIRI]]]]) および
[DFN[[[遺物拡張IRI参照]]]] ([DFN@@en[Legacy Extended IRI reference]])
として定義されるに至りました。この間、名前と定義文書だけでなく、
定義そのものも少しずつ変化しています。

[67]
作業が始まって5年以上が経つわけですが、 [[XML中核WG]] は [[LEIRI]]
の作業の完了待ちで各種仕様の改訂作業も中断状態、もうほんと gdgd です。

[65] '''XInclude 1.0 第2版 (将来の XML 1.1 の定義の参照)''':
[[XInclude]] 1.0 の第1版[[勧告]]に対する[[正誤票]]の修正案 PEX17
では、独自の「[[IRI参照]]」 (>>4) や「[[IRI参照]]に変換されるもの」 (>>62)
の定義を削除し、代わりに [[XML 1.1]] の「[[XML資源識別子]]」であるとしました。
[[XML資源識別子]]とは [[RFC 3987]] の [[IRI参照]]に変換されるものであるとも述べていました。

この修正は [[XInclude]] 1.0 第2版[[勧告]]に反映されました。
第2版は更に [[XML 1.1]] の4.2.2節で「[[XML資源識別子]]」が定義されていると明確化しています。
ただし、実は [[XML 1.1]] の改訂はこの時点では行われておらず (その後立ち消え)、
[[XML 1.1]] には「[[XML資源識別子]]」という言葉が一切出てきません。

- [CITE@@en-US[XInclude 1.0 Errata]] ([TIME[2006-04-24 01:05:52 +09:00]] 版)
<http://www.w3.org/2004/12/xinclude-errata/#PEX17>
-- 第1版 [[W3C]] [[勧告]] (改訂済) の[[正誤票]]。
- [CITE@@EN[XML Inclusions (XInclude) Version 1.0 (Second Edition)]]
([[W3C]] [[勧告]])
-- [CSECTION@@en[4.1.1 Escaping of href attribute values]]
<http://www.w3.org/TR/2006/REC-xinclude-20061115/#IRIs>

[28] '''XLink XML 資源識別子''':
[[XLink 1.1]] [[CR]] は「[[XM資源識別子]]」を定義しています。
当時の [[XML中核WG]] の目論見としては、各種 [[XML]] 関連仕様の
[[URI]]/[[IRI]] の定義をこれを参照する形に改める予定だったようです。

[[XML資源識別子]]を
[[IRI参照]]にするためには次の[[文字]]を[[百分率符号化]]しなければなりません。
- [CODE(char)[[[U+0000]]]] 〜 [CODE(char)[[[U+001F]]]], [CODE(char)[[[U+007F]]]]
- [CODE(char)[[[U+0020]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]], [CODE(char)[[["]]]]
- [CODE(char)[[[{]]]], [CODE(char)[[[}]]]], [CODE(char)[[[|]]]],
[CODE(char)[[[\]]]], [CODE(char)[[[^]]]], [CODE(char)[[[`]]]]

なお、 [[XML資源識別子]]を相対形から絶対形に[[解決]]する場合に、
[[IRI]] や [[URI]] を経由せずとも直接変換できることが明記されています。

[68]
- 前の [[WD]] (>>27) では [CODE(char)[[[U+0020]]]]
だけが[[百分率符号化]]対象でしたが、[[URI]] で認められない
[[ASCII]] [[文字]]全体に拡大しています。
- [[XLink]] [[XML資源識別子]]は [[XLink]]/[[XML基底]] [[URI参照]]に変換されるもの 
([[XLink 1.0]] の定義、>>9)
とほぼ同じですが、「[[URI参照]]」ではなく「[[IRI参照]]」
を参照している点が異なります。
- [[XLink]] [[XML資源識別子]]は [[XML]] [[システム識別子]]における
[[URI参照]]に変換されるもの (1.0 2e 以降、1.1、>>7) とほぼ同じですが、
「[[URI参照]]」ではなく「[[IRI参照]]」
を参照している点が異なります。

- [CITE@@en[XML Linking Language (XLink) Version 1.1]] ([DEL[[[W3C]] [[勧告候補]]]] (改訂済))
--[CSECTION@@en[5.4.1 XML Resource Identifiers]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>

[74] '''XML 基底 2e PER (XLink 1.1 CR の参照)''':
[[XML基底]]の第2版 [[PER]] では、第1版の [[URI参照]]に変換されるもの (>>9)
の規定が削除され、 [[XLink 1.1]] [[CR]] で定義されている [[XML資源識別子]] (>>28)
を参照する形に改められています。

- [CITE@@EN[XML Base (Second Edition)]] ([[W3C]] [[PER]])
--[CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<http://www.w3.org/TR/2006/PER-xmlbase-20061220/#syntax>

[71] '''XLink 1.1 2nd LCWD (IRIbis 02 の参照)''':
>>28 の次に出版された [[XLink 1.1]] の [[WD]] では、[[XML資源識別子]]の定義は削除されており、
[[RFC 3987]] の改訂案である [[draft-duerst-iri-bis-02]] の [[LEIRI]]
を参照するように改められています。

- [CITE@@en[XML Linking Language (XLink) Version 1.1]] ([[W3C]] [[WD]])
--[CSECTION@@en[5.4 Locator Attribute ([CODE(XMLa)@@en[href]])]]
<http://www.w3.org/TR/2008/WD-xlink11-20080331/#link-locators>

*** 「anyURI」を定義・参照している仕様

[77] 後述のように、 [[XML Schema]] 第2部の[[データ型]]に関する仕様書で定義されている
[[URI]]・[[IRI]] のための[[データ型]] [DFN@@en[[[anyURI]]]]
は、「[[URI]]」という名前にも関わらず、実質的に [[IRI参照]]として定義されています。
この[[データ型]]は [[XML Schema]] 仕様書内では [[XLink 1.0]] 
を参照する形で定義がなされていますが、
[[スキーマ]]で [CODE(XML)@@en[[[anyURI]]]] [[データ型]]を使う[[文書型]]の仕様書の中には、
[[RFC 3987]] [[IRI参照]]などを引用するものもあって、
厳密には矛盾した、あるいは不必要な制約が加わった形の参照となっていることがあります。

[15] '''XML Schema 1.0 anyURI''':
[[XML Schema]] [[データ型]] [DFN@@en[anyURI]] は、
[[URI]] を表すものであり、絶対形・相対形を含み、[[素片識別子]]があってもよいと定義されています。
更に、 [[RFC 2396]] と [[RFC 2732]] により定義される [[URI]]
の役割を果たす値を表すものとして使うべきであるとされています。
そして、 [[anyURI]] から [[URI]] への変換は [[XLink 1.0]] 5.4節による、
とされています。
[[anyURI]] の[[字句空間]]は [[XLink 1.0]] 5.4 節に従った変化によって
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]となる[[文字列]]、とされています。

[78] わかりにくい定義がなされているのですが、結局のところ、
[[XLink 1.0]] [[URI参照]]に変換されるものと同じものを意図しているようです。
([[XML Schema]] 第2部第1版が参照しているのは [[XLink 1.0]] [[PR]]
ですが、内容は >>8 と同じです。第2版は[[勧告]]を参照しています。)
厳密に解釈すれば [[XLink 1.0]] の「[[URI参照]]」は [[RFC 2396]]
により、 [[XML Schema]] は [[RFC 2396]] と [[RFC 2732]]
によっているので、 [[XML Schema]] の場合の方が表す範囲が広いことになります。

なお、 [[XLink 1.0]] は文脈的に [[XML 1.0]] で認められていない
[[C0制御文字]]はそもそも対象外で認められていないように読めるのですが、
[[XML Schema]] はそのような除外が記されておらず、 [[C0制御文字]]も認められているとも解釈できます。
([[XML Schema]] [[データ型]] [CODE(XML)@@en[[[string]]]] は [[XML 1.0]]
で認められている[[文字]]だけと明記されているのですが、 [CODE(XML)@@en[[[anyURI]]]]
については何も言及がありませんし、後者が前者の[[派生型]]というわけでもありません。)

ところで、 [[XML Schema]] 仕様書は「[[URI]]」を「[[URI参照]]」
の意味で使っているようです。

第2版では note が追加されるなど多少変更はありますが、実質的な規定の内容には変化がありません。

- [CITE[XML Schema Part 2: Datatypes]] ([DEL[[[W3C]] [[勧告]]]] 改訂済)
--[CSECTION@@en[3.2.17 anyURI]]
<http://www.w3.org/TR/2001/REC-xmlschema-2-20010502/#anyURI>
- [CITE@@EN[XML Schema Part 2: Datatypes Second Edition]] ([[W3C]] [[勧告]])
--[CSECTION@@en[3.2.17 anyURI]]
<http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/#anyURI>

[75] '''RELAX NG anyURI''':
[[RELAX NG]] を定義する [[ISO/IEC 19757]]‐2:2002 では、 [[RELAX NG]]
の構文の定義の中で、「[DFN@@en[anyURI]]」を定義しています (6章)。
それによると、 [[anyURI]] とは、 [[XLink 1.0]] 5.4節の[[百分率符号化]]処理 (>>9)
の結果が [[RFC 2396]] + [[RFC 2732]] の [[URI参照]]となる[[文字列]]です。

また、 7.4 節、7.6 節は anyURI として定義された[[属性]]の処理を規定していますが、
そこでは [[XLink 1.0]] 5.4節の[[百分率符号化]]処理 (>>9)
と同じであると規定されています。

更に、附属書 A には [[RELAX NG]] 自体の [[RELAX NG]] [[スキーマ]] (規定) がありますが、
そこでは [CODE(URI)@@en[[[http://www.w3.org/2001/XMLSchema-datatypes]]]]
を [CODE(XMLa)@@en[[[datatypeLibrary]]]] とした上で [CODE(XML)@@en[[[anyURI]]]]
が関係する[[属性]]の[[データ型]]として用いられています。

[29] 対応する[[翻訳JIS]] である [[JIS X 4177]] にも、当然同じ規定があります。

;;
[76] つまり、実質的には同じものを本文中では [[XML Schema]] を参照せずに規定し、
附属書中では [[XML Schema]] (>>15) を使って規定しています。
もっとも、厳密いえば [[ISO/IEC 19757]]‐2:2003 の中では [[XML Schema]]
の[[データ型]]の [[URL]] 
[CODE(URI)@@en[[[http://www.w3.org/2001/XMLSchema-datatypes]]]]
の意味を特に定義しておらず、 [[XML Schema]]
は参考文献にも挙がっていませんので、附属書Aの意図するところは (厳密には)
明確になっていません。

- [[ISO/IEC 19757]]‐2:2003 ([[ISO/IEC]] [[国際標準]])
-- [CSECTION@@en[6 Full syntax]]
-- [CSECTION@@en[7.4 datatypeLibrary attribute]]
-- [CSECTION@@en[7.6 href attribute]]
-- [CSECTION@@en[Annex A (normative) RELAX NG schema for RELAX NG]]
- [[JIS X 4177]]‐2:2005 ([[JIS]] [[規格]])

[84] '''RDF/XML anyURI''':
[[RDF/XML]] の2004年版仕様書は、構文の定義中に「anyURI」があり、
「Any URI.」と説明されているのですが、それ以上の詳しい説明はありません。

anyURI が使われているのは [[RDF/XML]] として解釈する
[[XML 1.0]] [[文書]]中の[[要素]]の[[名前空間URI]] と[[局所名]]を連結したもの
(いわゆる[[展開URI]]) に関する部分です。他の部分との整合性を考えれば、
[[RDF URI参照]] (>>6) と解するのが適切でしょうか。

- [CITE@@en[RDF/XML Syntax Specification (Revised)]] ([[W3C]] [[勧告]])
-- [CSECTION@@en[6.3.2 Grammar Event Matching Notation]]
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#anyURI>

[79] '''XML Schema 1.1 anyURI''':
[[XML Schema 1.1]] における [DFN@@en[[[anyURI]]]]  の定義は
[[XML Schema 1.0]] のもの (>>15) とは異なり、 [[RFC 3987]]
(またはその改訂版) の [[IRI参照]]とされています。
ただし、その[[字句空間]]は単なる[[文字列]]と同じで、それ以上の制約は設けられていません。
Note には [[anyURI]] が実用上有用であるためには [[RFC 3987]] 3.1節の[[百分率符号化]]によって
[[RFC 3986]] [[URI]] になる[[文字列]]であるべきだと述べられていますが、
note であって定義には含まれていません。

;;
[80] なお、  [[XML Schema 1.1]] も [[URI]]/[[IRI]] と
[[URI参照]]/[[IRI参照]]の違いに無頓着なようです。

- [CITE@@EN[W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes]] ([[W3C]]
[[LCWD]])
--[CSECTION@@en[3.3.18 anyURI]]
<http://www.w3.org/TR/2008/WD-xmlschema11-2-20080620/#anyURI>

[35] '''WSDL anyURI (XML Schema anyURI の参照)''':
[[WSDL 2.0]] は [[XML Schema]] 第2版の [CODE(XML)@@en[[[anyURI]]]] (>>15)
を使っています。ですが、単に引用するだけではなく、
- 本質的には [[RFC 3987]] [[IRI]] だ
- [[URI]] への変換は [[XLink 1.0]] で定義されているが、 [[RFC 3987]]
3.1 節とほとんど同じだ
- [[相互運用性]]のため、 [CODE(char)[[[<]]]], [CODE(char)[[[>]]]],
[CODE(char)[[["]]]], [CODE(char)[[[U+0020]]]], [CODE(char)[[[{]]]],
[CODE(char)[[[}]]]], [CODE(char)[[[|]]]], [CODE(char)[[[\]]]],
[CODE(char)[[[^]]]], [CODE(char)[[[`]]]] を使わないことをお勧めする

と述べられています。

実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。

[87] どうしてわざわざ「本質的に」などとわけのわからないことを付け加える必要があるのでしょう。
なお、この仕様書も [[URI]]/[[IRI]] と [[URI参照]]/[[IRI参照]]の違いには無頓着に見えます。

-[CITE@@en[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]]
([[W3C]] [[勧告]])
-- [CSECTION@@en[1.4.3 XML Schema anyURI]]
<http://www.w3.org/TR/2007/REC-wsdl20-20070626/#xmlSchemaAnyURI>

*** IRI・IRI 参照に近い意味で「URI」や「URI 参照」を定義している仕様

[25] '''P3P URI''':
[[P3P]] は用語の定義の中で「[[URI]]」を定義しています。その中では [[RFC 2396]]
によると述べているのですが、 [[HTML]] や [[XML]] においては [[W3C]]
[[charmod]] [[WD]] の規定に従うとしています。 
(ただし、 [[HTTP]] においては適用しないとされています。)

ですが、その参照 (normative reference) されている [[W3C]] [[charmod]] [[WD]]
は、仕様が [[IRI]] (の当時の [[Internet Draft]] である [[draft-masinter-url-i18n-08]])
を使用[['''するべきです''']]と述べているに過ぎず、 [[P3P]] 
の実装が何をするべきなのかは明らかでありません。

[26] [[P3P 1.1]] [[WD]] の当該規定は [[P3P 1.0]] [[勧告]]から変更されていません。
参照している [[charmod]] [[WD]] も古いもののままです。

[40]
なお、 [[WD]] の当該部分は後に分割された別の単独の仕様書に移動しています。
しかしながら、その仕様書は [[CR]] に達した後、放置されているようです。
(実質的な内容は変化していません。)

[[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。

- [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
([[W3C]] [[勧告]])
--[CSECTION@@en[1.3 Terminology]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
-[CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
([[W3C]] [[WD]])
--[CSECTION@@en[1.3 Terminology]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
- [CITE@@en[Character Model for the World Wide Web 1.0]] ([DEL[[[W3C]] [[WD]]]] 改訂済)
--[CSECTION@@en[8 Character Encoding in URI References]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
-- [[P3P]] [[勧告]]が参照 (normative reference) する [[WD]]。
- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
-- [[charmod]] [[WD]] が参照する [[Internet Draft]]。
-- 当然のことながら、後の [[RFC 3987]] とは内容が異なります。
- [CITE@@en[Character Model for the World Wide Web 1.0: Resource Identifiers]]
([[W3C]] [[CR]])
<http://www.w3.org/TR/2004/CR-charmod-resid-20041122/>

[24] '''XML 暗号化 URI''':
[[XML暗号化]]仕様書では、「[[URI]]」は [[XML Schema]] [[データ型]]
[CODE(XML)@@en[[[anyURI]]]] (>>15) と [[XML署名]]
[CODE(XMLa)@@en[[[URI]]]] [[属性]]の規定 (>>8)
に従わなければ[['''なりません''']]と規定されています。

なお、「[[URI]]」の参考文献として [[RFC 2396]] ([[URI]])、[[RFC 1738]] ([[URL]])、
[[RFC 2141]] ([[URN]])、[[RFC 2611]] ([[URN]]) が参照されています。

[83] 手当たり次第に何でも引用できるものはしてしまおうとでもいうのでしょうか、
無茶苦茶ですね。引用されている [[XML署名]]の規定は [[XLink 1.0]]
の規定と同じ内容なので、実用上は [[XML Schema]] の規定とも同じで、
問題にはならないのですが・・・。

- [CITE[XML Encryption Syntax and Processing]] ([[W3C]] [[勧告]])
--[CSECTION@@en[1.3 Versions, Namespaces, URIs, and Identifiers]]
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>

[6] '''RDF URI 参照''':
2004年の [[RDF]] 仕様書は「[[RDF]] [[グラフ]]における [[URI参照]]」
([[RDF URI参照]])」を定義しています。それによると、
[DFN[[[RDF URI参照]]]]とは、
- [[Unicode]] [[文字列]]であって、
- [CODE(char)[[[U+0000]]]] 〜 [CODE(char)[[[U+001F]]]]、
[CODE(char)[[[U+007F]]]] 〜 [CODE(char)[[[U+009F]]]] を含まず、
- [[百分率符号化]]によって [[RFC 2396]] [[URI参照]]
(ただし、[[絶対URI]] + [[素片識別子]]) となるもの

です。[[百分率符号化]]の対象としては、
- [[非ASCII文字]]
- [[RFC 2396]] 2.4節除外文字 ([CODE(char)[#]], [CODE(char)[[[%]]]],
[CODE(char)[[['''[''']]]], [CODE(char)[[[''']''']]]] を除く。)

が挙げられています。

[81] [[非文字]]や[[代理組]]の[[符号位置]]が認められているのかどうかは不明瞭です。

[82]
- 「[[URI参照]]」の定義に [[RFC 2396]] だけを引用しており、
厳密に解釈すると [[RFC 2732]] の拡張は含まれないことになります。
- [[相対参照]]は定義に含まれていませんが、 [[RDF/XML]] 等[[具象構文]]で[[基底URI]]
が定義されている場合には[[相対参照]]を使っても構わないと note に記述されています。
--[[RDF URI参照]]を参照している仕様はこの意味で[[相対参照]]まで含めて
[[RDF URI参照]]と呼んでいる (のかもしれない) ことがあります。
-- 例えば、 [[RDF/XML]] 仕様書のほとんどの「[[RDF URI参照]]」への言及は絶対形と理解して問題ないのですが、
文法規則 URI-reference をそう理解すると一部の[[属性値]]に[[相対参照]]が使えないことになり、
仕様書の他の部分の記述や一般的な理解と矛盾します。
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#section-grammar-summary>
- [[RDF URI参照]]は [[XML Schema]] 第1版の [[anyURI]] (>>15) のうち、
[[相対参照]]を除いたものと互換であると
note に記述されています。「互換」の意味は明確ではありませんが、
([[RFC 2732]] の解釈に関する問題を除けば) [[anyURI]]
が [[RDF URI参照]]の[[超集合]]となっています ([[anyURI]] では[[制御文字]]を使用可能)。
- [[RDF URI参照]]は [[XML名前空間 1.1]] の [[IRI]] (>>3)
と互換であると note に記述されています。「互換」の意味は明確ではありませんが、
([[XML名前空間 1.1]] における「[[URI参照]]」の定義が謎なのに目をつぶれば)
[[XML名前空間 1.1]] [[IRI参照]]は [[RDF URI参照]]の[[部分集合]]となっています
([[XML名前空間 1.1]] [[IRI参照]]では[[私用域]]、[[非文字]]、[[代理組]]の[[符号位置]]を使用不能)。
ただし、 [[XML名前空間 1.1]] [[IRI参照]]には[[相対参照]]も含まれています。
- 仕様書中の当該する節は [[IRI]] の [[RFC]] 化を見越したもので、 [[IRI]]
の [[Internet Draft]] である [[draft-duerst-iri-04]] やその後の版に適合しない
[[RDF URI参照]]に対しては警告を発しても構わないと note にあります。
実際のところ [[RFC 3987]] の [[IRI参照]] (の[[相対IRI参照]]を除いたもの)
と [[RDF URI参照]]を比較すると、 使える[[文字]]の種類としては [[RFC 3987]] の方が
[[RDF]] の方の[[部分集合]]になっています。しかし、構文的には逆に、
[[RFC 3987]] で認められている [[authority]] 中の[[百分率符号化]]が
[[RFC 2396]] ベースの [[RDF URI参照]]では認められていなかったりします。

- [CITE@@en[Resource Description Framework (RDF): Concepts and Abstract Syntax]]
([[W3C]] [[勧告]])
--[CSECTION@@en[6.4 RDF URI References]]
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>

[5] '''DOM URI''':
[[DOM水準3]] では、中の人も相当困ったのでしょう、具体的な書式に言及することを諦めて、
抽象的な [DFN@@en[[[DOM URI]]]] を次の条件を満たすものとして定義しています。
- 絶対識別子 (「絶対 URI」) は、 [[Web]] 上の資源を絶対的に識別する
- 単純な文字列比較により絶対識別子は比較でき、他の等価性は [[DOM]]
では扱わない
- 相対識別子 (「相対 URI」) は簡単に判別可能かつある絶対識別子に対して絶対にできる
- 資源の内容の取り出しは必要な時に行ってもよい

そして、一般に [[DOM]] 内では特定の書式を想定した処理はせず、
相対識別子の解決や内容の取り出しで必要になった場合に限り、
関係する仕様書に従って処理することとされています。
関係する仕様書の例としては、 [[HTML 4.01]]・[[XML 1.0]]・[[XML名前空間 1.0]]
については [[RFC 2396]]、[[XML名前空間 1.1]] 第1版についてはその [[IRI]]
が示されています。

[30] '''XSLT URI 参照''':
[[XSLT 2.0]] [[勧告]]では「[[URI参照]]」を定義しています。
また、[[XPL]] 仕様案では、「[[URI参照]]」の定義を、(当時の) [[XSLT 2.0]] の [[WD]]
から借りたとして同じことを定義しています。
それによると、「[[URI参照]]」は、 [[XML Schema]]
の [CODE(XML)@@en[[[anyURI]]]] [[データ型]]の[[字句空間]]に属する[[文字列]]です。

加えて、[[外部資源]]を識別する [[URI参照]]については、 [[XLink 1.0]]
5.4節 (>>8) と同じ規則に適合しなければならないとの制約が加わります。

また、[[相対参照]]を[[解決]]する場合は [[RFC 2396]] ([[XPL]])
または [[RFC 3986]] ([[XSLT]]) 
 [[URI参照]]に変換しなければならない旨が規定されています。

なお、 [[XPL]] の仕様書は、その規定・言及の仕方の範囲内では特に何の問題もないとは思いますが、
[[RFC 2396]] を引用しているものの、 [[RFC 2732]] には言及すらしていません。

[37] 単に [[XML Schema]] の [[anyURI]] を参照するとだけ述べずに、
なぜあえて[[字句空間]]に限定し、更に別に [[XLink]] を参照する規定を敢えて加えたのかはよくわかりませんが、
「外部参照の」という限定があることを考えると、外部参照以外の [[URI参照]]には
[[XLink]] の規定を適用しない、という意図があるのでしょうか。そうだとしても、
結局 [[XML Schema]] の規定する[[字句空間]]内では違いが現れないと思うのですが。

なお、 [[XPL]] 仕様書の参考文献一覧では [[XML Schema]] の発行年が2000年になっていますが
(リンクは最新版へ)、 [[XML Schema]] 第1版の[[勧告]]は2001年です。
2000年当時の [[CR]] では「[[anyURI]]」は規定されておらず、「[[uriReference]]」
という名前でした。この仕様書自体は2005年なので、そのような古い仕様案を引用する意味はなく、
単なる誤記かもしれません。
[[XSLT 2.0]] は [[XML Schema]] 第2版を参照しています。

- [CITE@@EN[XML Pipeline Language (XPL) Version 1.0 (Draft)]] ([DEL[[[W3C]] [[会員提出]]]]
改訂済)
--[CSECTION@@en[8.2 URI Reference]]
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
- [CITE@@EN[XSL Transformations (XSLT) Version 2.0]] ([[W3C]] [[勧告]])
--[CSECTION@@en[5.8 URI References]]
<http://www.w3.org/TR/2007/REC-xslt20-20070123/#uri-references>

[38] '''XPath URI''': [[XPath 2.0]] 本体仕様書と
[CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] では、「[[URI]]」
は [[RFC 3986]] で定義されて [[RFC 3987]] で [[IRI]] として拡張されているものを指すと定義しています。
「[[基底URI]]」等の複合語の「[[URI]]」を「[[IRI]]」に置き換えることによる混乱を防ぐ意図があると述べられています。

[CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] 
では更に「[[URI参照]]」も定義しています。「[[URI参照]]」は [[XSLT 2.0]]
(>>30) と同じく、 [[XML Schema]] 第2版 [CODE(XML)@@en[[[anyURI]]]] (>>15)
の[[字句空間]]とされています (ただし特に規定がない場合との限定付き)。 
([[XSLT 2.0]] とは異なり、こちらでは
[[XLink]] 仕様に基づく変換のような規定はありません。)

[85]
このおかしな定義のため、 [[XPath 2.0]] においては「[[URI]]」
が [[RFC 3986]]/[[RFC 3987]] ベース、「[[URI参照]]」
が [[RFC 2396]]/「「RFC 2732]] ベースになってしまっています。

- [CITE@@EN[XML Path Language (XPath) 2.0]] ([[W3C]] [[勧告]])
--[CSECTION@@en[2 Basics]]
<http://www.w3.org/TR/2007/REC-xpath20-20070123/#dt-URI>
- [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] ([[W3C]] [[勧告]])
--[CSECTION@@en[1.7 Terminology]]
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>

[45] '''PLS URI''':
[[PLS]] 仕様書では、「[[URI]]」を [[WebArch]] 仕様書に示された大域識別子であって、
[[XML Schema]] 第2版の [CODE(XML)@@en[[[anyURI]]]] (>>15) である、としています。
その上で、 informative purposes only としながら [[RFC 3986]] と [[RFC 2732]]
を有用だろうとして引用しています。 [[RFC 3987]] にも言及しています。

[89] 単に [[XML Schema]] だけを引用しておけばいいところ、なぜ敢えて色々わけのわからないものを引用しているのかが謎です。
[[WebArch]] を引用する意味はわかりませんし、 [[RFC 2732]]
への参照も消し忘れでしょうが、そんなものが review を越えて[[勧告]]になるというのもおかしな話です。

- [CITE[Pronunciation Lexicon Specification (PLS) Version 1.0]] ([[W3C]] [[勧告]])
--[CSECTION@@en[1.5. Glossary of Terms]]
<http://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/#term-uri>

*** IRI・IRI 参照に近い意味で「URL」を定義している仕様

[47] '''HTTP における URL''':
[[RFC 2068]] は [[HTTP/1.1]] における [[URL]] を定義していますが、
[[RFC 1738]] で認められていない [[ASCII]] [[文字]]
([CODE(ABNF)@@en[[[national]]]]) や [CODE(char)[[[0x80]]]] 以上の[[オクテット]]
([[右半面]]) を使うことを認めていました。 (ただし、
[CODE(char)[[[0x80]]]] 以上の[[オクテット]]の解釈は明記されていません。)

[[HTTP]] の [[URL]] が[[鯖]]が解釈するのだから、[[相互運用性]]の問題はないといったような理屈でした。

これは [[RFC 2616]] で修正され、 [[RFC 2396]] に従うようになりました。

[69] '''[[HTML 5]] [[URL]]''':
[[HTML 5]] は [[URL]] の処理を定義しており、そこでは任意の[[文字列]]が [[URL]]
として与えられた時にどう扱わなければならないかを規定しています。
更に、[[妥当なURL]] を定義しています。[[妥当なURL]] は [[RFC 3986]] [[URI]]
や [[RFC 3987]] [[IRI]] の[[部分集合]]になっています。

[48]
[[HTML 5]] の中の人である [[Ian Hickson]] は、 [[HTML 5]]
に [[URL]] の規定を含めるにあたり、 [[ietf-uri]] の人達に [[Web]]
のための [[URL]] の独立した仕様を作る気がないか問い合わせましたが、
彼らは自分達には関係のない問題だと拒否したため、 [[HTML 5]]
に含まれることになりました。

詳しくは [[URI5]] や [[URL]] の項を参照してください。

*** メモ

@@@@ SVG Tiny 1.2 勧告後、それについての説明を追加する。

[46]
[[RFC 4622]] は [CODE(URI)@@en[[[xmpp]]:]] [[URL]] の構文を定義しているのですが、
[[RFC 3986]] や [[RFC 3987]] で認められていない [[ASCII]] [[文字]]を使うことを認めていました。
これは [[RFC 5122]] で修正され、 [[RFC 3986]] や [[RFC 3987]] に従うようになりました。

[88] 他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。)

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[[#comment]]

** メモ


[44]
[CITE@@en[draft-duerst-iri-bidi-00 - Internet Identifiers and Bidirectionality]] ([CODE[2007-07-20 13:22:23 +09:00]] 版) <http://www.tools.ietf.org/html/draft-duerst-iri-bidi-00>

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[43]
[CITE[Resuming editing of IRI spec towards Draft Standard]] ([[Martin Duerst]] 著, [CODE[2007-06-04 08:31:57 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.public-iri/130>

[[#comment]]



* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>

[[#comment]]


* メモ

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([CODE[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

[41]
[CITE[Amazon日本語URL時代における書籍名の新常識 - 坂本多聞のインサイドアウト]] ([CODE[2007-06-09 23:47:23 +09:00]] 版) <http://rblog-ent.japan.cnet.com/tamon/2007/04/amazonurl_7390.html>
([[名無しさん]] [WEAK[2007-06-09 14:49:43 +00:00]])

[42]
[CITE@@ja[WordPressカスタマイズメモ【企業ホームページ制作方法】: SEO対策にはUTF-8(文字コード)]] ([CODE[2007-06-07 13:21:14 +09:00]] 版) <http://wordpress.seesaa.net/article/35406256.html>
([[名無しさん]] [WEAK[2007-06-09 14:50:32 +00:00]])
@


1.28
log
@auto-committed
@
text
@d1 850
a850 250

[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2007-01-25 02:12:49 +09:00]] 版) <http://www.w3.org/TR/2007/REC-webcgm20-20070130/WebCGM20-IC.html#webcgm_3_1_1_4>、
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2006-11-04 01:53:46 +09:00]] 版) 
<http://docs.oasis-open.org/webcgm/v2.0/OS/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
--- [40] 旧版:
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
-- [35]
[CITE@@en[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]]
<http://www.w3.org/TR/2007/REC-wsdl20-20070626/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
-- [37] [CITE@@en[XSL Transformations (XSLT) Version 2.0]] <http://www.w3.org/TR/2007/REC-xslt20-20070123/#uri-references>
--- [DFN[URI 参照]]は、 [[XML Schema 1.0]] の
[CODE(XML)@@en[xs:[[anyURI]]]] の[[字句空間]]に[[一致]]する[[文字列]]としています。
--- 更に、[[外部資源]]を[[識別]]する [[URI参照]]は、
[[XLink 1.0]] の [CODE(XMLa)@@en[[QN[xlink:[[href]]] [http://www.w3.org/1999/xlink]]]]
[[属性]]の制約にも従わなければならないとしています。
-- [38] [CITE@@EN[XML Path Language (XPath) 2.0]]
<http://www.w3.org/TR/2007/REC-xpath20-20070123/#dt-URI>
--- [Q[この仕様書内では]]として、 [Q@@en[URI]]
を次のように定義しています:
---- [[統一資源識別子]]で、
----- [[RFC 3986]] で定義されていて、
----- [[RFC 3987]] で新しい名前 [[IRI]] のもとに拡張されているもの
--- また、[Q[[[基底URI]]]] など、既存の用語が [Q@@en[[[URI]]]]
と呼んでいるものを [[IRI]] のために呼び替えることはせずに、
[Q@@en[[[URI]]]] のままにするとしています。
-- [39] [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] 
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>
--- >>38 と同じ [Q@@en[[[URI]]]] の定義と説明があります。
--- 更に、[Q[[[URI参照]]]]は、別途注意がない限り、
[[XML Schema 1.0]] の [CODE(XML)@@en[[[xs:[[anyURI]]]]]]
の[[字句空間]]に属する[[文字列]]を指すと定義されています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[43]
[CITE[Resuming editing of IRI spec towards Draft Standard]] ([[Martin Duerst]] 著, [CODE[2007-06-04 08:31:57 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.public-iri/130>
([[名無しさん]])

[45]
[CITE[Extensible Markup Language (XML) 1.0]] ([CODE[2000-05-10 01:35:50 +09:00]] 版) <http://www.w3.org/TR/1998/REC-xml-19980210#dt-sysid>
([[名無しさん]])

[46]
[[RFC 4622]] は [CODE(URI)@@en[[[xmpp]]:]] [[URL]] の構文を定義しているのですが、
[[RFC 3986]] や [[RFC 3987]] で認められていない [[ASCII]] [[文字]]を使うことを認めていました。
これは [[RFC 5122]] で修正され、 [[RFC 3986]] や [[RFC 3987]] に従うようになりました。
([[名無しさん]])

[47]
[[RFC 2068]] は [[HTTP/1.1]] における [[URL]] を定義していますが、
[[RFC 1738]] で認められていない [[ASCII]] [[文字]]
([CODE(ABNF)@@en[[[national]]]]) や [CODE(char)[[[0x80]]]] 以上の[[オクテット]]
([[右半面]]) を使うことを認めていました。 (ただし、
[CODE(char)[[[0x80]]]] 以上の[[オクテット]]の解釈は明記されていません。)
これは [[RFC 2616]] で修正され、 [[RFC 2396]] に従うようになりました。
([[名無しさん]])


[48]
d854 130
a983 96
や [[RFC 3987]] [[IRI]] の[[部分集合]]になっています。
([[名無しさん]])


[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])

[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([CODE[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

[41]
[CITE[Amazon日本語URL時代における書籍名の新常識 - 坂本多聞のインサイドアウト]] ([CODE[2007-06-09 23:47:23 +09:00]] 版) <http://rblog-ent.japan.cnet.com/tamon/2007/04/amazonurl_7390.html>
([[名無しさん]] [WEAK[2007-06-09 14:49:43 +00:00]])

[42]
[CITE@@ja[WordPressカスタマイズメモ【企業ホームページ制作方法】: SEO対策にはUTF-8(文字コード)]] ([CODE[2007-06-07 13:21:14 +09:00]] 版) <http://wordpress.seesaa.net/article/35406256.html>
([[名無しさん]] [WEAK[2007-06-09 14:50:32 +00:00]])

[44]
[CITE@@en[draft-duerst-iri-bidi-00 - Internet Identifiers and Bidirectionality]] ([CODE[2007-07-20 13:22:23 +09:00]] 版) <http://www.tools.ietf.org/html/draft-duerst-iri-bidi-00>
([[名無しさん]])@


1.27
log
@auto-committed
@
text
@d230 18
d249 6
a254 2
[45]
[CITE[Extensible Markup Language (XML) 1.0]] ([TIME[2000-05-10 01:35:50 +09:00]] 版) <http://www.w3.org/TR/1998/REC-xml-19980210#dt-sysid>
@


1.26
log
@auto-committed
@
text
@d230 6
d326 2
a327 3
[CITE@@en[draft-duerst-iri-bidi-00 - Internet Identifiers and Bidirectionality]] ([TIME[2007-07-20 13:22:23 +09:00]] 版) <http://www.tools.ietf.org/html/draft-duerst-iri-bidi-00>
([[名無しさん]])

@


1.25
log
@auto-committed
@
text
@a225 1

d227 1
a227 1
[CITE[Resuming editing of IRI spec towards Draft Standard]] ([[Martin Duerst]] 著, [TIME[2007-06-04 08:31:57 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.public-iri/130>
a229 1

d317 6
a322 1
([[名無しさん]] [WEAK[2007-06-09 14:50:32 +00:00]])@


1.24
log
@auto-committed
@
text
@d1 319
a319 313
[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2007-01-25 02:12:49 +09:00]] 版) <http://www.w3.org/TR/2007/REC-webcgm20-20070130/WebCGM20-IC.html#webcgm_3_1_1_4>、
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2006-11-04 01:53:46 +09:00]] 版) 
<http://docs.oasis-open.org/webcgm/v2.0/OS/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
--- [40] 旧版:
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
-- [35]
[CITE@@en[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]]
<http://www.w3.org/TR/2007/REC-wsdl20-20070626/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
-- [37] [CITE@@en[XSL Transformations (XSLT) Version 2.0]] <http://www.w3.org/TR/2007/REC-xslt20-20070123/#uri-references>
--- [DFN[URI 参照]]は、 [[XML Schema 1.0]] の
[CODE(XML)@@en[xs:[[anyURI]]]] の[[字句空間]]に[[一致]]する[[文字列]]としています。
--- 更に、[[外部資源]]を[[識別]]する [[URI参照]]は、
[[XLink 1.0]] の [CODE(XMLa)@@en[[QN[xlink:[[href]]] [http://www.w3.org/1999/xlink]]]]
[[属性]]の制約にも従わなければならないとしています。
-- [38] [CITE@@EN[XML Path Language (XPath) 2.0]]
<http://www.w3.org/TR/2007/REC-xpath20-20070123/#dt-URI>
--- [Q[この仕様書内では]]として、 [Q@@en[URI]]
を次のように定義しています:
---- [[統一資源識別子]]で、
----- [[RFC 3986]] で定義されていて、
----- [[RFC 3987]] で新しい名前 [[IRI]] のもとに拡張されているもの
--- また、[Q[[[基底URI]]]] など、既存の用語が [Q@@en[[[URI]]]]
と呼んでいるものを [[IRI]] のために呼び替えることはせずに、
[Q@@en[[[URI]]]] のままにするとしています。
-- [39] [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] 
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>
--- >>38 と同じ [Q@@en[[[URI]]]] の定義と説明があります。
--- 更に、[Q[[[URI参照]]]]は、別途注意がない限り、
[[XML Schema 1.0]] の [CODE(XML)@@en[[[xs:[[anyURI]]]]]]
の[[字句空間]]に属する[[文字列]]を指すと定義されています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])

[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([CODE[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

[41]
[CITE[Amazon日本語URL時代における書籍名の新常識 - 坂本多聞のインサイドアウト]] ([CODE[2007-06-09 23:47:23 +09:00]] 版) <http://rblog-ent.japan.cnet.com/tamon/2007/04/amazonurl_7390.html>
([[名無しさん]] [WEAK[2007-06-09 14:49:43 +00:00]])

[42]
[CITE@@ja[WordPressカスタマイズメモ【企業ホームページ制作方法】: SEO対策にはUTF-8(文字コード)]] ([TIME[2007-06-07 13:21:14 +09:00]] 版) <http://wordpress.seesaa.net/article/35406256.html>
([[名無しさん]] [WEAK[2007-06-09 14:50:32 +00:00]])

@


1.23
log
@auto-committed
@
text
@d1 313
a313 313

[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2007-01-25 02:12:49 +09:00]] 版) <http://www.w3.org/TR/2007/REC-webcgm20-20070130/WebCGM20-IC.html#webcgm_3_1_1_4>、
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([CODE[2006-11-04 01:53:46 +09:00]] 版) 
<http://docs.oasis-open.org/webcgm/v2.0/OS/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
--- [40] 旧版:
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
-- [35] [CITE[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]] 
<http://www.w3.org/TR/2006/CR-wsdl20-20060327/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
-- [37] [CITE@@en[XSL Transformations (XSLT) Version 2.0]] <http://www.w3.org/TR/2007/REC-xslt20-20070123/#uri-references>
--- [DFN[URI 参照]]は、 [[XML Schema 1.0]] の
[CODE(XML)@@en[xs:[[anyURI]]]] の[[字句空間]]に[[一致]]する[[文字列]]としています。
--- 更に、[[外部資源]]を[[識別]]する [[URI参照]]は、
[[XLink 1.0]] の [CODE(XMLa)@@en[[QN[xlink:[[href]]] [http://www.w3.org/1999/xlink]]]]
[[属性]]の制約にも従わなければならないとしています。
-- [38] [CITE@@EN[XML Path Language (XPath) 2.0]]
<http://www.w3.org/TR/2007/REC-xpath20-20070123/#dt-URI>
--- [Q[この仕様書内では]]として、 [Q@@en[URI]]
を次のように定義しています:
---- [[統一資源識別子]]で、
----- [[RFC 3986]] で定義されていて、
----- [[RFC 3987]] で新しい名前 [[IRI]] のもとに拡張されているもの
--- また、[Q[[[基底URI]]]] など、既存の用語が [Q@@en[[[URI]]]]
と呼んでいるものを [[IRI]] のために呼び替えることはせずに、
[Q@@en[[[URI]]]] のままにするとしています。
-- [39] [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] 
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>
--- >>38 と同じ [Q@@en[[[URI]]]] の定義と説明があります。
--- 更に、[Q[[[URI参照]]]]は、別途注意がない限り、
[[XML Schema 1.0]] の [CODE(XML)@@en[[[xs:[[anyURI]]]]]]
の[[字句空間]]に属する[[文字列]]を指すと定義されています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])

[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([CODE[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

[41]
[CITE[Amazon日本語URL時代における書籍名の新常識 - 坂本多聞のインサイドアウト]] ([CODE[2007-06-09 23:47:23 +09:00]] 版) <http://rblog-ent.japan.cnet.com/tamon/2007/04/amazonurl_7390.html>
([[名無しさん]] [WEAK[2007-06-09 14:49:43 +00:00]])

[42]
[CITE@@ja[WordPressカスタマイズメモ【企業ホームページ制作方法】: SEO対策にはUTF-8(文字コード)]] ([TIME[2007-06-07 13:21:14 +09:00]] 版) <http://wordpress.seesaa.net/article/35406256.html>
([[名無しさん]] [WEAK[2007-06-09 14:50:32 +00:00]])

@


1.22
log
@auto-committed
@
text
@d1 313
a313 304
[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([TIME[2007-01-25 02:12:49 +09:00]] 版) <http://www.w3.org/TR/2007/REC-webcgm20-20070130/WebCGM20-IC.html#webcgm_3_1_1_4>、
[CITE[WebCGM 2.0 - WebCGM Intelligent Content]] ([TIME[2006-11-04 01:53:46 +09:00]] 版) 
<http://docs.oasis-open.org/webcgm/v2.0/OS/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
---[40] 旧版:
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
-- [35] [CITE[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]] 
<http://www.w3.org/TR/2006/CR-wsdl20-20060327/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
--[37] [CITE@@en[XSL Transformations (XSLT) Version 2.0]] <http://www.w3.org/TR/2007/REC-xslt20-20070123/#uri-references>
--- [DFN[URI 参照]]は、 [[XML Schema 1.0]] の
[CODE(XML)@@en[xs:[[anyURI]]]] の[[字句空間]]に[[一致]]する[[文字列]]としています。
--- 更に、[[外部資源]]を[[識別]]する [[URI参照]]は、
[[XLink 1.0]] の [CODE(XMLa)@@en[[QN[xlink:[[href]]][http://www.w3.org/1999/xlink]]]]
[[属性]]の制約にも従わなければならないとしています。
--[38] [CITE@@EN[XML Path Language (XPath) 2.0]]
<http://www.w3.org/TR/2007/REC-xpath20-20070123/#dt-URI>
--- [Q[この仕様書内では]]として、 [Q@@en[URI]]
を次のように定義しています:
---- [[統一資源識別子]]で、
----- [[RFC 3986]] で定義されていて、
----- [[RFC 3987]] で新しい名前 [[IRI]] のもとに拡張されているもの
--- また、[Q[[[基底URI]]]] など、既存の用語が [Q@@en[[[URI]]]]
と呼んでいるものを [[IRI]] のために呼び替えることはせずに、
[Q@@en[[[URI]]]] のままにするとしています。
--[39] [CITE@@EN[XQuery 1.0 and XPath 2.0 Functions and Operators]] 
<http://www.w3.org/TR/2007/REC-xpath-functions-20070123/#uri>
--- >>38 と同じ [Q@@en[[[URI]]]] の定義と説明があります。
--- 更に、[Q[[[URI参照]]]]は、別途注意がない限り、
[[XML Schema 1.0]] の [CODE(XML)@@en[[[xs:[[anyURI]]]]
の[[字句空間]]に属する[[文字列]]を指すと定義されています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])

[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([TIME[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

@


1.21
log
@auto-committed
@
text
@d96 6
a103 2
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
@


1.20
log
@auto-committed
@
text
@d184 16
@


1.19
log
@auto-committed
@
text
@d1 284
a284 279

[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
-- [35] [CITE[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]] 
<http://www.w3.org/TR/2006/CR-wsdl20-20060327/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])

[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>

[36]
[CITE@@ja[電子メール本文中の日本語ドメイン名URLをクリックできるようにするには - 日本語.jp]] ([TIME[2006-11-29 16:15:15 +09:00]] 版) <http://nihongojp.jp/support/mail_guide/>
([[名無しさん]] [WEAK[2006-12-29 07:19:52 +00:00]])

@


1.18
log
@auto-committed
@
text
@d1 279
a279 275
[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
--[35] [CITE[Web Services Description Language (WSDL) Version 2.0 Part 1: Core Language]] 
<http://www.w3.org/TR/2006/CR-wsdl20-20060327/#xmlSchemaAnyURI>
--- [CODE(XML)@@en[[[anyURI]]]] を参照しています。
--- 実際に使用している箇所では、 [Q[[[RFC 3987]] の[[絶対IRI]]]]
のように更に制約があります。
--- [[IRI]] で使えない [[ASCII]] [[文字]]は使わないように助言しています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。


[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])


[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

[CITE[XML Encryption Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/>@


1.17
log
@auto-committed
@
text
@d1 274
a274 269

[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]


* 仕様

[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
-- [27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
--- [[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
-- [28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--- >>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
--- 今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
--- '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
--- [[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
---- [CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
--- この部分の規定は [ABBR[[[FE]]] [第1版]] にはありませんでした。
-- [33] 
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
-- [23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
-- [31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
-- [32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]] [Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
-- [25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
--- [CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
---- [[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
---- [[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
---- 後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
--- [CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
--- [26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
---- [[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
-- [15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
-- [24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
--- [Q[[ABBR[[[URI]]] [Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
-- [29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
-- [30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])

[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]


* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]


* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。


[34]
[CITE[Bug 261929 - Consider sending urls in UTF-8 by default (images/links with non-ASCII chacters not displayed)]] <https://bugzilla.mozilla.org/show_bug.cgi?id=261929>
([[名無しさん]])


[[#comment]]


* メモ

[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

@


1.16
log
@auto-committed
@
text
@d1 269
a269 257
[19] [[IRI]] は、 [[URI]] 
で使える[[文字]]の種類を増やした拡張版の[[識別子]]です。

[[#comment]]

* 仕様
[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987>, <http://www.ietf.org/rfc/rfc3987.txt>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 3986]] の
[[URI参照]]に変換できる文字列です。
--- [[ABNF]] によっても構文が規定されています。
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--- [Q[IRI]] を概念的に定義し、 [Q[IRI 参照]]に [[XPointer]]
[[指示子]]を使う方法を規定しています。
---- IRI 参照に指示子を挿入する時には、百分率記号は[[百分率符号化]]します。
それ以外の文字は百分率符号化しても'''構いません'''が、
しないことを推奨しています。
---- XPointer 指示子には任意の [[Unicode]] の文字
([CODE(char)[[[U+0000]]]]〜[CODE(char)[[[U+10FFFF]]]]、除外なし)
が使えます。つまり XPointer でいう IRI にはあらゆる Unicode
文字が生で使えます。
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--- [Q[IRI 参照]]は、[[百分率符号化]]と [[Punycode]] 符号化により
[[RFC 2396]] + [[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。
---- 構文的には RFC 3987 よりも狭いです。
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>
--- [Q[IRI 参照]]は、[[百分率符号化]]により [[RFC 2396]] +
[[RFC 2732]] の [[URI参照]]に変換できる文字列です。
---- 文字種的には RFC 3987 と出入りがあります。 XML
名前空間 1.1 とは同じです。
---- 構文的には RFC 3987 よりも狭いです。 Punycode
化の規定がないので、 XML 名前空間 1.1 よりも狭いです。
--- [Q[IRI 参照に変換できるもの]]も定義されています。
---- 文字種的には [Q[IRI 参照]] + α です。
- [Q[IRI 参照に変換できるもの]]または [Q[IRI に変換できるもの]]を定義している仕様書
--[27] [[XLink 1.1]] <http://www.w3.org/TR/2005/WD-xlink11-20050707/#link-locators>
---[[RFC 3987]] の [[IRI参照]]を使っていますが、 [[XLink 1.0]]
の名残りで [CODE(charname)[[[SPACE]]]] 
も[[百分率符号化]]するのだという規定があります。
--[28] [[XLink 1.1]]
<http://www.w3.org/TR/2006/CR-xlink11-20060328/#xml-resource-identifier>
--->>27 に[DFN[[[XML資源識別子]]]]という名前を与えています。
---今後の[[XML]]系規格はこれで統一するつもりのようです。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
---'''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
---[[UTF-8]] とみなして[[百分率符号化]]する方法と、
[[文書]]の[[文字符号化方式]]で百分率符号化する方法が紹介されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>
--- [Q[[[システム識別子]]]]に URI 参照
([[RFC 2396]] + [[RFC 2732]]) で禁止されている文字が使えると規定されています。
--- SE では RFC の参照により禁止文字が指定されていましたが、
TE, 1.1 では直接記載されています。なお、
この規定は正誤表で何度か訂正されています。
--- [22] [[RDF]] の1999年版仕様では XML 1.0 の[[システム識別子]]と同じ方法で 
URI 参照を扱うことが勧められていました。
----[CITE[Resource Description Framework (RDF) Model and Syntax Specification]] 
<http://www.w3.org/TR/1999/REC-rdf-syntax-19990222/#grammar>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
--- URI ([[RFC 2396]] + [[RFC 2732]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
--- URI ([[RFC 2396]]) のようなもので禁止文字が使えると規定しています。
--- 禁止文字は [[RFC 2396]] と [[RFC 2732]] に拠っています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
---- [28] [[RELAX NG]]
----- [[XLink]] を参照しています。 ([ISO/IEC 19757]]‐2:2002 7.6)
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>
--- URI ([[RFC 2396]] + [[RFC 2732]]) 
で禁止文字が使えると規定しています。
--- [[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ、
非 ASCII 文字にしか言及していません (ASCII 内の禁止文字については触れていません)。
---この部分の規定は [ABBR[[[FE]]][第1版]] にはありませんでした。
--[33] 
[CITE@@en[OASIS CGM Open specification - WebCGM 2.0 - WebCGM Intelligent Content]] 
<http://www.w3.org/Submission/2006/SUBM-WebCGM20-20060313/WebCGM20-IC.html#webcgm_3_1_1_4>
--- [[RFC 3987]]の方法で[[RFC 3986]]の[[URI]]になるものと規定しています。
--- が、単独の[CODE[%]]がどうとか、怪しい記述が色々あります。
--[23] [CITE[XML-Signature Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>
--- [CODE(XMLa)[[[URI]]]] 属性値を [[RFC 2396]] + [[RFC 2732]]
で禁止文字が使えると規定しています。
--[31] [[XML型録]]では[[正規化]]と称して[[URI]]や[[システム識別子]]を指定できる[[属性]]から[[URI]]を得るための方法が定義されています。
--[32] [[SVG 1.0]], [[SVG 1.1]]
--- <IW:SVG:"struct.html#xlinkusage">
--- [[XLink 1.0]] (>>8) を参照しつつ、同じことを定義しています。
- 実際には [ABBR[[[URI]]][Uniform Resource Identifiers]] や 
[[URI参照]]ではない
[Q[[ABBR[[[URI]]][Uniform Resource Identifiers]]]] や 
[Q[[[URI参照]]]]を定義している仕様書
--[25] [CITE@@en[The Platform for Privacy Preferences 1.0 (P3P1.0) Specification]]
<http://www.w3.org/TR/2002/REC-P3P-20020416/#Terminology>
--- [Q@@en[URI]] という用語が定義されています。基本的には [[RFC 2396]]
を参照していますが、 [[HTML]] や [[XML]] では [[W3C]] [[charmod]]
[[WD]] によるとしています。(ただし [[HTTP]] では元の定義によるとされています。)
---[CITE@@en[Character Model for the World Wide Web 1.0]]
<http://www.w3.org/TR/2002/WD-charmod-20020220/#sec-URIs>
----[[P3P 1.0]] [[勧告]]から参照 (Normative Reference) されている [[WD]]。
----[[W3C]] の仕様は [[IRI]] (の当時の [[I-D]]) 
の定義を使う'''べきだ'''と規定しています。
----後に仕様書が分割されて別の文書に移動しています。最新版は
<http://www.w3.org/TR/charmod-resid/#sec-URIs>。
---[CITE@@en[Internationalized Resource Identifiers (IRI)]]
<http://www.w3.org/International/2001/draft-masinter-url-i18n-08.txt>
---- 前項の [[charmod]] [[WD]] から参照されている [[I-D]]。
---- 当然、 [[RFC 3987]] とは細かい点で沢山の違いがあります。
---[26] [CITE@@en[The Platform for Privacy Preferences 1.1 (P3P1.1) Specification]]
<http://www.w3.org/TR/2005/WD-P3P11-20050701/#Terminology>
----[[P3P 1.1]] の [[WD]]。用語定義の部分はほとんど [[P3P 1.0]]
と同じです。 Normative Reference として参照されているのも依然として古い [[WD]]。
--- [[W3C]] [[勧告]]から [Q@@en[Work in progress]] 
な仕様を参照したことに大きな問題があります。
--[15] [CITE[XML Schema Part 2: Datatypes]]
<http://www.w3.org/TR/xmlschema#anyURI>
--- [CODE[[[anyURI]]]] という 
[Q[URI 参照に変換できるもの]]を規定しています。
--- [Q[URI 参照]]の定義は [[RFC 2396]] と [[RFC 2732]]
を参照しています。
--- [CODE[anyURI]] から URI 参照への写像としては XLink 1.0
の方法を参照しています。
--[24] [CITE[XML Encryption Syntax and Processing]] 
<http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/#sec-Versions>
---[Q[[ABBR[[[URI]]][Uniform Resource Identifiers]]]] [SRC[[[RFC 2396]]]]
は [CODE(XML)[[VAR[xs:]][[anyURI]]]] かつ >>23
の [CODE(XMLa)[[[URI]]]] 属性の値となり得るものとしています。
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>
--- [Q[RDF URI 参照]]あるいは [Q[URI 参照]]として
[Q[URI に変換できるもの]]を規定しています。
--- 文字種的には [[Unicode]] の文字列で、
[[C0制御文字]], [[C1制御文字]], [CODE(char)[[[DEL]]]]
を除いたものとされています。[[非文字]]や[[サロゲート・ペア]]の片割れの扱いは規定されていません。
--- 構文的には [[RFC 2396]] の URI 参照に[[百分率符号化]]で変換できるものとされています。
--- 符号化する禁止文字の定義には [[RFC 2396]] と [[RFC 2732]]
によっています。
--- つまり厳密に解釈すると [CODE(char)['''[''']] や
[CODE(char)[''']''']] を使うことはできません。
--[29] [[RELAX NG]] ([[JIS X 4177]]‐2:2005) の[[記号]]
[CODE@@en[anyURI]] (同 6.) は [[XLink 1.0]]
と [[RFC 2396]] と [[RFC 2732]] の[[URI参照]]を参照しています。
同 7.6 でも [CODE(XMLa)@@en[[[href]]]] [[属性]]の処理法法として
[[XLink 1.0]] の方法が参照されています。
--[30] [CITE[XML Pipeline Language (XPL) Version 1.0 (Draft)]] 
<http://www.w3.org/Submission/2005/SUBM-xpl-20050411/#d1056e1959>
--- [DFN[URI 参照]]と称するものの定義を [[XSLT 2.0]] [[WD]]
からコピってます。
--- [[XML Schema 1.0]] の [CODE(XML)@@en[[[anyURI]]]]
と [[XLink 1.0]] の定義を参照しています。
--- [[相対URI参照]]の[[解決]]について [[RFC 2396]]
を参照しています。 ([[RFC 2732]] は参照していません。)
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])


[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>

[[#comment]]

* 安全性, アクセス可能性, 可用性

[16] '''似た形の文字''':
[[UCS]] には[[図形記号]]が似た[[文字]](列)が極めて多く含まれています。
紛らわしくて困るというだけなら [WEAK[(それだけでも大問題ですが)]]
まだしも、[[なりすまし]]などの安全上の問題にもなります。
[[RFC 3987]] の仕様ではできるだけ [[NFC]] や [[NFKC]]
を使うことを勧めていますが、従来の[[文字符号化方式]]との関係
[WEAK[(RFC 3987 は従来の文字符号化方式で IRI が記述されていたら [[NFC]] に変換することを求めていますが、 RFC 3987 の対象外の世界で従来の文字符号化方式から [[UTF-8]] などに変換済みなら NFC でないかもしれません。 IRI を[Q[作る]]側も、[[ファイル名]]など NFC でない因子を持っているかもしれません。)]]
や悪意のある者が必ずしもそれに従うとは限りません。

[17] '''見えない文字''':
[[UCS]] には[[図形記号]]を持たない[[文字]]が多く含まれています。
例えば [CODE(char)[[[U+3000]]]]
([CODE(char)[[[IDEOGRAPHIC SPACE]]]]) も IRI
で使えます。 IRI のような文字列があった時にどこで終わるのかわからないので不便ですし、
[CODE(char)[[[IDSP]]]] と [CODE(char)[[[EMSP]]]] と
[CODE(char)[[[ENSP]]]] が2つ並んでいるものは区別できなかったりします
(>>16 の問題)。

単に見えないだけではなく、何らかの意味を持った[[文字]]もあります。
[CODE(char)[[[PARAGRAPH SEPARATOR]]]] は段落境界を意味します。
IRI の途中で改段落などされると甚だ迷惑ではあるのですが、
仕様上は認められているようです。
悪意のある人は悪いことに使うかもしれません。

[18] '''双方向性''':
[[RFC 3987]] には [[bidi]] に関する規定があります。
要約すると、 Unicode の bidi 算法をそのまま使うというものです。
最近の色々な規格 [WEAK[(例えば [[CSS]])]]
は全面的に Unicode の bidi 算法を採用しているので IRI
の部分だけ他の算法を採用するというのは非現実的ではありますが、
Unicode の bidi 算法は普通の文章を主に想定しているので、
記号を普通の文章とは違う特別な意味で使っている IRI
では予期せぬことが起こります ([[RFC 3987//6]] 
にわずかながら例があります)。

IRI の途中で直感とは異なる形で表示上の場所が入れ替わるのは実用上大きな問題ですが、
[[なりすまし]]の安全上の問題もかかえています。

[[#comment]]

* 相互運用性

[20] IRI が規格化される前から、色々な実装で URI
が使える場所に URI で使えない[[文字]]があっても処理できるようになっていました。
しかし、その取扱い (利用者への提示の仕方や[[文字符号化方式]]など)
は実装によりばらばらで、ある実装で動くように見えるものが別の実装では動かないといった問題が多発していました。

IRI が標準化されたことで長期的に見れば問題は減少に向かうでしょうが、
URI ではない IRI が積極的に使われるようになると短期的には問題が以前よりも多く発生するようになると思われます。

[21] IRI が標準化されたとはいえ、従来 URI
を使ってきた規格がすべて IRI に移行するわけではありません。
以前の実装やデータとの互換性の問題がありますから、
即座に移行するものはないと言っても過言ではないでしょう。

URI しか使えない場所に無理矢理 IRI を使おうとするのは問題を複雑にするだけであり、
[[著者]]・情報提供者の自己満足以上のものは得られません。

[[#comment]]

* メモ
[CITE[XML-Signature Syntax and Processing]] <http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-URI>

@


1.15
log
@auto-committed
@
text
@d51 4
d93 5
@


1.14
log
@auto-committed
@
text
@d94 3
@


1.13
log
@auto-committed
@
text
@d93 1
@


1.12
log
@auto-committed
@
text
@d149 8
@


1.11
log
@auto-committed
@
text
@d144 5
@


1.10
log
@auto-committed
@
text
@d80 2
@


1.9
log
@auto-committed
@
text
@d46 5
@


1.8
log
@auto-committed
@
text
@d90 22
@


1.7
log
@auto-committed
@
text
@d81 9
a89 1
- 実際には URI 参照ではない [Q[URI 参照]]を定義している仕様書
d98 5
@


1.6
log
@auto-committed
@
text
@d187 4
a190 1
* メモ@


1.5
log
@auto-committed
@
text
@d1 6
d48 1
a48 1
は '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
d50 2
d61 4
a121 1
([[名無しさん]])
d123 65
@


1.4
log
@auto-committed
@
text
@d1 111
a111 59


[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

(2005年1月に [[RFC 3987]] として発行されました。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [13] [[RFC 3987]] <urn:ietf:rfc:3987> <http://www.ietf.org/rfc/rfc3987.txt>
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
-- [3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
-- [4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>:
[Q[IRI 参照に変換できるもの]]も定義しています。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
は '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>:
[[システム識別子]]の文字列として定義しています。
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>:
[[XML 1.0]] [ABBR[[[SE]]] [第2版]] を参照しつつ同じことを定義しています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>:
[Q[[[RDF URI参照]]と名付けています。]]
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

[12]
HTML 4 は参考でエラー処理として現在の IRI
も処理できるといいよとしか言っていないのに、
HTML 4 は IRI に対応してるんだとかぬかす IRI 氏んじゃウゼー
([[名無しさん]] [WEAK[2005-02-01 11:43:21 +00:00]])


[14]
[CITE[Editing 'Internationalized Resource Identifiers']] <http://www.w3.org/International/iri-edit/>
([[名無しさん]])

@


1.3
log
@auto-committed
@
text
@d1 59
a59 43
[1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、
色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、
単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。

(2004年12月にようやく [[IESG]] に承認されて[[提案標準]]になるそうです。)

- [Q[IRI 参照]]または [Q[IRI]] を定義している仕様書
-- [2] [CITE[XPointer Framework]] <http://www.w3.org/TR/xptr-framework/#dt-iri>
--[3] [[XML名前空間 1.1]] 
<http://www.w3.org/TR/2004/REC-xml-names11-20040204/#IRIs>
--[4] [CITE[[XML Inclusions (XInclude) Version 1.0]]
<http://www.w3.org/TR/2004/REC-xinclude-20041220/#dt-IRI>:
[Q[IRI 参照に変換できるもの]]も定義しています。
- [Q[URI 参照に変換できるもの]]または [Q[URI に変換できるもの]]を定義している仕様書
-- [10] [CITE[HTML 4.01]] <IW:HTML4:"appendix/notes.html#h-B.2.1">
は '''URI 参照しか認めていません'''が、参考までに壊れた文書中の
URI 参照であるべきものを URI 参照らしく解釈する方法が提案されています。
-- [7] [CITE[Extensible Markup Language (XML) 1.0 (Third Edition)]] 
<http://www.w3.org/TR/2004/REC-xml-20040204/#dt-sysid>,
[CITE[Extensible Markup Language (XML) 1.1]] 
<http://www.w3.org/TR/2004/REC-xml11-20040204/#dt-sysid>:
[[システム識別子]]の文字列として定義しています。
-- [11] [CITE[WebCGM Intelligent Content]] 
<http://www.w3.org/TR/2001/REC-WebCGM-20011217/REC-03-CGM-IC.html#webcgm_3_1_1_4>:
[[XML 1.0]] [ABBR[[[SE]]][第2版]] を参照しつつ同じことを定義しています。
-- [8] [CITE[XML Linking Language (XLink) Version 1.0]] 
<http://www.w3.org/TR/2001/REC-xlink-20010627/#link-locators>
-- [9] [CITE[XML Base]] 
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#escaping>
-- [6] [CITE[Resource Description Framework (RDF): Concepts and Abstract Syntax]] 
<http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#section-Graph-URIref>:
[Q[[[RDF URI参照]]と名付けています。
- [Q[IRI 参照]]または [Q[IRI]] を包括する概念を定義している仕様書
-- [5] [CITE[Document Object Model Core]] 
<http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#domURIs>:
[DFN[[[DOM URI]]]] は、 [[URI参照]]や IRI 参照や似たようなものすべてです。

(他の仕様書で定義された [Q[IRI 参照]]や 
[Q[URI 参照に変換できるもの]]などを参照している規格はこの他に多々あります。
XML 系の規格は XLink 1.0 を、新し目の規格は [CODE(XML)[[VAR[xs:]][[anyURI]]]]
を参照する傾向にあります。
([CODE(XML)[[VAR[xs:]]anyURI]] は XLink 1.0 を参照しています。))

@


1.2
log
@auto-committed
@
text
@d1 43
a43 9
#?SuikaWiki/0.9

- [1] IRI は [[IETF]] 的には標準化は全然されてない状態なんですが、色んな [[W3C]] の仕様が参照したり定義したりしてます。結果的に同じだとしても、単一の仕様が色んなところで定義されているってのは困ったもんなんですがねぇ。
- [2] ''XPointer Framework'' <http://www.w3.org/TR/xptr-framework/#dt-iri> : [[XPointer]] 的 IRI の定義

[3]
[[XML名前空間]] 1.1 仕様書にも IRI の簡単な定義があります。
([[名無しさん]])

@


1.1
log
@auto-committed
@
text
@d5 5
@

