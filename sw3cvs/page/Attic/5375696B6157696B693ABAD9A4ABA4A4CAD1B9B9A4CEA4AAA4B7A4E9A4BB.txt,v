head	1.13;
access;
symbols;
locks; strict;
comment	@# @;


1.13
date	2003.06.06.12.26.25;	author make;	state dead;
branches;
next	1.12;

1.12
date	2003.03.27.07.24.57;	author make;	state Exp;
branches;
next	1.11;

1.11
date	2003.01.26.04.49.34;	author w;	state Exp;
branches;
next	1.10;

1.10
date	2002.12.30.13.23.12;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2002.12.30.06.23.13;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2002.12.25.06.37.42;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2002.12.24.09.25.42;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2002.12.19.13.27.55;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2002.12.19.09.25.43;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2002.12.19.06.25.30;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2002.12.10.09.27.02;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2002.12.08.06.25.55;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2002.12.06.06.25.47;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.13
log
@auto-commited
@
text
@#?SuikaWiki/0.9
[1] : [[わかば]] [sage] : 2002-12-06 (金) 11:43

一々他に書くまでもないけどどっかに書いておきたい [[SuikaWiki]]
の技術的な変更点は、今後ここに書いていきます。

[2] : [[わかば]] : 2002-12-08 (日) 12:00

Navigation links を [[link要素]]として出力するようにしました。
[[Mozilla]] の Site Navigation Bar などをお使いの時便利です。

[3] : [[わかば]] : 2002-12-10 (火) 16:43

編集時に、送信ボタンは textarea の上にも出るようにしました。
(scroll しなくてよくなって便利。)

また、下の送信ボタンの横に選択肢を設けました。編集を保存後に閲覧モードか再び編集モードかを選べます。
(CSS や [[InterWikiName]] のような設定ページで便利かも)


[4] : [[名無しさん]] : 2002-12-19 (木) 10:48

(技術的変更点ではありませんが) [[WikiAdmin]>>4] に SuikaWiki
内の設定文書の一覧を作りました。

[5] : [[名無しさん]] : 2002-12-19 (木) 17:42

(厳密には SuikaWiki の外ですが) [CODE[500 Internal Server Error]]
を [CODE[/wiki/]] 以下独自のものに設定しました。
(<http://suika.fam.cx/~wakaba/-temp/wiki/500>)

[[HTML4]].01 版と [[XHTML]] 1.1 版を用意しました。[[内容折衝]]で適当な方が送られます。

[6] : [[名無しさん]] : 2002-12-19 (木) 18:50

新しい Plugin, [CODE[Calender]] を作りました。 
[CODE[#form:'%calender(year=>2002,month=>12);':'':'%output(nosubmit);']]
とします。 ([CODE[%output(nosubmit);]] も新設。)

[CODE[year]], [CODE[month]] を省略すると最新のになります。
[CODE[caption=>"○年○月"]], [CODE[dayname=>"日 月 火 水 木 金 土"]]
が既定値として指定されているとみなします。
[CODE[nocaption]], [CODE[noheader]] が指定されているときはこれを出力しません。


[7] : [[わかば]] : 2002-12-24 17:11

「細かい」のかどうか知りませんが(w)、「地図」を追加しました。
どっかの Wiki で見かけたののぱくりですが、順方向リンクを集めて
数段階 ([[WikiResource:ja]] とかでケテーイ) 木を示します。

[8] : 7 : 2002-12-24 17:17

>>7 逆方向リンクというか、非参照の方の木も作ったら面白いかもしれませんのですが、そっちの木を作るとなると全
WikiPage を走査しないといけませんからねぇ。

[9] : 7 : 2002-12-24 17:17

まあ、その「深さ1」版が「検索」なんですけど。

[10] : [[わかば]] : 2002-12-25 11:37

[[RssPage]] の表示に [[WikiStyle:RSS]] を使えるようにしますた。
また、 RssPage では [[dc:date]] で更新日時を出力するようにしますた。

なお、更新日時は内部保管形式を従来の [[asctime形式]]から [[unix時間]]に改めたので、
[[Last-Modified:欄]]や頁末の更新日時情報は一旦消去された同然とお考え下さい。
(要は、既存日付データを変換しなかったのね:-))

なお、 HTML 内での出力時は [[RFC3339の日付形式]]で [[UTC]]
固定ですが、いずれ (いつか)  自由な日付形式を WikiResource:*
で指定出来るようにします(いつかね)。

[11] : 10 : 2002-12-25 11:41

>>10 [[CSS]] だとどうしても、ハイパーリンクが作れないとか要素の順番を入れ替えたり複製したり出来ないとか、[[要素型]]名を生成内容に出来ないとか、
[[Mozilla]] の実装だと [CODE(CSS)[content:]] で生成した内容の文字列は選択不能であるとか不満がありますね。

かといって、 [[XSLT]] スタイル・シートを SuikaWiki
で使用可能にするのもどうかと思ってます。表現力は広がりますが
(とは言っても普通の WikiPage で使えないと嬉しくないな...)、その分
[[HTML]] 直書きと同様の危険を持ち込みますし、なんせ現状ではうっかりでっかなスタイル・シートを書いてしまうと遅くてやってられないですしね。


[12] : 10 : 2002-12-25 11:43

>>10-11 まあ、今の所はちょっとした余興で実装してみた程度に思って下さい。

ところで、これらの変更のために [[Yuki::RSS]] に変更を加えたんですが、今から考えるとあの変更はちょっと綺麗じゃなかったなあと。
かといって書き直す気力もちょっとないですね。

[13] : [[名無しさん]] : 2002-12-30 12:16

[[CreatePage]], [[SearchPage]], [[WikiPluginInfo]] を特別扱いしていたのを廃止しますた。
また、これに伴い新しい plugin, [CODE[GoTo]], [CODE[Plugin]], [CODE[Resource]]
を追加しますた。

[14] : [[名無しさん]] : 2002-12-30 20:31

表示, 編集, [[CSS]] 出力で [[Expires:欄]]を吐く様にしました。
確かそれぞれ発行 (最終編集からでは'''ない'''。) から2分, 1分, 1時間で期限切れになります。
ちょっと短すぎかもしれませんが、どれくらいがいいかよくわからなくて...

まあこれでブラウザのキャッシュの関係も比較的まともになるんじゃないかと思います。
(もっときちんとしたければ、頁ごとの編集間隔の記録をとって、それを元にそれぞれ適当な値を算出して・・・とかしてもいいかもしれませんけど、そんな面倒なことするだけのものとも思えないしなあ。)

[15] : [[わかば]] [age] : 2003-01-13 09:51

細かいどころか大改造ですが... 見た目はあまり変化がないものの、内部的にかなり変えました。
[[CreatePage]] などの組み込み頁は全廃し、全て [[WikiPlugin]] として実装しなおしました。
表示や編集などもプラグイン化しました。 (但し現時点では表示・編集などの主要なものは、組み込みの subroutine を呼び出すだけの wrapper でしかないプラグインです。手抜きです:-)

設定は本体 script から分離しました。表示・編集などのモードの定義は設定 script
でいじれます。ですからお好み, 場合によって、表示かつ編集モードとかも作れます。
又、入力形式/出力形式の変換もプラグイン化されていますから、例えば [[hnf]]→[[HTML]]
とか、[[XSL-FO]]→[[CSS]] とかが簡単に組み込めます。 (組み込みが簡単なだけで、 XSL-FO→CSS
の変換処理はそう簡単じゃないと思うけどね(w)。)

[16] : 15 : 2003-01-13 09:53

>>15 の変更に伴い、以前のような段階的出力 (HTML の [[head]] 要素の部分を準備→出力,
本文を準備→出力, 尾部を準備→出力 のようなもの。) が出来なくなりまして、必ず全体を準備→出力としないといけないのですが、これは速度的には大して変わらないようです。
(むしろ perl 起動の overhead とかの方が余程大きい。)

[17] : 15 : 2003-01-13 09:55

ところで、本体の改造とは関係ありませんが、 [[CSS]] で [[outline]] 又は [CODE[-moz-outline]]
が実装されていれば、必須の入力欄の周りに赤い点線が出るようにしてみました。
従来は必須の欄が抜けていたら、送信しても何もせずに戻ってくるのですが、この方が親切でしょう。
(対応してない場合は従来通り何も表示されませんが...)

[18] : [[わかば]] : 2003-01-14 18:38

Cache database を作りました ([CODE[Yuki::YukiWikiCache]])。
他の Yuki::YukiWiki[CODE[*]] と同じように tied hash として使うんですが、データを要求された時に予め指定した期間以上経過したものであったら何も返しません。期日未経過なら保存してあったデータを返します。
(ちなみにファイル・ロックは今のところしてません。でもあった方が便利な場面もあるのかなあと思い始めてきた。。。)

これを WikiPage の要約 (検索結果や WikiPage へのアンカーの [[title]] 属性に出るもの。)
や検索結果に使ってます。特に後者は、このところこの [[SuikaWiki]]
も頁数が多くなってかなり時間がかかるようになったのですが、キャッシュすると体感できるくらいの差がでました。

もちろんキャッシュのせいで最新の状態が即座には反映されません。
キャッシュの期限切れは1日後にしてあります。 [[QUERY_STRING]]
でキャッシュ使用の有無を切り替えられるようにしようかとも思いましたが、面倒なのでやめました:)

[19]  書き忘れてましたが、組み込みだった [[RssPage]] は廃止されました。
代わりに [CODE[rss]] mode で [[RecentChanges]] (<IW:SuikaWikiRSS:RecentChanges>) を参照してください。

どういう仕組みかというと、 [[WikiForm]] で [CODE[%recent-change-list;]]
があると、 [[RSS]] mode が有効になり、その指示に従って RSS で出力します。
(この場合もちろん他の部分は出力されません。また、これが複数ある場合は最初の1つのみ有効になります。) ([[名無しさん]] [WEAK[2003-01-15 20:00]])

[20]  <IW:YukiWiki:HTML部分の分離> とかで話題にされているように、 Wiki CGI script
から、その出力の HTML を分離してしまうのは重要なポイントなんだけど、 (めんどいし)
あまり実装されてませんね。 Wiki でも掲示板でもその他でも。

SuikaWiki では >>15-16 で [CODE[Message::Util::Formatter]] 形式にしてしまいましたが、直
HTML (あるいは XML, 又は似非 XML) を使うのはとっても非効率ですよね。
HTML のタグとかは更にプラグインにまで追い出してしまって、出力の記述は中間形式にしといたほうがいい。 HTML/XHTML 切り替えみたいなのが簡単に動的にできる (非 SGML にも。)、って利点もあるし。

ただ実際のところ手抜きとかあんまり複雑にしたくないとか考えると今の SuikaWiki
の実装が best ではないわけで。あの多重 quote には正直うんざり。 ([[名無しさん]] [sage])

[21]  [[WalWiki]] で、検索結果を部分ごとで吐き出す機能が追加。
(<http://digit.que.ne.jp/visit/?2003%C7%AF1%B7%EE#i4>)

ちょっと面倒だけど便利そう。

問題はリンク先の fragment が匿名的 (単なる連番) だから、検索結果を作った後に heading
が挿入されたら正しいとび先でなくなってしまう。 SuikaWiki ではキャッシュがあるから問題だ。
まあ我慢してもいい範囲かな。

SuikaWiki なら更に [[VAR[n]]] も使うとよさそうだ。 ([[名無しさん]] [WEAK[2003-01-21 18:03]])

[22]  代替スタイルを support しますた。 [[WikiStyleList:HTML]]
で代替スタイルを定義します。

スタイル指定は [[Cookie]] で保存します。 (本当は設定保存は [[UA]] の機能だと思うんだけど、 [[Mozilla]] でさえ実装してないからなあ。)
とりあえず [[SandBox]] に cookie 焼き用プラグインをはっときました。 (明示的に発行させない限り cookie は発行されません。また、(現在のところは) client 側 script
で処理されるだけで、サーバーでは cookie の情報は使ってません。 (style 人気 ranking とかに使えるかなあ。 (それなら単純にスタイル・シートの頁の読み込み数を記録した方がいいかな。)))

なお、 [[XHTML]] mode では対応していません。 ([[JavaScriptのQ&A]>>11]) し、 [[WinIE]]
ではこの変更の結果読み込みが遅く感じるようになったかもしれません。
([[JavaScriptのQ&A]>>18]) ([[わかば]] [WEAK[2003-01-24 15:54]])

[23]  ところで、これに限らず SuikaWiki の JavaScript (限らずといっても現在の所これと浮動案内・浮動目次しかありませんがね。)
は WinIE6 と Mozilla でしか確認してません。 (できません。)
どなたか確認してくださると嬉しいんですが。
(([[JavaScript]] と [[DOM]] をちゃんと実装してるんなら
Mozilla mode で動くと思うんですけど、中途半端に
WinIE 互換ブラウザはまずいかもしれません...)) (22)

[24]  それから、 Mozilla でなぜか [[textarea]] 要素の縦
scroll bar が出なくなる現象があります。
(CSS と JavaScript のどれが原因かつかめていません。)
きちんと表示されることもあるのと、 WinIE ではきちんと出るのと、縦 scroll bar があるはずの場所が空いてて、そこを
click すると動作しているように見えるのと、他にも
Mozilla には form control 系がらみの bug
があるっぽいことから、 Mozilla の bug
の可能性が高いと思ってますが、まだはっきりしません。 ([[22=23]])

[25]  WinIE 対策は遅いのでやめました。 WinIE では従来通り既定スタイルで表示されます。
(ス切りボとか使えば代替も使えますが。) (>>22 [WEAK[2003-01-25 11:04]])

[26]  [CODE[mypage]] を [CODE(perl)[&code_convert]] に通してなかったせいで、 [CODE(URI)[?mycmd=edit;mypage=WikiPage]] のような指定のある [[URI]]
を使っていた時に正しく機能しない不具合を (今更ながら) 発見したので修正しますた。 ([[わかば]] [WEAK[2003-02-10 16:43]])

[27]  現在 SuikaWiki で大きな問題になっていること:
=[ 番号 ] のラベルがやたら多い。そこたらじゅうにある。
(でも無いと不便)
=編集中にブラウザが落ちたらあぼーん
(どうしようもない。)
=人気度ランキングでスタイルシートが首位独走中, そうでなくても上位に食い込みやすい
(対処するほどのことでもない。まあいいじゃないの。)
=盛り上がって内容が増えるとごちゃごちゃしてソースが見づらくなる
(適当に改行でも入れましょう。) ([[名無しさん]] [WEAK[2003-02-23 15:59]])

[28]  マーク付けの語彙が少ないとか, 語彙マーク付けの1重入れ子も一般には出来ないとか、 [[WikiForm]] とかで多重解釈云々で滅茶苦茶になるとかの問題は一朝一夕にはどうしようもなく。いずれいつかそのうちきっとなんとか、ということで。 (27)

[29]  あ、ここは変更しますた。スレだった。

問題追加:
=2ch 化が進行中 (27)

[30]  [[Yuki::YukiWikiDB2]] と [[Yuki::YukiWikiDBMeta]] を少しいじって名前空間というかディレクトリ掘り対応にしてみました。 (まだ commit してません。)
思ったより簡単でした。

Key name が [SAMP[1//2]] の時に、従来 [CODE(file)[312F2F32.txt]]
を実ファイル名としていたのを、 YukiWikiDB2 の encode/decode
で新しいモード (これを既定モードとした。) を設けて、
[CODE(file)[31.ns/32.txt]] になるようにしました。
もちろんディレクトリ [CODE(file)[31.ns]] はなければ自動で掘ります。
深さはファイル・システムが許す限り無限。

一覧系の API は修正, 拡張しています。 [CODE(perl)[sort_by_mtime]]
だけ非互換な変更を入れてしまいました。引数を [CODE(perl)[($self, @@key)]]
([CODE(perl)[@@key]] は省略可。) から
[CODE(perl)[($self, $option, @@key)]] ([CODE(perl)[$self]]
以外省略可。) にしてしまいました。

そんなわけもあって、 YukiWikiDB2 の修正じゃなくて YukiWikiDBNS
という新しいのにしたいところですけど、ちょこちょことした修正があちこちにある感じだからなぁ。
継承って意識して作られてない場合には使えないなーと。
(でもま、 YukiWikiDBMeta 同様に継承で処理する?)

発見された問題としては、 key が [SAMP[//foo]] とか [SAMP[foo////bar]]
とか [SAMP[bar//]] だったらどうしよう、というのがあります。
これらは都合上 [SAMP(file)[.ns/foo.txt]], [SAMP(fole)[foo.ns/.ns/bar.txt]], [SAMP[bar.ns/.txt]]
になってしまいます。

これは YukiWikiDB 側で処理すると面倒な上に厄介なことになりそうですから、仕様ということにして、例えば
SuikaWiki で使うときには WikiPage 名の正規化でこのような名前が DB
に渡らないようにするのがよさげです。 ([[わかば]] [WEAK[2003-03-25 17:31]])

[31]  あとは SuikaWiki 本体側で WikiName の処理の部分を修正すれば名前空間が動くようになりそう。

プラグイン 「WikiPage」 の page-list と recent-change-list
には新しいオプション ns, recursive, type=>{key,ns,both} を設けました。
既定値は今までどおりの処理になるように "", 1, key
としています。 ([[わかば]])

[32]  YukiWikiDB2 からの継承的分離(謎)や名前空間区切子の変数化とかは面倒なので止めました。気が向いたらすることもあるかもしれません。

仕様変更を元の名前でやるのはまずいので、 [CODE(perl)[Yuki::YukiWikiDBNS]] にしました。
[CODE(perl)[Yuki::YukiWikiDBMeta]] は [CODE(perl)[2]]
ではなく [CODE(perl)[NS]] を継承するようにしました。 ([[わかば]] [WEAK[2003-03-26 16:19]])

[33]  SuikaWiki の perl の名前空間の使用の現時点での方針は、
-整理した(つもりの) API の実装は [CODE(perl)[SuikaWiki::*]]
--特にプラグイン類は [CODE(perl)[SuikaWiki::Plugin::*]]
---プラグインそのものは [VAR(perl)[*]] は大文字で始め、プラグイン界面系モジュールが将来必要な場合は小文字で始める。
-とりあえず実装程度のものは [CODE(perl)[wiki::*]]
-Wiki database 系はとりあえず [CODE(perl)[Yuki::*]]
([[わかば]] [WEAK[2003-03-26 16:25]])

[34]  リンクも名前空間に対応させました。しばらく実験Wikiで運用して、そのうちこちらにも反映させます。
([[わかば]] [WEAK[2003-03-26 17:12]])

[35]  相対経路は対応させるのが面倒だったので、 [SAMP[.//Foo]] や [SAMP[..//Bar]] には対応していますが [SAMP[Foo//..//Bar]] や [SAMP[..//..//Foo]] には対応していません。しばらく様子見で。
([[わかば]])

[36]  また、 WikiName として [SAMP[.]], [SAMP[..]], [SAMP[//]], [SAMP[0]] はそのもの又は名前空間名として使えません。

([CODE[0]] が使えないのは perl での処理の都合上です。従来の code では意識している部分としていない部分が混在していて、実質使えませんでした。この際ついでに、使えないと決めてしまいます。)
([[わかば]] [WEAK[2003-03-26 17:16]])

[37]  [[RecentChanges]] でアンテナのようにダミーの日付文字列を使って、ブラウザの既読リンク色変更機能が働くようにしました。
([[名無しさん]] [WEAK[2003-03-26 20:45]])

[[#form:'%submit(label=>書き込む); %text(label=>"名前:",id=>name,size=>"7"); %text(label=>"メイル:",id=>mail,size=>7); %check(default,id=>record-date,label=>日付を記録);%n;%textarea(id=>msg,size=>20,lines=>2);':'[%index;]  %text(source=>msg);%n;(%name;%text(source=>mail,prefix=>" [",suffix=>"]");%iif(source=>record-date,true=>" [WEAK[%date;]]");)%n;':'%require(msg);']]@


1.12
log
@pre-namespace
@
text
@@


1.11
log
@auto-commited
@
text
@d200 81
a280 1
の可能性が高いと思ってますが、まだはっきりしません。 ([[22=23]])
d282 7
a288 2
[25]  WinIE 対策は遅いのでやめました。 WinIE では従来通り既定スタイルで表示されます。
(ス切りボとか使えば代替も使えますが。) (>>22 [WEAK[2003-01-25 11:04]])
d290 1
a290 1
[[#form:'%submit(label=>書き込む); %text(label=>"名前 : ",id=>name,size=>"9.5"); %text(label=>"メイル: ",id=>mail,size=>9.5); %check(default,id=>record-date,label=>日付を記録);%n;%textarea(id=>msg,size=>35,lines=>5);':'[%index;]  %text(source=>msg); (%name;%text(source=>mail,prefix=>" [",suffix=>"]");%iif(source=>record-date,true=>" [WEAK[%date;]]");)%n;':'%require(msg);']]@


1.10
log
@*** empty log message ***
@
text
@d2 2
a3 2
[1] : [[わかば]] [sage] : 2002-12-06 (金) 11:43

d5 4
a8 4
の技術的な変更点は、今後ここに書いていきます。

[2] : [[わかば]] : 2002-12-08 (日) 12:00

d10 4
a13 4
[[Mozilla]] の Site Navigation Bar などをお使いの時便利です。

[3] : [[わかば]] : 2002-12-10 (火) 16:43

d19 4
a22 4


[4] : [[名無しさん]] : 2002-12-19 (木) 10:48

d24 4
a27 4
内の設定文書の一覧を作りました。

[5] : [[名無しさん]] : 2002-12-19 (木) 17:42

d32 4
a35 4
[[HTML4]].01 版と [[XHTML]] 1.1 版を用意しました。[[内容折衝]]で適当な方が送られます。

[6] : [[名無しさん]] : 2002-12-19 (木) 18:50

d44 4
a47 4


[7] : [[わかば]] : 2002-12-24 17:11

d50 4
a53 4
数段階 ([[WikiResource:ja]] とかでケテーイ) 木を示します。

[8] : 7 : 2002-12-24 17:17

d55 8
a62 8
WikiPage を走査しないといけませんからねぇ。

[9] : 7 : 2002-12-24 17:17

まあ、その「深さ1」版が「検索」なんですけど。

[10] : [[わかば]] : 2002-12-25 11:37

d72 4
a75 4
で指定出来るようにします(いつかね)。

[11] : 10 : 2002-12-25 11:41

d83 4
a86 4


[12] : 10 : 2002-12-25 11:43

d90 4
a93 4
かといって書き直す気力もちょっとないですね。

[13] : [[名無しさん]] : 2002-12-30 12:16

d96 4
a99 4
を追加しますた。

[14] : [[名無しさん]] : 2002-12-30 20:31

d105 99
a203 1
(もっときちんとしたければ、頁ごとの編集間隔の記録をとって、それを元にそれぞれ適当な値を算出して・・・とかしてもいいかもしれませんけど、そんな面倒なことするだけのものとも思えないしなあ。)
d205 1
a205 1
[[#form:'%submit(label=>書き込む); %text(label=>"名前 : ",id=>name,size=>"9.5"); %text(label=>"メイル: ",id=>mail,size=>9.5);%n;%textarea(id=>msg,size=>35,lines=>5);':'[%index;] : %name;%text(source=>mail,prefix=>" [",suffix=>"]"); : %date;%n;%n;%text(source=>msg);%n;':'%require(msg);']]@


1.9
log
@*** empty log message ***
@
text
@d98 9
@


1.8
log
@*** empty log message ***
@
text
@d92 6
@


1.7
log
@*** empty log message ***
@
text
@d61 31
@


1.6
log
@*** empty log message ***
@
text
@d46 15
@


1.5
log
@Updated.
@
text
@d34 12
@


1.4
log
@Updated.
@
text
@d26 8
@


1.3
log
@Updated.
@
text
@d21 5
@


1.2
log
@Updated.
@
text
@d12 9
@


1.1
log
@Updated.
@
text
@d7 5
@

