head	1.55;
access;
symbols
	suika-20100509:1.1
	before-graph-20090923:1.1;
locks; strict;
comment	@# @;
expand	@b@;


1.55
date	2013.11.18.05.25.45;	author wakaba;	state Exp;
branches;
next	1.54;

1.54
date	2013.11.08.06.59.42;	author wakaba;	state Exp;
branches;
next	1.53;

1.53
date	2012.11.18.10.44.46;	author wakaba;	state Exp;
branches;
next	1.52;

1.52
date	2012.09.26.23.34.47;	author wakaba;	state Exp;
branches;
next	1.51;

1.51
date	2012.06.20.01.46.50;	author wakaba;	state Exp;
branches;
next	1.50;

1.50
date	2012.06.19.10.17.01;	author wakaba;	state Exp;
branches;
next	1.49;

1.49
date	2012.03.03.15.40.40;	author wakaba;	state Exp;
branches;
next	1.48;

1.48
date	2012.03.03.15.37.03;	author wakaba;	state Exp;
branches;
next	1.47;

1.47
date	2012.03.03.13.17.54;	author wakaba;	state Exp;
branches;
next	1.46;

1.46
date	2012.03.03.12.42.32;	author wakaba;	state Exp;
branches;
next	1.45;

1.45
date	2012.03.03.12.37.53;	author wakaba;	state Exp;
branches;
next	1.44;

1.44
date	2012.03.03.11.39.03;	author wakaba;	state Exp;
branches;
next	1.43;

1.43
date	2012.03.03.11.33.37;	author wakaba;	state Exp;
branches;
next	1.42;

1.42
date	2012.03.03.11.15.03;	author wakaba;	state Exp;
branches;
next	1.41;

1.41
date	2012.03.03.11.08.04;	author wakaba;	state Exp;
branches;
next	1.40;

1.40
date	2012.03.03.10.48.36;	author wakaba;	state Exp;
branches;
next	1.39;

1.39
date	2011.05.27.16.52.53;	author wakaba;	state Exp;
branches;
next	1.38;

1.38
date	2010.09.26.01.49.12;	author wakaba;	state Exp;
branches;
next	1.37;

1.37
date	2010.08.01.07.37.02;	author wakaba;	state Exp;
branches;
next	1.36;

1.36
date	2010.08.01.07.35.55;	author wakaba;	state Exp;
branches;
next	1.35;

1.35
date	2010.08.01.07.33.22;	author wakaba;	state Exp;
branches;
next	1.34;

1.34
date	2010.08.01.07.32.01;	author wakaba;	state Exp;
branches;
next	1.33;

1.33
date	2010.08.01.07.23.03;	author wakaba;	state Exp;
branches;
next	1.32;

1.32
date	2010.08.01.07.18.10;	author wakaba;	state Exp;
branches;
next	1.31;

1.31
date	2010.08.01.01.48.44;	author wakaba;	state Exp;
branches;
next	1.30;

1.30
date	2010.08.01.01.37.38;	author wakaba;	state Exp;
branches;
next	1.29;

1.29
date	2010.08.01.01.29.47;	author wakaba;	state Exp;
branches;
next	1.28;

1.28
date	2010.07.19.08.31.19;	author wakaba;	state Exp;
branches;
next	1.27;

1.27
date	2010.07.18.10.39.07;	author wakaba;	state Exp;
branches;
next	1.26;

1.26
date	2010.07.18.10.35.30;	author wakaba;	state Exp;
branches;
next	1.25;

1.25
date	2010.07.18.10.34.22;	author wakaba;	state Exp;
branches;
next	1.24;

1.24
date	2010.07.18.04.39.57;	author wakaba;	state Exp;
branches;
next	1.23;

1.23
date	2010.07.18.04.23.07;	author wakaba;	state Exp;
branches;
next	1.22;

1.22
date	2010.07.18.04.22.17;	author wakaba;	state Exp;
branches;
next	1.21;

1.21
date	2010.07.18.04.00.13;	author wakaba;	state Exp;
branches;
next	1.20;

1.20
date	2010.07.18.03.59.07;	author wakaba;	state Exp;
branches;
next	1.19;

1.19
date	2010.07.17.10.41.07;	author wakaba;	state Exp;
branches;
next	1.18;

1.18
date	2010.07.17.10.35.22;	author wakaba;	state Exp;
branches;
next	1.17;

1.17
date	2010.07.17.10.00.18;	author wakaba;	state Exp;
branches;
next	1.16;

1.16
date	2010.07.17.09.59.32;	author wakaba;	state Exp;
branches;
next	1.15;

1.15
date	2010.07.17.05.16.44;	author wakaba;	state Exp;
branches;
next	1.14;

1.14
date	2010.07.17.05.07.12;	author wakaba;	state Exp;
branches;
next	1.13;

1.13
date	2010.07.17.05.06.23;	author wakaba;	state Exp;
branches;
next	1.12;

1.12
date	2010.07.11.11.53.05;	author wakaba;	state Exp;
branches;
next	1.11;

1.11
date	2010.07.11.11.49.46;	author wakaba;	state Exp;
branches;
next	1.10;

1.10
date	2010.07.11.11.47.14;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2010.07.11.11.13.45;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2010.07.11.11.11.27;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2010.07.11.11.08.13;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2010.07.11.10.41.40;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.11.09.28.04;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.11.09.23.05;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.11.06.17.52;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.11.06.06.33;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.13.01.37.19;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.55
log
@updated by (anon)
@
text
@[3] [[HTTP]] の [DFN[[CODE(HTTP)@@en[Set-Cookie:]] [[応答頭欄]]]]は、
[[クライアント]]に対して [[Cookie]] を設定することを指示します。

[322] [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]は [[Netscape]] 社によってはじめに定義・実装され、
後に[[Webブラウザー]]を含む数多くの [[HTTP]] [[利用者エージェント]]で実装されるに至りました。
なお、 [CODE(HTTP)@@en[[[Set-Cookie]]]] (>>311) やその改訂版 [CODE(HTTP)@@en[[[Set-Cookie2]]]] 
(>>308) は [[IETF]] によって [[RFC 2109]], [[RFC 2965]] として標準化されましたが、
[[Netscape]] の定義と互換性がないため無視され、事実上死文化しています。

* 仕様書

[REFS[
- [371] [CITE@@en[RFC 6265 - HTTP State Management Mechanism]] ([TIME[2012-03-01 09:57:02 +09:00]] 版) <http://tools.ietf.org/html/rfc6265#section-3>
- [377] '''[CITE@@en[RFC 6265 - HTTP State Management Mechanism]] ([TIME[2012-03-01 09:57:02 +09:00]] 版) <http://tools.ietf.org/html/rfc6265#section-4.1>'''
]REFS]

* 構文

[4] [CODE(HTTP)@@en[Set-Cookie:]] 欄の[[欄本体]]は
[PRE(HTTP example code)[
Set-Cookie: NAME=VALUE; expires=DATE; path=PATH; domain=DOMAIN_NAME; secure
]PRE]
のように名前と値の組 ([RUBYB[[[属性]]]@@en[attribute]]) の連続として記述します [SRC[>>2]]。

[378] [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄の構文は次のように定義されています。
[[起源鯖]]はこの構文に従う[['''べきです''']] [SRC[>>377]]。

;; [379] なぜか違反を完全に禁止はされていません...

[FIG[
[FIGCAPTION[
[380] [[RFC 6265]] による [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄の構文
]FIGCAPTION]

[PRE(ABNF code)[
 set-cookie-header = "Set-Cookie:" [[SP]] set-cookie-string
 set-cookie-string = [[cookie-pair]] *( ";" [[SP]] [[cookie-av]] )
]PRE]
]FIG]

;; [381] 詳しくは [[Cookieの属性]]の項をご覧下さい。

** 文脈

[321] [[起源鯖]]は、 [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄を任意の[[HTTP]]
[[応答]]に含めて[['''構いません''']] [SRC[>>371]]。

;; [[RFC 2109]], [[RFC 2965]] は [CODE(HTTP)@@en[[[Set-Cookie]]]], [CODE(HTTP)@@en[[[Set-Cookie2]]]]
を任意の[[応答]]に含めて[['''構わない''']]としていました。
[SRC[>>319, >>318]]

** 複数のヘッダー

[16] [[起源鯖]]は複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄を含めて[['''構いません''']]
[SRC[>>2, >>371]]。

[373] [[起源鯖]]は複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄を1つに[[折り畳み]]する[['''べきではありません''']]。
[CODE(HTTP)[[[,]]]] は構文上、値の中に普通に使える[[文字]]なので、[[折り畳み]]によって意味が変わってしまうことがあります。
[SRC[>>371]]

;; [374] なぜ完全に禁止じゃなくて[['''べき''']]なんでしょうね。正当な理由ってあるのでしょうか。
[[アプリケーション鯖]]と [[HTTP]] [[鯖]]が分かれていて、[[アプリケーション]]から [[HTTP]]
を完全に制御できなくて、 [[HTTP]] で勝手に[[折り畳み]]してしまう糞実装とか考慮してるんでしょうか・・・。

;; [14] 元々 [CODE(char)[[[,]]]] の使用が禁止されていたのは複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]]
[[頭欄]]を連結した時に [CODE(char)[[[,]]]] が使われることへの配慮でしょうか、と思いきや、
[CODE(HTTP)@@en[[[Expires]]]] では [CODE(char)[[[,]]]] が[[曜日]]の後に使われています。
それならなんで禁止されているのでしょう。

[18] 複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄で同じ名前の [[Cookie]]
が設定されていた時の扱いは[[Cookieの属性]]の項をご覧下さい。

;; [320] [[RFC 2109]], [[RFC 2965]] でも複数の [CODE(HTTP)@@en[[[Set-Cookie]]]],
[CODE(HTTP)@@en[[[Set-Cookie2]]]] が[[応答]]1つに含まれても[['''構わない''']]と明記していました。
また、途中の[RUBYB[[[関門]]]@@en[gateway]]で[RUBYB[[[折り畳み]]]@@en[fold]]され得ることにも言及されていました。
[SRC[>>319, >>318]]

* 属性

[382] [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄の値としては、名前と値の組 ([[cookie-pair]])
と、それに続く0個以上の[[属性]]を指定することができます。詳しくは [[Cookieの属性]]の項をご覧下さい。

* 利用者エージェントの処理モデル

** 状態符号との関係

[375] [CODE(HTTP)@@en[[[Set-Cookie:]]]] は[[状態符号]]に関わらず任意の [[HTTP]] [[応答]]で使うことができます。
[[利用者エージェント]]は [CODE(HTTP)[[[1xx]]]] の場合にこれを無視して[['''構いません''']]が、
それ以外の場合は処理しなければ[['''なりません''']]。 [SRC[>>371]]

[305] [[利用者エージェント]]は[[状態符号]]が[[リダイレクト]]であっても、
(その[[リダイレクト]]が帰ってきた[[要求]]の [[URL]] に関して)
[CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]に従った処理をするべきです。

** 上書き

[17] [CODE(HTTP)@@en[[[Domain]]]] と 
[CODE(HTTP)@@en[[[Path]]]] と [CODE(HTTP)@@en[[VAR[NAME]]]] が同じ [[Cookie]] があれば、
値は上書きされて、最新のものだけが残ります。 [SRC[>>2]]

;; [19] 仕様上は [CODE(HTTP)@@en[[[Path]]]] と [CODE(HTTP)@@en[[VAR[NAME]]]]  
とありますが、 [CODE(HTTP)@@en[[[Domain]]]] も実際には見ています。

[20] >>17 の上書き判定における [CODE(HTTP)@@en[[[Path]]]] は完全一致 [SRC[>>2]] なので、
例えば [CODE(URI)[/foo]] と [CODE(URI)[/foo/bar]] で同じ名前の [[Cookie]]
が設定されると、 [CODE(URI)@@en[/foo/bar]] では両方が有効になります。

;; [345] [[RFC 2109]] では [CODE(HTTP)@@en[[VAR[NAME]]]] が同じで 
[CODE(HTTP)@@en[[[Path]]]]、[CODE(HTTP)@@en[[[Domain]]]] が[[文字列]]として[[一致]]するなら
[SRC[>>343]]、[[RFC 2965]] では [CODE(HTTP)@@en[[VAR[NAME]]]] が同じで 
[CODE(HTTP)@@en[[[Path]]]] が[[文字列]]として[[一致]]、 [CODE(HTTP)@@en[[[Domain]]]]
が[[大文字・小文字を区別しない]]で[[一致]]するなら上書きする [SRC[>>344]]、
とされていました。

;; [349] [[RFC 2965]] でも [CODE(HTTP)[[[Port]]]] [[属性]]はここでの[[一致]]判定には含まれないようです。

;; [350] [[RFC 2109]]、[[RFC 2965]] では[[属性]]の名前の[[大文字と小文字を区別しない]]ことになっていますが、
ここでの扱いは明確にされていません。

[346] 新しい [[Cookie]] の [CODE(HTTP)@@en[[[Expires]]]] が過去であれば、
古い [[Cookie]] は削除され、新しい [[Cookie]] も蓄積されません。

;; [347] [[RFC 2109]]、[[RFC 2965]] では [CODE(HTTP)@@en[[[Max-Age]]]] が [CODE(HTTP)[[[0]]]]
であれば、あるいは [[RFC 2965]] では [CODE(HTTP)@@en[[[Discard]]]]
[[属性]]があれば、古い [[Cookie]] は削除され、新しい [[Cookie]] も蓄積されません。
[SRC[>>343, >>344]]

* 串とキャッシュの処理モデル

[22] [[串]]は [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]をそのまま[[クライアント]]に渡すべきです。
[[状態符号]]が [CODE(HTTP)@@en[[[200]]]] であれ [CODE(HTTP)[[[304]]]] であれ、です。
[SRC[>>2]]

** キャッシュ可能性

[376] [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄の有無は[[キャッシュ可能性]]に影響しません [SRC[>>371]]。

[21] [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]は[[キャッシュ]]するべきではありません。
[SRC[>>2]]

;; [361] [[RFC 2109]] と [[RFC 2965]] は、[[HTTP/1.0]] に基づく[[串]]の 
[CODE(HTTP)@@en[[[Set-Cookie:]]]] や [CODE(HTTP)@@en[[[Set-Cookie2:]]]] との関わりを考察しています
[SRC[>>359, >>360]]。[[キャッシュ不能]]なら問題はないのですが、 [[pre-expired]]
な場合、状況によっては[[起源鯖]]による[[妥当性検証]]をスキップして[[クライアント]]に送られてしまい、
他の[[クライアント]]向けの [[Cookie]] がその[[クライアント]]に渡る可能性があることを指摘しています。

;; [[HTTP/1.1]] に従っているなら [CODE(HTTP)@@en[[[Cache-Control:]]]] 
によりもっと細かく制御できるので大丈夫ということなのでしょう。

* 歴史

** Netscape Cookie

[REFS[
- [2] [[Netscape Cookie]]
-- [CITE[Client Side State - HTTP Cookies]] <http://web.archive.org/web/19961125090609/http://www2.netscape.com/newsref/std/cookie_spec.html>
]REFS]

** RFC 2109 の [CODE(HTTP)@@en[Set-Cookie:]] 欄

[311] [[IETF]] は [[Cookie]] の標準化を試み、[[RFC 2109]] で [[Netscape Cookie]]
とは非互換な [DFN[[CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]]]を定義していました。

;; [351] 新旧 Cookie の互換性については、あまり役に立たない情報が多少 [[RFC 2109]]
の最後に載っています。詳しくは [CODE(HTTP)@@en[[[Cookie:]]]] の項の「歴史」の節をご覧ください。

*** 仕様書

- [312] [DEL[[[RFC 2109]]]] ([[廃止]]済み)
-- [313] [CSECTION@@en[4.1 Syntax: General]]
-- [319] [CSECTION@@en[3.2.1 General]]
-- [324] '''[CSECTION@@en[4.2.2 Set-Cookie Syntax]]'''
-- [331] [CSECTION@@en[4.2.3 Controlling Caching]]
-- [340] [CSECTION@@en[4.3.1 Interpreting Set-Cookie]]
-- [343] [CSECTION@@en[4.3.3  Cookie Management]]
-- [42] [CSECTION@@en[4.5  Caching Proxy Role]]
-- [359] [CSECTION@@en[10.2 Caching and HTTP/1.0]]

** [CODE(HTTP)@@en[Set-Cookie2:]] 欄

[308] [[RFC 2109]] を廃止して代わりに発行された [[RFC 2965]] は 
[CODE(HTTP)@@en[[[Set-Cookie]]]] を捨てて非互換な 
[DFN[[CODE(HTTP)@@en[[[Set-Cookie2:]]]] [[頭欄]]]] を定義していました。

[353] [[RFC 2965]] は (廃止した [[RFC 2109]] には触れずに) [[Netscape Cookie]]
との互換性について次のように規定していました。

- [354] [CODE(HTTP)@@en[[[Set-Cookie:]]]] と [CODE(HTTP)@@en[[[Set-Cookie2:]]]]
の両方があれば、 [CODE(HTTP)@@en[[[Set-Cookie:]]]] を捨てなければ[['''なりません''']] [SRC[>>352]]。
- [355] [CODE(HTTP)@@en[[[Set-Cookie2:]]]] があれば、[[起源鯖]]は [[RFC 2965]]
の [CODE(HTTP)@@en[[[Cookie:]]]] を理解できるとみなさなければ[['''なりません''']] [SRC[>>352]]。
- [356] 新 [[Cookie]] はそれと[[一致]]する [WEAK[(名前などが同じ)]] 新旧どちらの [[Cookie]] 
も置き換えなければ[['''なりません''']] [SRC[>>352]]。
- [358] 新旧 [[Cookie]] を理解する[[利用者エージェント]]が [CODE(HTTP)@@en[[[Set-Cookie:]]]]
だけを受け取ったときは、 [[Netscape Cookie]] による [CODE(HTTP)@@en[[[Cookie:]]]]
[[頭欄]]に加え、 [CODE(HTTP)@@en[[[Cookie2:]]]] [[頭欄]]も送る[['''べきです''']] [SRC[>>352]]。

[357] >>356 は新 [[Cookie]] による旧 [[Cookie]] の置き換えを命じていますが、
旧 [[Cookie]] による新 [[Cookie]] の置き換えには触れていません。

[370] [CODE(HTTP)@@en[[[Set-Cookie2:]]]] は [[RFC 6265]] により廃止されました [SRC[>>369]]。

*** 仕様書

[REFS[
- [309] [[RFC 2965]]
-- [310] [CSECTION@@en[3.1 Syntax: General]]
-- [318] [CSECTION@@en[3.2.1 General]]
-- [323] '''[CSECTION@@en[3.2.2 Set-Cookie2 Syntax]]'''
-- [332] [CSECTION@@en[3.2.3 Controlling Caching]]
-- [341] [CSECTION@@en[3.3.1 Interpreting Set-Cookie2]]
-- [344] [CSECTION@@en[3.3.3  Cookie Management]]
-- [43] [CSECTION@@en[3.5  Caching Proxy Role]]
-- [352] CSECTION@@en[9.1  Compatibility with Existing Implementations]]
-- [360] [CSECTION@@en[9.2 Caching and HTTP/1.0]]
- [369] [CITE@@en[RFC 6265 - HTTP State Management Mechanism]] ([TIME[2012-03-01 09:57:02 +09:00]] 版) <http://tools.ietf.org/html/rfc6265#page-4>
]REFS]

*** メモ

[306] [CITE['''['''JavaHouse-Brewers:31373''']''' Re: Cookie.setMaxAge() について]] ([TIME[2001-11-24 20:53:20 +09:00]] 版) <http://java-house.jp/ml/archive/j-h-b/031373.html>

>
=Cookie.serVersion(1)としたクッキーを送信した場合、
Set-CookieとSet-Cookie2ヘッダの両方がクライアントに送信されていました。
=NN4.7とIE5では、Set-Cookie2ヘッダはサポートしていないようです。

[307] [CITE[IRC logs: freenode / #whatwg / 20090808]]
([TIME[2009-10-06 23:37:54 +09:00]] 版)
<http://krijnhoetmer.nl/irc-logs/whatwg/20090808#l-417>

>
- [18:02] <abarth> annevk42: if you're interested in the cookie stuff, you should join the mailing list and comment on the charter
- [18:02] <abarth> annevk42: in general, i'm trying to keep the focus narrow
- [18:03] <abarth> annevk42: speccing cookie2 is going to take a lot more work and a lot more time than speccing cookie0
- [18:18] <annevk2> abarth, if you're going to spec cookies as implemented set-cookie2 is relevant, no?
- [18:18] <abarth> annevk2: depends how widely its used
- [18:18] <abarth> there was a recent message to the list
- [18:19] <abarth> that suggested very few sites use it
- [18:19] <abarth> i'm not sure we want to lock down the behavior of cookie2
- [18:19] <annevk2> hmm, if we could actually get impl to remove support for it that'd be cool
- [18:19] <abarth> which user agents implement it?
- [18:20] <annevk2> I thougt set-cookie2, not cookie2, was implemented, but maybe not
- [18:20] <abarth> i know they're in opera
- [18:20] <abarth> but i'm not sure where else
- [18:20] <annevk2> interesting
- [18:22] <annevk2> if we're the only ones by all means don't spec it or simply say it's obsolete
- [18:23] <annevk2> if we need extensions we can prolly extend cookie0 somehow once the processing model is written down
- [18:23] <abarth> i don't think we want to say it's obsolete. cookie suck in a number of ways. it would be good to have a long term plan for how to dig ourselves out of the mess
- [18:23] <abarth> yeah, that's a good point
- [18:23] <abarth> that's what 2109 originally tried to do with Version=1
- [18:24] <abarth> but i think they put the cart a bit in front of the horse
- [18:24] <annevk2> besides rough consensus you need running code :p
- [18:24] <annevk2> (also, versioning sucks :))

** IETF のキャッシュ制御に関する規定

[330] [[RFC 2109]]、[[RFC 2965]] は以下のようなキャッシュ制御に関する規定がありました
[SRC[>>331, >>332]]。
- [333] [CODE(HTTP)@@en[[[Set-Cookie]]]], [CODE(HTTP)@@en[[[Set-Cookie2]]]] の[[キャッシュ]]を防ぐため、
[PRE(HTTP example code)[
[[Cache-Control]]: [[no-cache]]="set-cookie"
]PRE]
や
[PRE(HTTP example code)[
[[Cache-Control]]: [[no-cache]]="set-cookie2"
]PRE]
を指定する[['''べきです''']]。
- [334] 次のいずれかを指定する[['''べきです''']]。
-- [335] 私的な文書でキャッシュするべきではないとき
[PRE(HTTP example code)[
[[Cache-Control]]: [[private]]
]PRE]
-- [336] キャッシュしても良いけど[[再検証]]が必要なとき
[PRE(HTTP example code)[
[[Cache-Control]]: [[must-revalidate]], [[max-age]]=0
]PRE]
-- [337] [[利用者エージェント]]はキャッシュをそのまま使ってよいけど、[[串]]はキャッシュしても[[再検証]]が必要なとき
[PRE(HTTP example code)[
[[Cache-Control]]: [[proxy-revalidate]], [[max-age]]=0
]PRE]
-- [338] キャッシュしても良いけどできれば[[再検証]]してほしいとき
[PRE(HTTP example code)[
[[Cache-Control]]: [[max-age]]=0
]PRE]
- [339] あらかじめ [[HTTP/1.0]] [[串]]が存在しないと分かっている場合を除き、過去の日付の [CODE(HTTP)@@en[[[Expires:]]]] 欄を含めなければ[['''なりません''']]。
[WEAK[([[HTTP/1.1]] [[串]]は [CODE(HTTP)@@en[[[Cache-Control]]]] を優先するので無視します。)]]
- [44] [[串]]は勝手に[[要求]]に [CODE(HTTP)@@en[[[Set-Cookie]]]], [CODE(HTTP)@@en[[[Set-Cookie2]]]]
を自分で付け足しては[['''なりません''']] [SRC[>>42, >>43]]。

* 実装

[364] [CITE[CGI::Cookie - search.cpan.org]] ([TIME[2010-08-01 16:28:43 +09:00]] 版) <http://search.cpan.org/~lds/CGI.pm-3.49/lib/CGI/Cookie.pm>

[[Netscape Cookie]] 対応と銘打っていますが、 [CODE(HTTP)@@en[[[Max-Age]]]] と
[CODE(HTTP)@@en[[[HttpOnly]]]] にもちゃんと対応しています。

[365] [CITE[CGI::Simple::Cookie - search.cpan.org]] ([TIME[2010-08-01 16:32:05 +09:00]] 版) <http://search.cpan.org/~andya/CGI-Simple-1.112/lib/CGI/Simple/Cookie.pm>

[[Netscape Cookie]] と [CODE(HTTP)@@en[[[HttpOnly]]]] に対応しています。
[CODE(HTTP)@@en[[[Max-Age]]]] には対応していません。

[362] [CITE[Servlet::Http::Cookie - search.cpan.org]] ([TIME[2010-08-01 16:15:08 +09:00]] 版) <http://search.cpan.org/~ix/libservlet-0.9.2/lib/Servlet/Http/Cookie.pm>

この [[Perlモジュール]]は、 [[RFC 2109]] に基づいた [[Cookie]] [[API]] を提供しています。
[[Netscape Cookie]] と [[RFC 2109]] の両方に対応しているようで、[[既定値]]は [[Netscape Cookie]]
になっています。

[366] [CITE[Apache2::Cookie - search.cpan.org]] ([TIME[2010-08-01 16:33:25 +09:00]] 版) <http://search.cpan.org/~joesuf/libapreq2-2.12/glue/perl/lib/Apache2/Cookie.pm>

[CODE(HTTP)@@en[[[Comment]]]]、[CODE(HTTP)@@en[[[CommentURL]]]]、
[CODE(HTTP)@@en[[[Expires]]]] には対応していますが、 [CODE(HTTP)@@en[[[Port]]]]、
[CODE(HTTP)@@en[[[Max-Age]]]]、[CODE(HTTP)@@en[[[HttpOnly]]]]
には対応していません。謎な実装です。

[363] [CITE[Mojo::Cookie::Response - search.cpan.org]] ([TIME[2010-08-01 16:18:15 +09:00]] 版) <http://search.cpan.org/~kraih/Mojolicious-0.999926/lib/Mojo/Cookie/Response.pm>

この [[Perlモジュール]]は [[RFC 2965]] の実装を名乗っています。
しかし [CODE(HTTP)@@en[[[CommentURL]]]] には対応しておらず、 [CODE(HTTP)@@en[[[Expires]]]]
や [CODE(HTTP)@@en[[[HttpOnly]]]] には対応しています (仕様違反?)。[[引用文字列]]は [CODE(HTTP)@@en[[[Port]]]]
[[属性]]でのみ使います (仕様違反)。(対象は[[欄本体]]だけなので、
[CODE(HTTP)@@en[[[Set-Cookie2:]]]] にも [CODE(HTTP)@@en[[[Set-Cookie]]]]
にも使えるようです。)

* メモ

[1] [CITE[苦い開発: クッキーの有効期限の更新]] ([TIME[2009-06-06 09:06:11 +09:00]] 版) <http://bitter-development.blogspot.com/2007/07/blog-post.html>

>
Apache2.2 と IE6 でsetcookie()で既存の同じ名前と値を設定する場合、有効期限(期間)は更新されない。
有効期限0で一旦セットしてから同じ有効期間をセットする。
>
[PRE(PHP example code)[
setcookie($name, $name, 0);
setcookie($name, $name, time()+60*60*24*365);
]PRE]


[367] [CITE@@en[Web Applications 1.0 r5486     Define http-equiv='set-cookie'Fixing http://www.w3.org/Bugs/Public/show_bug.cgi?id=9578]]
( ([TIME[2010-09-26 00:46:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5485&to=5486>

[368] [CITE[Apache HTTP Server Project]]
( ([TIME[2011-05-28 00:58:55 +09:00]] 版))
<http://httpd.apache.org/docs/1.3/misc/known_client_problems.html#cookie-merge>

[383] [CITE[HTTP::Cookies - search.cpan.org]]
( ([TIME[2012-03-04 00:36:16 +09:00]] 版))
<http://search.cpan.org/dist/HTTP-Cookies/lib/HTTP/Cookies.pm>

[384] [CITE[Apache2::Cookie - search.cpan.org]]
( ([TIME[2012-03-04 00:40:21 +09:00]] 版))
<http://search.cpan.org/dist/libapreq2/glue/perl/lib/Apache2/Cookie.pm>

[385] [CITE[KCP端末&SSLでクッキーが保存されない現象の覚書 - Kimura.Memo]]
( ([TIME[2012-06-19 19:16:32 +09:00]] 版))
<http://d.hatena.ne.jp/Kimura/20111210/p1>

[386] [CITE[co3k.org - Blog - 【情報求ム】au のガラケーで cookie が使えなくなる場合がある?]]
( ([TIME[2012-06-20 01:46:46 +09:00]] 版))
<http://co3k.org/blog/20>

[387] [CITE@@en[Web Applications 1.0 r7414     Require Cookies and Origin if you implement HTTP.]]
( ([TIME[2012-09-27 07:52:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7413&to=7414>

[388] [CITE@@en[RFC 6787 - Media Resource Control Protocol Version 2 (MRCPv2)]]
( ([TIME[2012-11-13 15:18:40 +09:00]] 版))
<http://tools.ietf.org/html/rfc6787#section-6.2.15>

[389] [CITE[Bug 3420 – XMLHttpRequest does not handle set-cookie headers]]
( ([TIME[2013-11-08 06:59:38 +09:00]] 版))
<https://bugs.webkit.org/show_bug.cgi?id=3420>

[390] [CITE@@en[Web Applications 1.0 r5486     Define http-equiv='set-cookie']]
( ([TIME[2010-09-26 00:46:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5485&to=5486>@


1.54
log
@updated by (anon)
@
text
@d373 5
a377 1
<https://bugs.webkit.org/show_bug.cgi?id=3420>@


1.53
log
@updated by (anon)
@
text
@d369 5
a373 1
<http://tools.ietf.org/html/rfc6787#section-6.2.15>@


1.52
log
@updated by (anon)
@
text
@d365 5
a369 1
<http://html5.org/tools/web-apps-tracker?from=7413&to=7414>@


1.51
log
@updated by (anon)
@
text
@d361 5
a365 1
<http://co3k.org/blog/20>@


1.50
log
@updated by (anon)
@
text
@d357 5
a361 1
<http://d.hatena.ne.jp/Kimura/20111210/p1>@


1.49
log
@updated by (anon)
@
text
@d353 5
a357 1
<http://search.cpan.org/dist/libapreq2/glue/perl/lib/Apache2/Cookie.pm>@


1.48
log
@updated by (anon)
@
text
@d349 5
a353 1
<http://search.cpan.org/dist/HTTP-Cookies/lib/HTTP/Cookies.pm>@


1.47
log
@updated by (anon)
@
text
@d345 5
a349 1
<http://httpd.apache.org/docs/1.3/misc/known_client_problems.html#cookie-merge>@


1.46
log
@updated by (anon)
@
text
@d70 2
a71 2
[18] 複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]で同じ [CODE(HTTP)@@en[[VAR[NAME]]]]
が指定されていたときにどれが生き残るのか (>>17) は仕様に明記されていません。
d81 1
a81 1
と、それに続く0個以上の[[属性]を指定することができます。詳しくは [[Cookieの属性]]の項をご覧下さい。
@


1.45
log
@updated by (anon)
@
text
@d36 2
a37 2
 set-cookie-header = "Set-Cookie:" SP set-cookie-string
 set-cookie-string = cookie-pair *( ";" SP cookie-av )
d41 2
d78 4
a81 1
* 処理モデル
d83 1
a83 1
** 利用者エージェントでの処理
d85 1
a85 1
*** 状態符号との関係
d95 1
a95 1
*** 上書き
d128 1
a128 1
** 串での処理
d134 1
a134 1
*** キャッシュ可能性
@


1.44
log
@updated by (anon)
@
text
@a37 13
 cookie-pair       = cookie-name "=" cookie-value
 cookie-name       = token
 cookie-value      = *cookie-octet / ( DQUOTE *cookie-octet DQUOTE )
 cookie-octet      = %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E
                       ; US-ASCII characters excluding CTLs,
                       ; whitespace DQUOTE, comma, semicolon,
                       ; and backslash
 token             = <token, defined in [RFC2616], Section 2.2>

 cookie-av         = expires-av / max-age-av / domain-av /
                     path-av / secure-av / httponly-av /
                     extension-av
 extension-av      = <any CHAR except CTLs or ";">
a49 85
** 順序

[5] 名前と値の組の順序については明確に規定されていませんが、 [[Cookie]]
として設定する名前と値の組 [CODE(HTTP)[[VAR[NAME]]=[VAR[VALUE]]]] 
の後に他の[[属性]]を適当な順番で記述します。

;; [325] [[RFC 2109]], [[RFC 2965]] では [CODE(HTTP)[[VAR[NAME]]=[VAR[VALUE]]]] 
の後に他の[[属性]]が来ること、他の[[属性]]の順序は任意であることが明記されていました。
[SRC[>>324, >>323]]

[326] [[属性]]の名前が同じものが複数回使われている場合の解釈については触れられていません。

;; [327] [[RFC 2109]] ではその場合の動作は[[未定義]]とされていました [SRC[>>324]]。
[[RFC 2965]] では最初に現れたものが有効であるとされていました [SRC[>>323]]。

** 大文字と小文字

[12] [[属性]]の名前や値の[[大文字と小文字を区別しない]]かどうかは仕様上明記されていません。
仕様書上は[[属性]]の名前はすべて[[小文字]]で記述されています。

;; [314] [[RFC 2109]], [[RFC 2965]] では[[名前]]の[[大文字と小文字を区別しない]]とされていました。
[SRC[>>313, >>310]]

** 引用文字列

[315] [[HTTP]] や [[MIME]] の他の[[頭欄]]では値は[RUBYB[[[字句]]]@@en[[[token]]]]か[RUBYB[[[引用文字列]]]@@en[[[quoted-string]]]]のいずれかとするのが一般的ですが、
[[Netscape Cookie]] では[[引用文字列]]は認められて''おらず''、
どんな[[文字列]]であってもそのまま値としなければなりません。

;; [316] [[RFC 2109]], [[RFC 2965]] では値は[[字句]]または[[引用文字列]]とされていました。
[SRC[>>313, >>310]]

** 空白

[317] [[HTTP]] や [[MIME]] の他の[[頭欄]]では特定の[[字句]]の間には[RUBYB[[[空白]]]@@en[white space]]を挿入することが認められていましたが、
[[Netscape Cookie]] で認められているのかどうかは不明確です。仕様書の記述から、
「[CODE(HTTP)[[[;]]]]」の直後に挿入することは認められているようです。

;; [316] [[RFC 2109]], [[RFC 2965]] では[[字句]]の間に[[空白]]を入れてもよいとされていました。
[SRC[>>313, >>310]]

** [CODE(HTTP)@@en[[VAR[NAME]]=[VAR[VALUE]]]]

[7] [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄にはまず最初に設定する名前と値の組を[[属性]]として指定します。

[8] この[[属性]]は必須です。 [SRC[>>2]]

*** 符号化

[9] 名前や値は任意の値ですが、 [CODE(char)[[[;]]]], [CODE(char)[[[,]]]], 
[RUBYB[[[空白]]]@@en[white space]]は使えません。 [SRC[>>2]]

[10] >>9 の記号を使いたい時の[[符号化]]の方法はありませんが、[[百分率符号化]]を用いることが[RUBYB[推奨]@@en[recommended]]されています。 [SRC[>>2]]

[11] 仕様上は >>9 の記号類以外の任意の[[文字]]が使えることになっていますが、その「[[文字]]」
全体の[[集合]]が何かは不明です。[[HTTP]] 
[[頭部]]で[[非ASCII文字]]を使う方法は標準不在な状況で、[CODE(HTTP)@@en[[[Set-Cookie:]]]]
欄に関しても何ら [WEAK[(利用できるのかどうかも)]] 定められていません。
[[文書]]の[[文字コード]]や[[利用者エージェント]]の種類によって違った解釈をされる可能性があります。
現実の[[CGIスクリプト]]等の実装は特に気にしていなかったり、
[[百分率符号化]]を用いていたりです。[[百分率符号化]]を使うのは仕様書の >>10
の記述の影響でしょうか。

[13] [CODE(HTTP)@@en[[[=]]]] も名前か値かその両方かで使えないはずなのですが、
仕様上は明記されていません。

;; [348] [[RFC 2109]] や [[RFC 2965]] では名前は [CODE(ABNF)@@en[[[token]]]]、
値は [CODE(ABNF)@@en[[[token]]]] か [CODE(ABNF)@@en[[[quoted-string]]]] とされていました。
また、 [[RFC 2965]] の [CODE(HTTP)@@en[[[Comment]]]] [[属性]]では値は [[UTF-8]]
とされていました。 [SRC[>>313, >>310]]

*** 予約名

[327] 他の[[属性]]と同じ [VAR[NAME]] を使っていいのかどうかは不明です。

;; [328] [[RFC 2109]] でも明記されていませんでした。
[[RFC 2965]] では[[属性]]の名前と同じ [VAR[NAME]] を使って[['''構いません''']]。
[SRC[>>323]]

;; [325] [[RFC 2109]], [[RFC 2965]] では [CODE(char)[[[$]]]]
から始まる名前は[[予約]]となっており、
[RUBYB[[[応用]]]@@en[application]]が使っては[['''ならない''']]とされていました。
[SRC[>>324, >>323]] ([CODE(HTTP)@@en[[[Cookie:]]]] [[頭欄]]で [CODE(char)[[[$]]]]
は特別な[[属性]]を表すために使われていました。)

a75 25
* 属性

[6] 
,[[属性名]],説明,状態,出典
,[VAR[NAME]],>>7,"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Comment]]]],[[注釈]],[[IETF]] [[提案標準]],"[DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[CommentURL]]]] ※,[[注釈]]の [[URL]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
,[CODE(HTTP)@@en[[[Domain]]]],対象となる[[ドメイン]],"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Expires]]]],有効期限,[[事実上の標準]],[[Netscape Cookie]]
,[CODE(HTTP)@@en[[[HttpOnly]]]],[[HTTP]] 専用,[[事実上の標準]],
,[CODE(HTTP)@@en[[[Max-Age]]]],[[寿命]],"[[IETF]] [[提案標準]], [[事実上の標準]]","[DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Path]]]],対象となる [[path]],"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Port]]]] ※,対象となる[[ポート]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
,[CODE(HTTP)@@en[[[Secure]]]],[[安全]]でなければならないか否か,"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Version]]]],[[Cookie]] 仕様の[[版]],[[IETF]] [[提案標準]],"[DEL[[[RFC 2109]]]], [[RFC 2965]]"

[329] 「※」は [CODE(HTTP)@@en[[[Set-Cookie2:]]]] [[頭欄]]でのみ定義されていることを表します。
また、 [CODE(HTTP)@@en[[[Expires]]]] は [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]でのみ定義されています。

[342] 未知の[[属性]]の扱いは明確に規定されていません。

;; [[RFC 2109]] でも明確には規定されていませんでしたが、 [[RFC 2965]]
では[[利用者エージェント]]は未知の[[属性]]を無視し[['''なければなりません''']]とされています
[SRC[>>341]]。

@


1.43
log
@updated by (anon)
@
text
@d30 5
d52 1
@


1.42
log
@updated by (anon)
@
text
@d14 1
d25 2
a26 13
[6] 
,[[属性名]],説明,状態,出典
,[VAR[NAME]],>>7,"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Comment]]]],[[注釈]],[[IETF]] [[提案標準]],"[DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[CommentURL]]]] ※,[[注釈]]の [[URL]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
,[CODE(HTTP)@@en[[[Domain]]]],対象となる[[ドメイン]],"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Expires]]]],有効期限,[[事実上の標準]],[[Netscape Cookie]]
,[CODE(HTTP)@@en[[[HttpOnly]]]],[[HTTP]] 専用,[[事実上の標準]],
,[CODE(HTTP)@@en[[[Max-Age]]]],[[寿命]],"[[IETF]] [[提案標準]], [[事実上の標準]]","[DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Path]]]],対象となる [[path]],"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Port]]]] ※,対象となる[[ポート]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
,[CODE(HTTP)@@en[[[Secure]]]],[[安全]]でなければならないか否か,"[[事実上の標準]], [[IETF]] [[提案標準]]","[[Netscape Cookie]], [DEL[[[RFC 2109]]]], [[RFC 2965]]"
,[CODE(HTTP)@@en[[[Version]]]],[[Cookie]] 仕様の[[版]],[[IETF]] [[提案標準]],"[DEL[[[RFC 2109]]]], [[RFC 2965]]"
d28 1
a28 2
[329] 「※」は [CODE(HTTP)@@en[[[Set-Cookie2:]]]] [[頭欄]]でのみ定義されていることを表します。
また、 [CODE(HTTP)@@en[[[Expires]]]] は [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]でのみ定義されています。
d30 17
a46 5
[342] 未知の[[属性]]の扱いは明確に規定されていません。

;; [[RFC 2109]] でも明確には規定されていませんでしたが、 [[RFC 2965]]
では[[利用者エージェント]]は未知の[[属性]]を無視し[['''なければなりません''']]とされています
[SRC[>>341]]。
d168 25
@


1.41
log
@updated by (anon)
@
text
@a55 13
** 複数のヘッダー

[372] [[起源鯖]]は複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄を含めて[['''構いません''']]
[SRC[>>371]]。

[373] [[起源鯖]]は複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄を1つに[[折り畳み]]する[['''べきではありません''']]。
[CODE(HTTP)[[[,]]]] は構文上、値の中に普通に使える[[文字]]なので、[[折り畳み]]によって意味が変わってしまうことがあります。
[SRC[>>371]]

;; [374] なぜ完全に禁止じゃなくて[['''べき''']]なんでしょうね。正当な理由ってあるのでしょうか。
[[アプリケーション鯖]]と [[HTTP]] [[鯖]]が分かれていて、[[アプリケーション]]から [[HTTP]]
を完全に制御できなくて、 [[HTTP]] で勝手に[[折り畳み]]してしまう糞実装とか考慮してるんでしょうか・・・。

d141 4
a144 1
** 複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] 欄
d146 7
a152 2
[16] 1つの [[HTTP]] [[応答]]内に複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]を指定することができます。
[SRC[>>2]]
d154 1
a154 1
[14] [CODE(char)[[[,]]]] の使用が禁止されているのは複数の [CODE(HTTP)@@en[[[Set-Cookie:]]]]
a158 3
[15] [[HTTP]] 上は複数の同じ名前の[[頭欄]]を指定するのは1つの[[頭欄]]に [CODE(char)[[[,]]]]
で併記するのと同義ですが、 >>14 のような状況なので、そのように解釈されることを当てにしない方が賢明です。

d171 6
d222 2
d227 1
a227 1
[361] [[RFC 2109]] と [[RFC 2965]] は、[[HTTP/1.0]] に基づく[[串]]の 
@


1.40
log
@updated by (anon)
@
text
@d12 3
a14 2
- [2] [[Netscape Cookie]]
-- [CITE[Client Side State - HTTP Cookies]] <http://web.archive.org/web/19961125090609/http://www2.netscape.com/newsref/std/cookie_spec.html>
d49 2
a50 1
[321] [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]は任意の[[HTTP]][[応答]]に含めて構いません。
d56 13
d238 7
@


1.39
log
@updated by (anon)
@
text
@d265 2
d269 1
d280 2
d401 8
a408 8


[367] [CITE@@en[Web Applications 1.0 r5486     Define http-equiv='set-cookie'Fixing http://www.w3.org/Bugs/Public/show_bug.cgi?id=9578]]
( ([TIME[2010-09-26 00:46:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5485&to=5486>

[368] [CITE[Apache HTTP Server Project]]
( ([TIME[2011-05-28 00:58:55 +09:00]] 版))
@


1.38
log
@updated by (anon)
@
text
@d400 5
a404 1
<http://html5.org/tools/web-apps-tracker?from=5485&to=5486>@


1.37
log
@updated by (anon)
@
text
@d396 5
@


1.36
log
@updated by (anon)
@
text
@d30 2
a31 1
,[CODE(HTTP)@@en[[[Max-Age]]]],[[寿命]],[[IETF]] [[提案標準]],"[DEL[[[RFC 2109]]]], [[RFC 2965]]"
@


1.35
log
@updated by (anon)
@
text
@d367 7
@


1.34
log
@updated by (anon)
@
text
@d356 5
@


1.33
log
@updated by (anon)
@
text
@d351 5
@


1.32
log
@updated by (anon)
@
text
@d357 9
@


1.31
log
@updated by (anon)
@
text
@d349 8
@


1.30
log
@updated by (anon)
@
text
@d211 9
d240 1
d275 1
@


1.29
log
@updated by (anon)
@
text
@d238 16
d264 1
@


1.28
log
@updated by (anon)
@
text
@d218 3
@


1.27
log
@updated by (anon)
@
text
@d227 1
d244 1
d315 2
@


1.26
log
@updated by (anon)
@
text
@d119 5
d187 4
a190 1
;; [[RFC 2965]] でも [CODE(HTTP)[[[Port]]]] [[属性]]はここでの[[一致]]判定には含まれないようです。
@


1.25
log
@updated by (anon)
@
text
@a99 30
*** 上書き

[17] [CODE(HTTP)@@en[[[Domain]]]] と 
[CODE(HTTP)@@en[[[Path]]]] と [CODE(HTTP)@@en[[VAR[NAME]]]] が同じ [[Cookie]] があれば、
値は上書きされて、最新のものだけが残ります。 [SRC[>>2]]

;; [19] 仕様上は [CODE(HTTP)@@en[[[Path]]]] と [CODE(HTTP)@@en[[VAR[NAME]]]]  
とありますが、 [CODE(HTTP)@@en[[[Domain]]]] も実際には見ています。

[20] >>17 の上書き判定における [CODE(HTTP)@@en[[[Path]]]] は完全一致 [SRC[>>2]] なので、
例えば [CODE(URI)[/foo]] と [CODE(URI)[/foo/bar]] で同じ名前の [[Cookie]]
が設定されると、 [CODE(URI)@@en[/foo/bar]] では両方が有効になります。

;; [345] [[RFC 2109]] では [CODE(HTTP)@@en[[VAR[NAME]]]] が同じで 
[CODE(HTTP)@@en[[[Path]]]]、[CODE(HTTP)@@en[[[Domain]]]] が[[文字列]]として[[一致]]するなら
[SRC[>>343]]、[[RFC 2965]] では [CODE(HTTP)@@en[[VAR[NAME]]]] が同じで 
[CODE(HTTP)@@en[[[Path]]]] が[[文字列]]として[[一致]]、 [CODE(HTTP)@@en[[[Domain]]]]
が[[大文字・小文字を区別しない]]で[[一致]]するなら上書きする [SRC[>>344]]、
とされていました。

;; [[RFC 2965]] でも [CODE(HTTP)[[[Port]]]] [[属性]]はここでの[[一致]]判定には含まれないようです。

[346] 新しい [[Cookie]] の [CODE(HTTP)@@en[[[Expires]]]] が過去であれば、
古い [[Cookie]] は削除され、新しい [[Cookie]] も蓄積されません。

;; [347] [[RFC 2109]]、[[RFC 2965]] では [CODE(HTTP)@@en[[[Max-Age]]]] が [CODE(HTTP)[[[0]]]]
であれば、あるいは [[RFC 2965]] では [CODE(HTTP)@@en[[[Discard]]]]
[[属性]]があれば、古い [[Cookie]] は削除され、新しい [[Cookie]] も蓄積されません。
[SRC[>>343, >>344]]

d162 30
@


1.24
log
@updated by (anon)
@
text
@d100 2
d113 17
d218 1
d234 1
@


1.23
log
@updated by (anon)
@
text
@d39 6
d198 1
d213 1
@


1.22
log
@updated by (anon)
@
text
@d250 1
a250 1
Cache-Control: no-cache="set-cookie"
d254 1
a254 1
Cache-Control: no-cache="set-cookie2"
d260 1
a260 1
Cache-Control: private
d264 1
a264 1
Cache-Control: must-revalidate, max-age=0
d268 1
a268 1
Cache-Control: proxy-revalidate, max-age=0
d272 1
a272 1
Cache-Control: max-age=0
@


1.21
log
@updated by (anon)
@
text
@d191 1
d205 1
d244 33
@


1.20
log
@updated by (anon)
@
text
@d27 1
a27 1
,[CODE(HTTP)@@en[[[CommentURL]]]],[[注釈]]の [[URL]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
d32 1
a32 1
,[CODE(HTTP)@@en[[[Port]]]],対象となる[[ポート]],[[IETF]] [[提案標準]],"[[RFC 2965]]"
d36 3
@


1.19
log
@updated by (anon)
@
text
@d27 2
d30 5
a34 3
,[CODE(HTTP)@@en[[[Path]]]],対象となる [[path]],[[事実上の標準]],[[Netscape Cookie]]
,[CODE(HTTP)@@en[[[Domain]]]],対象となる[[ドメイン]],[[事実上の標準]],[[Netscape Cookie]]
,[CODE(HTTP)@@en[[[Secure]]]],[[安全]]でなければならないか否か,[[事実上の標準]],[[Netscape Cookie]]
@


1.18
log
@updated by (anon)
@
text
@d24 7
a30 6
,[[属性名]],説明
,[VAR[NAME]],>>7
,[CODE(HTTP)@@en[[[Expires]]]],有効期限
,[CODE(HTTP)@@en[[[Path]]]],対象となる [[path]]
,[CODE(HTTP)@@en[[[Domain]]]],対象となる[[ドメイン]]
,[CODE(HTTP)@@en[[[Secure]]]],[[安全]]でなければならないか否か
@


1.17
log
@updated by (anon)
@
text
@d42 11
a52 1
として設定する名前と値の組の後に[[属性]]を適当な順番で記述します。
d116 14
d182 1
d195 1
@


1.16
log
@updated by (anon)
@
text
@d36 1
a36 1
を任意の[[応答]]に含めて[[''構わない''']]としていました。
@


1.15
log
@updated by (anon)
@
text
@d4 6
d31 8
d122 5
d157 1
d169 1
@


1.14
log
@updated by (anon)
@
text
@d35 21
d129 10
d141 11
@


1.13
log
@updated by (anon)
@
text
@d122 22
a143 24
[PRE[
# # [18:02] <abarth> annevk42: if you're interested in the cookie stuff, you should join the mailing list and comment on the charter
# # [18:02] <abarth> annevk42: in general, i'm trying to keep the focus narrow
# # [18:03] <abarth> annevk42: speccing cookie2 is going to take a lot more work and a lot more time than speccing cookie0
# # [18:18] <annevk2> abarth, if you're going to spec cookies as implemented set-cookie2 is relevant, no?
# # [18:18] <abarth> annevk2: depends how widely its used
# # [18:18] <abarth> there was a recent message to the list
# # [18:19] <abarth> that suggested very few sites use it
# # [18:19] <abarth> i'm not sure we want to lock down the behavior of cookie2
# # [18:19] <annevk2> hmm, if we could actually get impl to remove support for it that'd be cool
# # [18:19] <abarth> which user agents implement it?
# # [18:20] <annevk2> I thougt set-cookie2, not cookie2, was implemented, but maybe not
# # [18:20] <abarth> i know they're in opera
# # [18:20] <abarth> but i'm not sure where else
# # [18:20] <annevk2> interesting
# # [18:22] <annevk2> if we're the only ones by all means don't spec it or simply say it's obsolete
# # [18:23] <annevk2> if we need extensions we can prolly extend cookie0 somehow once the processing model is written down
# # [18:23] <abarth> i don't think we want to say it's obsolete. cookie suck in a number of ways. it would be good to have a long term plan for how to dig ourselves out of the mess
# # [18:23] <abarth> yeah, that's a good point
# # [18:23] <abarth> that's what 2109 originally tried to do with Version=1
# # [18:24] <abarth> but i think they put the cart a bit in front of the horse
# # [18:24] <annevk2> besides rough consensus you need running code :p
# # [18:24] <annevk2> (also, versioning sucks :))
]PRE]
@


1.12
log
@updated by (anon)
@
text
@d106 41
@


1.11
log
@updated by (anon)
@
text
@d95 1
a95 1
** キャッシュでの処理
d97 1
a97 1
[22] [[キャッシュ]]は [CODE(HTTP)@@en[[[Set-Cookie:]]]] [[頭欄]]をそのまま[[クライアント]]に渡すべきです。
@


1.10
log
@updated by (anon)
@
text
@d87 15
a101 1
* キャッシュ可能性
@


1.9
log
@updated by (anon)
@
text
@d87 5
@


1.8
log
@updated by (anon)
@
text
@d48 4
@


1.7
log
@updated by (anon)
@
text
@d41 7
d80 3
@


1.6
log
@updated by (anon)
@
text
@d57 16
@


1.5
log
@updated by (anon)
@
text
@d30 5
@


1.4
log
@updated by (anon)
@
text
@d20 4
a23 4
,[CODE(HTTP)@@en[[[expires]]]],有効期限
,[CODE(HTTP)@@en[[[path]]]],対象となる [[path]]
,[CODE(HTTP)@@en[[[domain]]]],対象となる[[ドメイン]]
,[CODE(HTTP)@@en[[[secure]]]],[[安全]]でなければならないか否か
@


1.3
log
@updated by (anon)
@
text
@d43 6
a48 2
[11] [[HTTP]] [[頭部]]で[[非ASCII文字]]を使う方法は標準不在な状況で、[CODE(HTTP)@@en[[[Set-Cookie:]]]]
欄に関しても何ら定められていません。現実の[[CGIスクリプト]]等の実装は特に気にしていなかったり、
@


1.2
log
@updated by (anon)
@
text
@d9 39
@


1.1
log
@created by (anon)
@
text
@d1 10
@

