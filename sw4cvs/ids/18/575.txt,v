head	1.9;
access;
symbols;
locks; strict;
comment	@# @;
expand	@b@;


1.9
date	2013.11.11.23.56.36;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2013.06.16.06.09.18;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2013.06.16.06.06.20;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2012.04.01.23.03.29;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2012.04.01.13.15.17;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2012.04.01.12.30.49;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2012.04.01.08.54.45;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2012.04.01.08.16.16;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2012.04.01.08.06.07;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.9
log
@updated by (anon)
@
text
@[2] [[イベント・ループ]]における処理の単位を[DFN[[RUBYB[タスク]@@en[task]]]]といいます。

* 仕様書

[REFS[
- [1] '''[CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2012-03-28 21:58:58 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#task-queue>'''
- [19] [CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2012-03-28 21:58:58 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#the-event-loop>
]REFS]

* 分類

[3] [[タスク]]には次の種類があります [SRC[>>1]]。

- [5] [[イベント]]: 特定の [CODE(DOMi)@@en[[[EventTarget]]]] において [CODE(DOMi)@@en[[[Event]]]]
を[[非同期]]的に [[dispatch]] します。 
-- [6] なお、[[タスク]]として[[非同期]]的に実行される[[イベント]]だけでなく、
他の[[タスク]]の中で[[同期]]的に実行されるものもあります。
- [7] [[構文解析]]: [[構文解析器]]が[[バイト]]列を[[字句]]化して処理します。
- [8] [[コールバック]]: [[コールバック]]を[[非同期]]的に呼び出します。
- [9] [[資源]]の利用: [[fetch]] 操作において[[非同期]]的に [[fetch]] が行われる時、
[[資源]]が利用可能になった時にその処理を行います。
- [10] [[DOM]] 操作の反応: [[要素]]によっては [[DOM]] 操作によって引き起こされる処理があります。

[20] また、[[タスク]]はそれぞれの[[タスク源]]に属しており、
それに応じて追加される[[タスク・キュー]]が決定されます。

* 歴史

[REFS[
- [21] [CITE@@en[Web Applications 1.0 r7874 Try to clarify event loop terminology.]] ([TIME[2013-05-31 07:22:00 +09:00]] 版) <http://html5.org/tools/web-apps-tracker?from=7873&to=7874>
]REFS]

* 関連

[4] [[タスク・キュー]]は、[[タスク]]の[[順序付き]]の[[リスト]]です [SRC[>>1]]。
[[タスク]]は[[タスク・キュー]]に追加されることによって順に実行されていきます。

[18] [[Webブラウザー]]における[[非同期]]な処理は、すべてが[[タスク]]として説明されているわけではありません。
[[資源]]の [[fetch]] の後の[[非同期]]な処理などは、[[安定状態]]に処理を再開するものとされています。

[22] [[タスク]]は[[文書]]に関連付けられています。[[タスク]]がある[[要素]]に関して追加されたなら、
その[[要素]]の[[文書]]が当該[[タスク]]の[[文書]]です。また[[タスク]]がある[[閲覧文脈]]に関して追加されたなら、
その[[閲覧文脈]]の[[活性文書]]が当該[[タスク]]の[[文書]]です。 
[[スクリプト]]により、あるいは[[スクリプト]]のために追加された[[タスク]]については、
その[[スクリプト]]の[[スクリプトの文書]]が[[タスク]]の[[文書]]です。 [SRC[>>1]]

[23] [[タスク]]は特定の[[イベント・ループ]]により処理されることを意図したものです。
[[タスク]]に関連付けられた[[文書]]についての[[タスク]]を処理する[[イベント・ループ]]が1つあって、
その[[文書]]の[[タスク]]はすべてその[[イベント・ループ]]で処理されます。 [SRC[>>1]]

[24] [[タスク]]とは別に[[マイクロタスク]]もあります。
@


1.8
log
@updated by (anon)
@
text
@d51 1
a51 1

@


1.7
log
@updated by (anon)
@
text
@d43 3
a45 1
その[[閲覧文脈]]の[[活性文書]]が当該[[タスク]]の[[文書]]です。 [SRC[>>1]]
@


1.6
log
@updated by (anon)
@
text
@d27 6
d39 11
a49 1
[[資源]]の [[fetch]] の後の[[非同期]]な処理などは、[[安定状態]]に処理を再開するものとされています。@


1.5
log
@updated by (anon)
@
text
@d24 3
@


1.4
log
@updated by (anon)
@
text
@a23 33
* 追加

[11] [[利用者エージェント]]が[DFN[[RUBYB[[[タスクをキューに追加]]]@@en[queue a task]]]]するという時は、
関係する[[イベント・ループ]]の[[タスク・キュー]]のいずれかに当該[[タスク]]を追加し[['''なければなりません''']]。
同じ[[タスク源]]からの[[タスク]]は常に同じ[[タスク・キュー]]に追加しなければ[['''なりません''']]。
違う[[タスク源]]からの[[タスク]]は別の[[タスク・キュー]]に追加して[['''構いません''']]。
[SRC[>>1]]

[EG[
[12] 例えば、[[マウス]]や[[鍵盤]]の[[イベント]]のための[[タスク・キュー]]
([[利用者対話タスク源]]用[[タスク・キュー]]) とそれ以外用の[[タスク・キュー]]の2つを用意し、
[[マウス]]や[[鍵盤]]の方の[[タスク・キュー]]を優先的に処理することにすれば、
[[利用者]]の操作には反応を返すようにしつつ、それが無い時に他の処理を実行する、
というようにできます。 [SRC[>>1]]
]EG]

[13] [[HTML]] 仕様で定義される[[タスク]]は、 [CODE(DOMi)@@en[[[Document]]]]
と関連付けられます。 [SRC[>>1]]
- [14] [[タスク]]がある[[要素]]の文脈で[[タスク・キュー]]に追加されたなら、
その[[要素]]の [CODE(DOMi)@@en[[[Document]]]] を使います。 [SRC[>>1]]
- [15] [[タスク]]がある[[閲覧文脈]]の文脈で[[タスク・キュー]]に追加されたなら、
その時点での[[閲覧文脈]]の[[活性文書]]を使います。 [SRC[>>1]]
- [16] [[タスク]]が[[スクリプト]]によって、あるいは[[スクリプト]]のために[[タスク・キュー]]に追加されたなら、
その[[スクリプトの文書]]を使います。 [SRC[>>1]]

;; [17] 「[[HTML]] 仕様で」と限定されているということは、他の仕様の[[タスク]]では関連付けられていないこともあるのでしょうか。

[20] [[closing]] [[フラグ]]が[[真]]に設定されている時は、
[[タスク]]が追加されようとしても捨てなければ[['''なりません''']]。 [SRC[>>19]]

;; [21] [[ワーカー]]が終了しようとしている時に発生した[[タイマー]]その他の[[タスク]]が捨てられることになります。
この[[フラグ]]は[[ワーカー]]にだけあり、本体の[[イベント・ループ]]では起こりません。

@


1.3
log
@updated by (anon)
@
text
@d6 2
a7 1
- [1] [CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2012-03-28 21:58:58 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#task-queue>
d51 6
@


1.2
log
@updated by (anon)
@
text
@d53 4
a56 1
[[タスク]]は[[タスク・キュー]]に追加されることによって順に実行されていきます。@


1.1
log
@created by (anon)
@
text
@d23 27
d53 1
a53 1
[[タスク]]は[[タスク・キュー]]に追加されることによって順に実行されていきます。
@

