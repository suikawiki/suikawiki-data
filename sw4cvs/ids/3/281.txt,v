head	1.37;
access;
symbols
	suika-20100509:1.10
	before-graph-20090923:1.10;
locks; strict;
comment	@# @;
expand	@b@;


1.37
date	2014.01.05.09.01.03;	author wakaba;	state Exp;
branches;
next	1.36;

1.36
date	2014.01.05.08.40.19;	author wakaba;	state Exp;
branches;
next	1.35;

1.35
date	2013.11.18.08.31.07;	author wakaba;	state Exp;
branches;
next	1.34;

1.34
date	2013.11.18.08.26.16;	author wakaba;	state Exp;
branches;
next	1.33;

1.33
date	2013.11.10.02.33.38;	author wakaba;	state Exp;
branches;
next	1.32;

1.32
date	2013.10.30.11.58.26;	author wakaba;	state Exp;
branches;
next	1.31;

1.31
date	2013.10.30.11.55.48;	author wakaba;	state Exp;
branches;
next	1.30;

1.30
date	2013.03.30.06.41.39;	author wakaba;	state Exp;
branches;
next	1.29;

1.29
date	2013.03.09.10.27.08;	author wakaba;	state Exp;
branches;
next	1.28;

1.28
date	2013.03.05.12.28.52;	author wakaba;	state Exp;
branches;
next	1.27;

1.27
date	2013.03.05.12.27.07;	author wakaba;	state Exp;
branches;
next	1.26;

1.26
date	2013.03.05.12.26.34;	author wakaba;	state Exp;
branches;
next	1.25;

1.25
date	2013.03.05.12.14.08;	author wakaba;	state Exp;
branches;
next	1.24;

1.24
date	2013.03.05.12.03.59;	author wakaba;	state Exp;
branches;
next	1.23;

1.23
date	2013.02.16.14.37.24;	author wakaba;	state Exp;
branches;
next	1.22;

1.22
date	2013.02.16.14.35.21;	author wakaba;	state Exp;
branches;
next	1.21;

1.21
date	2013.02.16.10.39.10;	author wakaba;	state Exp;
branches;
next	1.20;

1.20
date	2012.08.24.23.02.59;	author wakaba;	state Exp;
branches;
next	1.19;

1.19
date	2012.08.24.23.02.31;	author wakaba;	state Exp;
branches;
next	1.18;

1.18
date	2011.12.15.23.35.09;	author wakaba;	state Exp;
branches;
next	1.17;

1.17
date	2011.08.20.03.27.05;	author wakaba;	state Exp;
branches;
next	1.16;

1.16
date	2011.07.20.01.40.21;	author wakaba;	state Exp;
branches;
next	1.15;

1.15
date	2011.05.08.04.38.35;	author wakaba;	state Exp;
branches;
next	1.14;

1.14
date	2011.04.25.13.49.35;	author wakaba;	state Exp;
branches;
next	1.13;

1.13
date	2010.12.08.13.11.41;	author wakaba;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.20.05.43.21;	author wakaba;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.13.15.46.10;	author wakaba;	state Exp;
branches;
next	1.10;

1.10
date	2009.03.24.14.54.23;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2009.02.11.09.12.34;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2009.02.11.08.55.08;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2009.02.11.08.45.42;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2008.12.28.11.22.23;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2008.12.13.10.09.05;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2008.11.22.23.53.32;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2008.11.18.11.55.35;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2008.11.18.11.51.42;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.13.02.41.18;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.37
log
@updated by (anon)
@
text
@[1] [DFN[[CODE(XMLa)@@en[xml:base]]]] [[属性]]は、 [[XML]] の[[要素]]に[[基底URL]]
を指定します。

* [21] 仕様書

- [DEL[[[XML基底]]第1版 ([[W3C]] [[勧告]])]]
-- [6] [CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<http://www.w3.org/TR/2001/REC-xmlbase-20010627/#syntax>
-- [25] [CITE@@en[Errata in REC-xmlbase-20010627]]
<http://www.w3.org/2001/06/xmlbase-errata#E01>
(詳細は[[XML基底]]の項を参照。)
- [[XML基底]]第2版 ([[W3C]] [[勧告]])
-- [80] [CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<http://www.w3.org/TR/2009/REC-xmlbase-20090128/#syntax>

* 属性値

** 第1版の定義

[44] '''適当な属性値'''

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]は、
''後述の処理の後に''[[RFC 2396]] [[URI参照]]として処理されます。
[SRC[XML基底 3]]

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]で使うことのできる[[文字]]は、
[[XML]]の一般の場合と同じです。 [SRC[XML基底 3.1]]

[[属性値]]から[[URI参照]]に変換するためには、
- [[非ASCII文字]]
- [CODE(char)@@en[[[U+0000]]]]〜[CODE(char)@@en[[[U+0020]]]]
- [CODE(char)@@en[[[U+007F]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]],
[CODE(char)[[["]]]], [CODE(char)[[[{]]]], [CODE(char)[[[}]]]],
[CODE(char)[[[|]]]], [CODE(char)[[[\]]]], [CODE(char)[[[^]]]],
[CODE(char)[[[`]]]]

を[[UTF-8]]で[[百分率符号化]]します。 [SRC[XML基底 3.1]]

;; 詳しくは[[XML//URI]]および[[IRI]]の項を参照。

[52] '''RFC 3986との関係'''

[[RFC 3986]]の新しい構文では、[[命名権者]]部に[[百分率符号化]]や新しい[[IP番地]]のための構文が認められていますが、
[[RFC 2396]]や[[RFC 2732]]では認められていません。
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3986]]の[[URI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3986]]
に従って解釈する実装も不適合にはなりません。

[53] '''RFC 3987との関係'''

[[RFC 3987]]も[[RFC 3986]]にあわせた新しい構文を採用していますから、
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3987]]の[[IRI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3987]]
に従って解釈する実装も不適合にはなりません。

;; なお、 >>44 の[[URI参照]]に変換するために[[逃避]]しなければならない[[文字]]の種類は、
[[RFC 3987]]の[[算法]]で規定されたものと一致しています。

;; 
[45]
[[XML基底]] 3では[[RFC 2396]] [[URI参照]]として解釈するとしていますが、
同3.1の[[逃避]]に関する[[RFC 2732]]も参照しています。
字面通り厳密に解釈すると結局[[RFC 2732]]拡張は使えないことになってしまいますが、
本当にそれでよいのでしょうか。[[RFC 3986]]が発行された今、
早急に改訂するべきです。

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)

[75]
実のところ、[[XML基底]]仕様書には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性値]]がある処理の後 [[RFC 2396]]
[[URI参照]]として''処理される'' (実装に。) という説明があるだけで、
[[著者]]が [CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性]]にどのような値を指定してよいのか、
どのような値を指定することが期待されているのかがまったく規定されていません。

** 第2版の定義

[84] [[属性値]]は [[W3C]] [[WG Note]] で定義される [[LEIRI]] として解釈されます
[SRC@@en[[[XML基底]] 第2版 3.]]。

[85] ここでいう「[[LEIRI]]」は例示や文脈から鑑みて「[[LEIRI参照]]」のつもりと思われます。

[86] 相変わらず、「解釈される」というだけで、[[著者]]に対する要件はないみたいです。

;;
[88] 
歴史的経緯や各定義間の差異など詳しくは [[IRI]] の項を参照してください。

* 処理モデル

[42] '''意味不定の場合'''

- [43] [[XML基底]]仕様を直接または間接に参照する[[応用]]''以外''では、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の動作は未定義です。
[SRC[XML基底 1]]
- [40] 値が[[妥当]]な[[URI参照]]にならない場合の動作は、
[[応用]]依存です。 [SRC[XML基底正誤表 E03]]

[20] >>40
(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

** 基底URIの算出

[46] [SRC[XML基底 4]]
- ある[[要素]]の[[基底URI]]は、次の順に決定します。
== その[[要素]]に[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]があれば、
それによって指定された[[基底URI]]。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[要素]]中の文字列[[内容]]の[[基底URI]]は、
その[[要素]]の[[基底URI]]です。
- [CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- その他の[[属性]]の[[基底URI]] ([[既定属性]]を含みます。)
の[[基底URI]]は、その付されている[[要素]]の[[基底URI]]です。
- [[処理指令]]の[[内容]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[文字]]、[[内部実体]]、[[属性]]に個別に[[基底URI]]を指定する方法はありません。

[47] [[システム識別子]]における[[基底URI]]については、
[[XML]]の仕様書に規定があります。
([[XML//URI//基底]]の項を参照。)

[48] [CODE(XML)@@en[[[xmlns]]]]系[[属性]]については特に例外が規定されていないので、
>>46 の原則通りになりますが、[[名前空間URI]]が[[絶対URI参照]]で''ない''時にどう処理されるのかは[[XML]]系仕様書では定義していません。
[SRC[XML基底 附属書C (参考)]]

[[#comment]]


** 相対参照の解決

[49] [[XML基底]]仕様書には[CSECTION@@en[4 Resolving Relative URIs]]という章がありますが、
[[基底URI]]の決定方法の説明だけで、[[相対URI参照]]の[[解決]]の方法は何ら規定していないようです。

[[XML基底]]仕様からの引用規格に[[RFC 2396]]および[[RFC 2732]]がありますし、
本文中でも再三引用されていますから、それらで定義された方法で[[解決]]すると解釈するのが自然でしょう。

[50] '''RFC 3986との関係'''

[[RFC 3986]]の[[相対参照]]の[[解決]]方法には[[RFC 2396]]のものと違いがあります。
問題となる変更点は2つあります。
- [[素片識別子]]''だけ''の[[参照]]
-- [[RFC 2396]]における[[素片識別子]]''だけ''の[[URI参照]]は、
同じ[[文書]]内での[[参照]]です。[[基底URI]]に対してではなく、
[[文書]]自体に対して解釈されます。
-- [[RFC 3986]]における[[素片識別子]]''だけ''の[[URI参照]]は、
[[基底URI]]に対するものとして解釈されます。
- 非階層的[[URI]]
-- [[RFC 2396]]では、[[相対URI]]は階層的な[[URI]]に関して定義されており、
[[基底URI]]が階層的でない場合は使うことができません。
-- [[RFC 3986]]では、どんな[[URI]]に対しても[[相対参照]]とその[[解決]]方法が定義されています。

;; 
[54]
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]が[[RFC 2396]]によれば階層的ではなく、[[相対URI]]を使えないにも関わらず、
[[属性値]]が[[相対URI]]の場合はどうなるのでしょうか。
>>40 が適用されるのでしょうか。
(その場合は[[RFC 3986]]の動作をしても[[適合]]します。)

;; [[XML基底]]を参照する仕様の1つ、[[RDF/XML]] (2004年版)
は、[[RFC 2396]]の[[同文書参照]]も[[基底URI]]に対して解釈すると規定しています。

;; [CITE[RDF/XML Syntax Specification (Revised)]] 
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#section-baseURIs>

[87] [[XML基底]]第1版正誤票 E04 および [[XML基底]]第2版[[勧告]]では、
[[RFC 3986]] 的解釈に従い、[[同文書参照]]であっても[[基底URL]] に基づき解釈する旨が規定されています。
ただし、 Note として、 [[RFC 2396]] 的に[[文書]]の [[URL]]
に基づく[[処理器]]が存在するため、[[同文書参照]]を [CODE(XMLa)@@en[[[xml:base]]]]
[[属性]]で使うことは「[RUBYB[強く非推奨]@@en[strongly discouraged]]」とされています。

[51] '''RFC 3987との関係'''

>>44 の通り、[[IRI参照]]の多くはそのまま[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]として使うことができますが、
[[逃避]]して[[URI参照]]にして処理すると定義されていますから、
[[解決]]は[[IRI参照]]としてではなく、変換後の[[URI参照]]として行われます。

[[#comment]]


** XML名前空間およびスキーマとの関係

[41] '''XML名前空間を使わない場合'''

[[XML名前空間]]を使わない場合、
[[名前]]が[CODE(XMLa)@@en[[[xml]]:[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[3] '''XML名前空間を使う場合'''

[[XML名前空間]]を使う場合、
[[名前空間名]]が[CODE(URI)@@en[[[http://www.w3.org/XML/1998/namespace]]]]
([[名前空間接頭辞]]は[CODE(XML)@@en[[[xml]]]])
で[[局所名]]が[CODE(XMLa)@@en[[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。

[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[55] '''XML Schemaによる定義'''

[[XML Schema]]による定義 <http://www.w3.org/2001/xml.xsd>
(執筆時点での最新版は <http://www.w3.org/2005/08/xml.xsd>)
では、[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]は[[データ型]][CODE(XML)@@en[[QN[xs:[[anyURI]]] [http://www.w3.org/2001/XMLSchema]]]]として[[宣言]]されています。
また、[[属性集合]][CODE(XML)@@en[[QN[[[xml]]:[[specialAttrs]]] [http://www.w3.org/XML/1998/namespace]]]]
に含まれています。

[[#comment]]


** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[59]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[60]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[61]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[[#comment]]


** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]


*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]


*** [CODE(XMLa)@@en[xml:base]] 属性 (Atom)

[62]
[[Atom 1.0]] や [[AtomPub]] や [[RFC 6721]] で定義されているすべての[[要素]]には、[[XML基底]]で規定された
[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]を持って'''構いません'''。
[[RFC 3986]] にある[[基底URI]] ([[基底IRI]])
として使われます。

**** 仕様書

[REFS[
- [103] [[RFC 4287]] <http://tools.ietf.org/html/rfc4287> 
-- [CSECTION@@en[2. Atom Document]]
- [104] [CITE@@en[RFC 5023 - The Atom Publishing Protocol]] ([TIME[2008-11-20 18:52:14 +09:00]] 版) <http://tools.ietf.org/html/rfc5023#section-2.1.3>
- [105] [CITE@@en[RFC 6721 - The Atom "deleted-entry" Element]] ([TIME[2012-12-31 01:08:20 +09:00]] 版) <http://tools.ietf.org/html/rfc6721#page-4>
]REFS]

**** メモ

[63]
>>62 [[RFC 2396]]を参照する[[XML基底]]仕様を参照しながら、
[[RFC 3986]]の機能を持つといい、[Q@@en[or [[IRI]]]]
とまで書いていますが、いったいどう理解しろというのでしょう。

** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

* 関連

[81] 
[[HTML]] では [CODE(HTMLe)@@en[[[base]]]] [[要素]]に [CODE(HTMLa)@@en[[[href]]]]
[[属性]]を指定することによって[[文書]]の[[基底URL]] を指定することができます。
[CODE(XMLa)@@en[[[xml:base]]]] [[属性]]はこの [CODE(HTMLe)@@en[[[base]]]]
[[要素]]を参考に、より汎用的なものとして設計されたようです [SRC@@en[[[XML基底]] 1.]]。

[82] [[HTML]] にはその他に [CODE(HTMLa)@@en[[[codebase]]]] [[属性]]もあり、
それも[[基底URL]] を指定するものとして説明されています。

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。

[83] 
[[HTTP]] には[[実体]]の[[基底URL]] を指定するための [CODE(HTTP)@@en[[[Content-Base:]]]] 欄、
[CODE(HTTP)@@en[[[Base:]]]] 欄や、[[基底URL]]を指定する役割も果たすことになっている
[CODE(HTTP)@@en[[[Content-Location:]]]] 欄があります。 [[MIME]]
にも [CODE(MIME)@@en[[[Content-Base:]]]] 欄や [CODE(MIME)@@en[[[Content-Location:]]]]
欄があります。

* 例

[89] [CITE[『ジオどす』 京都通り名住所検索 ジオコーダー - 京都通り名ジオコーダーAPI『ジオどす』]] ([TIME[2009-03-24 23:51:35 +09:00]] 版) <http://geodosu.com/rss.xml>

>
[PRE(XML example code)[
<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xml:base="http://geodosu.com" xmlns:dc="http://purl.org/dc/elements/1.1/">
<channel>
]PRE]

[[RSS 2.0]] で[[根要素]]に [CODE(XMLa)@@en[[[xml:base]]]] [[属性]]を指定している例です。

* メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。

([[名無しさん]])

[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
の値を制約したりできなくなるというおはなし。
([[名無しさん]] [WEAK[2005-04-05 00:21:13 +00:00]])

[56]
[[正準XML]] (1.0) 仕様によって特定の[[要素]]以下を[[直列化]]する際には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を含め、
[CODE(XML)@@en[[[xml]]]][[名前空間]]に属する[[属性]]がその[[要素]]の[CODE(XPath)@@en[[[ancestor-or-self]]]]のうちの一番近くにあるものが[[指定]]されます。
[SRC[正準XML 2.4]]

([[名無しさん]])

[57]
[[排他的XML正準化 1.0]]仕様では >>56 の規定を適用しないことになっています。
([[名無しさん]])

[58]
[[XInclude]]では[CODE(InfoProp)[[[基底URI]]]]との整合性を保持するために[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を追加することがあります。
([[名無しさん]])

[70]
[CITE@@en[xml:base in M12N]] ([[Shane McCarron]] 著, [CODE[2007-07-13 21:52:09 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-xhtml2/2007Jul/0024.html>
([[名無しさん]])

[73]
[CITE@@EN[XML Base (Second Edition)]] ([CODE[2008-03-20 00:21:54 +09:00]] 版) <http://www.w3.org/TR/2008/PER-xmlbase-20080320/>
([[名無しさん]])

[74]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2008-02-13 01:15:07 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/13246>

[76] 
[[Firefox]] でも [[Opera]] でも、 [CODE(XMLa)@@en[[[xml]]:[[base]]]] [[属性]]の値は
([[LEIRI]] ではなく) [[HTML5]] [[URL]] として処理されるようです。

;; [CITE[Index of /~wakaba/-temp/test/uri/leiri/xmlbase]] ([TIME[2008-11-18 20:42:03 +09:00]] 版) <http://suika.fam.cx/~wakaba/-temp/test/uri/leiri/xmlbase/>

;; [[Safari]] は[[空文字列]]な[[相対参照]]を [CODE(JS)@@en[[[document]].[[URL]]]]
とみなすらしく ([[RFC 2396]] 時代の解釈)、 [[LEIRI]] か [[URL]]
か判断するいい方法が思いつきませんでした。

[77] [[Opera]] は [CODE(XMLa)@@en[xlink:[[href]]]] [[属性]]の値を [[URL]]
ではなく [[LEIRI]] として処理するようですけど、これって多分、
[[基底URL]] は無変換で素通しして、最後に [[URL]] を使う場面でだけ [[HTML]]
か [[SVG]] かで処理を分けているんじゃ''なく''、
[[基底URL]] の段階で [[URI]] 化してるってことですよね。

[[#comment]]




* メモ

[78] [CITE[SMIL 3.0 Metainformation]] ([TIME[2008-12-02 00:45:09 +09:00]] 版) <http://www.w3.org/TR/2008/REC-SMIL3-20081201/smil-metadata.html#edef-meta>

[79] [CITE[Document Structure – SVG Tiny 1.2]] ([TIME[2008-12-20 02:31:29 +09:00]] 版) <http://www.w3.org/TR/2008/REC-SVGTiny12-20081222/struct.html#XMLBaseAttribute>

[[RFC 3987]] [[IRI参照]]

[90] [CITE[XProc: An XML Pipeline Language]]
([TIME[2010-05-11 22:38:07 +09:00]] 版)
<http://www.w3.org/TR/2010/REC-xproc-20100511/#xml-base-attribute>

[91] [CITE@@en[Speech Synthesis Markup Language (SSML) Version 1.1]]
( ([TIME[2010-09-08 00:26:19 +09:00]] 版))
<http://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.3>

[93] [CITE@@en[XFrames]]
( ([TIME[2010-12-17 00:45:08 +09:00]] 版))
<http://www.w3.org/TR/2010/NOTE-xframes-20101216/#s_frames-element>

[96] [CITE[Document Structure – SVG 1.1 (Second Edition)]]
( ([TIME[2011-08-10 12:35:27 +09:00]] 版))
<http://www.w3.org/TR/2011/REC-SVG11-20110816/struct.html#Core.attrib>

[98] [CITE@@en[Web Applications 1.0 r7267     Narrow the scope of the xml:base ban to HTML elements. If SVG wants to allow them, e.g., that's up to them.]]
( ([TIME[2012-08-25 04:02:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7266&to=7267>

[100] [CITE[IRC logs: freenode / #whatwg / 20130212]]
( ([TIME[2013-02-16 18:57:01 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20130212#l-368>

[101] [CITE@@en-US[XBL 2.0]]
( ([TIME[2012-05-03 02:23:03 +09:00]] 版))
<http://dev.w3.org/2006/xbl2/Overview.html#rules-for-shadow-content-generation>

[102] [CITE@@en-US[XBL 2.0]]
( ([TIME[2012-05-03 02:23:03 +09:00]] 版))
<http://dev.w3.org/2006/xbl2/Overview.html#shadow-content-and-xmlbase>

[106] [CITE@@en[Bug 20976 – Define Node.baseURI properly]]
( ([TIME[2013-10-30 20:54:19 +09:00]] 版))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=20976#c5>

[107] [CITE@@en[903372 – Remove support for xml:base]]
( ([TIME[2013-10-30 20:55:33 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=903372>

[108] [CITE[Bug 17423 – ER: Add support for xml:base]]
( ([TIME[2013-11-10 02:33:35 +09:00]] 版))
<https://bugs.webkit.org/show_bug.cgi?id=17423>

[109] [CITE@@en-gb[Tiny Tiny RSS • View topic - xml:base support in atom feed]]
( ([TIME[2013-11-18 08:26:12 +09:00]] 版))
<http://www.tt-rss.org/forum/viewtopic.php?t=2372>

[110] [CITE@@en-gb[Tiny Tiny RSS • View topic - Problem with Tim Bray's ongoing blog]]
( ([TIME[2013-11-18 08:31:03 +09:00]] 版))
<http://tt-rss.org/forum/viewtopic.php?f=1&t=2310>

[111] [CITE@@en-US[XML Binding Language (XBL) 2.0]]
( ([TIME[2007-03-16 22:20:16 +09:00]] 版))
<http://www.w3.org/TR/2007/CR-xbl-20070316/#rules>

[112] [CITE@@en-US[XML Binding Language (XBL) 2.0]]
( ([TIME[2007-03-16 22:20:16 +09:00]] 版))
<http://www.w3.org/TR/2007/CR-xbl-20070316/#shadow1>@


1.36
log
@updated by (anon)
@
text
@d551 5
a555 1
<http://www.w3.org/TR/2007/CR-xbl-20070316/#rules>@


1.35
log
@updated by (anon)
@
text
@d547 5
a551 1
<http://tt-rss.org/forum/viewtopic.php?f=1&t=2310>@


1.34
log
@updated by (anon)
@
text
@d543 5
a547 1
<http://www.tt-rss.org/forum/viewtopic.php?t=2372>@


1.33
log
@updated by (anon)
@
text
@d539 5
a543 1
<https://bugs.webkit.org/show_bug.cgi?id=17423>@


1.32
log
@updated by (anon)
@
text
@d535 5
a539 1
<https://bugzilla.mozilla.org/show_bug.cgi?id=903372>@


1.31
log
@updated by (anon)
@
text
@d531 5
a535 1
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=20976#c5>@


1.30
log
@updated by (anon)
@
text
@d527 5
a531 1
<http://dev.w3.org/2006/xbl2/Overview.html#shadow-content-and-xmlbase>@


1.29
log
@updated by (anon)
@
text
@d335 1
a335 1
[[Atom 1.0]] や [[AtomPub]] で定義されているすべての[[要素]]には、[[XML基底]]で規定された
d340 1
a340 2
;; 出典: [[RFC 4287]] <urn:ietf:rfc:4287> 
[CSECTION@@en[2. Atom Document]]
d342 8
a349 1
;; [CITE@@en[RFC 5023 - The Atom Publishing Protocol]] ([TIME[2008-11-20 18:52:14 +09:00]] 版) <http://tools.ietf.org/html/rfc5023#section-2.1.3>
a355 3
[[#comment]]


d527 1
a527 1
<http://dev.w3.org/2006/xbl2/Overview.html#shadow-content-and-xmlbase>
@


1.28
log
@updated by (anon)
@
text
@d492 33
a524 73
[[RFC 3987]] [[IRI参照]]

[90] [CITE[XProc: An XML Pipeline Language]]
([TIME[2010-05-11 22:38:07 +09:00]] 版)
<http://www.w3.org/TR/2010/REC-xproc-20100511/#xml-base-attribute>

[91] [CITE@@en[Speech Synthesis Markup Language (SSML) Version 1.1]]
( ([TIME[2010-09-08 00:26:19 +09:00]] 版))
<http://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.3>

[92] [CITE@@en[Web Applications 1.0 r5711     Make <base> take effect everywhere, not just as a child of <head>.]]
( ([TIME[2010-12-08 09:22:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5710&to=5711>

[93] [CITE@@en[XFrames]]
( ([TIME[2010-12-17 00:45:08 +09:00]] 版))
<http://www.w3.org/TR/2010/NOTE-xframes-20101216/#s_frames-element>

[94] [CITE[''''''[''''''whatwg'''''']'''''' <base> elements, again]]
( ([TIME[2011-05-08 13:38:23 +09:00]] 版))
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/031511.html>

[95] [CITE['''['''whatwg''']''' <base> in <body>]]
([TIME[2011-07-20 10:17:19 +09:00]] 版)
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-July/032569.html>

[96] [CITE[Document Structure – SVG 1.1 (Second Edition)]]
( ([TIME[2011-08-10 12:35:27 +09:00]] 版))
<http://www.w3.org/TR/2011/REC-SVG11-20110816/struct.html#Core.attrib>

[97] [CITE[''''''[''''''whatwg'''''']'''''' <base> elements security issue]]
( ([TIME[2011-12-16 08:35:05 +09:00]] 版))
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-December/034199.html>

[98] [CITE@@en[Web Applications 1.0 r7267     Narrow the scope of the xml:base ban to HTML elements. If SVG wants to allow them, e.g., that's up to them.]]
( ([TIME[2012-08-25 04:02:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7266&to=7267>

[99] [CITE@@en[Web Applications 1.0 r7266     Update handling of the <base>.href IDL attribute and clarify how 'document's base URL' is defined.]]
( ([TIME[2012-08-25 03:52:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7265&to=7266>

[100] [CITE[IRC logs: freenode / #whatwg / 20130212]]
( ([TIME[2013-02-16 18:57:01 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20130212#l-368>

[101] [CITE@@en-US[XBL 2.0]]
( ([TIME[2012-05-03 02:23:03 +09:00]] 版))
<http://dev.w3.org/2006/xbl2/Overview.html#rules-for-shadow-content-generation>

[102] [CITE@@en-US[XBL 2.0]]
( ([TIME[2012-05-03 02:23:03 +09:00]] 版))
<http://dev.w3.org/2006/xbl2/Overview.html#shadow-content-and-xmlbase>

[103] [CITE[Tags used in HTML]]
( ([TIME[1992-11-13 08:29:05 +09:00]] 版))
<http://www.w3.org/History/19921103-hypertext/hypertext/WWW/MarkUp/Tags.html#11>

[104] [CITE@@en[draft-ietf-iiir-html-00 - Hypertext Markup Language (HTML): A Representation of Textual Information and MetaInformation for Retrieval and Interchange]]
( ([TIME[2013-02-10 00:15:56 +09:00]] 版))
<http://tools.ietf.org/html/draft-ietf-iiir-html-00>

[105] [CITE[HTML DTD issues]]
( ([TIME[2003-08-05 15:39:18 +09:00]] 版))
<http://lists.w3.org/Archives/Public/www-talk/1992NovDec/0068.html>

[106] [CITE[Re: HTML DTD issues]]
( ([TIME[2003-08-19 00:53:43 +09:00]] 版))
<http://lists.w3.org/Archives/Public/www-talk/1992NovDec/0072.html>

[107] [CITE[Future plans for HTML]]
( ([TIME[1992-12-02 18:35:56 +09:00]] 版))
<http://www.w3.org/History/19921103-hypertext/hypertext/WWW/MarkUp/Future.html>@


1.27
log
@updated by (anon)
@
text
@d560 5
a564 1
<http://lists.w3.org/Archives/Public/www-talk/1992NovDec/0072.html>@


1.26
log
@updated by (anon)
@
text
@d556 5
a560 1
<http://lists.w3.org/Archives/Public/www-talk/1992NovDec/0068.html>@


1.25
log
@updated by (anon)
@
text
@d552 5
a556 1
<http://tools.ietf.org/html/draft-ietf-iiir-html-00>@


1.24
log
@updated by (anon)
@
text
@d548 5
a552 1
<http://www.w3.org/History/19921103-hypertext/hypertext/WWW/MarkUp/Tags.html#11>@


1.23
log
@updated by (anon)
@
text
@d544 5
a548 1
<http://dev.w3.org/2006/xbl2/Overview.html#shadow-content-and-xmlbase>@


1.22
log
@updated by (anon)
@
text
@d540 5
a544 1
<http://dev.w3.org/2006/xbl2/Overview.html#rules-for-shadow-content-generation>@


1.21
log
@updated by (anon)
@
text
@d536 5
a540 1
<http://krijnhoetmer.nl/irc-logs/whatwg/20130212#l-368>@


1.20
log
@updated by (anon)
@
text
@d532 5
a536 1
<http://html5.org/tools/web-apps-tracker?from=7265&to=7266>@


1.19
log
@updated by (anon)
@
text
@d528 5
a532 1
<http://html5.org/tools/web-apps-tracker?from=7266&to=7267>@


1.18
log
@updated by (anon)
@
text
@d524 5
a528 1
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-December/034199.html>@


1.17
log
@updated by (anon)
@
text
@d520 5
a524 1
<http://www.w3.org/TR/2011/REC-SVG11-20110816/struct.html#Core.attrib>@


1.16
log
@updated by (anon)
@
text
@d516 5
a520 1
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-July/032569.html>@


1.15
log
@updated by (anon)
@
text
@d512 5
a516 1
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/031511.html>@


1.14
log
@updated by (anon)
@
text
@d508 5
a512 1
<http://www.w3.org/TR/2010/NOTE-xframes-20101216/#s_frames-element>@


1.13
log
@updated by (anon)
@
text
@d504 5
a508 1
<http://html5.org/tools/web-apps-tracker?from=5710&to=5711>@


1.12
log
@updated by (anon)
@
text
@d500 5
a504 1
<http://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.3>@


1.11
log
@updated by (anon)
@
text
@d496 5
a500 1
<http://www.w3.org/TR/2010/REC-xproc-20100511/#xml-base-attribute>@


1.10
log
@updated by (anon)
@
text
@d492 5
a496 1
[[RFC 3987]] [[IRI参照]]@


1.9
log
@updated by (anon)
@
text
@d379 13
@


1.8
log
@updated by (anon)
@
text
@d16 1
d18 1
a18 2

** 属性値
a63 11
[42] '''意味不定の場合'''

- [43] [[XML基底]]仕様を直接または間接に参照する[[応用]]''以外''では、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の動作は未定義です。
[SRC[XML基底 1]]
- [40] 値が[[妥当]]な[[URI参照]]にならない場合の動作は、
[[応用]]依存です。 [SRC[XML基底正誤表 E03]]

[20] >>40
(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

a76 1

a82 1
([[名無しさん]])
d84 6
d91 15
a105 1
[[#comment]]
d107 2
d181 6
@


1.7
log
@updated by (anon)
@
text
@d1 2
d4 1
d6 1
a6 9
* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

[21] '''仕様書'''
- [[XML基底]]
d8 2
a9 2
<IW:XMLBase:"#syntax">
-- [25] [CITE@@en[Errata in REC-xmlbase-20010627]] 
d12 3
a15 1
[[#comment]]
d343 13
a355 1
[[#comment]]
d357 6
d364 1
a364 1
** メモ
a458 3

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。
@


1.6
log
@updated by (anon)
@
text
@a440 271
* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
-- [CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典

,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]]	,(なし)	,固有識別子	,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]


** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]


** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[33]
[[WinIE]] ([[MSHTML]]) において、 [CODE(HTMLe)[[[base]]]]
要素が [CODE(HTMLe)[[[head]]]] 中に存在する場合、
- [CODE(HTMLe)[[[body]]]] の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[head]]]] 内の要素の内、
[CODE(HTMLe)[[[base]]]] の弟の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の弟や [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[previousSibling]]]]
は直近の兄です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の兄や [CODE(HTMLe)[[[base]]]]
が含まれます。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(HTMLe)[[[body]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[html]]]] です。
- [CODE(HTMLe)[[[html]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[head]]]] と [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には弟や [CODE(HTMLe)[[[body]]]] の内容も含まれます。
[CODE(HTMLe)[[[base]]]] の[[終了タグ]]はありません。
[CODE(HTMLe)[[[head]]]] の[[終了タグ]]は含まれます。
- [CODE(HTMLe)[[[head]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には [CODE(HTMLe)[[[body]]]] の内容は含まれません。

([[WinIE 6]] on [[Windows XP]] [[SP2]] で確認)

参考: [CITE[agenda 2002-03(下旬) - Personnel]] <http://members.jcom.home.ne.jp/jintrick/Personal/d20023l.html#d18_19>

([[名無しさん]])

[34]
>>33

>>3 のように [CODE(HTMLe)[[[body]]]] 内に複数
[CODE(HTMLe)[[[base]]]] を入れてみると、それ以降がすべて
[CODE(HTMLe)[[[base]]]] に飲み込まれます。
[CODE(HTMLe)[[[base]]]] の終了タグがあっても無視されます。

([[名無しさん]] [WEAK[2005-05-29 07:33:55 +00:00]])

[35]
>>34 のテスト: <http://suika.fam.cx/gate/cvs/*checkout*/www/test/html/base/base-in-body.html>
([[名無しさん]] [sage])

[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい

[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>

([[名無しさん]] [sage])

[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>

([[名無しさん]] [WEAK[2005-09-02 03:35:49 +00:00]])

[64]
[CITE[「base要素でいろいろ」@@水無月ばけらのえび日記]] <http://bakera.jp/hatomaru.aspx/ebi/topic/2697>
([[名無しさん]] [WEAK[2006-11-05 23:44:46 +00:00]])

[[#comment]]


** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>

[39]
[[libwww]]の[[HTML]][[構文解析器]]は1996年7月20日のRelease 4.1b3で[CODE(HTMLe)@@en[[[base]]]]を実装しました。
([[名無しさん]] [sage])

[[#comment]]


** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>
 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]

[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]


** メモ

[65]
[CITE@@en[crisp’s blog &#187; Blog Archive &#187; Broken parsers; the importance of BASE]] ([CODE[2007-01-12 23:43:01 +09:00]] 版) <http://therealcrisp.xs4all.nl/blog/2007/01/06/broken-parsers-the-importance-of-base/>
([[名無しさん]] [WEAK[2007-01-12 14:45:56 +00:00]])

[66]
[CITE@@en[Useful CSS Snippets - webSemantics]] ([[Mike Foskett]] 著, [CODE[2007-01-13 16:06:46 +09:00]] 版) <http://www.websemantics.co.uk/tutorials/useful_css_snippets/#base>
([[名無しさん]])

[67]
今朝の #whatwg より ([[JST]]):

>
- 08:15 <Hixie> about 5% of sites have 1 <base> tag, apparently
- 08:16 <Hixie> 0.03% have 2
- 08:16 <Hixie> 0.0017% have 3
- 08:16 <Hixie> and a few thousand have more than 3
- 08:18 <Hixie> so we're talking about a few million pages here
- 08:18 <Hixie> with 2 or more <base> elements

([[名無しさん]] [WEAK[2007-05-01 02:57:59 +00:00]])

[68]

>
- 08:19 <Hixie> oh actually this was only counting _different_ values for <base>
- 08:19 <Hixie> so a few million pages use two different values for <base>

([[名無しさん]] [WEAK[2007-05-01 02:59:14 +00:00]])

[69]
[CITE[Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-05-01 06:53:18 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/10460>
([[名無しさん]] [WEAK[2007-05-04 04:39:41 +00:00]])

[71]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[72]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[[#comment]]
@


1.5
log
@updated by (anon)
@
text
@d719 5
a723 1
[78] [CITE[SMIL 3.0 Metainformation]] ([TIME[2008-12-02 00:45:09 +09:00]] 版) <http://www.w3.org/TR/2008/REC-SMIL3-20081201/smil-metadata.html#edef-meta>@


1.4
log
@updated by (anon)
@
text
@d718 2
a719 1
([[名無しさん]])@


1.3
log
@updated by (anon)
@
text
@d323 1
a323 1
[[Atom 1.0]]のすべての[[要素]]には、[[XML基底]]で規定された
d331 2
d464 1
@


1.2
log
@updated by (anon)
@
text
@d430 6
@


1.1
log
@converted from SuikaWiki3 <http://suika.fam.cx/gate/cvs/suikawiki/wikidata/page/62617365.txt>
@
text
@d1 92
a92 92


* xml:base 属性 (XML Base)

[1] [DFN[[CODE(XMLa)[xml:base]]]] 属性は、 
[[HTML]] の [CODE(HTMLe)[base]]
要素型を汎用化して、 [[XML]] の任意の要素の属性として[[基底URI]]
を指定できるようにしたものです。

[21] '''仕様書'''
- [[XML基底]]
-- [6] [CSECTION@@en[3 [CODE(XMLa)@@en[xml:base]] Attribute]]
<IW:XMLBase:"#syntax">
-- [25] [CITE@@en[Errata in REC-xmlbase-20010627]] 
<http://www.w3.org/2001/06/xmlbase-errata#E01>
(詳細は[[XML基底]]の項を参照。)

[[#comment]]


** 属性値

[44] '''適当な属性値'''

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]は、
''後述の処理の後に''[[RFC 2396]] [[URI参照]]として処理されます。
[SRC[XML基底 3]]

[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]で使うことのできる[[文字]]は、
[[XML]]の一般の場合と同じです。 [SRC[XML基底 3.1]]

[[属性値]]から[[URI参照]]に変換するためには、
- [[非ASCII文字]]
- [CODE(char)@@en[[[U+0000]]]]〜[CODE(char)@@en[[[U+0020]]]]
- [CODE(char)@@en[[[U+007F]]]]
- [CODE(char)[[[<]]]], [CODE(char)[[[>]]]],
[CODE(char)[[["]]]], [CODE(char)[[[{]]]], [CODE(char)[[[}]]]],
[CODE(char)[[[|]]]], [CODE(char)[[[\]]]], [CODE(char)[[[^]]]],
[CODE(char)[[[`]]]]

を[[UTF-8]]で[[百分率符号化]]します。 [SRC[XML基底 3.1]]

;; 詳しくは[[XML//URI]]および[[IRI]]の項を参照。

[52] '''RFC 3986との関係'''

[[RFC 3986]]の新しい構文では、[[命名権者]]部に[[百分率符号化]]や新しい[[IP番地]]のための構文が認められていますが、
[[RFC 2396]]や[[RFC 2732]]では認められていません。
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3986]]の[[URI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3986]]
に従って解釈する実装も不適合にはなりません。

[53] '''RFC 3987との関係'''

[[RFC 3987]]も[[RFC 3986]]にあわせた新しい構文を採用していますから、
[[XML基底]]仕様を厳密に運用するなら、
[[RFC 3987]]の[[IRI参照]]の一部は[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]に使えません。

;; ただし、 >>40 の規定により、 [[RFC 3987]]
に従って解釈する実装も不適合にはなりません。

;; なお、 >>44 の[[URI参照]]に変換するために[[逃避]]しなければならない[[文字]]の種類は、
[[RFC 3987]]の[[算法]]で規定されたものと一致しています。

[42] '''意味不定の場合'''

- [43] [[XML基底]]仕様を直接または間接に参照する[[応用]]''以外''では、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の動作は未定義です。
[SRC[XML基底 1]]
- [40] 値が[[妥当]]な[[URI参照]]にならない場合の動作は、
[[応用]]依存です。 [SRC[XML基底正誤表 E03]]

[20] >>40
(>>2 の絡みで、厳密には[Q[URI 参照と解釈できない場合]]とでもしないといけないと思うのですが...)

;; 
[45]
[[XML基底]] 3では[[RFC 2396]] [[URI参照]]として解釈するとしていますが、
同3.1の[[逃避]]に関する[[RFC 2732]]も参照しています。
字面通り厳密に解釈すると結局[[RFC 2732]]拡張は使えないことになってしまいますが、
本当にそれでよいのでしょうか。[[RFC 3986]]が発行された今、
早急に改訂するべきです。

[2] [CODE(XMLa)[xml:base]] 属性の値の定義は 
[Q[URI 参照と解釈されるもの]]ですから、
[CODE(URI)[#]] + [[素片識別子]]をつけても構いません。
(あまり意味は無いですが。)


[75]
d97 612
a708 603
どのような値を指定することが期待されているのかがまったく規定されていません。
([[名無しさん]])


[[#comment]]


** 基底URIの算出

[46] [SRC[XML基底 4]]
- ある[[要素]]の[[基底URI]]は、次の順に決定します。
== その[[要素]]に[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]があれば、
それによって指定された[[基底URI]]。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[要素]]中の文字列[[内容]]の[[基底URI]]は、
その[[要素]]の[[基底URI]]です。
- [CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- その他の[[属性]]の[[基底URI]] ([[既定属性]]を含みます。)
の[[基底URI]]は、その付されている[[要素]]の[[基底URI]]です。
- [[処理指令]]の[[内容]]の[[基底URI]]は、
次の順に決定します。
== 同じ[[文書実体]]または[[外部実体]]中に[[親要素]]があれば、
その[[基底URI]]。
== その[[要素]]が含まれる[[文書実体]]または[[外部実体]]の[[基底URI]]。
- [[文字]]、[[内部実体]]、[[属性]]に個別に[[基底URI]]を指定する方法はありません。

[47] [[システム識別子]]における[[基底URI]]については、
[[XML]]の仕様書に規定があります。
([[XML//URI//基底]]の項を参照。)

[48] [CODE(XML)@@en[[[xmlns]]]]系[[属性]]については特に例外が規定されていないので、
>>46 の原則通りになりますが、[[名前空間URI]]が[[絶対URI参照]]で''ない''時にどう処理されるのかは[[XML]]系仕様書では定義していません。
[SRC[XML基底 附属書C (参考)]]

[[#comment]]


** 相対参照の解決

[49] [[XML基底]]仕様書には[CSECTION@@en[4 Resolving Relative URIs]]という章がありますが、
[[基底URI]]の決定方法の説明だけで、[[相対URI参照]]の[[解決]]の方法は何ら規定していないようです。

[[XML基底]]仕様からの引用規格に[[RFC 2396]]および[[RFC 2732]]がありますし、
本文中でも再三引用されていますから、それらで定義された方法で[[解決]]すると解釈するのが自然でしょう。

[50] '''RFC 3986との関係'''

[[RFC 3986]]の[[相対参照]]の[[解決]]方法には[[RFC 2396]]のものと違いがあります。
問題となる変更点は2つあります。
- [[素片識別子]]''だけ''の[[参照]]
-- [[RFC 2396]]における[[素片識別子]]''だけ''の[[URI参照]]は、
同じ[[文書]]内での[[参照]]です。[[基底URI]]に対してではなく、
[[文書]]自体に対して解釈されます。
-- [[RFC 3986]]における[[素片識別子]]''だけ''の[[URI参照]]は、
[[基底URI]]に対するものとして解釈されます。
- 非階層的[[URI]]
-- [[RFC 2396]]では、[[相対URI]]は階層的な[[URI]]に関して定義されており、
[[基底URI]]が階層的でない場合は使うことができません。
-- [[RFC 3986]]では、どんな[[URI]]に対しても[[相対参照]]とその[[解決]]方法が定義されています。

;; 
[54]
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]の[[基底URI]]が[[RFC 2396]]によれば階層的ではなく、[[相対URI]]を使えないにも関わらず、
[[属性値]]が[[相対URI]]の場合はどうなるのでしょうか。
>>40 が適用されるのでしょうか。
(その場合は[[RFC 3986]]の動作をしても[[適合]]します。)

;; [[XML基底]]を参照する仕様の1つ、[[RDF/XML]] (2004年版)
は、[[RFC 2396]]の[[同文書参照]]も[[基底URI]]に対して解釈すると規定しています。

;; [CITE[RDF/XML Syntax Specification (Revised)]] 
<http://www.w3.org/TR/2004/REC-rdf-syntax-grammar-20040210/#section-baseURIs>

[51] '''RFC 3987との関係'''

>>44 の通り、[[IRI参照]]の多くはそのまま[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性値]]として使うことができますが、
[[逃避]]して[[URI参照]]にして処理すると定義されていますから、
[[解決]]は[[IRI参照]]としてではなく、変換後の[[URI参照]]として行われます。

[[#comment]]


** XML名前空間およびスキーマとの関係

[41] '''XML名前空間を使わない場合'''

[[XML名前空間]]を使わない場合、
[[名前]]が[CODE(XMLa)@@en[[[xml]]:[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[3] '''XML名前空間を使う場合'''

[[XML名前空間]]を使う場合、
[[名前空間名]]が[CODE(URI)@@en[[[http://www.w3.org/XML/1998/namespace]]]]
([[名前空間接頭辞]]は[CODE(XML)@@en[[[xml]]]])
で[[局所名]]が[CODE(XMLa)@@en[[[base]]]]の[[属性]]を使うことができます。
[SRC[XML基底 3]]

[24]
[[XML基底]]仕様書にも注記がありますが、 
[CODE(XMLa)[xml:base]] 属性に DTD 
や外部スキーマで初期値が設定されていると、
[[妥当性]]を検証しない処理器などで正しい値が得られませんから、好ましくありません。

[11] >>5 ですから、既定値は DTD の内部部分集合で指定するか、
又は直接指定する'''べき'''だとされています。 
(<http://www.w3.org/TR/xmlbase/#matching>, <http://www.w3.org/2001/06/xmlbase-errata>)

[55] '''XML Schemaによる定義'''

[[XML Schema]]による定義 <http://www.w3.org/2001/xml.xsd>
(執筆時点での最新版は <http://www.w3.org/2005/08/xml.xsd>)
では、[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]は[[データ型]][CODE(XML)@@en[[QN[xs:[[anyURI]]] [http://www.w3.org/2001/XMLSchema]]]]として[[宣言]]されています。
また、[[属性集合]][CODE(XML)@@en[[QN[[[xml]]:[[specialAttrs]]] [http://www.w3.org/XML/1998/namespace]]]]
に含まれています。

[[#comment]]


** 各種データ・モデルとの関係

[29] [[XML情報集合]]は、 XML 基底仕様書の規定に基づく[[要素情報項目]]の
[CODE(infoprop)[[[基底URI]]]] 特性を定義しています。
>>25 の E02 の通り、一旦情報集合を構築してしまった後は [CODE(XMLa)[xml:base]]
属性情報項目と [CODE(infoprop)[基底 URI]] 特性は切り離されてしまいます。

[30] [[DOM 3]] の [CODE(DOMi)[[[Node]]]] 界面の [CODE(DOMa)[[[baseURI]]]]
属性は基底 URI を保持しています。
XML 情報集合の [CODE(infoprop)[基底 URI]] とは異なり、
[CODE(DOMa)[baseURI]] の値は (XML 基底仕様書に基づく) 計算により求めます。
[CODE(XMLa)[xml:base]] 属性節と [CODE(DOMa)[baseURI]] は同期しています。

[59]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[60]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[61]
[CODE(InfoProp)[[[基底URI]]]]と[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]では、
[CODE(InfoProp)[[[基底URI]]]]の方を優先して[[相対参照]]の[[解決]]に使うべきとされています。
[SRC[XML情報集合 1]]

([[名無しさん]])

[[#comment]]


** 応用言語と xml:base 属性

[23]
[CODE(XMLa)[xmlns]] 系属性の値も URI 参照
(XML 名前空間 1.1 では [[IRI参照]]) で、相対 URI
参照である可能性があります (常識的な仕様とは思えません:))。
[WEAK[(一応今では非推奨になっています。)]]
しかしこの URI/IRI 参照は単なる識別子で、
解決する必要があるものではありませんから、そのまま扱います。
但しその名前空間 URI/IRI 参照をたどってみる場合には 
[CODE(XML)[xml:base]] 属性の値を使って解決するのも勝手だそうです。

(そういえば XML 基底では IRI 参照の解決の方法は書かれていない。
そのうち改訂されるのか? それとも IRI 参照を解決する時には
URI 参照に変換するのか?)

[4] [[XHTML]] の使用については XML Base 
仕様書は参考で曖昧なことを書いています。
実際のところ W3C の [[XHTML 1]] の [[DTD]]
には[CODE(XMLa)[xml:base]] 属性は定義されていませんから、
そのままでは使えません。

[[XHTML 2.0]] [[WD]] では明確に使用できると定義されています。

[5] XML Base を使用できると明記していない仕様では、 XML Base
対応 [[UA]] と非対応 UA で挙動が異なることになるので無理して使用しない方が良いと思われます。

[[#comment]]


*** xml:base 属性 (XML 型録)

[12] [[XML]] [[型録]]のほとんどの要素型
([[名前空間名]]が
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:xml:catalog]]]]
及び
[CODE(URI)[[[urn:oasis:names:tc:entity:xmlns:tr9401:catalog]]]]
の全ての要素型。但し、 [CODE(XML)[[[rewriteSystem]]]],
[CODE(XML)[[[rewriteURI]]]] 両要素型を除く。) では
[CODE(XML)[xml:base]] 属性が使えます。
<http://www.oasis-open.org/committees/entity/spec.html#attrib.common>

[13] 唯二つ使えない両要素型も、 URI 参照を値に持つ
[CODE(XML)[[[rewritePrefix]]]] 属性を持っているのに
[CODE(XML)[xml:base]] 属性が無いのは不可解です。

これらの両要素型の [CODE(XML)[rewritePrefix]] 属性、
仕様書本文中の定義では [CODE[uri-reference]]
になっていますし、本文中の説明でも相対 URI
はその場の基底 URI で解決することになっていますが、
[[DTD]] では URI 参照ではなく単なる文字列になっています。
[WEAK[(もちろん実際の型は [CODE(XML)[[[CDATA]]]] ですが、[[引数実体]]を使って型が擬似的に示してあります。あと、 DTD でなくても [[XML Schema]] も示してありますが、こちらも同じ状況です。)]]

もしかしたら [CODE(XML)[rewritePrefix]] では URI
としては不正な値 [WEAK[([SAMP(URI)[http://foo.]] とか。)]]
も認めたかったから文字列型にしたのかもしれません。
でもなんだかなあ。

[[#comment]]


*** [CODE(XMLa)@@en[xml:base]] 属性 (Atom)

[62]
[[Atom 1.0]]のすべての[[要素]]には、[[XML基底]]で規定された
[CODE(XMLa)@@en[[QN[[[xml]]:[[base]]] [http://www.w3.org/XML/1998/namespace]]]][[属性]]を持って'''構いません'''。
[[RFC 3986]] にある[[基底URI]] ([[基底IRI]])
として使われます。

;; 出典: [[RFC 4287]] <urn:ietf:rfc:4287> 
[CSECTION@@en[2. Atom Document]]

[63]
>>62 [[RFC 2396]]を参照する[[XML基底]]仕様を参照しながら、
[[RFC 3986]]の機能を持つといい、[Q@@en[or [[IRI]]]]
とまで書いていますが、いったいどう理解しろというのでしょう。

[[#comment]]


** 歴史

[7] XML Base は [[XLink]] 
と一緒に開発されたものの汎用性を持たせるべく独立した仕様となったそうです。

[[#comment]]


** メモ

[9] XML 基底を使うとして、
[PRE(XML)[
<doc xml:base="http://foo.example/dir1/">
<style type="text/css" xml:base="http://foo.example/dir2/">
@@import 'foo.css';
</style>
</doc>
]PRE]

の [SAMP(URI)[foo.css]] は [SAMP(URI)[dir2]]
からの相対 URI として解釈されるのかな?
(要素の内容だから。)

[10] HTML で
[PRE(HTML)[
<!-- base = <http://foo.example/dir1/> -->
<head>
<base href="http://foo.example/dir2/"/>
<style type="text/css">
@@import 'foo.css';
</style>
</head>
]PRE]

は >>9 と同じように解釈されるのかなあ??

[31]
[CITE[XInclude, xml:base, and validation]] <http://norman.walsh.name/2005/04/01/xinclude>

[[XInclude]] の処理に伴って
[CODE(XMLa)[[[xml]]:[[base]]]] [[属性情報項目]]が追加されると[[妥当性検証]]に影響がでかねないという問題
([CODE(XMLa)[[[xml]]:[[lang]]]] でも)。

([[名無しさん]])

[32]
[CITE[2005 / 04 / 04: .NET developers want inconsistent schema validity on xml:* attributes?]] <http://monkey.workarea.jp/lb/archive/2005/4-04.html>

>>31 の問題で予想通り(藁) [CODE(XMLa)[[[xml]]:[VAR[*]]]]
は[[妥当性検証]]で無視すればよいという意見が出ていることに対して、
それでは [CODE(XMLa)[[[xml]]:[[lang]]]]
の値を制約したりできなくなるというおはなし。
([[名無しさん]] [WEAK[2005-04-05 00:21:13 +00:00]])

[56]
[[正準XML]] (1.0) 仕様によって特定の[[要素]]以下を[[直列化]]する際には、
[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を含め、
[CODE(XML)@@en[[[xml]]]][[名前空間]]に属する[[属性]]がその[[要素]]の[CODE(XPath)@@en[[[ancestor-or-self]]]]のうちの一番近くにあるものが[[指定]]されます。
[SRC[正準XML 2.4]]

([[名無しさん]])

[57]
[[排他的XML正準化 1.0]]仕様では >>56 の規定を適用しないことになっています。
([[名無しさん]])

[58]
[[XInclude]]では[CODE(InfoProp)[[[基底URI]]]]との整合性を保持するために[CODE(XMLa)@@en[[[xml]]:[[base]]]][[属性]]を追加することがあります。
([[名無しさん]])

[70]
[CITE@@en[xml:base in M12N]] ([[Shane McCarron]] 著, [CODE[2007-07-13 21:52:09 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-xhtml2/2007Jul/0024.html>
([[名無しさん]])

[73]
[CITE@@EN[XML Base (Second Edition)]] ([CODE[2008-03-20 00:21:54 +09:00]] 版) <http://www.w3.org/TR/2008/PER-xmlbase-20080320/>
([[名無しさん]])

[74]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2008-02-13 01:15:07 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/13246>
([[名無しさん]])

[[#comment]]


* base 要素型 (HTML, XHTML 1)

[14] [[HTML]] の [DFN[[CODE(HTMLe)[base]] 要素型]]の要素は、
[[文書]]の[[基底URI]] や基底対象枠を指定するために使用することができます。

[17] HTML での基底 URI に関しては、
[[HTML//基底URI]] も参照してください。

[26] 仕様書:
- [[HTML 2.0]] ([[RFC 1866]])
-- [CITE[5.2.2. Base Address: [CODE(HTMLe)[BASE]]]]
- [[HTML 4]]
-- [CITE[12.4 Path information: the [CODE(HTMLe)[BASE]] element]]
<IW:HTML4:"struct/links.html#edef-BASE">

[15]
:[[開始タグ]]:必須
:[[終了タグ]] ([[HTML 2]], [[HTML 4]], [[ISO-HTML]]):禁止
:終了タグ (XHTML 1):必須
:[[内容模型]]:[[強制空要素]]
:出現できる文脈:[CODE(HTMLe)[[[head]]]] 内の、参照を持つ要素の前に高々1個
:[[属性]]:
,属性名	,値の型	,既定値	,意味	,出典
,[CODE(HTMLa)[[[href]]]]	,[[絶対URI]]	,(選択必須)	,基底 URI	,"[HTML 2], [HTML 4]"
,[CODE(HTMLa)[[[id]]]]	,(なし)	,固有識別子	,"[XHTML 1.0 SE], Microsoft [[Word]]"
,[CODE(HTMLa)[[[target]]]]	,[CODE(SGML)[%[[FrameTarget]]]]	,(選択必須)	,既定の対象枠	,[HTML 4] 非推奨


[CODE(HTMLa)[href]] 属性と [CODE(HTMLa)[target]]
属性のいずれかは必須です (が、 [[DTD]] でこれを表すことができないので、
両方の属性が存在する DTD では、両方省略可能になっています)。

[[#comment]]


** 出現できる文脈

[16] この要素は
[CODE(HTMLe)[head]] 要素内に高々1個存在できますが [SRC[HTML 4]]、
外部参照を持つ要素の前になければなりません [SRC[HTML 4 仕様書]]。

[CODE(HTMLe)[base]] 要素の前に来得る、
外部参照を持ち得る要素型は [CODE(HTMLe)[[[script]]]],
[CODE(HTMLe)[[[object]]]], [CODE(HTMLe)[[[link]]]]
です。 (スクリプト内やスタイルシート内の参照も含まれるのでしょうか? 
だとしたら [CODE(HTMLe)[[[style]]]] 要素や、
[CODE(HTMLa)[style]] 属性または事象系属性を持つ任意の要素が該当します。)

ところで、 [CODE(HTMLe)[head]] 要素自体も
[CODE(HTMLa)[[[profile]]]] という値に [[URI]]
を含む属性があります。でもそれ以前にもっていくのは不可能です。

[18]
HTML 4 loose DTD でも [CODE(HTMLe)[base]] が出現可能なのは高々1回です。つまり、
[CODE(HTMLa)[href]] 用と [CODE(HTMLa)[target]] 用を別にするようなことはできない、
ということです。

[[#comment]]


** 他との関係

[27]
HTML には [CODE(HTMLa)[[[codebase]]]]
属性があって、特定の要素の特定の処理における基底 URI
を別途指定できます。

[[XHTML]] を他のマーク語彙と組合せる時の
[CODE(HTMLe)[base]] 要素の影響は規定されていませんから、
どう解釈されるかわかりませんので危険です。

[[#comment]]


** 仕様書から


*** RFC 1866 (HTML 2.0) 5.2.2. Base Address: BASE

> The optional <BASE> element provides a base address for interpreting
relative URLs when the document is read out of context (see 7,
"Hyperlinks"). The value of the HREF attribute must be an absolute URI.

省略可能な [DFN[[CODE(HTMLe)[base]] 要素]]は、
文書が文脈外で読まれる時に[[相対URL]]を解釈するための基底番地を提供します。
[CODE(HTMLa)[href]] 属性の値は[[絶対URI]]でなければなりません。


** 不思議解釈

[8] [[不思議マーク付け]]的には、 [CODE(HTMLe)[base]] 要素は次の 
[CODE(HTMLe)[base]] 
要素が現れるまで有効なのだそうです (少なくても [[WinIE]] はこの通り動くらしい)。
[CODE(HTMLe)[[[basefont]]]] 要素と同じですね。

[33]
[[WinIE]] ([[MSHTML]]) において、 [CODE(HTMLe)[[[base]]]]
要素が [CODE(HTMLe)[[[head]]]] 中に存在する場合、
- [CODE(HTMLe)[[[body]]]] の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[head]]]] 内の要素の内、
[CODE(HTMLe)[[[base]]]] の弟の
[CODE(DOMa)[[[parentNode]]]] は [CODE(HTMLe)[[[base]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の弟や [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[previousSibling]]]]
は直近の兄です。
- [CODE(HTMLe)[[[base]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[base]]]] の兄や [CODE(HTMLe)[[[base]]]]
が含まれます。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(HTMLe)[[[head]]]] です。
- [CODE(HTMLe)[[[body]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[previousSibling]]]]
は [CODE(DOM)[[[null]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[nextSibling]]]]
は [CODE(HTMLe)[[[body]]]] です。
- [CODE(HTMLe)[[[head]]]] の [CODE(DOMa)[[[parentNode]]]]
は [CODE(HTMLe)[[[html]]]] です。
- [CODE(HTMLe)[[[html]]]] の [CODE(DOMa)[[[childNodes]]]]
には [CODE(HTMLe)[[[head]]]] と [CODE(HTMLe)[[[body]]]]
が含まれます。
- [CODE(HTMLe)[[[base]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には弟や [CODE(HTMLe)[[[body]]]] の内容も含まれます。
[CODE(HTMLe)[[[base]]]] の[[終了タグ]]はありません。
[CODE(HTMLe)[[[head]]]] の[[終了タグ]]は含まれます。
- [CODE(HTMLe)[[[head]]]] の
[CODE(DOMa)[[[outerHTML]]]], [CODE(DOMa)[[[innerHTML]]]],
[CODE(DOMa)[[[outerText]]]], [CODE(DOMa)[[[innerText]]]]
には [CODE(HTMLe)[[[body]]]] の内容は含まれません。

([[WinIE 6]] on [[Windows XP]] [[SP2]] で確認)

参考: [CITE[agenda 2002-03(下旬) - Personnel]] <http://members.jcom.home.ne.jp/jintrick/Personal/d20023l.html#d18_19>

([[名無しさん]])

[34]
>>33

>>3 のように [CODE(HTMLe)[[[body]]]] 内に複数
[CODE(HTMLe)[[[base]]]] を入れてみると、それ以降がすべて
[CODE(HTMLe)[[[base]]]] に飲み込まれます。
[CODE(HTMLe)[[[base]]]] の終了タグがあっても無視されます。

([[名無しさん]] [WEAK[2005-05-29 07:33:55 +00:00]])

[35]
>>34 のテスト: <http://suika.fam.cx/gate/cvs/*checkout*/www/test/html/base/base-in-body.html>
([[名無しさん]] [sage])

[37]
こういう変な包含関係は [CODE(HTMLa)@@en[[[contentEditable]]]]
でも生じるらしい

[CITE@@en[contentEditable - Anne’s Weblog about Markup & Style]] 
<http://annevankesteren.nl/2005/07/contenteditable>

([[名無しさん]] [sage])

[38]
>>33-35
[[WinIE 7]] で修正される予定だそうです。

[CITE@@en[IEBlog : All your <base> are belong to us]] 
<http://blogs.msdn.com/ie/archive/2005/08/29/457667.aspx>

([[名無しさん]] [WEAK[2005-09-02 03:35:49 +00:00]])

[64]
[CITE[「base要素でいろいろ」@@水無月ばけらのえび日記]] <http://bakera.jp/hatomaru.aspx/ebi/topic/2697>
([[名無しさん]] [WEAK[2006-11-05 23:44:46 +00:00]])

[[#comment]]


** 歴史

[19]
[CODE(HTMLe)[base]] 要素に [CODE(HTMLa)[[[id]]]] を振って、相対 URI 
を使う文脈でどの基底 URI (たとえば画像用の基底 URI) 
を使うのかを選べるようにしたらどうかという案もありました。

''www-html@@w3.org from May 1995: Re: <BASE> processing by browsers'' <http://lists.w3.org/Archives/Public/www-html/1995May/0004.html>

[39]
[[libwww]]の[[HTML]][[構文解析器]]は1996年7月20日のRelease 4.1b3で[CODE(HTMLe)@@en[[[base]]]]を実装しました。
([[名無しさん]] [sage])

[[#comment]]


** 例

[28]
[PRE(HTML)[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
   <TITLE>Our Products</TITLE>
   <BASE href="http://www.example.com/products/intro">
 </HEAD>
 <BODY>
   <P>Have you seen our <A href="../cages/birds">Bird Cages</A>?
 </BODY>
</HTML>
]PRE]

[WEAK[(HTML 4 仕様書より、改)]]

この場合、この文書自体の [[URI]] にかかわらず、
[CODE(HTMLe)[a]] 要素のリンク先は
[SAMP(URI)[http://www.example.com/cages/birds]] になります。

[[#comment]]


** メモ

[65]
[CITE@@en[crisp’s blog &#187; Blog Archive &#187; Broken parsers; the importance of BASE]] ([CODE[2007-01-12 23:43:01 +09:00]] 版) <http://therealcrisp.xs4all.nl/blog/2007/01/06/broken-parsers-the-importance-of-base/>
([[名無しさん]] [WEAK[2007-01-12 14:45:56 +00:00]])

[66]
[CITE@@en[Useful CSS Snippets - webSemantics]] ([[Mike Foskett]] 著, [CODE[2007-01-13 16:06:46 +09:00]] 版) <http://www.websemantics.co.uk/tutorials/useful_css_snippets/#base>
([[名無しさん]])

[67]
今朝の #whatwg より ([[JST]]):

>
- 08:15 <Hixie> about 5% of sites have 1 <base> tag, apparently
- 08:16 <Hixie> 0.03% have 2
- 08:16 <Hixie> 0.0017% have 3
- 08:16 <Hixie> and a few thousand have more than 3
- 08:18 <Hixie> so we're talking about a few million pages here
- 08:18 <Hixie> with 2 or more <base> elements

([[名無しさん]] [WEAK[2007-05-01 02:57:59 +00:00]])

[68]

>
- 08:19 <Hixie> oh actually this was only counting _different_ values for <base>
- 08:19 <Hixie> so a few million pages use two different values for <base>

([[名無しさん]] [WEAK[2007-05-01 02:59:14 +00:00]])

[69]
[CITE[Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-05-01 06:53:18 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/10460>
([[名無しさん]] [WEAK[2007-05-04 04:39:41 +00:00]])

[71]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[72]
[CITE[Re: Issues concerning the <base> element and xml:base]] ([[Ian Hickson <ian@@...>]] 著, [CODE[2007-08-07 09:32:28 +09:00]] 版) <http://permalink.gmane.org/gmane.org.w3c.whatwg.discuss/11598>
([[名無しさん]])

[[#comment]]


* メモ

[36]
[[P3P]] に[[基底URI]] を指定するための [CODE(XMLa)[base]] 属性があります。
@

