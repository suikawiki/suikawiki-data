head	1.41;
access;
symbols
	suika-20100509:1.6
	before-graph-20090923:1.5;
locks; strict;
comment	@# @;
expand	@b@;


1.41
date	2014.04.18.16.25.43;	author wakaba;	state Exp;
branches;
next	1.40;

1.40
date	2014.04.18.15.42.38;	author wakaba;	state Exp;
branches;
next	1.39;

1.39
date	2014.04.18.15.33.44;	author wakaba;	state Exp;
branches;
next	1.38;

1.38
date	2014.04.18.14.28.21;	author wakaba;	state Exp;
branches;
next	1.37;

1.37
date	2014.04.18.14.11.22;	author wakaba;	state Exp;
branches;
next	1.36;

1.36
date	2014.03.10.13.35.43;	author wakaba;	state Exp;
branches;
next	1.35;

1.35
date	2014.03.08.01.02.39;	author wakaba;	state Exp;
branches;
next	1.34;

1.34
date	2014.02.21.01.27.18;	author wakaba;	state Exp;
branches;
next	1.33;

1.33
date	2013.07.27.06.36.55;	author wakaba;	state Exp;
branches;
next	1.32;

1.32
date	2013.07.27.06.16.55;	author wakaba;	state Exp;
branches;
next	1.31;

1.31
date	2013.07.27.06.07.30;	author wakaba;	state Exp;
branches;
next	1.30;

1.30
date	2013.07.27.05.59.58;	author wakaba;	state Exp;
branches;
next	1.29;

1.29
date	2013.07.27.05.59.47;	author wakaba;	state Exp;
branches;
next	1.28;

1.28
date	2013.07.27.05.55.59;	author wakaba;	state Exp;
branches;
next	1.27;

1.27
date	2013.07.27.05.54.29;	author wakaba;	state Exp;
branches;
next	1.26;

1.26
date	2013.07.27.05.50.51;	author wakaba;	state Exp;
branches;
next	1.25;

1.25
date	2013.07.27.05.44.02;	author wakaba;	state Exp;
branches;
next	1.24;

1.24
date	2013.07.27.05.41.02;	author wakaba;	state Exp;
branches;
next	1.23;

1.23
date	2013.07.27.05.40.32;	author wakaba;	state Exp;
branches;
next	1.22;

1.22
date	2013.07.27.05.39.19;	author wakaba;	state Exp;
branches;
next	1.21;

1.21
date	2013.07.27.05.38.45;	author wakaba;	state Exp;
branches;
next	1.20;

1.20
date	2013.07.27.05.33.44;	author wakaba;	state Exp;
branches;
next	1.19;

1.19
date	2013.07.27.05.19.40;	author wakaba;	state Exp;
branches;
next	1.18;

1.18
date	2013.03.06.23.45.50;	author wakaba;	state Exp;
branches;
next	1.17;

1.17
date	2013.02.09.13.53.12;	author wakaba;	state Exp;
branches;
next	1.16;

1.16
date	2012.12.05.15.10.05;	author wakaba;	state Exp;
branches;
next	1.15;

1.15
date	2012.07.12.14.47.24;	author wakaba;	state Exp;
branches;
next	1.14;

1.14
date	2012.01.31.23.57.48;	author wakaba;	state Exp;
branches;
next	1.13;

1.13
date	2012.01.17.23.14.38;	author wakaba;	state Exp;
branches;
next	1.12;

1.12
date	2011.08.17.23.07.42;	author wakaba;	state Exp;
branches;
next	1.11;

1.11
date	2011.02.12.01.26.11;	author wakaba;	state Exp;
branches;
next	1.10;

1.10
date	2011.01.16.04.52.06;	author wakaba;	state Exp;
branches;
next	1.9;

1.9
date	2011.01.09.04.44.52;	author wakaba;	state Exp;
branches;
next	1.8;

1.8
date	2010.09.28.22.20.15;	author wakaba;	state Exp;
branches;
next	1.7;

1.7
date	2010.09.28.22.19.25;	author wakaba;	state Exp;
branches;
next	1.6;

1.6
date	2010.01.01.03.31.44;	author wakaba;	state Exp;
branches;
next	1.5;

1.5
date	2009.09.19.03.02.19;	author wakaba;	state Exp;
branches;
next	1.4;

1.4
date	2009.08.06.14.26.15;	author wakaba;	state Exp;
branches;
next	1.3;

1.3
date	2009.03.30.23.37.00;	author wakaba;	state Exp;
branches;
next	1.2;

1.2
date	2009.02.02.02.35.29;	author wakaba;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.15.05.12.17;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.41
log
@updated by (anon)
@
text
@[45] [DFN[[CODE(DOMm)@@en[[[setTimeout()]]]]]] と [DFN[[CODE(DOMm)@@en[[[setInterval()]]]]]]
は、一定時間後、あるいは一定時間ごとに指定した処理を実行するものです。

* 仕様書

[REFS[
- [33] '''[CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2013-07-27 01:56:00 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#timers>'''
- [47] [CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2014-04-03 03:44:44 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#apis-available-to-workers>
]REFS]

* 定義

[46] [DFN[[CODE(DOMi)@@en[[[WindowTimer]]]]]] [[インターフェイス]]は、[[メソッド]]
[DFN[[CODE(DOMm)@@en[[[setTimeout]]]]]], [DFN[[CODE(DOMm)@@en[[[setInterval]]]]]],
[DFN[[CODE(DOMm)@@en[[[clearTimeout]]]]]], [DFN[[CODE(DOMm)@@en[[[clearInterval]]]]]]
を持ちます [SRC[>>33]]。 [CODE(DOMi)@@en[[[WindowTimer]]]] は [CODE(IDL)@@en[[[NoInterfaceObject]]]]
であり、 [CODE(DOMi)@@en[[[Window]]]] [SRC[>>33]] と [CODE(DOMi)@@en[[[WorkerGlobalScope]]]] [SRC[>>47]]
が[[実装]]しています。

* タイマー設定メソッド

[48] [CODE(DOMm)@@en[[[setTimeout]]]] と [CODE(DOMm)@@en[[[setInterval]]]] は、
1つ以上の[[引数]]が必要です [SRC[>>33]]。いずれも[[タイマー初期化手順]]を実行するものです [SRC[>>33]]。

[49] 第1引数は、一定時間後に実行されるべきコードを指定します。[[データ型]]は
[CODE(DOMi)@@en[[[Function]]]] または [CODE(DOMi)@@en[[[DOMString]]]] です [SRC[>>33]]。

[50] 第2引数は、コードが実行されるまでの時間です。[[データ型]]は [CODE(IDL)@@en[[[long]]]]
で、省略した場合の[[既定値]]は [CODE[[[0]]]] です [SRC[>>33]]。

[51] 第3引数以降は、任意の値を指定でき [SRC[>>33]]、コードへの[[引数]]として使われます。

[52] [[メソッド]]の返り値は、 [CODE(IDL)@@en[[[long]]]] です [SRC[>>33]]。

* タイマー消去メソッド

[53] [CODE(DOMm)@@en[[[clearTimeout]]]] と [CODE(DOMm)@@en[[[clearInterval]]]]
には [[long]] の[[引数]]を1つ指定できます [SRC[>>33]]。省略した場合の[[既定値]]は
[CODE[[[0]]]] です [SRC[>>33]]。

[54] [[メソッド]]の返り値はありません [SRC[>>33]]。

[57] いずれも、[[活性タイマーのリスト]]から[[引数]]で指定された[[数]]により識別される項目があれば、
これを消去します。該当するものがなければ、何もしません。 [SRC[>>33]]

;; [58] どちらのメソッドも、同じように動作します。 [VAR@@en[repeat]] フラグは無視されます。

* 待ち時間

[87] 与えられたコードは、 >>66、>>72、>>32 を待った後、実行されます。

[66] 基本となる待ち時間は、第2引数で指定された値です。ただしその値が4より小さく、
[[タイマー入れ子水準]] (なければ0) が5より大きいなら、4とします。 [SRC[>>33]]

[75] [DFN[[RUBYB[[[タイマー入れ子水準]]]@@en[timer nesting level]]]] [SRC[>>33]] は、
入れ子回数の管理のための値です。[[タイマー初期化手順]]により追加された[[タスク]]に存在します。
追加された[[タスク]]の[[タイマー入れ子水準]]は、元の[[タスク]]の[[タイマー入れ子水準]]よりも1大きな値です [SRCD[>>33]]。

;; [31] 元々は最小でも 10ms とされていましたが、後に実装によっては最小 4ms となり、 >>27
で仕様もそれに揃いました。更に入れ子回数 (タイマーによる処理によって更にタイマー処理を予定した回数)
が4回までは 4ms の制限すらも撤廃されるようになり、仕様も  >>24 で追随しています。

[70] [[文脈オブジェクト]]が [CODE(DOMi)@@en[[[Window]]]] なら、
関連付けられている[[文書]]が[[完全に活性]]な状態の[[ミリ秒]]数として解釈されます [SRC[>>33]]。

[71] [[文脈オブジェクト]]が [CODE(DOMi)@@en[[[WorkerGlobalScope]]]] なら、[[ワーカー]]が [[suspend]]
されていない状態の[[ミリ秒]]数として解釈されます [SRC[>>33]]。

;; [86] いずれも、連続的な秒数ではなく、合計の秒数です。

[72] 同じ[[文脈オブジェクト]]について[[タイマー初期化手順]]が何度も呼ばれている場合、
呼び出しのタイミングがより早く、待ち時間 (>>66) が等しいか小さいものが実行完了 ([[タスク]]が追加完了)
されるまで、待つことになっています [SRC[>>33]]。

[32] [[利用者エージェント]]は更に加えて任意の時間待っても構いません [SRC[>>33]]。
[[電力]]等利用できる資源の制約や性能上の限界その他の要因により処理を遅らせることができます。

* 活性タイマーのリスト

[55] [CODE(DOMi)@@en[[[WindowTimer]]]] [[オブジェクト]] ([CODE(DOMi)@@en[[[Window]]]] や
[CODE(DOMi)@@en[[[WorkerGlobalScope]]]]) は[DFN[[RUBYB[[[活性タイマーのリスト]]]@@en[list of active timers]]]]を持ちます
[SRC[>>33]]。[[活性タイマーのリスト]]には、 [CODE(DOMm)@@en[[[setTimeout]]]] や
[CODE(DOMm)@@en[[[setInterval]]]] で指定された[[タイマー]]が含まれます。

[60] [[活性タイマーのリスト]]内の各項目は、[[非負整数]]により識別されます [SRC[>>33]]。
この[[非負整数]]は[[ハンドル]]と呼ばれています。

[88] [[ハンドル]]は、 [CODE(DOMi)@@en[[[WindowTimer]]]] 
[[オブジェクト]]の生存期間内において固有でなければ[['''なりません''']] [SRC[>>33]]。

;; [56] ということは [CODE(IDL)@@en[[[long]]]] で表せる[[数]]の回数以上はタイマーを使えないことになります。

[89] [[ハンドル]]は[[タイマー初期化手順]]の実行時 ([CODE(DOMm)@@en[[[setInterval]]]] の場合は、初回のみ)
に[[利用者エージェント]]定義の方法で決定されます [SRC[>>33]]。
[[タイマー初期化手順]]はこの[[ハンドル]]を使って[[活性タイマーのリスト]]に新しい項目を追加し、
その[[ハンドル]]を返します [SRC[>>33]]。

* タイマーの実行

[59] [DFN[[RUBYB[タイマー初期化手順]@@en[timer initialization steps]]]]は、
ハンドル (>>60) を返し、[[非同期的]]に待って (>>87) から、タイマー[[タスク]] (>>77)
を[[タスクキュー]]に追加するものです [SRC[>>33]]。

[77] タイマー[[タスク]]は次のようなものです [SRC[>>33]]。
[[タスク源]]は[DFN[[RUBYB[[[タイマータスク源]]]@@en[timer task source]]]]です [SRC[>>33]]。
[FIG[
= [63] 本タイマー項目が[[活性タイマーのリスト]]から既に消去されていれば、何もしません。
= [78] 第1引数が [CODE(JS)@@en[[[Function]]]] の場合、これを呼び出します。
-- [79] [CODE(JS)@@en[[[thisArg]]]] は[[文脈オブジェクト]]を使います。ただし [CODE(DOMi)@@en[[[Window]]]]
であれば、対応する [CODE(DOMi)@@en[[[WindowProxy]]]] を使います。
= [80] 第1引数が [CODE(DOMi)@@en[[[DOMString]]]] の場合、[[スクリプトを作成]]します。
-- [81] スクリプト源は指定された [CODE(DOMi)@@en[[[DOMString]]]] とします。
-- [82] [[スクリプト言語]]は [[JavaScript]] とします。
-- [83] [[設定オブジェクト]]は[[文脈オブジェクト]]の[[スクリプト設定群オブジェクト]]とします。
= [65] [CODE(DOMm)@@en[[[setInterval]]]] だった場合は、[[タイマー初期化手順]]を呼び出します。
]FIG]

;; [84] [[スクリプトの作成]]の手順は、[[スクリプト]]を作って実行します。

;; [85] [CODE(DOMm)@@en[[[setInterval]]]] の場合、毎回[[スクリプト]]のコンパイルから行われることになります。

* 歴史

[2]
[CITE[IRC logs: freenode / #whatwg / 20070409]] ([CODE[2007-04-12 00:04:42 +09:00]] 版) <http://krijnhoetmer.nl/irc-logs/whatwg/20070409#l-233>
([[名無しさん]] [WEAK[2007-04-11 15:37:28 +00:00]])

[6]
[CITE@@en[Re: Proposal: High resolution (and otherwise improved) timer API]] ([[Maciej Stachowiak]] 著, [CODE[2008-10-04 06:21:35 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-webapps/2008OctDec/0031.html>

>I cannot state with certainty that nothing lower than  
10ms is safe. Chrome shipped with a 1ms delay and that was found to  
create problems on a number of sites, including nytimes. They are  
planning to try 4ms next. We would consider using a lower limit in the  
official webkit.org version of WebKit, not not as low as 1ms.

[9] [CITE[IRC logs: freenode / #whatwg / 20090504]]
([TIME[2009-08-05 07:43:45 +09:00]] 版)
<http://krijnhoetmer.nl/irc-logs/whatwg/20090504#l-24>

[10] [CITE['''['''webkit-dev''']''' setTimeout as browser speed throttle]]
([TIME[2008-10-01 15:56:01 +09:00]] 版)
<http://lists.macosforge.org/pipermail/webkit-dev/2008-September/005093.html>

[12] [CITE@@en[Web Applications 1.0 r5535     Allow timers to be delayed when power usage is an issue.Fixing http://www.w3.org/Bugs/Public/show_bug.cgi?id=10633]]
( ([TIME[2010-09-29 07:08:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5534&to=5535>

[13] [CITE[Bug 10633 – Minimums for timer granularity should be left to the user agent - different form factors have different power requirements]]
( ([TIME[2010-09-29 07:19:30 +09:00]] 版))
<http://www.w3.org/Bugs/Public/show_bug.cgi?id=10633>

[14] [CITE[''''''[''''''whatwg'''''']'''''' Timeouts and monotonic vs clock time]]
( ([TIME[2011-01-09 13:44:38 +09:00]] 版))
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-January/029734.html>

[15] [CITE['''['''whatwg''']''' setTimeout clamps]]
([TIME[2011-01-16 12:00:52 +09:00]] 版)
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-January/029886.html>

[16] [CITE@@en[Web Applications 1.0 r5879     Define 'this' for setTimeout functions]]
( ([TIME[2011-02-12 08:50:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5878&to=5879>

[17] [CITE@@en[Web Applications 1.0 r6492 Explain ordering of setTimeout() calls better]]
( ([TIME[2011-08-18 06:36:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6491&to=6492>

[18] [CITE@@en[Web Applications 1.0 r6899     Make setTimeout() not be well-ordered across multiple browsing contexts, so as to allow user agents to e.g. throttle setTimeout()s in background tabs.]]
( ([TIME[2012-01-18 07:13:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6898&to=6899>

[19] [CITE@@en[Web Applications 1.0 r6949     Turns out clearTimeout() and clearInterval() are synonyms! Who knew? Oh what a tangled Web we weave.Fixing https://www.w3.org/Bugs/Public/show_bug.cgi?id=14907]]
( ([TIME[2012-02-01 05:20:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6948&to=6949>

[20] [CITE[IRC logs: freenode / #whatwg / 20120626]]
( ([TIME[2012-07-12 23:44:39 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20120626#l-1008>

[21] [CITE@@en-US[Window Object 1.0]]
( ([TIME[2006-04-08 02:19:28 +09:00]] 版))
<http://www.w3.org/TR/Window/#timers>

[22] [CITE@@en[Bug 15007 – Add an API to queue a task]]
( ([TIME[2013-02-09 22:45:48 +09:00]] 版))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=15007>

[23] [CITE@@en[Web Applications 1.0 r7737     Try to more closely match reality.]]
( ([TIME[2013-03-07 08:03:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7736&to=7737>

[24] [CITE@@en[Web Applications 1.0 r8095     Refactor the timer code to match current practice in WebKit, Gecko, and Blink (the ones whose source I could examine)]]
( ([TIME[2013-07-27 08:27:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8094&to=8095>

[25] [CITE[Bug 376643 &#8211; setInterval fires repeatedly with incorrectly small delays if machine is suspend/resumed, hibernate/resumed or process is SIGSTOP/SIGCONT]] ([CODE[2007-06-23 10:13:26 +09:00]] 版) <https://bugzilla.mozilla.org/show_bug.cgi?id=376643>

[26] [CITE[HTML5 IRC logs: freenode / #whatwg / 20070622]] ([TIME[2007-06-23 10:17:05 +09:00]] 版) <http://krijnhoetmer.nl/irc-logs/whatwg/20070622#l-608>
([[名無しさん]] [WEAK[2007-06-23 01:21:49 +00:00]])

[27] [CITE@@en[Web Applications 1.0 r6362     Make setInterval() clamp at 4ms as well.]]
( ([TIME[2011-08-04 08:54:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6361&to=6362>

[34] [CITE@@en[Efficient Script Yielding]] ([TIME[2013-07-23 11:06:32 +09:00]] 版) <http://w3c-test.org/webperf/specs/setImmediate/>

* メモ

[1]
[CITE[Scope of setTimeout Method]] <http://www2u.biglobe.ne.jp/~oz-07ams/prog/js-notes/setTimeout.html>

[7] [CITE[for 文を setTimeout に変換する - IT戦記]] ([TIME[2009-02-02 01:57:56 +09:00]] 版) <http://d.hatena.ne.jp/amachang/20071108/1194501306>

[8]
[CITE[JSDeferred を高速化する (試し中) - 冬通りに消え行く制服ガールは、夢物語にリアルを求めない。 - subtech]] ([TIME[2009-03-31 08:34:10 +09:00]] 版) <http://subtech.g.hatena.ne.jp/cho45/20090125/1232831437>

[28] [CITE[zarame.com/zide/ 日記(2005-11-24)]] <http://zarame.com/zide/diary/20051124.html#p01>
([[名無しさん]] [WEAK[2005-12-07 11:45:55 +00:00]])

[29] [CITE[ぷろじぇくと、みすじら。]] <http://www.fastwave.gr.jp/diarysrv/misuzilla/200511c.html#20051126-4>
([[名無しさん]] [WEAK[2005-12-07 11:46:42 +00:00]])

[30] [CITE[zarame.com/zide/ 日記(2005-11-28)]] <http://zarame.com/zide/diary/20051128.html#p01>
([[名無しさん]] [WEAK[2005-12-07 11:46:56 +00:00]])

[35] [CITE[setIntervalとsetTimeoutを調べた結果余分なことになった - 三等兵]]
( ([TIME[2013-07-24 01:30:24 +09:00]] 版))
<http://d.hatena.ne.jp/sandai/20100513/p1>

[36] [CITE@@en-US[window.setTimeout - Web API reference | MDN]]
( ([TIME[2013-07-10 02:55:41 +09:00]] 版))
<https://developer.mozilla.org/en/docs/Web/API/window.setTimeout>

[37] [CITE[Issue 792 - chromium - TRACKING: Chrome does not implement the Webkit 10ms setTimeout clamp. - An open-source project to help move the web forward. - Google Project Hosting]]
( ([TIME[2013-07-27 05:59:41 +09:00]] 版))
<https://code.google.com/p/chromium/issues/detail?id=792>

[38] [CITE@@en-US[David Baron's weblog: setTimeout with a shorter delay]]
( ([TIME[2013-07-27 05:59:54 +09:00]] 版))
<http://dbaron.org/log/20100309-faster-timeouts>

[39] [CITE@@en[123273 – setTimeout(something, 0) causes 100% CPU constant]]
( ([TIME[2013-07-27 06:07:25 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=123273>

[40] [CITE@@en[686201 – implementation: setImmediate API]]
( ([TIME[2013-07-27 06:16:49 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=686201>

[41] [CITE@@en[839816 – Make next-tick mechanisms like postMessage faster]]
( ([TIME[2013-07-27 06:36:50 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=839816>

[42] [CITE[''''''[''''''whatwg'''''']'''''' Proposal: requestBackgroundProcessing()]]
( ([TIME[2014-02-20 21:38:44 +09:00]] 版))
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2014-February/042075.html>

[43] [CITE@@en[Web Applications 1.0 r8535 Move a setTimeout() requirement from prose to IDL.]]
( ([TIME[2014-03-08 07:55:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8534&to=8535>

[44] [CITE@@en[Web Applications 1.0 r8508     Make clearTimeout()/clearInterval() (with no arguments) into no-ops; change the <table> role mapping so that tables aren't interactive.]]
( ([TIME[2014-02-25 03:44:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8507&to=8508>@


1.40
log
@updated by (anon)
@
text
@d48 30
a83 3
[[活性タイマーのリスト]]内の各項目は、[[非負整数]]により識別されます [SRC[>>33]]。
この[[数]]は、 [CODE(DOMi)@@en[[[WindowTimer]]]] [[オブジェクト]]の生存期間内において固有でなければ[['''なりません''']]
[SRC[>>33]]。
d85 2
a86 1
;; [56] ということは [CODE(IDL)@@en[[[long]]]] で表せる[[数]]の回数以上はタイマーを使えないことになります。
d88 2
a89 1
* タイマー初期化手順
d91 1
a91 18
[59] [DFN[[RUBYB[タイマー初期化手順]@@en[timer initialization steps]]]]には、次のような内容が含まれています [SRC[>>33]]。
[FIG[
= [66] [VAR@@en[timeout]] を第2引数の値とします。
= [67] 現在実行中の[[タスク]]の[[タイマー入れ子水準]] (なければ 0) が5より大きく、 [VAR@@en[timeout]]
が4より小さいなら、 [VAR@@en[timeout]] を4にします。
= [60] >>65 からの呼び出しでないなら、[[利用者エージェント]]定義の[[非負整数]]を識別子とする項目を[[活性タイマーのリスト]]に追加し、その[[非負整数]]を返します。
= [68] 同期的に実行するのはここまでで、この続きは[[非同期的]]に継続します。次の時間、待ちます。
== [70] [[文脈オブジェクト]]が [CODE(DOMi)@@en[[[Window]]]] なら、関連付けられている[[文書]]が[[完全に活性]]な状態を
[VAR@@en[timeout]] [[ミリ秒]] (連続的でなくても構いません)。
== [71] [[文脈オブジェクト]]が [CODE(DOMi)@@en[[[WorkerGlobalScope]]]] なら、[[ワーカー]]が [[suspend]]
されていない状態を [VAR@@en[timeout]] [[ミリ秒]] (連続的でなくても構いません)。
== [72] 同じ[[文脈オブジェクト]]で実行された[[タイマー初期化手順]]で、本呼び出しより前に呼び出されたもので、
[VAR@@en[timeout]] が本呼び出し[[以下]]のものが完了するまで。
== [73] [[利用者エージェント]]定義の時間。
= [74] タイマー[[タスク]] (>>77) を[[キュー]]に追加します。
=- [86] [[タスク源]]は[[タイマータスク源]]とします。
=- [62] [[タイマー入れ子水準]]は元の[[タイマー入れ子水準]] (なければ 0) + 1 とします。
]FIG]
d93 10
a102 2
[76] [DFN[[RUBYB[[[タイマータスク源]]]@@en[timer task source]]]] [SRC[>>33]] は、
[CODE(DOMm)@@en[[[setTimeout]]]] と [CODE(DOMm)@@en[[[setInterval]]]] により追加される[[タスク]]で使われる[[タスク源]]です。
d105 1
a121 12
* タイマーの精度

[31] 元々は最小でも 10ms とされていましたが、後に実装によっては最小 4ms となり、 >>27
で仕様もそれに揃いました。更に入れ子回数 (タイマーによる処理によって更にタイマー処理を予定した回数)
が4回までは 4ms の制限すらも撤廃されるようになり、仕様も  >>24 で追随しています。

[32] なお、いずれにせよ、[[利用者エージェント]]は指定された時間に厳密に従う必要はなく、
利用できる資源の制約や性能上の限界その他の要因により前後する可能性があります。

[75] [DFN[[RUBYB[[[タイマー入れ子水準]]]@@en[timer nesting level]]]] [SRC[>>33]] は、
この入れ子回数の管理のための値です。[[タイマー初期化手順]]により追加された[[タスク]]に存在します。

@


1.39
log
@updated by (anon)
@
text
@a63 7
= [60] [VAR@@en[handle]] は、 >>65 からの呼び出しならもとの [VAR@@en[handle]]、
そうでなければ[[利用者エージェント]]定義の[[非負整数]]とします。
後者の場合は、 [VAR@@en[handle]] を識別子とする項目を[[活性タイマーのリスト]]に追加します。
= [61] 次のような[[タスク]]を用意します。
-= [63] 本項目が[[活性タイマーのリスト]]から既に消去されていれば、何もしません。
-= [64] 指定されたコードを実行します (>>77)。
-= [65] [CODE(DOMm)@@en[[[setInterval]]]] だった場合は、[[タイマー初期化手順]]を呼び出します。
d67 2
a68 4
= [62] >>61 の[[タスク]]の[[タイマー入れ子水準]]を現在実行中の[[タスク]]の[[タイマー入れ子水準]] (なければ 0) + 1
とします。
= [68] [VAR@@en[handle]] を返します。この続きは[[非同期的]]に継続します。
= [69] 待ちます。
d76 3
a78 1
= [74] >>61 の[[タスク]]を[[キュー]]に追加します。[[タスク源]]は[[タイマータスク源]]とします。
d84 1
a84 1
[77] 指定されたコードは次のように実行されます [SRC[>>33]]。
d86 2
a87 1
- [78] [CODE(JS)@@en[[[Function]]]] の場合、これを呼び出します。
d90 1
a90 1
- [80] [CODE(DOMi)@@en[[[DOMString]]]] の場合、[[スクリプトを作成]]します。
d94 1
@


1.38
log
@updated by (anon)
@
text
@d23 1
a23 2
1つ以上の[[引数]]が必要です [SRC[>>33]]。いずれも[[タイマー初期化手順]]を実行するものですが、
[VAR@@en[repeat]] フラグが前者は[[偽]]、後者は[[真]]となります [SRC[>>33]]。
d54 1
a54 1
[[活性タイマーのリスト]]内の各項目は、[[数]]により識別されます [SRC[>>33]]。
d60 46
d115 3
@


1.37
log
@updated by (anon)
@
text
@d23 2
a24 1
1つ以上の[[引数]]が必要です [SRC[>>33]]。
d44 17
@


1.36
log
@updated by (anon)
@
text
@d1 3
d7 2
a8 1
- [33] [CITE@@en-US-x-hixie[HTML Standard]] ([TIME[2013-07-27 01:56:00 +09:00]] 版) <http://www.whatwg.org/specs/web-apps/current-work/#timers>
d11 32
d155 40
a194 40
([[名無しさん]] [WEAK[2005-12-07 11:46:56 +00:00]])

[35] [CITE[setIntervalとsetTimeoutを調べた結果余分なことになった - 三等兵]]
( ([TIME[2013-07-24 01:30:24 +09:00]] 版))
<http://d.hatena.ne.jp/sandai/20100513/p1>

[36] [CITE@@en-US[window.setTimeout - Web API reference | MDN]]
( ([TIME[2013-07-10 02:55:41 +09:00]] 版))
<https://developer.mozilla.org/en/docs/Web/API/window.setTimeout>

[37] [CITE[Issue 792 - chromium - TRACKING: Chrome does not implement the Webkit 10ms setTimeout clamp. - An open-source project to help move the web forward. - Google Project Hosting]]
( ([TIME[2013-07-27 05:59:41 +09:00]] 版))
<https://code.google.com/p/chromium/issues/detail?id=792>

[38] [CITE@@en-US[David Baron's weblog: setTimeout with a shorter delay]]
( ([TIME[2013-07-27 05:59:54 +09:00]] 版))
<http://dbaron.org/log/20100309-faster-timeouts>

[39] [CITE@@en[123273 – setTimeout(something, 0) causes 100% CPU constant]]
( ([TIME[2013-07-27 06:07:25 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=123273>

[40] [CITE@@en[686201 – implementation: setImmediate API]]
( ([TIME[2013-07-27 06:16:49 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=686201>

[41] [CITE@@en[839816 – Make next-tick mechanisms like postMessage faster]]
( ([TIME[2013-07-27 06:36:50 +09:00]] 版))
<https://bugzilla.mozilla.org/show_bug.cgi?id=839816>

[42] [CITE[''''''[''''''whatwg'''''']'''''' Proposal: requestBackgroundProcessing()]]
( ([TIME[2014-02-20 21:38:44 +09:00]] 版))
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2014-February/042075.html>

[43] [CITE@@en[Web Applications 1.0 r8535 Move a setTimeout() requirement from prose to IDL.]]
( ([TIME[2014-03-08 07:55:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8534&to=8535>

[44] [CITE@@en[Web Applications 1.0 r8508     Make clearTimeout()/clearInterval() (with no arguments) into no-ops; change the <table> role mapping so that tables aren't interactive.]]
( ([TIME[2014-02-25 03:44:00 +09:00]] 版))
@


1.35
log
@updated by (anon)
@
text
@d155 5
a159 1
<http://html5.org/tools/web-apps-tracker?from=8534&to=8535>@


1.34
log
@updated by (anon)
@
text
@d151 5
a155 1
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2014-February/042075.html>@


1.33
log
@updated by (anon)
@
text
@d147 5
a151 1
<https://bugzilla.mozilla.org/show_bug.cgi?id=839816>@


1.32
log
@updated by (anon)
@
text
@d143 5
a147 1
<https://bugzilla.mozilla.org/show_bug.cgi?id=686201>@


1.31
log
@updated by (anon)
@
text
@d139 5
a143 1
<https://bugzilla.mozilla.org/show_bug.cgi?id=123273>@


1.30
log
@updated by (anon)
@
text
@d135 5
a139 1
<http://dbaron.org/log/20100309-faster-timeouts>@


1.29
log
@updated by (anon)
@
text
@d131 5
a135 1
<https://code.google.com/p/chromium/issues/detail?id=792>@


1.28
log
@updated by (anon)
@
text
@d127 5
a131 1
<https://developer.mozilla.org/en/docs/Web/API/window.setTimeout>@


1.27
log
@updated by (anon)
@
text
@d123 5
a127 1
<http://d.hatena.ne.jp/sandai/20100513/p1>@


1.26
log
@updated by (anon)
@
text
@d119 5
a123 1
([[名無しさん]] [WEAK[2005-12-07 11:46:56 +00:00]])@


1.25
log
@updated by (anon)
@
text
@d25 6
a38 4
[11] [CITE@@en[Web Timing]]
([TIME[2009-10-06 09:31:48 +09:00]] 版)
<http://dev.w3.org/2006/webapi/WebTiming/>

@


1.24
log
@updated by (anon)
@
text
@d98 2
@


1.23
log
@updated by (anon)
@
text
@a97 2
[34] [CITE@@en[Navigation Timing]] ([TIME[2013-07-27 05:40:13 +09:00]] 版) <https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/NavigationTiming/Overview.html>

@


1.22
log
@updated by (anon)
@
text
@d98 2
@


1.21
log
@updated by (anon)
@
text
@d1 5
d115 1
a115 1
([[名無しさん]] [WEAK[2005-12-07 11:46:56 +00:00]])
@


1.20
log
@updated by (anon)
@
text
@d2 9
@


1.19
log
@updated by (anon)
@
text
@d2 1
a2 3
[1]
[CITE[Scope of setTimeout Method]] <http://www2u.biglobe.ne.jp/~oz-07ams/prog/js-notes/setTimeout.html>
([[名無しさん]])
d11 78
d92 10
a101 65
[CITE[JSDeferred を高速化する (試し中) - 冬通りに消え行く制服ガールは、夢物語にリアルを求めない。 - subtech]] ([TIME[2009-03-31 08:34:10 +09:00]] 版) <http://subtech.g.hatena.ne.jp/cho45/20090125/1232831437>

[9] [CITE[IRC logs: freenode / #whatwg / 20090504]]
([TIME[2009-08-05 07:43:45 +09:00]] 版)
<http://krijnhoetmer.nl/irc-logs/whatwg/20090504#l-24>

[10] [CITE['''['''webkit-dev''']''' setTimeout as browser speed throttle]]
([TIME[2008-10-01 15:56:01 +09:00]] 版)
<http://lists.macosforge.org/pipermail/webkit-dev/2008-September/005093.html>

[11] [CITE@@en[Web Timing]]
([TIME[2009-10-06 09:31:48 +09:00]] 版)
<http://dev.w3.org/2006/webapi/WebTiming/>

[12] [CITE@@en[Web Applications 1.0 r5535     Allow timers to be delayed when power usage is an issue.Fixing http://www.w3.org/Bugs/Public/show_bug.cgi?id=10633]]
( ([TIME[2010-09-29 07:08:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5534&to=5535>

[13] [CITE[Bug 10633 – Minimums for timer granularity should be left to the user agent - different form factors have different power requirements]]
( ([TIME[2010-09-29 07:19:30 +09:00]] 版))
<http://www.w3.org/Bugs/Public/show_bug.cgi?id=10633>

[14] [CITE[''''''[''''''whatwg'''''']'''''' Timeouts and monotonic vs clock time]]
( ([TIME[2011-01-09 13:44:38 +09:00]] 版))
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-January/029734.html>

[15] [CITE['''['''whatwg''']''' setTimeout clamps]]
([TIME[2011-01-16 12:00:52 +09:00]] 版)
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-January/029886.html>

[16] [CITE@@en[Web Applications 1.0 r5879     Define 'this' for setTimeout functions]]
( ([TIME[2011-02-12 08:50:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=5878&to=5879>

[17] [CITE@@en[Web Applications 1.0 r6492 Explain ordering of setTimeout() calls better]]
( ([TIME[2011-08-18 06:36:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6491&to=6492>

[18] [CITE@@en[Web Applications 1.0 r6899     Make setTimeout() not be well-ordered across multiple browsing contexts, so as to allow user agents to e.g. throttle setTimeout()s in background tabs.]]
( ([TIME[2012-01-18 07:13:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6898&to=6899>

[19] [CITE@@en[Web Applications 1.0 r6949     Turns out clearTimeout() and clearInterval() are synonyms! Who knew? Oh what a tangled Web we weave.Fixing https://www.w3.org/Bugs/Public/show_bug.cgi?id=14907]]
( ([TIME[2012-02-01 05:20:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=6948&to=6949>

[20] [CITE[IRC logs: freenode / #whatwg / 20120626]]
( ([TIME[2012-07-12 23:44:39 +09:00]] 版))
<http://krijnhoetmer.nl/irc-logs/whatwg/20120626#l-1008>

[21] [CITE@@en-US[Window Object 1.0]]
( ([TIME[2006-04-08 02:19:28 +09:00]] 版))
<http://www.w3.org/TR/Window/#timers>

[22] [CITE@@en[Bug 15007 – Add an API to queue a task]]
( ([TIME[2013-02-09 22:45:48 +09:00]] 版))
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=15007>

[23] [CITE@@en[Web Applications 1.0 r7737     Try to more closely match reality.]]
( ([TIME[2013-03-07 08:03:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=7736&to=7737>

[24] [CITE@@en[Web Applications 1.0 r8095     Refactor the timer code to match current practice in WebKit, Gecko, and Blink (the ones whose source I could examine)]]
( ([TIME[2013-07-27 08:27:00 +09:00]] 版))
<http://html5.org/tools/web-apps-tracker?from=8094&to=8095>@


1.18
log
@updated by (anon)
@
text
@d76 5
a80 1
<http://html5.org/tools/web-apps-tracker?from=7736&to=7737>@


1.17
log
@updated by (anon)
@
text
@d72 5
a76 1
<https://www.w3.org/Bugs/Public/show_bug.cgi?id=15007>@


1.16
log
@updated by (anon)
@
text
@d68 5
a72 1
<http://www.w3.org/TR/Window/#timers>@


1.15
log
@updated by (anon)
@
text
@d64 5
a68 1
<http://krijnhoetmer.nl/irc-logs/whatwg/20120626#l-1008>@


1.14
log
@updated by (anon)
@
text
@d60 5
a64 1
<http://html5.org/tools/web-apps-tracker?from=6948&to=6949>@


1.13
log
@updated by (anon)
@
text
@d56 5
a60 1
<http://html5.org/tools/web-apps-tracker?from=6898&to=6899>@


1.12
log
@updated by (anon)
@
text
@d52 5
a56 1
<http://html5.org/tools/web-apps-tracker?from=6491&to=6492>@


1.11
log
@updated by (anon)
@
text
@d48 5
a52 1
<http://html5.org/tools/web-apps-tracker?from=5878&to=5879>@


1.10
log
@updated by (anon)
@
text
@d44 5
a48 1
<http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-January/029886.html>@


1.9
log
@updated by (anon)
@
text
@d40 5
a44 1
<http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-January/029734.html>@


1.8
log
@updated by (anon)
@
text
@d36 5
a40 1
<http://www.w3.org/Bugs/Public/show_bug.cgi?id=10633>@


1.7
log
@updated by (anon)
@
text
@d32 5
a36 1
<http://html5.org/tools/web-apps-tracker?from=5534&to=5535>@


1.6
log
@updated by (anon)
@
text
@d28 5
a32 1
<http://dev.w3.org/2006/webapi/WebTiming/>@


1.5
log
@updated by (anon)
@
text
@d24 5
a28 1
<http://lists.macosforge.org/pipermail/webkit-dev/2008-September/005093.html>@


1.4
log
@updated by (anon)
@
text
@d20 5
a24 1
<http://krijnhoetmer.nl/irc-logs/whatwg/20090504#l-24>@


1.3
log
@updated by (anon)
@
text
@d16 5
a20 1
[CITE[JSDeferred を高速化する (試し中) - 冬通りに消え行く制服ガールは、夢物語にリアルを求めない。 - subtech]] ([TIME[2009-03-31 08:34:10 +09:00]] 版) <http://subtech.g.hatena.ne.jp/cho45/20090125/1232831437>@


1.2
log
@updated by (anon)
@
text
@d15 2
@


1.1
log
@converted from SuikaWiki3 <http://suika.fam.cx/gate/cvs/suikawiki/wikidata/page/73657454696D656F7574.txt>
@
text
@d1 14
a14 30

[1]
[CITE[Scope of setTimeout Method]] <http://www2u.biglobe.ne.jp/~oz-07ams/prog/js-notes/setTimeout.html>
([[名無しさん]])

[2]
[CITE[IRC logs: freenode / #whatwg / 20070409]] ([CODE[2007-04-12 00:04:42 +09:00]] 版) <http://krijnhoetmer.nl/irc-logs/whatwg/20070409#l-233>
([[名無しさん]] [WEAK[2007-04-11 15:37:28 +00:00]])

[3]
Shiit is happened!(c)Forrest Gump
([[Sector]] [gaz@@pisem.net])

[4]
Shiit is happened!(c)Forrest Gump
([[Sector]] [gaz@@pisem.net])

[5]
http://vremena.freehoxt.com vremena
([[Kramfw]] [polawwq@@serimx.com])

[6]
[CITE@@en[Re: Proposal: High resolution (and otherwise improved) timer API]] ([[Maciej Stachowiak]] 著, [CODE[2008-10-04 06:21:35 +09:00]] 版) <http://lists.w3.org/Archives/Public/public-webapps/2008OctDec/0031.html>
([[名無しさん]])


[7]
[url=http://metal40.007sites.com/nylon-links/footsiebabes-preview.html]footsiebabes preview[/url]   [url=http://sizo41.007sites.com/footsiebabes-members/catfight-message.html]catfight message[/url]   [url=http://sizo41.007sites.com/footsiebabes-members/nylon-camisole.html]nylon camisole[/url]   [url=http://interes39.007sites.com/lady-hathaway-camisole/tan-nylons.html]tan nylons[/url]   [url=http://bedola40.007sites.com/cartoon-catfights/only-hearts-camisoles.html]only hearts camisoles[/url]   
([[Zapa]] [sushi@@gmail.com])

@

