head	1.1;
access;
symbols
	suika-20100509:1.1
	before-graph-20090923:1.1;
locks; strict;
comment	@# @;
expand	@b@;


1.1
date	2008.11.12.13.02.39;	author wakaba;	state Exp;
branches;
next	;


desc
@@


1.1
log
@converted from SuikaWiki3 <http://suika.fam.cx/gate/cvs/suikawiki/wikidata/page/5375696B6157696B6933.ns/A5E1A5E2.ns/323030352D30372D3231.txt>
@
text
@[1]  
いまの SuikaWiki3 の中核部分の仕様をまとめてみたわけだが・・・。
やっぱ全部作り直しか?

[PRE[
Interface SW3Implementation

  The objects implementing this interface also implement the SW3EventTarget
  interface.
  
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Implementation.pm?rev=1.17>
  
  Methods
  
    initVariables
    
      Initializes per-session variables.  This method should
      be called before any other init* methods are called.
      This method does:
        - close opened SW3Input objects if any,
        - clears $obj->{var} hash and
        - raises a "setting_initial_variables" event
      ... in this order.

    initPlugin
    
      Loads the WikiPlugin manager.  This method sets
      the WikiPlugin manager to the $obj->{plugin} and then
      raises a "plugin_manager_loaded" event.

    initView
      
      Loads the WikiView manager.  This method sets
      the WikiView manager to the $obj->{view} and then
      raises a "view_implementation_loaded" event.

    initDB
    
      Loads the WikiDatabase.  This method does:
        - set the default locking configuration option if not,
        - set the $obj->{db} new "SuikaWiki::DB::Logical" instance and
        - raise a "database_loaded" event
      ... in this order.  Note that if the database is already loaded
      this method does nothing.
    
    viewInMode
    
      Raises a "view_in_mode" event with "argv" parameter set to 
      reference to named parameters (hash) passed to this method.
      It is intended to do the "main" process.
      
      Parameters
      
        (named parameters)
          A hash reference containing these parameters are
          passed to the event raised by this method.

    uriReference
    
      Returns a URI reference that identifies one of resource
      part of this wiki.  How the URI references are computed 
      is implementation dependent.
          The $obj->{input} value should be set before any call to
      this method, or the result is unspecified.
      
      Parameters
      
        anchorNo of type unsigned-long, named
          Numeral anchor index which identifies a subresource
          or "null".
        base of type DOMString, named
          The base URI reference.  If the value is the string "1",
          it is taken from the $obj->{input}.  If the value is the
          null, then no base URI is assumed.
        fragment of type DOMString, named
          The "fragment" part of the URI reference to be generated.
          It must be percent-encoded if necessary so that it is a legal
          fragment identifier.
              If "anchorNo" parameter is set to non-null value, 
          then this parameter is ignored.  Otherwise, this parameter
          value is used unless it is null.
        mode of type DOMString, named
          The WikiView mode name identified by the URI reference
          generated by this method.  If this parameter is set to null, "default"
          is assumed.
        page of type SW3Name, named
          The WikiName of the resource identified by the URI reference
          generated by this method.  If this parameter is set to null,
          an implementation dependent default resource is selected.
        param of type hash, named
          Additional URI query parameters.  Name and value pairs
          in the hash are percent-encoded if necessary and then
          used to compose a URI reference.  Note that the Perl hash
          does not preserve the order of pairs nor does allow
          the dupulication of the names.  Note also that some of name and value
          pairs in the hash might be discarded if appropriate.
          The value may be a null.
        upToDate of type boolean, named
          Requests the generation of a "up-to-date" URI reference
          for the purpose of cheating caches.
        wikiURI of type DOMString, named
          A URI reference of the wiki, which is used as a basis to compose
          the URI reference of a particular resource.  If this parameter
          set the null, implementation dependent default is in use.
        withLM of type boolean, named
          Requests the generation of a "this version" URI reference.
      
      Return Value
      
        URI               An instance of the Perl URI class whose
                          value is an absolute URI reference,
                          if the context where this method is called
                          is not the list context.
        (URI, URI) pair   Two instances of the Perl URI class,
                          their values are a relative reference and
                          an absolute URI reference respectively,
                          if the context where this method is called
                          is the list (array) context.  Note that
                          the first object may be the same object
                          as the second if no base URI is provided
                          or the URI schemes does not allow the computation
                          of relative reference.

    uriIsPartOfWiki
    
      Tests whether a URI reference is "part of" this wiki or not.
      The algorithm to detect whether a URI is part of wiki
      is implementation dependent.
      
      Parameters
        uriReference of type DOMString
          An absolute URI reference to test.
      
      Return Value
      
        boolean
    
    name
    
      Creates a WikiName object from an implementation dependent
      literal name format.
      
      Parameters
        name of type DOMString
          A serialized WikiName.
        (named parameters)
          Passed to the constructor if necessary.
    
    closeInput
      Closes the input manager, i.e. $obj->{input}, if it is opened.
      An "input_close" event is raised just before the call of
      "exit" method of the input manager.
    
    closeView
      Closes the WikiView manager, i.e. $obj->{view}, if it is loaded.
    
    closeDB
      Closes the WikiDB, i.e. $obj->{db}, if it is loaded.
      A "database_closed" event is raised just before the call of
      "close" method of the database.
    
    closePlugin
      Closes the WikiPlugin manager, i.e. $obj->{plugin}, if it is loaded.
    
    exit
      Notifies that this wiki object is no longer used.  This 
      method closes:
        - input manager ($obj->{input}),
        - WikiDB ($obj->{db}),
        - WikiView manager ($obj->{view}) and
        - WikiPlugin manager ($obj->{plugin})
      ... preceded by the raising of a "close" event.  If the "close"
      event is canceled, this method results in no closing and
      just returns the false.
          This method is implicitly called before the destruction
      of this wiki object.

  Attributes
    config of type hash
      Session-independent persistent configuration parameters.
    db of type SW3Database, read-only
      The WikiDB object associated with this wiki object,
      or null if not exist.
    driverName of type DOMString
      The product name of the WikiDriver.  For interoperability, only
      alphanumeric characters and limited symbols should be used
      (see RFC 2616 "token" definition).
    driverVersion of type DOMString
      The product version of the WikiDriver.  For interoperability, only
      alphanumeric characters and limited symbols should be used
      (see RFC 2616 "token" definition).
    engineName of type DOMString, read-only
      The product name of the WikiEngine.  For interoperability, only
      alphanumeric characters and limited symbols should be used
      (see RFC 2616 "token" definition).
    engineVersion of type DOMString, read-only
      The product version of the WikiEngine.  For interoperability, only
      alphanumeric characters and limited symbols should be used
      (see RFC 2616 "token" definition).
    input of type SW3Input
      The WikiInput object associated with this wiki object,
      or null if not exist.
    plugin of type SW3Plugin, read-only
      The WikiPlugin manager associated with this wiki object,
      or null if not exist.
    var of type hash
      Per-session variables.
    view of type SW3ViewImplementation, read-only
      The WikiView manager associated with this wiki object,
      or null if not exist.
  
  Events
    close, cancelable
    database_close
    database_loaded
    plugin_manager_loaded
    setting_initial_variables
    view_error, only bubble phase
    view_in_mode
]PRE]

[PRE[
Interface SW3EventTarget
  Attributes
    event of type hash
      $obj->{event}->{ event-name } is an array reference containing
      event handler CODE references.  Each event handlers are 
      called in the order of this array.
]PRE]

[PRE[
Interface SW3Plugin
  The plugin manager.
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Plugin.pm?rev=1.17>
  
  Attributes
    wiki of type SW3Implementation, read-only
      The wiki object associated to this plugin manager.
  
  Methods
    exit
      Declares that this object is no longer used.  Note that this method
      does not need to call explicitly.
]PRE]

[PRE[
Exception SW3PluginException
  Constant Group SW3PluginExceptionCode
    Constants
      PLUGIN_COMPILE_ERROR
        The plugin manager has encounted to some error
        during the load of a file containing plugins.
        
        Error Parameters
          file of type DOMString, required
            An environment dependent file name string of the file the
            plugin manager attempted to load.
          message of type DOMString
            An implementation dependent (possibily human readable) error
            message describing what has been happend.
    
      PLUGIN_DIRECTORY_CANT_OPEN
        The plugin manager has encounted to some error 
        durign the open of a directory containing plugin files.
        
        Error Parameters
          file of type DOMString, required
            An environment dependent directory name string of the directory
            the plugin manager attempted to open.
          message of type DOMString
            An implementation dependent (possibily human readable) error
            message describing what has been happend.
      
      PLUGIN_NOT_FOUND
        The specified plugin module is not found.
        
        Error Parameters
          module of type DOMString, required
            The module name (in implementation dependent syntax) requested.
]PRE]

[PRE[
Interface SW3ViewImplementation
  The wiki view implementation object.
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/View/Implementation.pm?rev=1.9>.
  
  Attributes
    wiki of type SW3Implementation, read-only
      The wiki object associated with this view manager.
  
  Methods
    exit
      Declares that this object is no longer used.  Note that
      this method does not need to be called explicitly.
    initDB
      Initializes the wiki database by calling "initDB" method of 
      the "wiki" attribute.
    instantiate
      Instantiates a view.  This method first selects a view by
      calling the "select" method and then instantiates the view definition,
      return ed by the "select" method.  Instantiation of a view definition
      is done by the instantiation of the class specified by the
      "objectClass" attribute of the view definition or by
      the call of the handler set to the "objectInit" attribute and the insntatiated
      object is set to the "object" attribute of it.  Note that
      this step is skipped if the "object" attribute already has a value.
      
      Parameters
        mode of type DOMString
          The implementation dependent wiki mode name of the view.
        opt of type hash
          A Perl hash which provides the condition by which a view is selected.
      Return Value
        SW3View  The insntatiated view object or "null" if no view
                 met the condition is available.
    select
      Selects a view definition that met the given condition.
      
      Parameters
        mode of type DOMString
          The implementation dependent wiki mode name from
          which a view is selected.
        opt of type hash
          A Perl hash which provides the condition.  The "condition" 
          value must be an SW3ViewCondition object.
      Return Value
        SW3ViewDefinition  The selected view definition, if any,
                           or "null" otherwise.
    registerMode
      Registers a view definition.
      
      Parameters
        mode of type DOMString
          The implementation dependent wiki mode name to which the
          view is installed.
        view of type SW3ViewDefinition
          A view definition.
]PRE]

[PRE[
Interface SW3ViewDefinition
  Attributes
    condition of type SW3ViewCondition, read-only
      The condition to which any attemption to instantiate this
      view must be met.
    view of type SW3View
      The view object instantiated from this definition if any.
    viewClass of type DOMString
      A binding dependent class name.  A binding dependent
      instantiation mechanism using this class name should
      provide an instance of the view.  If the value is "null",
      no such class name is available.
    viewInit of type code
      A binding dependent code reference, which provides
      an instance of the view.  If the value is "null", no
      such code is available.
]PRE]

[PRE[
Interface SW3ViewCondition
  Attributes
    mode of type DOMString
      The implementation dependent wiki mode name.
]PRE]

[PRE[
Interface SW3View
  Methods
    main
      This method is called to process the session.
      
      Parameter
        opt of type hash
          A hash reference which provides information on the session.
]PRE]

[PRE[
Exception SW3ViewException
  VIEW_NOT_DEFINED
    The specified view is not defined so that the process must be stopped.
  WARN_VIEW_NOT_DEFINED
    The specified view is not defined.
]PRE]

[PRE[
Interface SW3Database
  An interface which abstracts databases which contains data handled
  by the SuikaWiki WikiEngine.
    Any kind of physical "database" can be accessed via this interface;
  for example, either relational databases, 
  DBM implementations, some formatted text files, etc. or their combinations
  can be used.  It may be a file or some mapping to file system entities.
  Even non-persistent resources such as Perl hash and remote
  resources can be part of the database.
    In the SuikaWiki3 WikiDatabase system, a database is a two-dimension
  array whose values are identified by properties and keys.  A key is a
  linear array, where the last element is referred as "key leaf" and
  any other elements as "key namespace".  The zero-element key namespace
  is also known as the "root".  A property name is a string.  A value
  is a Perl scalar data.  Note that an implementation of the interface
  may impose constraints to these constructions.
  <http://suika.fam.cx/gate/2005/sw/SuikaWiki3/WikiDB>
  
  Methods
    close
      Closes the database.  It closes all properties and any locks may 
      be unlocked. 
    closeProp
      Closes a property in the database.
      
      Return Value
        "0 but true" if a property cannot be closed alone,
    delete
      Parameters
        prop of type DOMString
        key of type array
    exist
      Parameters
        prop of type DOMString
        key of type array
    get
      Parameters
        prop of type DOMString
        key of type array
    keys
      Parameters
        prop of type DOMString
      Return Value
        (key1, key2, key3, ..., keyn)
    open
      Opens the database.  If the database is already opened, no effect.
      Note that the implementation may choose to open the database in
      any time including when the object is instantiated and
      when the actual access to the database is requested 
      and not to open the database when this method is called.
    openProp
      Opens a property in the database if there are one or more properties
      and they can be opened or closed separately.
      
      Return Value
        1 if succssed, 0 if failed, "0 but true" if it is alrady opened.
    set
      Parameters
        prop of type DOMString
        key of type array
        value of type DOMObject
]PRE]

[PRE[
Interface SW3Name
  Wiki names.
  
  In the Perl binding, the "eq" and "ne" operators is overloaded so that
  the "eq" or "ne" operation to two SW3Name objects returns whether 
  they are "(not) equal" or not.  The "@@{}" operator is overloaded
  so that the "@@{}" operation for a SW3Name objects returns
  the Perl array representation of the wiki name.
  
  In the Perl binding, the constructor method "new" takes
  two parameters: "$name" and "%options" (named parameters).
  The $name represents a wiki name, either in the implementation
  dependent textual format, as a Perl array reference or
  as a SW3Name object.  How the array references are mapped to
  the actual wiki name is implementation dependent.
  The %options must include at least one of three named parameters:
  "wiki" whose value is the wiki object implementing the SW3Implementation
  interface, the "delimiter" whose value is the delimiter
  used in the textual format or the "dlimiter_reg" whose
  value is the regular expression object for the delimiter.
  Note that how the textual wiki name
  is interpreted against the delimiter is implementation dependent.
  The optional "root" parameter may be used to resolve an implementation
  dependent "root" wiki names.
  
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Name.pm?rev=1.4>
  
  Methods
  
    absolute
      Resolves this wiki name against a base wiki name.  The resolution
      algorithm is implementation dependent.
      
      Parameters
        base of type SW3Name, named
          The base wiki name.  This parameter is required.
        nearest of type SW3Name, named
          Whether the "nearest" existing wiki page should be selected or not.
          The wiki database must be associated with the "wiki" object
          and be opened for reading.
        parent of type DOMString, named
          The "parent" indicator component.  If missing, the default provided
          by "wiki" is used.
        self of type DOMString, named
          The "self" indicator component.  If missing, the default provided
          by "wiki" is used.
        wiki of type SW3Name, named
          The SW3Implementation object which provides the default
          configuration for variable options such as the "parent"
          component.  This parameter is required.
      
      Return Value
        SW3Name  The absolute form of the wiki name.  Even the new form
                 is equal to the original form, a new instance is created.
    
    appendComponent
      Appends one or more wiki name component (whose definition is 
      implementation dependent).
      
      Parameters
        component of type DOMObject
          One or more component to add.  If it is a DOMString,
          it is appended as a component.  Otherwise, the value
          is evaluated as an array reference and whose elements
          are appended as components in that order.
    
    clone
      Creates a new instance of the wiki name object which references
      the same name as this object.
      
      Return Value
        SW3Name  The cloned wiki name object.
    
    preprendComponent
      Prepends one or more wiki name component (whose definition is 
      implementation dependent).
      
      Parameters
        component of type DOMObject
          One or more component to preprend.  If it is a DOMString,
          it is inserted as the first component.  Otherwise, the value
          is evaluated as an array reference and whose elements
          are inserted as components in that order.
    
    stringify
      Returns a textual representation of the wiki name.
      
      Parameters
      
        delimiter of type DOMString, named
          A delimiter string used to serialize the wiki name.
          How the textual representation is constructed with the
          delimiter is implementation dependent.  If missing,
          the "wiki" parameter is required.
        root of type SW3Name, named
          The implementation dependent "root" wiki name.  If missing,
          the default "root" may be used.
        wiki of type SW3Implementation, named
          The SW3Implementation object which may provide the default
          configuration for the serialization including (but not limited to)
          the delimiter.  Either "delimiter" or "wiki" is required.
      
      Return value
      
        DOMString  The textual representation.
]PRE]

[PRE[
Interface SW3Format
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Format/Definition.pm?rev=1.8>
  
  Methods
    contentPropModified
      Called if the content property other than media type has modified.
    contentRemoved
      Called if the content is removed from the database.
    contentTypeChangedFrom
      Called if the media type of the content is changed to this format.
    contentWritten
      Called if the content is written down to the database.
    convert
      Converts an object to another format.
      
      Parameters
        source of type DOMObject
        Named parameters to specify the new format
      Return Value
        DOMObject  Converted object.
      Exception
        SW3FormatException  CONVERTER_NOT_FOUND: No converter available
                            for the format.
    headSummary
      Creates a summary of the content or returns "null" if not available.
    nextIndexForAnchor
      Returns the next numeric index for subresource.
    prop
      Gets the format property value.
      Parameters
        uri of type DOMString
          Identifies the property.
    wikiform
      Submits a WikiForm request to the object.
      
      Parameters
        source of type DOMObject
        Named parameters to provide WikiForm parameters
      Exception
        SW3FormatException  WIKIFORM_NOT_FOUND: WikiForm submittion is not defined
                            for this format.
]PRE]

[PRE[
Interface SW3HTTPInput
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Input/HTTP.pm?rev=1.7>
  
  Attributes
    body of type octet-sequence
      Entity-body of the request if any, or "null" otherwise.
    bodyText of type DOMString
      "body", as string, or "null" if no "body".
    decoder of type hash
      Decoder code references to convert octet sequences to character sequences.
      Parameter values are decoded by the decoder whose hash key matched
      to the decoded parameter name, if any, or by the "#default" decoder.
      Parameter naems are decoded by the "#name" decoder, if any,
      or the "#default" decoder.
    metaVariableList of type array
      The list of available meta-variables.  It may contain other
      environmental variables.
    parameterNames of type array
      The list of available parameters.
    requestURI of type DOMString
      The request-URI of the request.  It is an absolute URI without 
      fragment identifier.  "null" if uncomputable.
  
  Methods
    exit
      Declreas no longer used.  Don't have to call this.
    metaVariable
      Returns a meta-variable value.  See the CGI/1.1 specification
      for the meta-variables.
      
      Parameters
        name of type DOMString
          The name of the meta-variable to get.
      Return Value
        DOMString  Meta-variable value or "null" if not available.  Note
                   that the meta-variable value itself may also be "null".
    parameter
      Returns a parameter obtained from the query part of the Request-URI
      and/or the entity-body of the request.
      
      Parameters
        name of type DOMString
          The name of the parameter, which is case-sensitive.
      Return Value
        DOMString  The first parameter value whose name matches to "name",
                   or "null" if no such one.  Decoded.
        array of DOMString if in the list context.  It contains all
                   parameter values whose value matches to "name", in the
                   original order.  Note that the query part of the Request-URI
                   is defined as at "before" the entity-body.
]PRE]

[PRE[
Interface SW3HTTPOutput
  <http://suika.fam.cx/gate/cvs/suikawiki/script/lib/SuikaWiki/Output/HTTP.pm?rev=1.7>
  
  Attributes
    entity of hash
      body of DOMString
      charset of DOMString
      language of array of DOMString
      mediaType of DOMString
    statusCode of type unsigned-integer
    statusPharase of type DOMString
    wiki of type SW3Implementation
  
  Methods
    addHeaderField
      Parameters
        name of type DOMString
        body of type DOMString
    addNegotiateHeaderField
      Added to "Vary" header field body later.
      
      Parameters
        name of type DOMString
    appendToBody
    exit
    output
      Named Parameters.
    setExpires
      Named Parameters.
    setLastModified
      Named Parameters.
    setRedirect
      Named Parameters.
]PRE]

[2]
途中で説明書くのが面倒になったとまる分かりだw
([[名無しさん]] [WEAK[2005-07-21 04:34:46 +00:00]])

@
